(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function s(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(c){if(c.ep)return;c.ep=!0;const d=s(c);fetch(c.href,d)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(a){return a===null||typeof a!="object"?null:(a=z$1&&a[z$1]||a["@@iterator"],typeof a=="function"?a:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$2(a,e,s){this.props=a,this.context=e,this.refs=D$1,this.updater=s||B$1}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(a,e){if(typeof a!="object"&&typeof a!="function"&&a!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,a,e,"setState")};E$2.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function F(){}F.prototype=E$2.prototype;function G$1(a,e,s){this.props=a,this.context=e,this.refs=D$1,this.updater=s||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$2.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(a,e,s){var o,c={},d=null,h=null;if(e!=null)for(o in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(d=""+e.key),e)J.call(e,o)&&!L$1.hasOwnProperty(o)&&(c[o]=e[o]);var g=arguments.length-2;if(g===1)c.children=s;else if(1<g){for(var _=Array(g),b=0;b<g;b++)_[b]=arguments[b+2];c.children=_}if(a&&a.defaultProps)for(o in g=a.defaultProps,g)c[o]===void 0&&(c[o]=g[o]);return{$$typeof:l$1,type:a,key:d,ref:h,props:c,_owner:K$1.current}}function N$1(a,e){return{$$typeof:l$1,type:a.type,key:e,ref:a.ref,props:a.props,_owner:a._owner}}function O$1(a){return typeof a=="object"&&a!==null&&a.$$typeof===l$1}function escape(a){var e={"=":"=0",":":"=2"};return"$"+a.replace(/[=:]/g,function(s){return e[s]})}var P$1=/\/+/g;function Q$1(a,e){return typeof a=="object"&&a!==null&&a.key!=null?escape(""+a.key):e.toString(36)}function R$2(a,e,s,o,c){var d=typeof a;(d==="undefined"||d==="boolean")&&(a=null);var h=!1;if(a===null)h=!0;else switch(d){case"string":case"number":h=!0;break;case"object":switch(a.$$typeof){case l$1:case n$1:h=!0}}if(h)return h=a,c=c(h),a=o===""?"."+Q$1(h,0):o,I$1(c)?(s="",a!=null&&(s=a.replace(P$1,"$&/")+"/"),R$2(c,e,s,"",function(b){return b})):c!=null&&(O$1(c)&&(c=N$1(c,s+(!c.key||h&&h.key===c.key?"":(""+c.key).replace(P$1,"$&/")+"/")+a)),e.push(c)),1;if(h=0,o=o===""?".":o+":",I$1(a))for(var g=0;g<a.length;g++){d=a[g];var _=o+Q$1(d,g);h+=R$2(d,e,s,_,c)}else if(_=A$1(a),typeof _=="function")for(a=_.call(a),g=0;!(d=a.next()).done;)d=d.value,_=o+Q$1(d,g++),h+=R$2(d,e,s,_,c);else if(d==="object")throw e=String(a),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function S$1(a,e,s){if(a==null)return a;var o=[],c=0;return R$2(a,o,"","",function(d){return e.call(s,d,c++)}),o}function T$1(a){if(a._status===-1){var e=a._result;e=e(),e.then(function(s){(a._status===0||a._status===-1)&&(a._status=1,a._result=s)},function(s){(a._status===0||a._status===-1)&&(a._status=2,a._result=s)}),a._status===-1&&(a._status=0,a._result=e)}if(a._status===1)return a._result.default;throw a._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(a,e,s){S$1(a,function(){e.apply(this,arguments)},s)},count:function(a){var e=0;return S$1(a,function(){e++}),e},toArray:function(a){return S$1(a,function(e){return e})||[]},only:function(a){if(!O$1(a))throw Error("React.Children.only expected to receive a single React element child.");return a}};react_production_min.Component=E$2;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(a,e,s){if(a==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+a+".");var o=C$1({},a.props),c=a.key,d=a.ref,h=a._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,h=K$1.current),e.key!==void 0&&(c=""+e.key),a.type&&a.type.defaultProps)var g=a.type.defaultProps;for(_ in e)J.call(e,_)&&!L$1.hasOwnProperty(_)&&(o[_]=e[_]===void 0&&g!==void 0?g[_]:e[_])}var _=arguments.length-2;if(_===1)o.children=s;else if(1<_){g=Array(_);for(var b=0;b<_;b++)g[b]=arguments[b+2];o.children=g}return{$$typeof:l$1,type:a.type,key:c,ref:d,props:o,_owner:h}};react_production_min.createContext=function(a){return a={$$typeof:u,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},a.Provider={$$typeof:t,_context:a},a.Consumer=a};react_production_min.createElement=M$1;react_production_min.createFactory=function(a){var e=M$1.bind(null,a);return e.type=a,e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(a){return{$$typeof:v$1,render:a}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(a){return{$$typeof:y,_payload:{_status:-1,_result:a},_init:T$1}};react_production_min.memo=function(a,e){return{$$typeof:x,type:a,compare:e===void 0?null:e}};react_production_min.startTransition=function(a){var e=V$1.transition;V$1.transition={};try{a()}finally{V$1.transition=e}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(a,e){return U$1.current.useCallback(a,e)};react_production_min.useContext=function(a){return U$1.current.useContext(a)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(a){return U$1.current.useDeferredValue(a)};react_production_min.useEffect=function(a,e){return U$1.current.useEffect(a,e)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(a,e,s){return U$1.current.useImperativeHandle(a,e,s)};react_production_min.useInsertionEffect=function(a,e){return U$1.current.useInsertionEffect(a,e)};react_production_min.useLayoutEffect=function(a,e){return U$1.current.useLayoutEffect(a,e)};react_production_min.useMemo=function(a,e){return U$1.current.useMemo(a,e)};react_production_min.useReducer=function(a,e,s){return U$1.current.useReducer(a,e,s)};react_production_min.useRef=function(a){return U$1.current.useRef(a)};react_production_min.useState=function(a){return U$1.current.useState(a)};react_production_min.useSyncExternalStore=function(a,e,s){return U$1.current.useSyncExternalStore(a,e,s)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs$1(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(a,e,s){var o,c={},d=null,h=null;s!==void 0&&(d=""+s),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(h=e.ref);for(o in e)m$1.call(e,o)&&!p$1.hasOwnProperty(o)&&(c[o]=e[o]);if(a&&a.defaultProps)for(o in e=a.defaultProps,e)c[o]===void 0&&(c[o]=e[o]);return{$$typeof:k,type:a,key:d,ref:h,props:c,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup[45]=62;revLookup[95]=63;function getLens(a){var e=a.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=a.indexOf("=");s===-1&&(s=e);var o=s===e?0:4-s%4;return[s,o]}function byteLength(a){var e=getLens(a),s=e[0],o=e[1];return(s+o)*3/4-o}function _byteLength(a,e,s){return(e+s)*3/4-s}function toByteArray(a){var e,s=getLens(a),o=s[0],c=s[1],d=new Arr(_byteLength(a,o,c)),h=0,g=c>0?o-4:o,_;for(_=0;_<g;_+=4)e=revLookup[a.charCodeAt(_)]<<18|revLookup[a.charCodeAt(_+1)]<<12|revLookup[a.charCodeAt(_+2)]<<6|revLookup[a.charCodeAt(_+3)],d[h++]=e>>16&255,d[h++]=e>>8&255,d[h++]=e&255;return c===2&&(e=revLookup[a.charCodeAt(_)]<<2|revLookup[a.charCodeAt(_+1)]>>4,d[h++]=e&255),c===1&&(e=revLookup[a.charCodeAt(_)]<<10|revLookup[a.charCodeAt(_+1)]<<4|revLookup[a.charCodeAt(_+2)]>>2,d[h++]=e>>8&255,d[h++]=e&255),d}function tripletToBase64(a){return lookup[a>>18&63]+lookup[a>>12&63]+lookup[a>>6&63]+lookup[a&63]}function encodeChunk(a,e,s){for(var o,c=[],d=e;d<s;d+=3)o=(a[d]<<16&16711680)+(a[d+1]<<8&65280)+(a[d+2]&255),c.push(tripletToBase64(o));return c.join("")}function fromByteArray(a){for(var e,s=a.length,o=s%3,c=[],d=16383,h=0,g=s-o;h<g;h+=d)c.push(encodeChunk(a,h,h+d>g?g:h+d));return o===1?(e=a[s-1],c.push(lookup[e>>2]+lookup[e<<4&63]+"==")):o===2&&(e=(a[s-2]<<8)+a[s-1],c.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),c.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(a,e,s,o,c){var d,h,g=c*8-o-1,_=(1<<g)-1,b=_>>1,$=-7,j=s?c-1:0,_e=s?-1:1,tt=a[e+j];for(j+=_e,d=tt&(1<<-$)-1,tt>>=-$,$+=g;$>0;d=d*256+a[e+j],j+=_e,$-=8);for(h=d&(1<<-$)-1,d>>=-$,$+=o;$>0;h=h*256+a[e+j],j+=_e,$-=8);if(d===0)d=1-b;else{if(d===_)return h?NaN:(tt?-1:1)*(1/0);h=h+Math.pow(2,o),d=d-b}return(tt?-1:1)*h*Math.pow(2,d-o)};ieee754.write=function(a,e,s,o,c,d){var h,g,_,b=d*8-c-1,$=(1<<b)-1,j=$>>1,_e=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,tt=o?0:d-1,rt=o?1:-1,nt=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,h=$):(h=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-h))<1&&(h--,_*=2),h+j>=1?e+=_e/_:e+=_e*Math.pow(2,1-j),e*_>=2&&(h++,_/=2),h+j>=$?(g=0,h=$):h+j>=1?(g=(e*_-1)*Math.pow(2,c),h=h+j):(g=e*Math.pow(2,j-1)*Math.pow(2,c),h=0));c>=8;a[s+tt]=g&255,tt+=rt,g/=256,c-=8);for(h=h<<c|g,b+=c;b>0;a[s+tt]=h&255,tt+=rt,h/=256,b-=8);a[s+tt-rt]|=nt*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(a){const e=base64Js,s=ieee754,o=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;a.Buffer=g,a.SlowBuffer=ot,a.INSPECT_MAX_BYTES=50;const c=2147483647;a.kMaxLength=c,g.TYPED_ARRAY_SUPPORT=d(),!g.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{const Tt=new Uint8Array(1),ct={foo:function(){return 42}};return Object.setPrototypeOf(ct,Uint8Array.prototype),Object.setPrototypeOf(Tt,ct),Tt.foo()===42}catch{return!1}}Object.defineProperty(g.prototype,"parent",{enumerable:!0,get:function(){if(g.isBuffer(this))return this.buffer}}),Object.defineProperty(g.prototype,"offset",{enumerable:!0,get:function(){if(g.isBuffer(this))return this.byteOffset}});function h(Tt){if(Tt>c)throw new RangeError('The value "'+Tt+'" is invalid for option "size"');const ct=new Uint8Array(Tt);return Object.setPrototypeOf(ct,g.prototype),ct}function g(Tt,ct,ft){if(typeof Tt=="number"){if(typeof ct=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return j(Tt)}return _(Tt,ct,ft)}g.poolSize=8192;function _(Tt,ct,ft){if(typeof Tt=="string")return _e(Tt,ct);if(ArrayBuffer.isView(Tt))return rt(Tt);if(Tt==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Tt);if(xr(Tt,ArrayBuffer)||Tt&&xr(Tt.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(xr(Tt,SharedArrayBuffer)||Tt&&xr(Tt.buffer,SharedArrayBuffer)))return nt(Tt,ct,ft);if(typeof Tt=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const At=Tt.valueOf&&Tt.valueOf();if(At!=null&&At!==Tt)return g.from(At,ct,ft);const Pt=st(Tt);if(Pt)return Pt;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Tt[Symbol.toPrimitive]=="function")return g.from(Tt[Symbol.toPrimitive]("string"),ct,ft);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Tt)}g.from=function(Tt,ct,ft){return _(Tt,ct,ft)},Object.setPrototypeOf(g.prototype,Uint8Array.prototype),Object.setPrototypeOf(g,Uint8Array);function b(Tt){if(typeof Tt!="number")throw new TypeError('"size" argument must be of type number');if(Tt<0)throw new RangeError('The value "'+Tt+'" is invalid for option "size"')}function $(Tt,ct,ft){return b(Tt),Tt<=0?h(Tt):ct!==void 0?typeof ft=="string"?h(Tt).fill(ct,ft):h(Tt).fill(ct):h(Tt)}g.alloc=function(Tt,ct,ft){return $(Tt,ct,ft)};function j(Tt){return b(Tt),h(Tt<0?0:at(Tt)|0)}g.allocUnsafe=function(Tt){return j(Tt)},g.allocUnsafeSlow=function(Tt){return j(Tt)};function _e(Tt,ct){if((typeof ct!="string"||ct==="")&&(ct="utf8"),!g.isEncoding(ct))throw new TypeError("Unknown encoding: "+ct);const ft=ut(Tt,ct)|0;let At=h(ft);const Pt=At.write(Tt,ct);return Pt!==ft&&(At=At.slice(0,Pt)),At}function tt(Tt){const ct=Tt.length<0?0:at(Tt.length)|0,ft=h(ct);for(let At=0;At<ct;At+=1)ft[At]=Tt[At]&255;return ft}function rt(Tt){if(xr(Tt,Uint8Array)){const ct=new Uint8Array(Tt);return nt(ct.buffer,ct.byteOffset,ct.byteLength)}return tt(Tt)}function nt(Tt,ct,ft){if(ct<0||Tt.byteLength<ct)throw new RangeError('"offset" is outside of buffer bounds');if(Tt.byteLength<ct+(ft||0))throw new RangeError('"length" is outside of buffer bounds');let At;return ct===void 0&&ft===void 0?At=new Uint8Array(Tt):ft===void 0?At=new Uint8Array(Tt,ct):At=new Uint8Array(Tt,ct,ft),Object.setPrototypeOf(At,g.prototype),At}function st(Tt){if(g.isBuffer(Tt)){const ct=at(Tt.length)|0,ft=h(ct);return ft.length===0||Tt.copy(ft,0,0,ct),ft}if(Tt.length!==void 0)return typeof Tt.length!="number"||Hr(Tt.length)?h(0):tt(Tt);if(Tt.type==="Buffer"&&Array.isArray(Tt.data))return tt(Tt.data)}function at(Tt){if(Tt>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return Tt|0}function ot(Tt){return+Tt!=Tt&&(Tt=0),g.alloc(+Tt)}g.isBuffer=function(ct){return ct!=null&&ct._isBuffer===!0&&ct!==g.prototype},g.compare=function(ct,ft){if(xr(ct,Uint8Array)&&(ct=g.from(ct,ct.offset,ct.byteLength)),xr(ft,Uint8Array)&&(ft=g.from(ft,ft.offset,ft.byteLength)),!g.isBuffer(ct)||!g.isBuffer(ft))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ct===ft)return 0;let At=ct.length,Pt=ft.length;for(let Kt=0,Jt=Math.min(At,Pt);Kt<Jt;++Kt)if(ct[Kt]!==ft[Kt]){At=ct[Kt],Pt=ft[Kt];break}return At<Pt?-1:Pt<At?1:0},g.isEncoding=function(ct){switch(String(ct).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(ct,ft){if(!Array.isArray(ct))throw new TypeError('"list" argument must be an Array of Buffers');if(ct.length===0)return g.alloc(0);let At;if(ft===void 0)for(ft=0,At=0;At<ct.length;++At)ft+=ct[At].length;const Pt=g.allocUnsafe(ft);let Kt=0;for(At=0;At<ct.length;++At){let Jt=ct[At];if(xr(Jt,Uint8Array))Kt+Jt.length>Pt.length?(g.isBuffer(Jt)||(Jt=g.from(Jt)),Jt.copy(Pt,Kt)):Uint8Array.prototype.set.call(Pt,Jt,Kt);else if(g.isBuffer(Jt))Jt.copy(Pt,Kt);else throw new TypeError('"list" argument must be an Array of Buffers');Kt+=Jt.length}return Pt};function ut(Tt,ct){if(g.isBuffer(Tt))return Tt.length;if(ArrayBuffer.isView(Tt)||xr(Tt,ArrayBuffer))return Tt.byteLength;if(typeof Tt!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Tt);const ft=Tt.length,At=arguments.length>2&&arguments[2]===!0;if(!At&&ft===0)return 0;let Pt=!1;for(;;)switch(ct){case"ascii":case"latin1":case"binary":return ft;case"utf8":case"utf-8":return pr(Tt).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ft*2;case"hex":return ft>>>1;case"base64":return Ar(Tt).length;default:if(Pt)return At?-1:pr(Tt).length;ct=(""+ct).toLowerCase(),Pt=!0}}g.byteLength=ut;function mt(Tt,ct,ft){let At=!1;if((ct===void 0||ct<0)&&(ct=0),ct>this.length||((ft===void 0||ft>this.length)&&(ft=this.length),ft<=0)||(ft>>>=0,ct>>>=0,ft<=ct))return"";for(Tt||(Tt="utf8");;)switch(Tt){case"hex":return Yt(this,ct,ft);case"utf8":case"utf-8":return rr(this,ct,ft);case"ascii":return tr(this,ct,ft);case"latin1":case"binary":return Ft(this,ct,ft);case"base64":return Dt(this,ct,ft);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qt(this,ct,ft);default:if(At)throw new TypeError("Unknown encoding: "+Tt);Tt=(Tt+"").toLowerCase(),At=!0}}g.prototype._isBuffer=!0;function yt(Tt,ct,ft){const At=Tt[ct];Tt[ct]=Tt[ft],Tt[ft]=At}g.prototype.swap16=function(){const ct=this.length;if(ct%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let ft=0;ft<ct;ft+=2)yt(this,ft,ft+1);return this},g.prototype.swap32=function(){const ct=this.length;if(ct%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let ft=0;ft<ct;ft+=4)yt(this,ft,ft+3),yt(this,ft+1,ft+2);return this},g.prototype.swap64=function(){const ct=this.length;if(ct%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let ft=0;ft<ct;ft+=8)yt(this,ft,ft+7),yt(this,ft+1,ft+6),yt(this,ft+2,ft+5),yt(this,ft+3,ft+4);return this},g.prototype.toString=function(){const ct=this.length;return ct===0?"":arguments.length===0?rr(this,0,ct):mt.apply(this,arguments)},g.prototype.toLocaleString=g.prototype.toString,g.prototype.equals=function(ct){if(!g.isBuffer(ct))throw new TypeError("Argument must be a Buffer");return this===ct?!0:g.compare(this,ct)===0},g.prototype.inspect=function(){let ct="";const ft=a.INSPECT_MAX_BYTES;return ct=this.toString("hex",0,ft).replace(/(.{2})/g,"$1 ").trim(),this.length>ft&&(ct+=" ... "),"<Buffer "+ct+">"},o&&(g.prototype[o]=g.prototype.inspect),g.prototype.compare=function(ct,ft,At,Pt,Kt){if(xr(ct,Uint8Array)&&(ct=g.from(ct,ct.offset,ct.byteLength)),!g.isBuffer(ct))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ct);if(ft===void 0&&(ft=0),At===void 0&&(At=ct?ct.length:0),Pt===void 0&&(Pt=0),Kt===void 0&&(Kt=this.length),ft<0||At>ct.length||Pt<0||Kt>this.length)throw new RangeError("out of range index");if(Pt>=Kt&&ft>=At)return 0;if(Pt>=Kt)return-1;if(ft>=At)return 1;if(ft>>>=0,At>>>=0,Pt>>>=0,Kt>>>=0,this===ct)return 0;let Jt=Kt-Pt,wr=At-ft;const Br=Math.min(Jt,wr),dr=this.slice(Pt,Kt),Gr=ct.slice(ft,At);for(let Lr=0;Lr<Br;++Lr)if(dr[Lr]!==Gr[Lr]){Jt=dr[Lr],wr=Gr[Lr];break}return Jt<wr?-1:wr<Jt?1:0};function Et(Tt,ct,ft,At,Pt){if(Tt.length===0)return-1;if(typeof ft=="string"?(At=ft,ft=0):ft>2147483647?ft=2147483647:ft<-2147483648&&(ft=-2147483648),ft=+ft,Hr(ft)&&(ft=Pt?0:Tt.length-1),ft<0&&(ft=Tt.length+ft),ft>=Tt.length){if(Pt)return-1;ft=Tt.length-1}else if(ft<0)if(Pt)ft=0;else return-1;if(typeof ct=="string"&&(ct=g.from(ct,At)),g.isBuffer(ct))return ct.length===0?-1:dt(Tt,ct,ft,At,Pt);if(typeof ct=="number")return ct=ct&255,typeof Uint8Array.prototype.indexOf=="function"?Pt?Uint8Array.prototype.indexOf.call(Tt,ct,ft):Uint8Array.prototype.lastIndexOf.call(Tt,ct,ft):dt(Tt,[ct],ft,At,Pt);throw new TypeError("val must be string, number or Buffer")}function dt(Tt,ct,ft,At,Pt){let Kt=1,Jt=Tt.length,wr=ct.length;if(At!==void 0&&(At=String(At).toLowerCase(),At==="ucs2"||At==="ucs-2"||At==="utf16le"||At==="utf-16le")){if(Tt.length<2||ct.length<2)return-1;Kt=2,Jt/=2,wr/=2,ft/=2}function Br(Gr,Lr){return Kt===1?Gr[Lr]:Gr.readUInt16BE(Lr*Kt)}let dr;if(Pt){let Gr=-1;for(dr=ft;dr<Jt;dr++)if(Br(Tt,dr)===Br(ct,Gr===-1?0:dr-Gr)){if(Gr===-1&&(Gr=dr),dr-Gr+1===wr)return Gr*Kt}else Gr!==-1&&(dr-=dr-Gr),Gr=-1}else for(ft+wr>Jt&&(ft=Jt-wr),dr=ft;dr>=0;dr--){let Gr=!0;for(let Lr=0;Lr<wr;Lr++)if(Br(Tt,dr+Lr)!==Br(ct,Lr)){Gr=!1;break}if(Gr)return dr}return-1}g.prototype.includes=function(ct,ft,At){return this.indexOf(ct,ft,At)!==-1},g.prototype.indexOf=function(ct,ft,At){return Et(this,ct,ft,At,!0)},g.prototype.lastIndexOf=function(ct,ft,At){return Et(this,ct,ft,At,!1)};function gt(Tt,ct,ft,At){ft=Number(ft)||0;const Pt=Tt.length-ft;At?(At=Number(At),At>Pt&&(At=Pt)):At=Pt;const Kt=ct.length;At>Kt/2&&(At=Kt/2);let Jt;for(Jt=0;Jt<At;++Jt){const wr=parseInt(ct.substr(Jt*2,2),16);if(Hr(wr))return Jt;Tt[ft+Jt]=wr}return Jt}function St(Tt,ct,ft,At){return Ur(pr(ct,Tt.length-ft),Tt,ft,At)}function xt(Tt,ct,ft,At){return Ur(kr(ct),Tt,ft,At)}function Ct(Tt,ct,ft,At){return Ur(Ar(ct),Tt,ft,At)}function Ht(Tt,ct,ft,At){return Ur(Or(ct,Tt.length-ft),Tt,ft,At)}g.prototype.write=function(ct,ft,At,Pt){if(ft===void 0)Pt="utf8",At=this.length,ft=0;else if(At===void 0&&typeof ft=="string")Pt=ft,At=this.length,ft=0;else if(isFinite(ft))ft=ft>>>0,isFinite(At)?(At=At>>>0,Pt===void 0&&(Pt="utf8")):(Pt=At,At=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Kt=this.length-ft;if((At===void 0||At>Kt)&&(At=Kt),ct.length>0&&(At<0||ft<0)||ft>this.length)throw new RangeError("Attempt to write outside buffer bounds");Pt||(Pt="utf8");let Jt=!1;for(;;)switch(Pt){case"hex":return gt(this,ct,ft,At);case"utf8":case"utf-8":return St(this,ct,ft,At);case"ascii":case"latin1":case"binary":return xt(this,ct,ft,At);case"base64":return Ct(this,ct,ft,At);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ht(this,ct,ft,At);default:if(Jt)throw new TypeError("Unknown encoding: "+Pt);Pt=(""+Pt).toLowerCase(),Jt=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Dt(Tt,ct,ft){return ct===0&&ft===Tt.length?e.fromByteArray(Tt):e.fromByteArray(Tt.slice(ct,ft))}function rr(Tt,ct,ft){ft=Math.min(Tt.length,ft);const At=[];let Pt=ct;for(;Pt<ft;){const Kt=Tt[Pt];let Jt=null,wr=Kt>239?4:Kt>223?3:Kt>191?2:1;if(Pt+wr<=ft){let Br,dr,Gr,Lr;switch(wr){case 1:Kt<128&&(Jt=Kt);break;case 2:Br=Tt[Pt+1],(Br&192)===128&&(Lr=(Kt&31)<<6|Br&63,Lr>127&&(Jt=Lr));break;case 3:Br=Tt[Pt+1],dr=Tt[Pt+2],(Br&192)===128&&(dr&192)===128&&(Lr=(Kt&15)<<12|(Br&63)<<6|dr&63,Lr>2047&&(Lr<55296||Lr>57343)&&(Jt=Lr));break;case 4:Br=Tt[Pt+1],dr=Tt[Pt+2],Gr=Tt[Pt+3],(Br&192)===128&&(dr&192)===128&&(Gr&192)===128&&(Lr=(Kt&15)<<18|(Br&63)<<12|(dr&63)<<6|Gr&63,Lr>65535&&Lr<1114112&&(Jt=Lr))}}Jt===null?(Jt=65533,wr=1):Jt>65535&&(Jt-=65536,At.push(Jt>>>10&1023|55296),Jt=56320|Jt&1023),At.push(Jt),Pt+=wr}return qt(At)}const er=4096;function qt(Tt){const ct=Tt.length;if(ct<=er)return String.fromCharCode.apply(String,Tt);let ft="",At=0;for(;At<ct;)ft+=String.fromCharCode.apply(String,Tt.slice(At,At+=er));return ft}function tr(Tt,ct,ft){let At="";ft=Math.min(Tt.length,ft);for(let Pt=ct;Pt<ft;++Pt)At+=String.fromCharCode(Tt[Pt]&127);return At}function Ft(Tt,ct,ft){let At="";ft=Math.min(Tt.length,ft);for(let Pt=ct;Pt<ft;++Pt)At+=String.fromCharCode(Tt[Pt]);return At}function Yt(Tt,ct,ft){const At=Tt.length;(!ct||ct<0)&&(ct=0),(!ft||ft<0||ft>At)&&(ft=At);let Pt="";for(let Kt=ct;Kt<ft;++Kt)Pt+=sn[Tt[Kt]];return Pt}function Qt(Tt,ct,ft){const At=Tt.slice(ct,ft);let Pt="";for(let Kt=0;Kt<At.length-1;Kt+=2)Pt+=String.fromCharCode(At[Kt]+At[Kt+1]*256);return Pt}g.prototype.slice=function(ct,ft){const At=this.length;ct=~~ct,ft=ft===void 0?At:~~ft,ct<0?(ct+=At,ct<0&&(ct=0)):ct>At&&(ct=At),ft<0?(ft+=At,ft<0&&(ft=0)):ft>At&&(ft=At),ft<ct&&(ft=ct);const Pt=this.subarray(ct,ft);return Object.setPrototypeOf(Pt,g.prototype),Pt};function zt(Tt,ct,ft){if(Tt%1!==0||Tt<0)throw new RangeError("offset is not uint");if(Tt+ct>ft)throw new RangeError("Trying to access beyond buffer length")}g.prototype.readUintLE=g.prototype.readUIntLE=function(ct,ft,At){ct=ct>>>0,ft=ft>>>0,At||zt(ct,ft,this.length);let Pt=this[ct],Kt=1,Jt=0;for(;++Jt<ft&&(Kt*=256);)Pt+=this[ct+Jt]*Kt;return Pt},g.prototype.readUintBE=g.prototype.readUIntBE=function(ct,ft,At){ct=ct>>>0,ft=ft>>>0,At||zt(ct,ft,this.length);let Pt=this[ct+--ft],Kt=1;for(;ft>0&&(Kt*=256);)Pt+=this[ct+--ft]*Kt;return Pt},g.prototype.readUint8=g.prototype.readUInt8=function(ct,ft){return ct=ct>>>0,ft||zt(ct,1,this.length),this[ct]},g.prototype.readUint16LE=g.prototype.readUInt16LE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,2,this.length),this[ct]|this[ct+1]<<8},g.prototype.readUint16BE=g.prototype.readUInt16BE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,2,this.length),this[ct]<<8|this[ct+1]},g.prototype.readUint32LE=g.prototype.readUInt32LE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,4,this.length),(this[ct]|this[ct+1]<<8|this[ct+2]<<16)+this[ct+3]*16777216},g.prototype.readUint32BE=g.prototype.readUInt32BE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,4,this.length),this[ct]*16777216+(this[ct+1]<<16|this[ct+2]<<8|this[ct+3])},g.prototype.readBigUInt64LE=Xr(function(ct){ct=ct>>>0,Bt(ct,"offset");const ft=this[ct],At=this[ct+7];(ft===void 0||At===void 0)&&Vt(ct,this.length-8);const Pt=ft+this[++ct]*2**8+this[++ct]*2**16+this[++ct]*2**24,Kt=this[++ct]+this[++ct]*2**8+this[++ct]*2**16+At*2**24;return BigInt(Pt)+(BigInt(Kt)<<BigInt(32))}),g.prototype.readBigUInt64BE=Xr(function(ct){ct=ct>>>0,Bt(ct,"offset");const ft=this[ct],At=this[ct+7];(ft===void 0||At===void 0)&&Vt(ct,this.length-8);const Pt=ft*2**24+this[++ct]*2**16+this[++ct]*2**8+this[++ct],Kt=this[++ct]*2**24+this[++ct]*2**16+this[++ct]*2**8+At;return(BigInt(Pt)<<BigInt(32))+BigInt(Kt)}),g.prototype.readIntLE=function(ct,ft,At){ct=ct>>>0,ft=ft>>>0,At||zt(ct,ft,this.length);let Pt=this[ct],Kt=1,Jt=0;for(;++Jt<ft&&(Kt*=256);)Pt+=this[ct+Jt]*Kt;return Kt*=128,Pt>=Kt&&(Pt-=Math.pow(2,8*ft)),Pt},g.prototype.readIntBE=function(ct,ft,At){ct=ct>>>0,ft=ft>>>0,At||zt(ct,ft,this.length);let Pt=ft,Kt=1,Jt=this[ct+--Pt];for(;Pt>0&&(Kt*=256);)Jt+=this[ct+--Pt]*Kt;return Kt*=128,Jt>=Kt&&(Jt-=Math.pow(2,8*ft)),Jt},g.prototype.readInt8=function(ct,ft){return ct=ct>>>0,ft||zt(ct,1,this.length),this[ct]&128?(255-this[ct]+1)*-1:this[ct]},g.prototype.readInt16LE=function(ct,ft){ct=ct>>>0,ft||zt(ct,2,this.length);const At=this[ct]|this[ct+1]<<8;return At&32768?At|4294901760:At},g.prototype.readInt16BE=function(ct,ft){ct=ct>>>0,ft||zt(ct,2,this.length);const At=this[ct+1]|this[ct]<<8;return At&32768?At|4294901760:At},g.prototype.readInt32LE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,4,this.length),this[ct]|this[ct+1]<<8|this[ct+2]<<16|this[ct+3]<<24},g.prototype.readInt32BE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,4,this.length),this[ct]<<24|this[ct+1]<<16|this[ct+2]<<8|this[ct+3]},g.prototype.readBigInt64LE=Xr(function(ct){ct=ct>>>0,Bt(ct,"offset");const ft=this[ct],At=this[ct+7];(ft===void 0||At===void 0)&&Vt(ct,this.length-8);const Pt=this[ct+4]+this[ct+5]*2**8+this[ct+6]*2**16+(At<<24);return(BigInt(Pt)<<BigInt(32))+BigInt(ft+this[++ct]*2**8+this[++ct]*2**16+this[++ct]*2**24)}),g.prototype.readBigInt64BE=Xr(function(ct){ct=ct>>>0,Bt(ct,"offset");const ft=this[ct],At=this[ct+7];(ft===void 0||At===void 0)&&Vt(ct,this.length-8);const Pt=(ft<<24)+this[++ct]*2**16+this[++ct]*2**8+this[++ct];return(BigInt(Pt)<<BigInt(32))+BigInt(this[++ct]*2**24+this[++ct]*2**16+this[++ct]*2**8+At)}),g.prototype.readFloatLE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,4,this.length),s.read(this,ct,!0,23,4)},g.prototype.readFloatBE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,4,this.length),s.read(this,ct,!1,23,4)},g.prototype.readDoubleLE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,8,this.length),s.read(this,ct,!0,52,8)},g.prototype.readDoubleBE=function(ct,ft){return ct=ct>>>0,ft||zt(ct,8,this.length),s.read(this,ct,!1,52,8)};function Xt(Tt,ct,ft,At,Pt,Kt){if(!g.isBuffer(Tt))throw new TypeError('"buffer" argument must be a Buffer instance');if(ct>Pt||ct<Kt)throw new RangeError('"value" argument is out of bounds');if(ft+At>Tt.length)throw new RangeError("Index out of range")}g.prototype.writeUintLE=g.prototype.writeUIntLE=function(ct,ft,At,Pt){if(ct=+ct,ft=ft>>>0,At=At>>>0,!Pt){const wr=Math.pow(2,8*At)-1;Xt(this,ct,ft,At,wr,0)}let Kt=1,Jt=0;for(this[ft]=ct&255;++Jt<At&&(Kt*=256);)this[ft+Jt]=ct/Kt&255;return ft+At},g.prototype.writeUintBE=g.prototype.writeUIntBE=function(ct,ft,At,Pt){if(ct=+ct,ft=ft>>>0,At=At>>>0,!Pt){const wr=Math.pow(2,8*At)-1;Xt(this,ct,ft,At,wr,0)}let Kt=At-1,Jt=1;for(this[ft+Kt]=ct&255;--Kt>=0&&(Jt*=256);)this[ft+Kt]=ct/Jt&255;return ft+At},g.prototype.writeUint8=g.prototype.writeUInt8=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,1,255,0),this[ft]=ct&255,ft+1},g.prototype.writeUint16LE=g.prototype.writeUInt16LE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,2,65535,0),this[ft]=ct&255,this[ft+1]=ct>>>8,ft+2},g.prototype.writeUint16BE=g.prototype.writeUInt16BE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,2,65535,0),this[ft]=ct>>>8,this[ft+1]=ct&255,ft+2},g.prototype.writeUint32LE=g.prototype.writeUInt32LE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,4,4294967295,0),this[ft+3]=ct>>>24,this[ft+2]=ct>>>16,this[ft+1]=ct>>>8,this[ft]=ct&255,ft+4},g.prototype.writeUint32BE=g.prototype.writeUInt32BE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,4,4294967295,0),this[ft]=ct>>>24,this[ft+1]=ct>>>16,this[ft+2]=ct>>>8,this[ft+3]=ct&255,ft+4};function sr(Tt,ct,ft,At,Pt){Pr(ct,At,Pt,Tt,ft,7);let Kt=Number(ct&BigInt(4294967295));Tt[ft++]=Kt,Kt=Kt>>8,Tt[ft++]=Kt,Kt=Kt>>8,Tt[ft++]=Kt,Kt=Kt>>8,Tt[ft++]=Kt;let Jt=Number(ct>>BigInt(32)&BigInt(4294967295));return Tt[ft++]=Jt,Jt=Jt>>8,Tt[ft++]=Jt,Jt=Jt>>8,Tt[ft++]=Jt,Jt=Jt>>8,Tt[ft++]=Jt,ft}function Er(Tt,ct,ft,At,Pt){Pr(ct,At,Pt,Tt,ft,7);let Kt=Number(ct&BigInt(4294967295));Tt[ft+7]=Kt,Kt=Kt>>8,Tt[ft+6]=Kt,Kt=Kt>>8,Tt[ft+5]=Kt,Kt=Kt>>8,Tt[ft+4]=Kt;let Jt=Number(ct>>BigInt(32)&BigInt(4294967295));return Tt[ft+3]=Jt,Jt=Jt>>8,Tt[ft+2]=Jt,Jt=Jt>>8,Tt[ft+1]=Jt,Jt=Jt>>8,Tt[ft]=Jt,ft+8}g.prototype.writeBigUInt64LE=Xr(function(ct,ft=0){return sr(this,ct,ft,BigInt(0),BigInt("0xffffffffffffffff"))}),g.prototype.writeBigUInt64BE=Xr(function(ct,ft=0){return Er(this,ct,ft,BigInt(0),BigInt("0xffffffffffffffff"))}),g.prototype.writeIntLE=function(ct,ft,At,Pt){if(ct=+ct,ft=ft>>>0,!Pt){const Br=Math.pow(2,8*At-1);Xt(this,ct,ft,At,Br-1,-Br)}let Kt=0,Jt=1,wr=0;for(this[ft]=ct&255;++Kt<At&&(Jt*=256);)ct<0&&wr===0&&this[ft+Kt-1]!==0&&(wr=1),this[ft+Kt]=(ct/Jt>>0)-wr&255;return ft+At},g.prototype.writeIntBE=function(ct,ft,At,Pt){if(ct=+ct,ft=ft>>>0,!Pt){const Br=Math.pow(2,8*At-1);Xt(this,ct,ft,At,Br-1,-Br)}let Kt=At-1,Jt=1,wr=0;for(this[ft+Kt]=ct&255;--Kt>=0&&(Jt*=256);)ct<0&&wr===0&&this[ft+Kt+1]!==0&&(wr=1),this[ft+Kt]=(ct/Jt>>0)-wr&255;return ft+At},g.prototype.writeInt8=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,1,127,-128),ct<0&&(ct=255+ct+1),this[ft]=ct&255,ft+1},g.prototype.writeInt16LE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,2,32767,-32768),this[ft]=ct&255,this[ft+1]=ct>>>8,ft+2},g.prototype.writeInt16BE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,2,32767,-32768),this[ft]=ct>>>8,this[ft+1]=ct&255,ft+2},g.prototype.writeInt32LE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,4,2147483647,-2147483648),this[ft]=ct&255,this[ft+1]=ct>>>8,this[ft+2]=ct>>>16,this[ft+3]=ct>>>24,ft+4},g.prototype.writeInt32BE=function(ct,ft,At){return ct=+ct,ft=ft>>>0,At||Xt(this,ct,ft,4,2147483647,-2147483648),ct<0&&(ct=4294967295+ct+1),this[ft]=ct>>>24,this[ft+1]=ct>>>16,this[ft+2]=ct>>>8,this[ft+3]=ct&255,ft+4},g.prototype.writeBigInt64LE=Xr(function(ct,ft=0){return sr(this,ct,ft,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),g.prototype.writeBigInt64BE=Xr(function(ct,ft=0){return Er(this,ct,ft,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Sr(Tt,ct,ft,At,Pt,Kt){if(ft+At>Tt.length)throw new RangeError("Index out of range");if(ft<0)throw new RangeError("Index out of range")}function _r(Tt,ct,ft,At,Pt){return ct=+ct,ft=ft>>>0,Pt||Sr(Tt,ct,ft,4),s.write(Tt,ct,ft,At,23,4),ft+4}g.prototype.writeFloatLE=function(ct,ft,At){return _r(this,ct,ft,!0,At)},g.prototype.writeFloatBE=function(ct,ft,At){return _r(this,ct,ft,!1,At)};function Fr(Tt,ct,ft,At,Pt){return ct=+ct,ft=ft>>>0,Pt||Sr(Tt,ct,ft,8),s.write(Tt,ct,ft,At,52,8),ft+8}g.prototype.writeDoubleLE=function(ct,ft,At){return Fr(this,ct,ft,!0,At)},g.prototype.writeDoubleBE=function(ct,ft,At){return Fr(this,ct,ft,!1,At)},g.prototype.copy=function(ct,ft,At,Pt){if(!g.isBuffer(ct))throw new TypeError("argument should be a Buffer");if(At||(At=0),!Pt&&Pt!==0&&(Pt=this.length),ft>=ct.length&&(ft=ct.length),ft||(ft=0),Pt>0&&Pt<At&&(Pt=At),Pt===At||ct.length===0||this.length===0)return 0;if(ft<0)throw new RangeError("targetStart out of bounds");if(At<0||At>=this.length)throw new RangeError("Index out of range");if(Pt<0)throw new RangeError("sourceEnd out of bounds");Pt>this.length&&(Pt=this.length),ct.length-ft<Pt-At&&(Pt=ct.length-ft+At);const Kt=Pt-At;return this===ct&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(ft,At,Pt):Uint8Array.prototype.set.call(ct,this.subarray(At,Pt),ft),Kt},g.prototype.fill=function(ct,ft,At,Pt){if(typeof ct=="string"){if(typeof ft=="string"?(Pt=ft,ft=0,At=this.length):typeof At=="string"&&(Pt=At,At=this.length),Pt!==void 0&&typeof Pt!="string")throw new TypeError("encoding must be a string");if(typeof Pt=="string"&&!g.isEncoding(Pt))throw new TypeError("Unknown encoding: "+Pt);if(ct.length===1){const Jt=ct.charCodeAt(0);(Pt==="utf8"&&Jt<128||Pt==="latin1")&&(ct=Jt)}}else typeof ct=="number"?ct=ct&255:typeof ct=="boolean"&&(ct=Number(ct));if(ft<0||this.length<ft||this.length<At)throw new RangeError("Out of range index");if(At<=ft)return this;ft=ft>>>0,At=At===void 0?this.length:At>>>0,ct||(ct=0);let Kt;if(typeof ct=="number")for(Kt=ft;Kt<At;++Kt)this[Kt]=ct;else{const Jt=g.isBuffer(ct)?ct:g.from(ct,Pt),wr=Jt.length;if(wr===0)throw new TypeError('The value "'+ct+'" is invalid for argument "value"');for(Kt=0;Kt<At-ft;++Kt)this[Kt+ft]=Jt[Kt%wr]}return this};const $r={};function yr(Tt,ct,ft){$r[Tt]=class extends ft{constructor(){super(),Object.defineProperty(this,"message",{value:ct.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Tt}]`,this.stack,delete this.name}get code(){return Tt}set code(Pt){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Pt,writable:!0})}toString(){return`${this.name} [${Tt}]: ${this.message}`}}}yr("ERR_BUFFER_OUT_OF_BOUNDS",function(Tt){return Tt?`${Tt} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),yr("ERR_INVALID_ARG_TYPE",function(Tt,ct){return`The "${Tt}" argument must be of type number. Received type ${typeof ct}`},TypeError),yr("ERR_OUT_OF_RANGE",function(Tt,ct,ft){let At=`The value of "${Tt}" is out of range.`,Pt=ft;return Number.isInteger(ft)&&Math.abs(ft)>2**32?Pt=qr(String(ft)):typeof ft=="bigint"&&(Pt=String(ft),(ft>BigInt(2)**BigInt(32)||ft<-(BigInt(2)**BigInt(32)))&&(Pt=qr(Pt)),Pt+="n"),At+=` It must be ${ct}. Received ${Pt}`,At},RangeError);function qr(Tt){let ct="",ft=Tt.length;const At=Tt[0]==="-"?1:0;for(;ft>=At+4;ft-=3)ct=`_${Tt.slice(ft-3,ft)}${ct}`;return`${Tt.slice(0,ft)}${ct}`}function Yr(Tt,ct,ft){Bt(ct,"offset"),(Tt[ct]===void 0||Tt[ct+ft]===void 0)&&Vt(ct,Tt.length-(ft+1))}function Pr(Tt,ct,ft,At,Pt,Kt){if(Tt>ft||Tt<ct){const Jt=typeof ct=="bigint"?"n":"";let wr;throw ct===0||ct===BigInt(0)?wr=`>= 0${Jt} and < 2${Jt} ** ${(Kt+1)*8}${Jt}`:wr=`>= -(2${Jt} ** ${(Kt+1)*8-1}${Jt}) and < 2 ** ${(Kt+1)*8-1}${Jt}`,new $r.ERR_OUT_OF_RANGE("value",wr,Tt)}Yr(At,Pt,Kt)}function Bt(Tt,ct){if(typeof Tt!="number")throw new $r.ERR_INVALID_ARG_TYPE(ct,"number",Tt)}function Vt(Tt,ct,ft){throw Math.floor(Tt)!==Tt?(Bt(Tt,ft),new $r.ERR_OUT_OF_RANGE("offset","an integer",Tt)):ct<0?new $r.ERR_BUFFER_OUT_OF_BOUNDS:new $r.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${ct}`,Tt)}const ir=/[^+/0-9A-Za-z-_]/g;function ar(Tt){if(Tt=Tt.split("=")[0],Tt=Tt.trim().replace(ir,""),Tt.length<2)return"";for(;Tt.length%4!==0;)Tt=Tt+"=";return Tt}function pr(Tt,ct){ct=ct||1/0;let ft;const At=Tt.length;let Pt=null;const Kt=[];for(let Jt=0;Jt<At;++Jt){if(ft=Tt.charCodeAt(Jt),ft>55295&&ft<57344){if(!Pt){if(ft>56319){(ct-=3)>-1&&Kt.push(239,191,189);continue}else if(Jt+1===At){(ct-=3)>-1&&Kt.push(239,191,189);continue}Pt=ft;continue}if(ft<56320){(ct-=3)>-1&&Kt.push(239,191,189),Pt=ft;continue}ft=(Pt-55296<<10|ft-56320)+65536}else Pt&&(ct-=3)>-1&&Kt.push(239,191,189);if(Pt=null,ft<128){if((ct-=1)<0)break;Kt.push(ft)}else if(ft<2048){if((ct-=2)<0)break;Kt.push(ft>>6|192,ft&63|128)}else if(ft<65536){if((ct-=3)<0)break;Kt.push(ft>>12|224,ft>>6&63|128,ft&63|128)}else if(ft<1114112){if((ct-=4)<0)break;Kt.push(ft>>18|240,ft>>12&63|128,ft>>6&63|128,ft&63|128)}else throw new Error("Invalid code point")}return Kt}function kr(Tt){const ct=[];for(let ft=0;ft<Tt.length;++ft)ct.push(Tt.charCodeAt(ft)&255);return ct}function Or(Tt,ct){let ft,At,Pt;const Kt=[];for(let Jt=0;Jt<Tt.length&&!((ct-=2)<0);++Jt)ft=Tt.charCodeAt(Jt),At=ft>>8,Pt=ft%256,Kt.push(Pt),Kt.push(At);return Kt}function Ar(Tt){return e.toByteArray(ar(Tt))}function Ur(Tt,ct,ft,At){let Pt;for(Pt=0;Pt<At&&!(Pt+ft>=ct.length||Pt>=Tt.length);++Pt)ct[Pt+ft]=Tt[Pt];return Pt}function xr(Tt,ct){return Tt instanceof ct||Tt!=null&&Tt.constructor!=null&&Tt.constructor.name!=null&&Tt.constructor.name===ct.name}function Hr(Tt){return Tt!==Tt}const sn=function(){const Tt="0123456789abcdef",ct=new Array(256);for(let ft=0;ft<16;++ft){const At=ft*16;for(let Pt=0;Pt<16;++Pt)ct[At+Pt]=Tt[ft]+Tt[Pt]}return ct}();function Xr(Tt){return typeof BigInt>"u"?Zr:Tt}function Zr(){throw new Error("BigInt not supported")}})(buffer);var browser$3={exports:{}},process$5=browser$3.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(a){if(cachedSetTimeout===setTimeout)return setTimeout(a,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(a,0);try{return cachedSetTimeout(a,0)}catch{try{return cachedSetTimeout.call(null,a,0)}catch{return cachedSetTimeout.call(this,a,0)}}}function runClearTimeout(a){if(cachedClearTimeout===clearTimeout)return clearTimeout(a);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(a);try{return cachedClearTimeout(a)}catch{try{return cachedClearTimeout.call(null,a)}catch{return cachedClearTimeout.call(this,a)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var a=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(a)}}process$5.nextTick=function(a){var e=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)e[s-1]=arguments[s];queue.push(new Item(a,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(a,e){this.fun=a,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process$5.title="browser";process$5.browser=!0;process$5.env={};process$5.argv=[];process$5.version="";process$5.versions={};function noop$3(){}process$5.on=noop$3;process$5.addListener=noop$3;process$5.once=noop$3;process$5.off=noop$3;process$5.removeListener=noop$3;process$5.removeAllListeners=noop$3;process$5.emit=noop$3;process$5.prependListener=noop$3;process$5.prependOnceListener=noop$3;process$5.listeners=function(a){return[]};process$5.binding=function(a){throw new Error("process.binding is not supported")};process$5.cwd=function(){return"/"};process$5.chdir=function(a){throw new Error("process.chdir is not supported")};process$5.umask=function(){return 0};var browserExports$2=browser$3.exports;const process$6=getDefaultExportFromCjs$1(browserExports$2);window.Buffer=buffer.Buffer;window.process=process$6;var client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(a){function e(Ft,Yt){var Qt=Ft.length;Ft.push(Yt);e:for(;0<Qt;){var zt=Qt-1>>>1,Xt=Ft[zt];if(0<c(Xt,Yt))Ft[zt]=Yt,Ft[Qt]=Xt,Qt=zt;else break e}}function s(Ft){return Ft.length===0?null:Ft[0]}function o(Ft){if(Ft.length===0)return null;var Yt=Ft[0],Qt=Ft.pop();if(Qt!==Yt){Ft[0]=Qt;e:for(var zt=0,Xt=Ft.length,sr=Xt>>>1;zt<sr;){var Er=2*(zt+1)-1,Sr=Ft[Er],_r=Er+1,Fr=Ft[_r];if(0>c(Sr,Qt))_r<Xt&&0>c(Fr,Sr)?(Ft[zt]=Fr,Ft[_r]=Qt,zt=_r):(Ft[zt]=Sr,Ft[Er]=Qt,zt=Er);else if(_r<Xt&&0>c(Fr,Qt))Ft[zt]=Fr,Ft[_r]=Qt,zt=_r;else break e}}return Yt}function c(Ft,Yt){var Qt=Ft.sortIndex-Yt.sortIndex;return Qt!==0?Qt:Ft.id-Yt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;a.unstable_now=function(){return d.now()}}else{var h=Date,g=h.now();a.unstable_now=function(){return h.now()-g}}var _=[],b=[],$=1,j=null,_e=3,tt=!1,rt=!1,nt=!1,st=typeof setTimeout=="function"?setTimeout:null,at=typeof clearTimeout=="function"?clearTimeout:null,ot=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ut(Ft){for(var Yt=s(b);Yt!==null;){if(Yt.callback===null)o(b);else if(Yt.startTime<=Ft)o(b),Yt.sortIndex=Yt.expirationTime,e(_,Yt);else break;Yt=s(b)}}function mt(Ft){if(nt=!1,ut(Ft),!rt)if(s(_)!==null)rt=!0,qt(yt);else{var Yt=s(b);Yt!==null&&tr(mt,Yt.startTime-Ft)}}function yt(Ft,Yt){rt=!1,nt&&(nt=!1,at(gt),gt=-1),tt=!0;var Qt=_e;try{for(ut(Yt),j=s(_);j!==null&&(!(j.expirationTime>Yt)||Ft&&!Ct());){var zt=j.callback;if(typeof zt=="function"){j.callback=null,_e=j.priorityLevel;var Xt=zt(j.expirationTime<=Yt);Yt=a.unstable_now(),typeof Xt=="function"?j.callback=Xt:j===s(_)&&o(_),ut(Yt)}else o(_);j=s(_)}if(j!==null)var sr=!0;else{var Er=s(b);Er!==null&&tr(mt,Er.startTime-Yt),sr=!1}return sr}finally{j=null,_e=Qt,tt=!1}}var Et=!1,dt=null,gt=-1,St=5,xt=-1;function Ct(){return!(a.unstable_now()-xt<St)}function Ht(){if(dt!==null){var Ft=a.unstable_now();xt=Ft;var Yt=!0;try{Yt=dt(!0,Ft)}finally{Yt?Dt():(Et=!1,dt=null)}}else Et=!1}var Dt;if(typeof ot=="function")Dt=function(){ot(Ht)};else if(typeof MessageChannel<"u"){var rr=new MessageChannel,er=rr.port2;rr.port1.onmessage=Ht,Dt=function(){er.postMessage(null)}}else Dt=function(){st(Ht,0)};function qt(Ft){dt=Ft,Et||(Et=!0,Dt())}function tr(Ft,Yt){gt=st(function(){Ft(a.unstable_now())},Yt)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(Ft){Ft.callback=null},a.unstable_continueExecution=function(){rt||tt||(rt=!0,qt(yt))},a.unstable_forceFrameRate=function(Ft){0>Ft||125<Ft?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):St=0<Ft?Math.floor(1e3/Ft):5},a.unstable_getCurrentPriorityLevel=function(){return _e},a.unstable_getFirstCallbackNode=function(){return s(_)},a.unstable_next=function(Ft){switch(_e){case 1:case 2:case 3:var Yt=3;break;default:Yt=_e}var Qt=_e;_e=Yt;try{return Ft()}finally{_e=Qt}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(Ft,Yt){switch(Ft){case 1:case 2:case 3:case 4:case 5:break;default:Ft=3}var Qt=_e;_e=Ft;try{return Yt()}finally{_e=Qt}},a.unstable_scheduleCallback=function(Ft,Yt,Qt){var zt=a.unstable_now();switch(typeof Qt=="object"&&Qt!==null?(Qt=Qt.delay,Qt=typeof Qt=="number"&&0<Qt?zt+Qt:zt):Qt=zt,Ft){case 1:var Xt=-1;break;case 2:Xt=250;break;case 5:Xt=1073741823;break;case 4:Xt=1e4;break;default:Xt=5e3}return Xt=Qt+Xt,Ft={id:$++,callback:Yt,priorityLevel:Ft,startTime:Qt,expirationTime:Xt,sortIndex:-1},Qt>zt?(Ft.sortIndex=Qt,e(b,Ft),s(_)===null&&Ft===s(b)&&(nt?(at(gt),gt=-1):nt=!0,tr(mt,Qt-zt))):(Ft.sortIndex=Xt,e(_,Ft),rt||tt||(rt=!0,qt(yt))),Ft},a.unstable_shouldYield=Ct,a.unstable_wrapCallback=function(Ft){var Yt=_e;return function(){var Qt=_e;_e=Yt;try{return Ft.apply(this,arguments)}finally{_e=Qt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(a){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+a,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+a+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(a,e){ha(a,e),ha(a+"Capture",e)}function ha(a,e){for(ea[a]=e,a=0;a<e.length;a++)da.add(e[a])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(a){return ja.call(ma,a)?!0:ja.call(la,a)?!1:ka.test(a)?ma[a]=!0:(la[a]=!0,!1)}function pa(a,e,s,o){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return o?!1:s!==null?!s.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function qa(a,e,s,o){if(e===null||typeof e>"u"||pa(a,e,s,o))return!0;if(o)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function v(a,e,s,o,c,d,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=o,this.attributeNamespace=c,this.mustUseProperty=s,this.propertyName=a,this.type=e,this.sanitizeURL=d,this.removeEmptyString=h}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){z[a]=new v(a,0,!1,a,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var e=a[0];z[e]=new v(e,1,!1,a[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){z[a]=new v(a,2,!1,a.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){z[a]=new v(a,2,!1,a,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){z[a]=new v(a,3,!1,a.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(a){z[a]=new v(a,3,!0,a,null,!1,!1)});["capture","download"].forEach(function(a){z[a]=new v(a,4,!1,a,null,!1,!1)});["cols","rows","size","span"].forEach(function(a){z[a]=new v(a,6,!1,a,null,!1,!1)});["rowSpan","start"].forEach(function(a){z[a]=new v(a,5,!1,a.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var e=a.replace(ra,sa);z[e]=new v(e,1,!1,a,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var e=a.replace(ra,sa);z[e]=new v(e,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var e=a.replace(ra,sa);z[e]=new v(e,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(a){z[a]=new v(a,1,!1,a.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(a){z[a]=new v(a,1,!1,a.toLowerCase(),null,!0,!0)});function ta(a,e,s,o){var c=z.hasOwnProperty(e)?z[e]:null;(c!==null?c.type!==0:o||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qa(e,s,c,o)&&(s=null),o||c===null?oa(e)&&(s===null?a.removeAttribute(e):a.setAttribute(e,""+s)):c.mustUseProperty?a[c.propertyName]=s===null?c.type===3?!1:"":s:(e=c.attributeName,o=c.attributeNamespace,s===null?a.removeAttribute(e):(c=c.type,s=c===3||c===4&&s===!0?"":""+s,o?a.setAttributeNS(o,e,s):a.setAttribute(e,s))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(a){return a===null||typeof a!="object"?null:(a=Ja&&a[Ja]||a["@@iterator"],typeof a=="function"?a:null)}var A=Object.assign,La;function Ma(a){if(La===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);La=e&&e[1]||""}return`
`+La+a}var Na=!1;function Oa(a,e){if(!a||Na)return"";Na=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(b){var o=b}Reflect.construct(a,[],e)}else{try{e.call()}catch(b){o=b}a.call(e.prototype)}else{try{throw Error()}catch(b){o=b}a()}}catch(b){if(b&&o&&typeof b.stack=="string"){for(var c=b.stack.split(`
`),d=o.stack.split(`
`),h=c.length-1,g=d.length-1;1<=h&&0<=g&&c[h]!==d[g];)g--;for(;1<=h&&0<=g;h--,g--)if(c[h]!==d[g]){if(h!==1||g!==1)do if(h--,g--,0>g||c[h]!==d[g]){var _=`
`+c[h].replace(" at new "," at ");return a.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",a.displayName)),_}while(1<=h&&0<=g);break}}}finally{Na=!1,Error.prepareStackTrace=s}return(a=a?a.displayName||a.name:"")?Ma(a):""}function Pa(a){switch(a.tag){case 5:return Ma(a.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return a=Oa(a.type,!1),a;case 11:return a=Oa(a.type.render,!1),a;case 1:return a=Oa(a.type,!0),a;default:return""}}function Qa(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Ca:return(a.displayName||"Context")+".Consumer";case Ba:return(a._context.displayName||"Context")+".Provider";case Da:var e=a.render;return a=a.displayName,a||(a=e.displayName||e.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Ga:return e=a.displayName||null,e!==null?e:Qa(a.type)||"Memo";case Ha:e=a._payload,a=a._init;try{return Qa(a(e))}catch{}}return null}function Ra(a){var e=a.type;switch(a.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=e.render,a=a.displayName||a.name||"",e.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(e);case 8:return e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Ta(a){var e=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ua(a){var e=Ta(a)?"checked":"value",s=Object.getOwnPropertyDescriptor(a.constructor.prototype,e),o=""+a[e];if(!a.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var c=s.get,d=s.set;return Object.defineProperty(a,e,{configurable:!0,get:function(){return c.call(this)},set:function(h){o=""+h,d.call(this,h)}}),Object.defineProperty(a,e,{enumerable:s.enumerable}),{getValue:function(){return o},setValue:function(h){o=""+h},stopTracking:function(){a._valueTracker=null,delete a[e]}}}}function Va(a){a._valueTracker||(a._valueTracker=Ua(a))}function Wa(a){if(!a)return!1;var e=a._valueTracker;if(!e)return!0;var s=e.getValue(),o="";return a&&(o=Ta(a)?a.checked?"true":"false":a.value),a=o,a!==s?(e.setValue(a),!0):!1}function Xa(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Ya(a,e){var s=e.checked;return A({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??a._wrapperState.initialChecked})}function Za(a,e){var s=e.defaultValue==null?"":e.defaultValue,o=e.checked!=null?e.checked:e.defaultChecked;s=Sa(e.value!=null?e.value:s),a._wrapperState={initialChecked:o,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ab(a,e){e=e.checked,e!=null&&ta(a,"checked",e,!1)}function bb(a,e){ab(a,e);var s=Sa(e.value),o=e.type;if(s!=null)o==="number"?(s===0&&a.value===""||a.value!=s)&&(a.value=""+s):a.value!==""+s&&(a.value=""+s);else if(o==="submit"||o==="reset"){a.removeAttribute("value");return}e.hasOwnProperty("value")?cb(a,e.type,s):e.hasOwnProperty("defaultValue")&&cb(a,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(a.defaultChecked=!!e.defaultChecked)}function db$1(a,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var o=e.type;if(!(o!=="submit"&&o!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+a._wrapperState.initialValue,s||e===a.value||(a.value=e),a.defaultValue=e}s=a.name,s!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,s!==""&&(a.name=s)}function cb(a,e,s){(e!=="number"||Xa(a.ownerDocument)!==a)&&(s==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+s&&(a.defaultValue=""+s))}var eb=Array.isArray;function fb(a,e,s,o){if(a=a.options,e){e={};for(var c=0;c<s.length;c++)e["$"+s[c]]=!0;for(s=0;s<a.length;s++)c=e.hasOwnProperty("$"+a[s].value),a[s].selected!==c&&(a[s].selected=c),c&&o&&(a[s].defaultSelected=!0)}else{for(s=""+Sa(s),e=null,c=0;c<a.length;c++){if(a[c].value===s){a[c].selected=!0,o&&(a[c].defaultSelected=!0);return}e!==null||a[c].disabled||(e=a[c])}e!==null&&(e.selected=!0)}}function gb(a,e){if(e.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},e,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function hb(a,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(p(92));if(eb(s)){if(1<s.length)throw Error(p(93));s=s[0]}e=s}e==null&&(e=""),s=e}a._wrapperState={initialValue:Sa(s)}}function ib(a,e){var s=Sa(e.value),o=Sa(e.defaultValue);s!=null&&(s=""+s,s!==a.value&&(a.value=s),e.defaultValue==null&&a.defaultValue!==s&&(a.defaultValue=s)),o!=null&&(a.defaultValue=""+o)}function jb(a){var e=a.textContent;e===a._wrapperState.initialValue&&e!==""&&e!==null&&(a.value=e)}function kb(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(a,e){return a==null||a==="http://www.w3.org/1999/xhtml"?kb(e):a==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var mb,nb=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,o,c){MSApp.execUnsafeLocalFunction(function(){return a(e,s,o,c)})}:a}(function(a,e){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mb.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;e.firstChild;)a.appendChild(e.firstChild)}});function ob(a,e){if(e){var s=a.firstChild;if(s&&s===a.lastChild&&s.nodeType===3){s.nodeValue=e;return}}a.textContent=e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(a){qb.forEach(function(e){e=e+a.charAt(0).toUpperCase()+a.substring(1),pb[e]=pb[a]})});function rb(a,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||pb.hasOwnProperty(a)&&pb[a]?(""+e).trim():e+"px"}function sb(a,e){a=a.style;for(var s in e)if(e.hasOwnProperty(s)){var o=s.indexOf("--")===0,c=rb(s,e[s],o);s==="float"&&(s="cssFloat"),o?a.setProperty(s,c):a[s]=c}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(a,e){if(e){if(tb[a]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(p(137,a));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(p(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(p(61))}if(e.style!=null&&typeof e.style!="object")throw Error(p(62))}}function vb(a,e){if(a.indexOf("-")===-1)return typeof e.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var yb=null,zb=null,Ab=null;function Bb(a){if(a=Cb(a)){if(typeof yb!="function")throw Error(p(280));var e=a.stateNode;e&&(e=Db(e),yb(a.stateNode,a.type,e))}}function Eb(a){zb?Ab?Ab.push(a):Ab=[a]:zb=a}function Fb(){if(zb){var a=zb,e=Ab;if(Ab=zb=null,Bb(a),e)for(a=0;a<e.length;a++)Bb(e[a])}}function Gb(a,e){return a(e)}function Hb(){}var Ib=!1;function Jb(a,e,s){if(Ib)return a(e,s);Ib=!0;try{return Gb(a,e,s)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(a,e){var s=a.stateNode;if(s===null)return null;var o=Db(s);if(o===null)return null;s=o[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(a=a.type,o=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!o;break e;default:a=!1}if(a)return null;if(s&&typeof s!="function")throw Error(p(231,e,typeof s));return s}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(a,e,s,o,c,d,h,g,_){var b=Array.prototype.slice.call(arguments,3);try{e.apply(s,b)}catch($){this.onError($)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(a){Ob=!0,Pb=a}};function Tb(a,e,s,o,c,d,h,g,_){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(a,e,s,o,c,d,h,g,_){if(Tb.apply(this,arguments),Ob){if(Ob){var b=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=b)}}function Vb(a){var e=a,s=a;if(a.alternate)for(;e.return;)e=e.return;else{a=e;do e=a,e.flags&4098&&(s=e.return),a=e.return;while(a)}return e.tag===3?s:null}function Wb(a){if(a.tag===13){var e=a.memoizedState;if(e===null&&(a=a.alternate,a!==null&&(e=a.memoizedState)),e!==null)return e.dehydrated}return null}function Xb(a){if(Vb(a)!==a)throw Error(p(188))}function Yb(a){var e=a.alternate;if(!e){if(e=Vb(a),e===null)throw Error(p(188));return e!==a?null:a}for(var s=a,o=e;;){var c=s.return;if(c===null)break;var d=c.alternate;if(d===null){if(o=c.return,o!==null){s=o;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===s)return Xb(c),a;if(d===o)return Xb(c),e;d=d.sibling}throw Error(p(188))}if(s.return!==o.return)s=c,o=d;else{for(var h=!1,g=c.child;g;){if(g===s){h=!0,s=c,o=d;break}if(g===o){h=!0,o=c,s=d;break}g=g.sibling}if(!h){for(g=d.child;g;){if(g===s){h=!0,s=d,o=c;break}if(g===o){h=!0,o=d,s=c;break}g=g.sibling}if(!h)throw Error(p(189))}}if(s.alternate!==o)throw Error(p(190))}if(s.tag!==3)throw Error(p(188));return s.stateNode.current===s?a:e}function Zb(a){return a=Yb(a),a!==null?$b(a):null}function $b(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var e=$b(a);if(e!==null)return e;a=a.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(a){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,a,void 0,(a.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(a){return a>>>=0,a===0?32:31-(pc(a)/qc|0)|0}var rc=64,sc=4194304;function tc(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function uc(a,e){var s=a.pendingLanes;if(s===0)return 0;var o=0,c=a.suspendedLanes,d=a.pingedLanes,h=s&268435455;if(h!==0){var g=h&~c;g!==0?o=tc(g):(d&=h,d!==0&&(o=tc(d)))}else h=s&~c,h!==0?o=tc(h):d!==0&&(o=tc(d));if(o===0)return 0;if(e!==0&&e!==o&&!(e&c)&&(c=o&-o,d=e&-e,c>=d||c===16&&(d&4194240)!==0))return e;if(o&4&&(o|=s&16),e=a.entangledLanes,e!==0)for(a=a.entanglements,e&=o;0<e;)s=31-oc(e),c=1<<s,o|=a[s],e&=~c;return o}function vc(a,e){switch(a){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(a,e){for(var s=a.suspendedLanes,o=a.pingedLanes,c=a.expirationTimes,d=a.pendingLanes;0<d;){var h=31-oc(d),g=1<<h,_=c[h];_===-1?(!(g&s)||g&o)&&(c[h]=vc(g,e)):_<=e&&(a.expiredLanes|=g),d&=~g}}function xc(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function yc(){var a=rc;return rc<<=1,!(rc&4194240)&&(rc=64),a}function zc(a){for(var e=[],s=0;31>s;s++)e.push(a);return e}function Ac(a,e,s){a.pendingLanes|=e,e!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,e=31-oc(e),a[e]=s}function Bc(a,e){var s=a.pendingLanes&~e;a.pendingLanes=e,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=e,a.mutableReadLanes&=e,a.entangledLanes&=e,e=a.entanglements;var o=a.eventTimes;for(a=a.expirationTimes;0<s;){var c=31-oc(s),d=1<<c;e[c]=0,o[c]=-1,a[c]=-1,s&=~d}}function Cc(a,e){var s=a.entangledLanes|=e;for(a=a.entanglements;s;){var o=31-oc(s),c=1<<o;c&e|a[o]&e&&(a[o]|=e),s&=~c}}var C=0;function Dc(a){return a&=-a,1<a?4<a?a&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(a,e){switch(a){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(e.pointerId)}}function Tc(a,e,s,o,c,d){return a===null||a.nativeEvent!==d?(a={blockedOn:e,domEventName:s,eventSystemFlags:o,nativeEvent:d,targetContainers:[c]},e!==null&&(e=Cb(e),e!==null&&Fc(e)),a):(a.eventSystemFlags|=o,e=a.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),a)}function Uc(a,e,s,o,c){switch(e){case"focusin":return Lc=Tc(Lc,a,e,s,o,c),!0;case"dragenter":return Mc=Tc(Mc,a,e,s,o,c),!0;case"mouseover":return Nc=Tc(Nc,a,e,s,o,c),!0;case"pointerover":var d=c.pointerId;return Oc.set(d,Tc(Oc.get(d)||null,a,e,s,o,c)),!0;case"gotpointercapture":return d=c.pointerId,Pc.set(d,Tc(Pc.get(d)||null,a,e,s,o,c)),!0}return!1}function Vc(a){var e=Wc(a.target);if(e!==null){var s=Vb(e);if(s!==null){if(e=s.tag,e===13){if(e=Wb(s),e!==null){a.blockedOn=e,Ic(a.priority,function(){Gc(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){a.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xc(a){if(a.blockedOn!==null)return!1;for(var e=a.targetContainers;0<e.length;){var s=Yc(a.domEventName,a.eventSystemFlags,e[0],a.nativeEvent);if(s===null){s=a.nativeEvent;var o=new s.constructor(s.type,s);wb=o,s.target.dispatchEvent(o),wb=null}else return e=Cb(s),e!==null&&Fc(e),a.blockedOn=s,!1;e.shift()}return!0}function Zc(a,e,s){Xc(a)&&s.delete(e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(a,e){a.blockedOn===e&&(a.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(a){function e(c){return ad(c,a)}if(0<Kc.length){ad(Kc[0],a);for(var s=1;s<Kc.length;s++){var o=Kc[s];o.blockedOn===a&&(o.blockedOn=null)}}for(Lc!==null&&ad(Lc,a),Mc!==null&&ad(Mc,a),Nc!==null&&ad(Nc,a),Oc.forEach(e),Pc.forEach(e),s=0;s<Qc.length;s++)o=Qc[s],o.blockedOn===a&&(o.blockedOn=null);for(;0<Qc.length&&(s=Qc[0],s.blockedOn===null);)Vc(s),s.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(a,e,s,o){var c=C,d=cd.transition;cd.transition=null;try{C=1,fd(a,e,s,o)}finally{C=c,cd.transition=d}}function gd(a,e,s,o){var c=C,d=cd.transition;cd.transition=null;try{C=4,fd(a,e,s,o)}finally{C=c,cd.transition=d}}function fd(a,e,s,o){if(dd){var c=Yc(a,e,s,o);if(c===null)hd(a,e,o,id$2,s),Sc(a,o);else if(Uc(c,a,e,s,o))o.stopPropagation();else if(Sc(a,o),e&4&&-1<Rc.indexOf(a)){for(;c!==null;){var d=Cb(c);if(d!==null&&Ec(d),d=Yc(a,e,s,o),d===null&&hd(a,e,o,id$2,s),d===c)break;c=d}c!==null&&o.stopPropagation()}else hd(a,e,o,null,s)}}var id$2=null;function Yc(a,e,s,o){if(id$2=null,a=xb(o),a=Wc(a),a!==null)if(e=Vb(a),e===null)a=null;else if(s=e.tag,s===13){if(a=Wb(e),a!==null)return a;a=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;a=null}else e!==a&&(a=null);return id$2=a,null}function jd(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var a,e=ld,s=e.length,o,c="value"in kd?kd.value:kd.textContent,d=c.length;for(a=0;a<s&&e[a]===c[a];a++);var h=s-a;for(o=1;o<=h&&e[s-o]===c[d-o];o++);return md=c.slice(a,1<o?1-o:void 0)}function od(a){var e=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&e===13&&(a=13)):a=e,a===10&&(a=13),32<=a||a===13?a:0}function pd(){return!0}function qd(){return!1}function rd(a){function e(s,o,c,d,h){this._reactName=s,this._targetInst=c,this.type=o,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var g in a)a.hasOwnProperty(g)&&(s=a[g],this[g]=s?s(d):d[g]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==yd&&(yd&&a.type==="mousemove"?(wd=a.screenX-yd.screenX,xd=a.screenY-yd.screenY):xd=wd=0,yd=a),wd)},movementY:function(a){return"movementY"in a?a.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(a){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(a):(a=Od[a])?!!e[a]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(a){if(a.key){var e=Md[a.key]||a.key;if(e!=="Unidentified")return e}return a.type==="keypress"?(a=od(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Nd[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(a){return a.type==="keypress"?od(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?od(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(a,e){switch(a){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ie=!1;function je(a,e){switch(a){case"compositionend":return he(e);case"keypress":return e.which!==32?null:(fe=!0,ee);case"textInput":return a=e.data,a===ee&&fe?null:a;default:return null}}function ke(a,e){if(ie)return a==="compositionend"||!ae&&ge(a,e)?(a=nd(),md=ld=kd=null,ie=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return de&&e.locale!=="ko"?null:e.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(a){var e=a&&a.nodeName&&a.nodeName.toLowerCase();return e==="input"?!!le[a.type]:e==="textarea"}function ne(a,e,s,o){Eb(o),e=oe(e,"onChange"),0<e.length&&(s=new td("onChange","change",null,s,o),a.push({event:s,listeners:e}))}var pe=null,qe=null;function re(a){se(a,0)}function te(a){var e=ue(a);if(Wa(e))return a}function ve(a,e){if(a==="change")return e}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(a){if(a.propertyName==="value"&&te(qe)){var e=[];ne(e,qe,a,xb(a)),Jb(re,e)}}function Ce(a,e,s){a==="focusin"?(Ae(),pe=e,qe=s,pe.attachEvent("onpropertychange",Be)):a==="focusout"&&Ae()}function De(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return te(qe)}function Ee(a,e){if(a==="click")return te(e)}function Fe(a,e){if(a==="input"||a==="change")return te(e)}function Ge(a,e){return a===e&&(a!==0||1/a===1/e)||a!==a&&e!==e}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(a,e){if(He(a,e))return!0;if(typeof a!="object"||a===null||typeof e!="object"||e===null)return!1;var s=Object.keys(a),o=Object.keys(e);if(s.length!==o.length)return!1;for(o=0;o<s.length;o++){var c=s[o];if(!ja.call(e,c)||!He(a[c],e[c]))return!1}return!0}function Je(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Ke(a,e){var s=Je(a);a=0;for(var o;s;){if(s.nodeType===3){if(o=a+s.textContent.length,a<=e&&o>=e)return{node:s,offset:e-a};a=o}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Je(s)}}function Le(a,e){return a&&e?a===e?!0:a&&a.nodeType===3?!1:e&&e.nodeType===3?Le(a,e.parentNode):"contains"in a?a.contains(e):a.compareDocumentPosition?!!(a.compareDocumentPosition(e)&16):!1:!1}function Me(){for(var a=window,e=Xa();e instanceof a.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)a=e.contentWindow;else break;e=Xa(a.document)}return e}function Ne(a){var e=a&&a.nodeName&&a.nodeName.toLowerCase();return e&&(e==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||e==="textarea"||a.contentEditable==="true")}function Oe(a){var e=Me(),s=a.focusedElem,o=a.selectionRange;if(e!==s&&s&&s.ownerDocument&&Le(s.ownerDocument.documentElement,s)){if(o!==null&&Ne(s)){if(e=o.start,a=o.end,a===void 0&&(a=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(a,s.value.length);else if(a=(e=s.ownerDocument||document)&&e.defaultView||window,a.getSelection){a=a.getSelection();var c=s.textContent.length,d=Math.min(o.start,c);o=o.end===void 0?d:Math.min(o.end,c),!a.extend&&d>o&&(c=o,o=d,d=c),c=Ke(s,d);var h=Ke(s,o);c&&h&&(a.rangeCount!==1||a.anchorNode!==c.node||a.anchorOffset!==c.offset||a.focusNode!==h.node||a.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),a.removeAllRanges(),d>o?(a.addRange(e),a.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),a.addRange(e)))}}for(e=[],a=s;a=a.parentNode;)a.nodeType===1&&e.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)a=e[s],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(a,e,s){var o=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Te||Qe==null||Qe!==Xa(o)||(o=Qe,"selectionStart"in o&&Ne(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Se&&Ie(Se,o)||(Se=o,o=oe(Re,"onSelect"),0<o.length&&(e=new td("onSelect","select",null,e,s),a.push({event:e,listeners:o}),e.target=Qe)))}function Ve(a,e){var s={};return s[a.toLowerCase()]=e.toLowerCase(),s["Webkit"+a]="webkit"+e,s["Moz"+a]="moz"+e,s}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(a){if(Xe[a])return Xe[a];if(!We[a])return a;var e=We[a],s;for(s in e)if(e.hasOwnProperty(s)&&s in Ye)return Xe[a]=e[s];return a}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(a,e){df.set(a,e),fa(e,[a])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(a,e,s){var o=a.type||"unknown-event";a.currentTarget=s,Ub(o,e,void 0,a),a.currentTarget=null}function se(a,e){e=(e&4)!==0;for(var s=0;s<a.length;s++){var o=a[s],c=o.event;o=o.listeners;e:{var d=void 0;if(e)for(var h=o.length-1;0<=h;h--){var g=o[h],_=g.instance,b=g.currentTarget;if(g=g.listener,_!==d&&c.isPropagationStopped())break e;nf(c,g,b),d=_}else for(h=0;h<o.length;h++){if(g=o[h],_=g.instance,b=g.currentTarget,g=g.listener,_!==d&&c.isPropagationStopped())break e;nf(c,g,b),d=_}}}if(Qb)throw a=Rb,Qb=!1,Rb=null,a}function D(a,e){var s=e[of];s===void 0&&(s=e[of]=new Set);var o=a+"__bubble";s.has(o)||(pf(e,a,2,!1),s.add(o))}function qf(a,e,s){var o=0;e&&(o|=4),pf(s,a,o,e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(a){if(!a[rf]){a[rf]=!0,da.forEach(function(s){s!=="selectionchange"&&(mf.has(s)||qf(s,!1,a),qf(s,!0,a))});var e=a.nodeType===9?a:a.ownerDocument;e===null||e[rf]||(e[rf]=!0,qf("selectionchange",!1,e))}}function pf(a,e,s,o){switch(jd(e)){case 1:var c=ed;break;case 4:c=gd;break;default:c=fd}s=c.bind(null,e,s,a),c=void 0,!Lb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),o?c!==void 0?a.addEventListener(e,s,{capture:!0,passive:c}):a.addEventListener(e,s,!0):c!==void 0?a.addEventListener(e,s,{passive:c}):a.addEventListener(e,s,!1)}function hd(a,e,s,o,c){var d=o;if(!(e&1)&&!(e&2)&&o!==null)e:for(;;){if(o===null)return;var h=o.tag;if(h===3||h===4){var g=o.stateNode.containerInfo;if(g===c||g.nodeType===8&&g.parentNode===c)break;if(h===4)for(h=o.return;h!==null;){var _=h.tag;if((_===3||_===4)&&(_=h.stateNode.containerInfo,_===c||_.nodeType===8&&_.parentNode===c))return;h=h.return}for(;g!==null;){if(h=Wc(g),h===null)return;if(_=h.tag,_===5||_===6){o=d=h;continue e}g=g.parentNode}}o=o.return}Jb(function(){var b=d,$=xb(s),j=[];e:{var _e=df.get(a);if(_e!==void 0){var tt=td,rt=a;switch(a){case"keypress":if(od(s)===0)break e;case"keydown":case"keyup":tt=Rd;break;case"focusin":rt="focus",tt=Fd;break;case"focusout":rt="blur",tt=Fd;break;case"beforeblur":case"afterblur":tt=Fd;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=Vd;break;case $e:case af:case bf:tt=Hd;break;case cf:tt=Xd;break;case"scroll":tt=vd;break;case"wheel":tt=Zd;break;case"copy":case"cut":case"paste":tt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=Td}var nt=(e&4)!==0,st=!nt&&a==="scroll",at=nt?_e!==null?_e+"Capture":null:_e;nt=[];for(var ot=b,ut;ot!==null;){ut=ot;var mt=ut.stateNode;if(ut.tag===5&&mt!==null&&(ut=mt,at!==null&&(mt=Kb(ot,at),mt!=null&&nt.push(tf(ot,mt,ut)))),st)break;ot=ot.return}0<nt.length&&(_e=new tt(_e,rt,null,s,$),j.push({event:_e,listeners:nt}))}}if(!(e&7)){e:{if(_e=a==="mouseover"||a==="pointerover",tt=a==="mouseout"||a==="pointerout",_e&&s!==wb&&(rt=s.relatedTarget||s.fromElement)&&(Wc(rt)||rt[uf]))break e;if((tt||_e)&&(_e=$.window===$?$:(_e=$.ownerDocument)?_e.defaultView||_e.parentWindow:window,tt?(rt=s.relatedTarget||s.toElement,tt=b,rt=rt?Wc(rt):null,rt!==null&&(st=Vb(rt),rt!==st||rt.tag!==5&&rt.tag!==6)&&(rt=null)):(tt=null,rt=b),tt!==rt)){if(nt=Bd,mt="onMouseLeave",at="onMouseEnter",ot="mouse",(a==="pointerout"||a==="pointerover")&&(nt=Td,mt="onPointerLeave",at="onPointerEnter",ot="pointer"),st=tt==null?_e:ue(tt),ut=rt==null?_e:ue(rt),_e=new nt(mt,ot+"leave",tt,s,$),_e.target=st,_e.relatedTarget=ut,mt=null,Wc($)===b&&(nt=new nt(at,ot+"enter",rt,s,$),nt.target=ut,nt.relatedTarget=st,mt=nt),st=mt,tt&&rt)t:{for(nt=tt,at=rt,ot=0,ut=nt;ut;ut=vf(ut))ot++;for(ut=0,mt=at;mt;mt=vf(mt))ut++;for(;0<ot-ut;)nt=vf(nt),ot--;for(;0<ut-ot;)at=vf(at),ut--;for(;ot--;){if(nt===at||at!==null&&nt===at.alternate)break t;nt=vf(nt),at=vf(at)}nt=null}else nt=null;tt!==null&&wf(j,_e,tt,nt,!1),rt!==null&&st!==null&&wf(j,st,rt,nt,!0)}}e:{if(_e=b?ue(b):window,tt=_e.nodeName&&_e.nodeName.toLowerCase(),tt==="select"||tt==="input"&&_e.type==="file")var yt=ve;else if(me(_e))if(we)yt=Fe;else{yt=De;var Et=Ce}else(tt=_e.nodeName)&&tt.toLowerCase()==="input"&&(_e.type==="checkbox"||_e.type==="radio")&&(yt=Ee);if(yt&&(yt=yt(a,b))){ne(j,yt,s,$);break e}Et&&Et(a,_e,b),a==="focusout"&&(Et=_e._wrapperState)&&Et.controlled&&_e.type==="number"&&cb(_e,"number",_e.value)}switch(Et=b?ue(b):window,a){case"focusin":(me(Et)||Et.contentEditable==="true")&&(Qe=Et,Re=b,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(j,s,$);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(j,s,$)}var dt;if(ae)e:{switch(a){case"compositionstart":var gt="onCompositionStart";break e;case"compositionend":gt="onCompositionEnd";break e;case"compositionupdate":gt="onCompositionUpdate";break e}gt=void 0}else ie?ge(a,s)&&(gt="onCompositionEnd"):a==="keydown"&&s.keyCode===229&&(gt="onCompositionStart");gt&&(de&&s.locale!=="ko"&&(ie||gt!=="onCompositionStart"?gt==="onCompositionEnd"&&ie&&(dt=nd()):(kd=$,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Et=oe(b,gt),0<Et.length&&(gt=new Ld(gt,a,null,s,$),j.push({event:gt,listeners:Et}),dt?gt.data=dt:(dt=he(s),dt!==null&&(gt.data=dt)))),(dt=ce?je(a,s):ke(a,s))&&(b=oe(b,"onBeforeInput"),0<b.length&&($=new Ld("onBeforeInput","beforeinput",null,s,$),j.push({event:$,listeners:b}),$.data=dt))}se(j,e)})}function tf(a,e,s){return{instance:a,listener:e,currentTarget:s}}function oe(a,e){for(var s=e+"Capture",o=[];a!==null;){var c=a,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=Kb(a,s),d!=null&&o.unshift(tf(a,d,c)),d=Kb(a,e),d!=null&&o.push(tf(a,d,c))),a=a.return}return o}function vf(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function wf(a,e,s,o,c){for(var d=e._reactName,h=[];s!==null&&s!==o;){var g=s,_=g.alternate,b=g.stateNode;if(_!==null&&_===o)break;g.tag===5&&b!==null&&(g=b,c?(_=Kb(s,d),_!=null&&h.unshift(tf(s,_,g))):c||(_=Kb(s,d),_!=null&&h.push(tf(s,_,g)))),s=s.return}h.length!==0&&a.push({event:e,listeners:h})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(a){return(typeof a=="string"?a:""+a).replace(xf,`
`).replace(yf,"")}function Af(a,e,s){if(e=zf(e),zf(a)!==e&&s)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(a,e){return a==="textarea"||a==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(a){return Hf.resolve(null).then(a).catch(If)}:Ff;function If(a){setTimeout(function(){throw a})}function Kf(a,e){var s=e,o=0;do{var c=s.nextSibling;if(a.removeChild(s),c&&c.nodeType===8)if(s=c.data,s==="/$"){if(o===0){a.removeChild(c),bd(e);return}o--}else s!=="$"&&s!=="$?"&&s!=="$!"||o++;s=c}while(s);bd(e)}function Lf(a){for(;a!=null;a=a.nextSibling){var e=a.nodeType;if(e===1||e===3)break;if(e===8){if(e=a.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return a}function Mf(a){a=a.previousSibling;for(var e=0;a;){if(a.nodeType===8){var s=a.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return a;e--}else s==="/$"&&e++}a=a.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(a){var e=a[Of];if(e)return e;for(var s=a.parentNode;s;){if(e=s[uf]||s[Of]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(a=Mf(a);a!==null;){if(s=a[Of])return s;a=Mf(a)}return e}a=s,s=a.parentNode}return null}function Cb(a){return a=a[Of]||a[uf],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function ue(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(p(33))}function Db(a){return a[Pf]||null}var Sf=[],Tf=-1;function Uf(a){return{current:a}}function E$1(a){0>Tf||(a.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(a,e){Tf++,Sf[Tf]=a.current,a.current=e}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(a,e){var s=a.type.contextTypes;if(!s)return Vf;var o=a.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===e)return o.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in s)c[d]=e[d];return o&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=c),c}function Zf(a){return a=a.childContextTypes,a!=null}function $f(){E$1(Wf),E$1(H)}function ag(a,e,s){if(H.current!==Vf)throw Error(p(168));G(H,e),G(Wf,s)}function bg(a,e,s){var o=a.stateNode;if(e=e.childContextTypes,typeof o.getChildContext!="function")return s;o=o.getChildContext();for(var c in o)if(!(c in e))throw Error(p(108,Ra(a)||"Unknown",c));return A({},s,o)}function cg(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,a),G(Wf,Wf.current),!0}function dg(a,e,s){var o=a.stateNode;if(!o)throw Error(p(169));s?(a=bg(a,e,Xf),o.__reactInternalMemoizedMergedChildContext=a,E$1(Wf),E$1(H),G(H,a)):E$1(Wf),G(Wf,s)}var eg=null,fg=!1,gg=!1;function hg(a){eg===null?eg=[a]:eg.push(a)}function ig(a){fg=!0,hg(a)}function jg(){if(!gg&&eg!==null){gg=!0;var a=0,e=C;try{var s=eg;for(C=1;a<s.length;a++){var o=s[a];do o=o(!0);while(o!==null)}eg=null,fg=!1}catch(c){throw eg!==null&&(eg=eg.slice(a+1)),ac(fc,jg),c}finally{C=e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(a,e){kg[lg++]=ng,kg[lg++]=mg,mg=a,ng=e}function ug(a,e,s){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=a;var o=rg;a=sg;var c=32-oc(o)-1;o&=~(1<<c),s+=1;var d=32-oc(e)+c;if(30<d){var h=c-c%5;d=(o&(1<<h)-1).toString(32),o>>=h,c-=h,rg=1<<32-oc(e)+c|s<<c|o,sg=d+a}else rg=1<<d|s<<c|o,sg=a}function vg(a){a.return!==null&&(tg(a,1),ug(a,1,0))}function wg(a){for(;a===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;a===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(a,e){var s=Bg(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=a,e=a.deletions,e===null?(a.deletions=[s],a.flags|=16):e.push(s)}function Cg(a,e){switch(a.tag){case 5:var s=a.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(a.stateNode=e,xg=a,yg=Lf(e.firstChild),!0):!1;case 6:return e=a.pendingProps===""||e.nodeType!==3?null:e,e!==null?(a.stateNode=e,xg=a,yg=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=qg!==null?{id:rg,overflow:sg}:null,a.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=Bg(18,null,null,0),s.stateNode=e,s.return=a,a.child=s,xg=a,yg=null,!0):!1;default:return!1}}function Dg(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Eg(a){if(I){var e=yg;if(e){var s=e;if(!Cg(a,e)){if(Dg(a))throw Error(p(418));e=Lf(s.nextSibling);var o=xg;e&&Cg(a,e)?Ag(o,s):(a.flags=a.flags&-4097|2,I=!1,xg=a)}}else{if(Dg(a))throw Error(p(418));a.flags=a.flags&-4097|2,I=!1,xg=a}}}function Fg(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;xg=a}function Gg(a){if(a!==xg)return!1;if(!I)return Fg(a),I=!0,!1;var e;if((e=a.tag!==3)&&!(e=a.tag!==5)&&(e=a.type,e=e!=="head"&&e!=="body"&&!Ef(a.type,a.memoizedProps)),e&&(e=yg)){if(Dg(a))throw Hg(),Error(p(418));for(;e;)Ag(a,e),e=Lf(e.nextSibling)}if(Fg(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(p(317));e:{for(a=a.nextSibling,e=0;a;){if(a.nodeType===8){var s=a.data;if(s==="/$"){if(e===0){yg=Lf(a.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}a=a.nextSibling}yg=null}}else yg=xg?Lf(a.stateNode.nextSibling):null;return!0}function Hg(){for(var a=yg;a;)a=Lf(a.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(a){zg===null?zg=[a]:zg.push(a)}var Kg=ua.ReactCurrentBatchConfig;function Lg(a,e,s){if(a=s.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(p(309));var o=s.stateNode}if(!o)throw Error(p(147,a));var c=o,d=""+a;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(h){var g=c.refs;h===null?delete g[d]:g[d]=h},e._stringRef=d,e)}if(typeof a!="string")throw Error(p(284));if(!s._owner)throw Error(p(290,a))}return a}function Mg(a,e){throw a=Object.prototype.toString.call(e),Error(p(31,a==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":a))}function Ng(a){var e=a._init;return e(a._payload)}function Og(a){function e(at,ot){if(a){var ut=at.deletions;ut===null?(at.deletions=[ot],at.flags|=16):ut.push(ot)}}function s(at,ot){if(!a)return null;for(;ot!==null;)e(at,ot),ot=ot.sibling;return null}function o(at,ot){for(at=new Map;ot!==null;)ot.key!==null?at.set(ot.key,ot):at.set(ot.index,ot),ot=ot.sibling;return at}function c(at,ot){return at=Pg(at,ot),at.index=0,at.sibling=null,at}function d(at,ot,ut){return at.index=ut,a?(ut=at.alternate,ut!==null?(ut=ut.index,ut<ot?(at.flags|=2,ot):ut):(at.flags|=2,ot)):(at.flags|=1048576,ot)}function h(at){return a&&at.alternate===null&&(at.flags|=2),at}function g(at,ot,ut,mt){return ot===null||ot.tag!==6?(ot=Qg(ut,at.mode,mt),ot.return=at,ot):(ot=c(ot,ut),ot.return=at,ot)}function _(at,ot,ut,mt){var yt=ut.type;return yt===ya?$(at,ot,ut.props.children,mt,ut.key):ot!==null&&(ot.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===Ha&&Ng(yt)===ot.type)?(mt=c(ot,ut.props),mt.ref=Lg(at,ot,ut),mt.return=at,mt):(mt=Rg(ut.type,ut.key,ut.props,null,at.mode,mt),mt.ref=Lg(at,ot,ut),mt.return=at,mt)}function b(at,ot,ut,mt){return ot===null||ot.tag!==4||ot.stateNode.containerInfo!==ut.containerInfo||ot.stateNode.implementation!==ut.implementation?(ot=Sg(ut,at.mode,mt),ot.return=at,ot):(ot=c(ot,ut.children||[]),ot.return=at,ot)}function $(at,ot,ut,mt,yt){return ot===null||ot.tag!==7?(ot=Tg(ut,at.mode,mt,yt),ot.return=at,ot):(ot=c(ot,ut),ot.return=at,ot)}function j(at,ot,ut){if(typeof ot=="string"&&ot!==""||typeof ot=="number")return ot=Qg(""+ot,at.mode,ut),ot.return=at,ot;if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case va:return ut=Rg(ot.type,ot.key,ot.props,null,at.mode,ut),ut.ref=Lg(at,null,ot),ut.return=at,ut;case wa:return ot=Sg(ot,at.mode,ut),ot.return=at,ot;case Ha:var mt=ot._init;return j(at,mt(ot._payload),ut)}if(eb(ot)||Ka(ot))return ot=Tg(ot,at.mode,ut,null),ot.return=at,ot;Mg(at,ot)}return null}function _e(at,ot,ut,mt){var yt=ot!==null?ot.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return yt!==null?null:g(at,ot,""+ut,mt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case va:return ut.key===yt?_(at,ot,ut,mt):null;case wa:return ut.key===yt?b(at,ot,ut,mt):null;case Ha:return yt=ut._init,_e(at,ot,yt(ut._payload),mt)}if(eb(ut)||Ka(ut))return yt!==null?null:$(at,ot,ut,mt,null);Mg(at,ut)}return null}function tt(at,ot,ut,mt,yt){if(typeof mt=="string"&&mt!==""||typeof mt=="number")return at=at.get(ut)||null,g(ot,at,""+mt,yt);if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case va:return at=at.get(mt.key===null?ut:mt.key)||null,_(ot,at,mt,yt);case wa:return at=at.get(mt.key===null?ut:mt.key)||null,b(ot,at,mt,yt);case Ha:var Et=mt._init;return tt(at,ot,ut,Et(mt._payload),yt)}if(eb(mt)||Ka(mt))return at=at.get(ut)||null,$(ot,at,mt,yt,null);Mg(ot,mt)}return null}function rt(at,ot,ut,mt){for(var yt=null,Et=null,dt=ot,gt=ot=0,St=null;dt!==null&&gt<ut.length;gt++){dt.index>gt?(St=dt,dt=null):St=dt.sibling;var xt=_e(at,dt,ut[gt],mt);if(xt===null){dt===null&&(dt=St);break}a&&dt&&xt.alternate===null&&e(at,dt),ot=d(xt,ot,gt),Et===null?yt=xt:Et.sibling=xt,Et=xt,dt=St}if(gt===ut.length)return s(at,dt),I&&tg(at,gt),yt;if(dt===null){for(;gt<ut.length;gt++)dt=j(at,ut[gt],mt),dt!==null&&(ot=d(dt,ot,gt),Et===null?yt=dt:Et.sibling=dt,Et=dt);return I&&tg(at,gt),yt}for(dt=o(at,dt);gt<ut.length;gt++)St=tt(dt,at,gt,ut[gt],mt),St!==null&&(a&&St.alternate!==null&&dt.delete(St.key===null?gt:St.key),ot=d(St,ot,gt),Et===null?yt=St:Et.sibling=St,Et=St);return a&&dt.forEach(function(Ct){return e(at,Ct)}),I&&tg(at,gt),yt}function nt(at,ot,ut,mt){var yt=Ka(ut);if(typeof yt!="function")throw Error(p(150));if(ut=yt.call(ut),ut==null)throw Error(p(151));for(var Et=yt=null,dt=ot,gt=ot=0,St=null,xt=ut.next();dt!==null&&!xt.done;gt++,xt=ut.next()){dt.index>gt?(St=dt,dt=null):St=dt.sibling;var Ct=_e(at,dt,xt.value,mt);if(Ct===null){dt===null&&(dt=St);break}a&&dt&&Ct.alternate===null&&e(at,dt),ot=d(Ct,ot,gt),Et===null?yt=Ct:Et.sibling=Ct,Et=Ct,dt=St}if(xt.done)return s(at,dt),I&&tg(at,gt),yt;if(dt===null){for(;!xt.done;gt++,xt=ut.next())xt=j(at,xt.value,mt),xt!==null&&(ot=d(xt,ot,gt),Et===null?yt=xt:Et.sibling=xt,Et=xt);return I&&tg(at,gt),yt}for(dt=o(at,dt);!xt.done;gt++,xt=ut.next())xt=tt(dt,at,gt,xt.value,mt),xt!==null&&(a&&xt.alternate!==null&&dt.delete(xt.key===null?gt:xt.key),ot=d(xt,ot,gt),Et===null?yt=xt:Et.sibling=xt,Et=xt);return a&&dt.forEach(function(Ht){return e(at,Ht)}),I&&tg(at,gt),yt}function st(at,ot,ut,mt){if(typeof ut=="object"&&ut!==null&&ut.type===ya&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case va:e:{for(var yt=ut.key,Et=ot;Et!==null;){if(Et.key===yt){if(yt=ut.type,yt===ya){if(Et.tag===7){s(at,Et.sibling),ot=c(Et,ut.props.children),ot.return=at,at=ot;break e}}else if(Et.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===Ha&&Ng(yt)===Et.type){s(at,Et.sibling),ot=c(Et,ut.props),ot.ref=Lg(at,Et,ut),ot.return=at,at=ot;break e}s(at,Et);break}else e(at,Et);Et=Et.sibling}ut.type===ya?(ot=Tg(ut.props.children,at.mode,mt,ut.key),ot.return=at,at=ot):(mt=Rg(ut.type,ut.key,ut.props,null,at.mode,mt),mt.ref=Lg(at,ot,ut),mt.return=at,at=mt)}return h(at);case wa:e:{for(Et=ut.key;ot!==null;){if(ot.key===Et)if(ot.tag===4&&ot.stateNode.containerInfo===ut.containerInfo&&ot.stateNode.implementation===ut.implementation){s(at,ot.sibling),ot=c(ot,ut.children||[]),ot.return=at,at=ot;break e}else{s(at,ot);break}else e(at,ot);ot=ot.sibling}ot=Sg(ut,at.mode,mt),ot.return=at,at=ot}return h(at);case Ha:return Et=ut._init,st(at,ot,Et(ut._payload),mt)}if(eb(ut))return rt(at,ot,ut,mt);if(Ka(ut))return nt(at,ot,ut,mt);Mg(at,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,ot!==null&&ot.tag===6?(s(at,ot.sibling),ot=c(ot,ut),ot.return=at,at=ot):(s(at,ot),ot=Qg(ut,at.mode,mt),ot.return=at,at=ot),h(at)):s(at,ot)}return st}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(a){var e=Wg.current;E$1(Wg),a._currentValue=e}function bh(a,e,s){for(;a!==null;){var o=a.alternate;if((a.childLanes&e)!==e?(a.childLanes|=e,o!==null&&(o.childLanes|=e)):o!==null&&(o.childLanes&e)!==e&&(o.childLanes|=e),a===s)break;a=a.return}}function ch(a,e){Xg=a,Zg=Yg=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&e&&(dh=!0),a.firstContext=null)}function eh(a){var e=a._currentValue;if(Zg!==a)if(a={context:a,memoizedValue:e,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=a,Xg.dependencies={lanes:0,firstContext:a}}else Yg=Yg.next=a;return e}var fh=null;function gh(a){fh===null?fh=[a]:fh.push(a)}function hh(a,e,s,o){var c=e.interleaved;return c===null?(s.next=s,gh(e)):(s.next=c.next,c.next=s),e.interleaved=s,ih(a,o)}function ih(a,e){a.lanes|=e;var s=a.alternate;for(s!==null&&(s.lanes|=e),s=a,a=a.return;a!==null;)a.childLanes|=e,s=a.alternate,s!==null&&(s.childLanes|=e),s=a,a=a.return;return s.tag===3?s.stateNode:null}var jh=!1;function kh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(a,e){a=a.updateQueue,e.updateQueue===a&&(e.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function mh(a,e){return{eventTime:a,lane:e,tag:0,payload:null,callback:null,next:null}}function nh(a,e,s){var o=a.updateQueue;if(o===null)return null;if(o=o.shared,K&2){var c=o.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),o.pending=e,ih(a,s)}return c=o.interleaved,c===null?(e.next=e,gh(o)):(e.next=c.next,c.next=e),o.interleaved=e,ih(a,s)}function oh(a,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var o=e.lanes;o&=a.pendingLanes,s|=o,e.lanes=s,Cc(a,s)}}function ph(a,e){var s=a.updateQueue,o=a.alternate;if(o!==null&&(o=o.updateQueue,s===o)){var c=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};d===null?c=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?c=d=e:d=d.next=e}else c=d=e;s={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:o.shared,effects:o.effects},a.updateQueue=s;return}a=s.lastBaseUpdate,a===null?s.firstBaseUpdate=e:a.next=e,s.lastBaseUpdate=e}function qh(a,e,s,o){var c=a.updateQueue;jh=!1;var d=c.firstBaseUpdate,h=c.lastBaseUpdate,g=c.shared.pending;if(g!==null){c.shared.pending=null;var _=g,b=_.next;_.next=null,h===null?d=b:h.next=b,h=_;var $=a.alternate;$!==null&&($=$.updateQueue,g=$.lastBaseUpdate,g!==h&&(g===null?$.firstBaseUpdate=b:g.next=b,$.lastBaseUpdate=_))}if(d!==null){var j=c.baseState;h=0,$=b=_=null,g=d;do{var _e=g.lane,tt=g.eventTime;if((o&_e)===_e){$!==null&&($=$.next={eventTime:tt,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var rt=a,nt=g;switch(_e=e,tt=s,nt.tag){case 1:if(rt=nt.payload,typeof rt=="function"){j=rt.call(tt,j,_e);break e}j=rt;break e;case 3:rt.flags=rt.flags&-65537|128;case 0:if(rt=nt.payload,_e=typeof rt=="function"?rt.call(tt,j,_e):rt,_e==null)break e;j=A({},j,_e);break e;case 2:jh=!0}}g.callback!==null&&g.lane!==0&&(a.flags|=64,_e=c.effects,_e===null?c.effects=[g]:_e.push(g))}else tt={eventTime:tt,lane:_e,tag:g.tag,payload:g.payload,callback:g.callback,next:null},$===null?(b=$=tt,_=j):$=$.next=tt,h|=_e;if(g=g.next,g===null){if(g=c.shared.pending,g===null)break;_e=g,g=_e.next,_e.next=null,c.lastBaseUpdate=_e,c.shared.pending=null}}while(!0);if($===null&&(_=j),c.baseState=_,c.firstBaseUpdate=b,c.lastBaseUpdate=$,e=c.shared.interleaved,e!==null){c=e;do h|=c.lane,c=c.next;while(c!==e)}else d===null&&(c.shared.lanes=0);rh|=h,a.lanes=h,a.memoizedState=j}}function sh(a,e,s){if(a=e.effects,e.effects=null,a!==null)for(e=0;e<a.length;e++){var o=a[e],c=o.callback;if(c!==null){if(o.callback=null,o=s,typeof c!="function")throw Error(p(191,c));c.call(o)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(a){if(a===th)throw Error(p(174));return a}function yh(a,e){switch(G(wh,e),G(vh$1,a),G(uh,th),a=e.nodeType,a){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lb(null,"");break;default:a=a===8?e.parentNode:e,e=a.namespaceURI||null,a=a.tagName,e=lb(e,a)}E$1(uh),G(uh,e)}function zh(){E$1(uh),E$1(vh$1),E$1(wh)}function Ah(a){xh(wh.current);var e=xh(uh.current),s=lb(e,a.type);e!==s&&(G(vh$1,a),G(uh,s))}function Bh(a){vh$1.current===a&&(E$1(uh),E$1(vh$1))}var L=Uf(0);function Ch(a){for(var e=a;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break;for(;e.sibling===null;){if(e.return===null||e.return===a)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Dh=[];function Eh(){for(var a=0;a<Dh.length;a++)Dh[a]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(a,e){if(e===null)return!1;for(var s=0;s<e.length&&s<a.length;s++)if(!He(a[s],e[s]))return!1;return!0}function Nh(a,e,s,o,c,d){if(Hh=d,M=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Fh.current=a===null||a.memoizedState===null?Oh:Ph,a=s(o,c),Jh){d=0;do{if(Jh=!1,Kh=0,25<=d)throw Error(p(301));d+=1,O=N=null,e.updateQueue=null,Fh.current=Qh,a=s(o,c)}while(Jh)}if(Fh.current=Rh,e=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,e)throw Error(p(300));return a}function Sh(){var a=Kh!==0;return Kh=0,a}function Th(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=a:O=O.next=a,O}function Uh(){if(N===null){var a=M.alternate;a=a!==null?a.memoizedState:null}else a=N.next;var e=O===null?M.memoizedState:O.next;if(e!==null)O=e,N=a;else{if(a===null)throw Error(p(310));N=a,a={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=a:O=O.next=a}return O}function Vh(a,e){return typeof e=="function"?e(a):e}function Wh(a){var e=Uh(),s=e.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=a;var o=N,c=o.baseQueue,d=s.pending;if(d!==null){if(c!==null){var h=c.next;c.next=d.next,d.next=h}o.baseQueue=c=d,s.pending=null}if(c!==null){d=c.next,o=o.baseState;var g=h=null,_=null,b=d;do{var $=b.lane;if((Hh&$)===$)_!==null&&(_=_.next={lane:0,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null}),o=b.hasEagerState?b.eagerState:a(o,b.action);else{var j={lane:$,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null};_===null?(g=_=j,h=o):_=_.next=j,M.lanes|=$,rh|=$}b=b.next}while(b!==null&&b!==d);_===null?h=o:_.next=g,He(o,e.memoizedState)||(dh=!0),e.memoizedState=o,e.baseState=h,e.baseQueue=_,s.lastRenderedState=o}if(a=s.interleaved,a!==null){c=a;do d=c.lane,M.lanes|=d,rh|=d,c=c.next;while(c!==a)}else c===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function Xh(a){var e=Uh(),s=e.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=a;var o=s.dispatch,c=s.pending,d=e.memoizedState;if(c!==null){s.pending=null;var h=c=c.next;do d=a(d,h.action),h=h.next;while(h!==c);He(d,e.memoizedState)||(dh=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),s.lastRenderedState=d}return[d,o]}function Yh(){}function Zh(a,e){var s=M,o=Uh(),c=e(),d=!He(o.memoizedState,c);if(d&&(o.memoizedState=c,dh=!0),o=o.queue,$h(ai.bind(null,s,o,a),[a]),o.getSnapshot!==e||d||O!==null&&O.memoizedState.tag&1){if(s.flags|=2048,bi(9,ci.bind(null,s,o,c,e),void 0,null),Q===null)throw Error(p(349));Hh&30||di(s,e,c)}return c}function di(a,e,s){a.flags|=16384,a={getSnapshot:e,value:s},e=M.updateQueue,e===null?(e={lastEffect:null,stores:null},M.updateQueue=e,e.stores=[a]):(s=e.stores,s===null?e.stores=[a]:s.push(a))}function ci(a,e,s,o){e.value=s,e.getSnapshot=o,ei(e)&&fi(a)}function ai(a,e,s){return s(function(){ei(e)&&fi(a)})}function ei(a){var e=a.getSnapshot;a=a.value;try{var s=e();return!He(a,s)}catch{return!0}}function fi(a){var e=ih(a,1);e!==null&&gi(e,a,1,-1)}function hi(a){var e=Th();return typeof a=="function"&&(a=a()),e.memoizedState=e.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:a},e.queue=a,a=a.dispatch=ii.bind(null,M,a),[e.memoizedState,a]}function bi(a,e,s,o){return a={tag:a,create:e,destroy:s,deps:o,next:null},e=M.updateQueue,e===null?(e={lastEffect:null,stores:null},M.updateQueue=e,e.lastEffect=a.next=a):(s=e.lastEffect,s===null?e.lastEffect=a.next=a:(o=s.next,s.next=a,a.next=o,e.lastEffect=a)),a}function ji(){return Uh().memoizedState}function ki(a,e,s,o){var c=Th();M.flags|=a,c.memoizedState=bi(1|e,s,void 0,o===void 0?null:o)}function li(a,e,s,o){var c=Uh();o=o===void 0?null:o;var d=void 0;if(N!==null){var h=N.memoizedState;if(d=h.destroy,o!==null&&Mh(o,h.deps)){c.memoizedState=bi(e,s,d,o);return}}M.flags|=a,c.memoizedState=bi(1|e,s,d,o)}function mi(a,e){return ki(8390656,8,a,e)}function $h(a,e){return li(2048,8,a,e)}function ni(a,e){return li(4,2,a,e)}function oi(a,e){return li(4,4,a,e)}function pi(a,e){if(typeof e=="function")return a=a(),e(a),function(){e(null)};if(e!=null)return a=a(),e.current=a,function(){e.current=null}}function qi(a,e,s){return s=s!=null?s.concat([a]):null,li(4,4,pi.bind(null,e,a),s)}function ri(){}function si(a,e){var s=Uh();e=e===void 0?null:e;var o=s.memoizedState;return o!==null&&e!==null&&Mh(e,o[1])?o[0]:(s.memoizedState=[a,e],a)}function ti(a,e){var s=Uh();e=e===void 0?null:e;var o=s.memoizedState;return o!==null&&e!==null&&Mh(e,o[1])?o[0]:(a=a(),s.memoizedState=[a,e],a)}function ui(a,e,s){return Hh&21?(He(s,e)||(s=yc(),M.lanes|=s,rh|=s,a.baseState=!0),e):(a.baseState&&(a.baseState=!1,dh=!0),a.memoizedState=s)}function vi(a,e){var s=C;C=s!==0&&4>s?s:4,a(!0);var o=Gh.transition;Gh.transition={};try{a(!1),e()}finally{C=s,Gh.transition=o}}function wi(){return Uh().memoizedState}function xi(a,e,s){var o=yi(a);if(s={lane:o,action:s,hasEagerState:!1,eagerState:null,next:null},zi(a))Ai(e,s);else if(s=hh(a,e,s,o),s!==null){var c=R$1();gi(s,a,o,c),Bi(s,e,o)}}function ii(a,e,s){var o=yi(a),c={lane:o,action:s,hasEagerState:!1,eagerState:null,next:null};if(zi(a))Ai(e,c);else{var d=a.alternate;if(a.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var h=e.lastRenderedState,g=d(h,s);if(c.hasEagerState=!0,c.eagerState=g,He(g,h)){var _=e.interleaved;_===null?(c.next=c,gh(e)):(c.next=_.next,_.next=c),e.interleaved=c;return}}catch{}finally{}s=hh(a,e,c,o),s!==null&&(c=R$1(),gi(s,a,o,c),Bi(s,e,o))}}function zi(a){var e=a.alternate;return a===M||e!==null&&e===M}function Ai(a,e){Jh=Ih=!0;var s=a.pending;s===null?e.next=e:(e.next=s.next,s.next=e),a.pending=e}function Bi(a,e,s){if(s&4194240){var o=e.lanes;o&=a.pendingLanes,s|=o,e.lanes=s,Cc(a,s)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(a,e){return Th().memoizedState=[a,e===void 0?null:e],a},useContext:eh,useEffect:mi,useImperativeHandle:function(a,e,s){return s=s!=null?s.concat([a]):null,ki(4194308,4,pi.bind(null,e,a),s)},useLayoutEffect:function(a,e){return ki(4194308,4,a,e)},useInsertionEffect:function(a,e){return ki(4,2,a,e)},useMemo:function(a,e){var s=Th();return e=e===void 0?null:e,a=a(),s.memoizedState=[a,e],a},useReducer:function(a,e,s){var o=Th();return e=s!==void 0?s(e):e,o.memoizedState=o.baseState=e,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:e},o.queue=a,a=a.dispatch=xi.bind(null,M,a),[o.memoizedState,a]},useRef:function(a){var e=Th();return a={current:a},e.memoizedState=a},useState:hi,useDebugValue:ri,useDeferredValue:function(a){return Th().memoizedState=a},useTransition:function(){var a=hi(!1),e=a[0];return a=vi.bind(null,a[1]),Th().memoizedState=a,[e,a]},useMutableSource:function(){},useSyncExternalStore:function(a,e,s){var o=M,c=Th();if(I){if(s===void 0)throw Error(p(407));s=s()}else{if(s=e(),Q===null)throw Error(p(349));Hh&30||di(o,e,s)}c.memoizedState=s;var d={value:s,getSnapshot:e};return c.queue=d,mi(ai.bind(null,o,d,a),[a]),o.flags|=2048,bi(9,ci.bind(null,o,d,s,e),void 0,null),s},useId:function(){var a=Th(),e=Q.identifierPrefix;if(I){var s=sg,o=rg;s=(o&~(1<<32-oc(o)-1)).toString(32)+s,e=":"+e+"R"+s,s=Kh++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=Lh++,e=":"+e+"r"+s.toString(32)+":";return a.memoizedState=e},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(a){var e=Uh();return ui(e,N.memoizedState,a)},useTransition:function(){var a=Wh(Vh)[0],e=Uh().memoizedState;return[a,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(a){var e=Uh();return N===null?e.memoizedState=a:ui(e,N.memoizedState,a)},useTransition:function(){var a=Xh(Vh)[0],e=Uh().memoizedState;return[a,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(a,e){if(a&&a.defaultProps){e=A({},e),a=a.defaultProps;for(var s in a)e[s]===void 0&&(e[s]=a[s]);return e}return e}function Di(a,e,s,o){e=a.memoizedState,s=s(o,e),s=s==null?e:A({},e,s),a.memoizedState=s,a.lanes===0&&(a.updateQueue.baseState=s)}var Ei={isMounted:function(a){return(a=a._reactInternals)?Vb(a)===a:!1},enqueueSetState:function(a,e,s){a=a._reactInternals;var o=R$1(),c=yi(a),d=mh(o,c);d.payload=e,s!=null&&(d.callback=s),e=nh(a,d,c),e!==null&&(gi(e,a,c,o),oh(e,a,c))},enqueueReplaceState:function(a,e,s){a=a._reactInternals;var o=R$1(),c=yi(a),d=mh(o,c);d.tag=1,d.payload=e,s!=null&&(d.callback=s),e=nh(a,d,c),e!==null&&(gi(e,a,c,o),oh(e,a,c))},enqueueForceUpdate:function(a,e){a=a._reactInternals;var s=R$1(),o=yi(a),c=mh(s,o);c.tag=2,e!=null&&(c.callback=e),e=nh(a,c,o),e!==null&&(gi(e,a,o,s),oh(e,a,o))}};function Fi(a,e,s,o,c,d,h){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(o,d,h):e.prototype&&e.prototype.isPureReactComponent?!Ie(s,o)||!Ie(c,d):!0}function Gi(a,e,s){var o=!1,c=Vf,d=e.contextType;return typeof d=="object"&&d!==null?d=eh(d):(c=Zf(e)?Xf:H.current,o=e.contextTypes,d=(o=o!=null)?Yf(a,c):Vf),e=new e(s,d),a.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ei,a.stateNode=e,e._reactInternals=a,o&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=c,a.__reactInternalMemoizedMaskedChildContext=d),e}function Hi(a,e,s,o){a=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,o),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,o),e.state!==a&&Ei.enqueueReplaceState(e,e.state,null)}function Ii(a,e,s,o){var c=a.stateNode;c.props=s,c.state=a.memoizedState,c.refs={},kh(a);var d=e.contextType;typeof d=="object"&&d!==null?c.context=eh(d):(d=Zf(e)?Xf:H.current,c.context=Yf(a,d)),c.state=a.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(Di(a,e,d,s),c.state=a.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&Ei.enqueueReplaceState(c,c.state,null),qh(a,s,c,o),c.state=a.memoizedState),typeof c.componentDidMount=="function"&&(a.flags|=4194308)}function Ji(a,e){try{var s="",o=e;do s+=Pa(o),o=o.return;while(o);var c=s}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:a,source:e,stack:c,digest:null}}function Ki(a,e,s){return{value:a,source:null,stack:s??null,digest:e??null}}function Li(a,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(a,e,s){s=mh(-1,s),s.tag=3,s.payload={element:null};var o=e.value;return s.callback=function(){Oi||(Oi=!0,Pi=o),Li(a,e)},s}function Qi(a,e,s){s=mh(-1,s),s.tag=3;var o=a.type.getDerivedStateFromError;if(typeof o=="function"){var c=e.value;s.payload=function(){return o(c)},s.callback=function(){Li(a,e)}}var d=a.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(s.callback=function(){Li(a,e),typeof o!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),s}function Si(a,e,s){var o=a.pingCache;if(o===null){o=a.pingCache=new Mi;var c=new Set;o.set(e,c)}else c=o.get(e),c===void 0&&(c=new Set,o.set(e,c));c.has(s)||(c.add(s),a=Ti.bind(null,a,e,s),e.then(a,a))}function Ui(a){do{var e;if((e=a.tag===13)&&(e=a.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return a;a=a.return}while(a!==null);return null}function Vi(a,e,s,o,c){return a.mode&1?(a.flags|=65536,a.lanes=c,a):(a===e?a.flags|=65536:(a.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=mh(-1,1),e.tag=2,nh(s,e,1))),s.lanes|=1),a)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(a,e,s,o){e.child=a===null?Vg(e,null,s,o):Ug(e,a.child,s,o)}function Yi(a,e,s,o,c){s=s.render;var d=e.ref;return ch(e,c),o=Nh(a,e,s,o,d,c),s=Sh(),a!==null&&!dh?(e.updateQueue=a.updateQueue,e.flags&=-2053,a.lanes&=~c,Zi(a,e,c)):(I&&s&&vg(e),e.flags|=1,Xi(a,e,o,c),e.child)}function $i(a,e,s,o,c){if(a===null){var d=s.type;return typeof d=="function"&&!aj(d)&&d.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=d,bj(a,e,d,o,c)):(a=Rg(s.type,null,o,e,e.mode,c),a.ref=e.ref,a.return=e,e.child=a)}if(d=a.child,!(a.lanes&c)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:Ie,s(h,o)&&a.ref===e.ref)return Zi(a,e,c)}return e.flags|=1,a=Pg(d,o),a.ref=e.ref,a.return=e,e.child=a}function bj(a,e,s,o,c){if(a!==null){var d=a.memoizedProps;if(Ie(d,o)&&a.ref===e.ref)if(dh=!1,e.pendingProps=o=d,(a.lanes&c)!==0)a.flags&131072&&(dh=!0);else return e.lanes=a.lanes,Zi(a,e,c)}return cj(a,e,s,o,c)}function dj(a,e,s){var o=e.pendingProps,c=o.children,d=a!==null?a.memoizedState:null;if(o.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=s;else{if(!(s&1073741824))return a=d!==null?d.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:a,cachePool:null,transitions:null},e.updateQueue=null,G(ej,fj),fj|=a,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=d!==null?d.baseLanes:s,G(ej,fj),fj|=o}else d!==null?(o=d.baseLanes|s,e.memoizedState=null):o=s,G(ej,fj),fj|=o;return Xi(a,e,c,s),e.child}function gj(a,e){var s=e.ref;(a===null&&s!==null||a!==null&&a.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function cj(a,e,s,o,c){var d=Zf(s)?Xf:H.current;return d=Yf(e,d),ch(e,c),s=Nh(a,e,s,o,d,c),o=Sh(),a!==null&&!dh?(e.updateQueue=a.updateQueue,e.flags&=-2053,a.lanes&=~c,Zi(a,e,c)):(I&&o&&vg(e),e.flags|=1,Xi(a,e,s,c),e.child)}function hj(a,e,s,o,c){if(Zf(s)){var d=!0;cg(e)}else d=!1;if(ch(e,c),e.stateNode===null)ij(a,e),Gi(e,s,o),Ii(e,s,o,c),o=!0;else if(a===null){var h=e.stateNode,g=e.memoizedProps;h.props=g;var _=h.context,b=s.contextType;typeof b=="object"&&b!==null?b=eh(b):(b=Zf(s)?Xf:H.current,b=Yf(e,b));var $=s.getDerivedStateFromProps,j=typeof $=="function"||typeof h.getSnapshotBeforeUpdate=="function";j||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(g!==o||_!==b)&&Hi(e,h,o,b),jh=!1;var _e=e.memoizedState;h.state=_e,qh(e,o,h,c),_=e.memoizedState,g!==o||_e!==_||Wf.current||jh?(typeof $=="function"&&(Di(e,s,$,o),_=e.memoizedState),(g=jh||Fi(e,s,g,o,_e,_,b))?(j||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=o,e.memoizedState=_),h.props=o,h.state=_,h.context=b,o=g):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),o=!1)}else{h=e.stateNode,lh(a,e),g=e.memoizedProps,b=e.type===e.elementType?g:Ci(e.type,g),h.props=b,j=e.pendingProps,_e=h.context,_=s.contextType,typeof _=="object"&&_!==null?_=eh(_):(_=Zf(s)?Xf:H.current,_=Yf(e,_));var tt=s.getDerivedStateFromProps;($=typeof tt=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(g!==j||_e!==_)&&Hi(e,h,o,_),jh=!1,_e=e.memoizedState,h.state=_e,qh(e,o,h,c);var rt=e.memoizedState;g!==j||_e!==rt||Wf.current||jh?(typeof tt=="function"&&(Di(e,s,tt,o),rt=e.memoizedState),(b=jh||Fi(e,s,b,o,_e,rt,_)||!1)?($||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(o,rt,_),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(o,rt,_)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||g===a.memoizedProps&&_e===a.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||g===a.memoizedProps&&_e===a.memoizedState||(e.flags|=1024),e.memoizedProps=o,e.memoizedState=rt),h.props=o,h.state=rt,h.context=_,o=b):(typeof h.componentDidUpdate!="function"||g===a.memoizedProps&&_e===a.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||g===a.memoizedProps&&_e===a.memoizedState||(e.flags|=1024),o=!1)}return jj(a,e,s,o,d,c)}function jj(a,e,s,o,c,d){gj(a,e);var h=(e.flags&128)!==0;if(!o&&!h)return c&&dg(e,s,!1),Zi(a,e,d);o=e.stateNode,Wi.current=e;var g=h&&typeof s.getDerivedStateFromError!="function"?null:o.render();return e.flags|=1,a!==null&&h?(e.child=Ug(e,a.child,null,d),e.child=Ug(e,null,g,d)):Xi(a,e,g,d),e.memoizedState=o.state,c&&dg(e,s,!0),e.child}function kj(a){var e=a.stateNode;e.pendingContext?ag(a,e.pendingContext,e.pendingContext!==e.context):e.context&&ag(a,e.context,!1),yh(a,e.containerInfo)}function lj(a,e,s,o,c){return Ig(),Jg(c),e.flags|=256,Xi(a,e,s,o),e.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(a){return{baseLanes:a,cachePool:null,transitions:null}}function oj(a,e,s){var o=e.pendingProps,c=L.current,d=!1,h=(e.flags&128)!==0,g;if((g=h)||(g=a!==null&&a.memoizedState===null?!1:(c&2)!==0),g?(d=!0,e.flags&=-129):(a===null||a.memoizedState!==null)&&(c|=1),G(L,c&1),a===null)return Eg(e),a=e.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?(e.mode&1?a.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=o.children,a=o.fallback,d?(o=e.mode,d=e.child,h={mode:"hidden",children:h},!(o&1)&&d!==null?(d.childLanes=0,d.pendingProps=h):d=pj(h,o,0,null),a=Tg(a,o,s,null),d.return=e,a.return=e,d.sibling=a,e.child=d,e.child.memoizedState=nj(s),e.memoizedState=mj,a):qj(e,h));if(c=a.memoizedState,c!==null&&(g=c.dehydrated,g!==null))return rj(a,e,h,o,g,c,s);if(d){d=o.fallback,h=e.mode,c=a.child,g=c.sibling;var _={mode:"hidden",children:o.children};return!(h&1)&&e.child!==c?(o=e.child,o.childLanes=0,o.pendingProps=_,e.deletions=null):(o=Pg(c,_),o.subtreeFlags=c.subtreeFlags&14680064),g!==null?d=Pg(g,d):(d=Tg(d,h,s,null),d.flags|=2),d.return=e,o.return=e,o.sibling=d,e.child=o,o=d,d=e.child,h=a.child.memoizedState,h=h===null?nj(s):{baseLanes:h.baseLanes|s,cachePool:null,transitions:h.transitions},d.memoizedState=h,d.childLanes=a.childLanes&~s,e.memoizedState=mj,o}return d=a.child,a=d.sibling,o=Pg(d,{mode:"visible",children:o.children}),!(e.mode&1)&&(o.lanes=s),o.return=e,o.sibling=null,a!==null&&(s=e.deletions,s===null?(e.deletions=[a],e.flags|=16):s.push(a)),e.child=o,e.memoizedState=null,o}function qj(a,e){return e=pj({mode:"visible",children:e},a.mode,0,null),e.return=a,a.child=e}function sj(a,e,s,o){return o!==null&&Jg(o),Ug(e,a.child,null,s),a=qj(e,e.pendingProps.children),a.flags|=2,e.memoizedState=null,a}function rj(a,e,s,o,c,d,h){if(s)return e.flags&256?(e.flags&=-257,o=Ki(Error(p(422))),sj(a,e,h,o)):e.memoizedState!==null?(e.child=a.child,e.flags|=128,null):(d=o.fallback,c=e.mode,o=pj({mode:"visible",children:o.children},c,0,null),d=Tg(d,c,h,null),d.flags|=2,o.return=e,d.return=e,o.sibling=d,e.child=o,e.mode&1&&Ug(e,a.child,null,h),e.child.memoizedState=nj(h),e.memoizedState=mj,d);if(!(e.mode&1))return sj(a,e,h,null);if(c.data==="$!"){if(o=c.nextSibling&&c.nextSibling.dataset,o)var g=o.dgst;return o=g,d=Error(p(419)),o=Ki(d,o,void 0),sj(a,e,h,o)}if(g=(h&a.childLanes)!==0,dh||g){if(o=Q,o!==null){switch(h&-h){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(o.suspendedLanes|h)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,ih(a,c),gi(o,a,c,-1))}return tj(),o=Ki(Error(p(421))),sj(a,e,h,o)}return c.data==="$?"?(e.flags|=128,e.child=a.child,e=uj.bind(null,a),c._reactRetry=e,null):(a=d.treeContext,yg=Lf(c.nextSibling),xg=e,I=!0,zg=null,a!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=a.id,sg=a.overflow,qg=e),e=qj(e,o.children),e.flags|=4096,e)}function vj(a,e,s){a.lanes|=e;var o=a.alternate;o!==null&&(o.lanes|=e),bh(a.return,e,s)}function wj(a,e,s,o,c){var d=a.memoizedState;d===null?a.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:o,tail:s,tailMode:c}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=s,d.tailMode=c)}function xj(a,e,s){var o=e.pendingProps,c=o.revealOrder,d=o.tail;if(Xi(a,e,o.children,s),o=L.current,o&2)o=o&1|2,e.flags|=128;else{if(a!==null&&a.flags&128)e:for(a=e.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&vj(a,s,e);else if(a.tag===19)vj(a,s,e);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}o&=1}if(G(L,o),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(s=e.child,c=null;s!==null;)a=s.alternate,a!==null&&Ch(a)===null&&(c=s),s=s.sibling;s=c,s===null?(c=e.child,e.child=null):(c=s.sibling,s.sibling=null),wj(e,!1,c,s,d);break;case"backwards":for(s=null,c=e.child,e.child=null;c!==null;){if(a=c.alternate,a!==null&&Ch(a)===null){e.child=c;break}a=c.sibling,c.sibling=s,s=c,c=a}wj(e,!0,s,null,d);break;case"together":wj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ij(a,e){!(e.mode&1)&&a!==null&&(a.alternate=null,e.alternate=null,e.flags|=2)}function Zi(a,e,s){if(a!==null&&(e.dependencies=a.dependencies),rh|=e.lanes,!(s&e.childLanes))return null;if(a!==null&&e.child!==a.child)throw Error(p(153));if(e.child!==null){for(a=e.child,s=Pg(a,a.pendingProps),e.child=s,s.return=e;a.sibling!==null;)a=a.sibling,s=s.sibling=Pg(a,a.pendingProps),s.return=e;s.sibling=null}return e.child}function yj(a,e,s){switch(e.tag){case 3:kj(e),Ig();break;case 5:Ah(e);break;case 1:Zf(e.type)&&cg(e);break;case 4:yh(e,e.stateNode.containerInfo);break;case 10:var o=e.type._context,c=e.memoizedProps.value;G(Wg,o._currentValue),o._currentValue=c;break;case 13:if(o=e.memoizedState,o!==null)return o.dehydrated!==null?(G(L,L.current&1),e.flags|=128,null):s&e.child.childLanes?oj(a,e,s):(G(L,L.current&1),a=Zi(a,e,s),a!==null?a.sibling:null);G(L,L.current&1);break;case 19:if(o=(s&e.childLanes)!==0,a.flags&128){if(o)return xj(a,e,s);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),G(L,L.current),o)break;return null;case 22:case 23:return e.lanes=0,dj(a,e,s)}return Zi(a,e,s)}var zj,Aj,Bj,Cj;zj=function(a,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)a.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Aj=function(){};Bj=function(a,e,s,o){var c=a.memoizedProps;if(c!==o){a=e.stateNode,xh(uh.current);var d=null;switch(s){case"input":c=Ya(a,c),o=Ya(a,o),d=[];break;case"select":c=A({},c,{value:void 0}),o=A({},o,{value:void 0}),d=[];break;case"textarea":c=gb(a,c),o=gb(a,o),d=[];break;default:typeof c.onClick!="function"&&typeof o.onClick=="function"&&(a.onclick=Bf)}ub(s,o);var h;s=null;for(b in c)if(!o.hasOwnProperty(b)&&c.hasOwnProperty(b)&&c[b]!=null)if(b==="style"){var g=c[b];for(h in g)g.hasOwnProperty(h)&&(s||(s={}),s[h]="")}else b!=="dangerouslySetInnerHTML"&&b!=="children"&&b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(ea.hasOwnProperty(b)?d||(d=[]):(d=d||[]).push(b,null));for(b in o){var _=o[b];if(g=c!=null?c[b]:void 0,o.hasOwnProperty(b)&&_!==g&&(_!=null||g!=null))if(b==="style")if(g){for(h in g)!g.hasOwnProperty(h)||_&&_.hasOwnProperty(h)||(s||(s={}),s[h]="");for(h in _)_.hasOwnProperty(h)&&g[h]!==_[h]&&(s||(s={}),s[h]=_[h])}else s||(d||(d=[]),d.push(b,s)),s=_;else b==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,g=g?g.__html:void 0,_!=null&&g!==_&&(d=d||[]).push(b,_)):b==="children"?typeof _!="string"&&typeof _!="number"||(d=d||[]).push(b,""+_):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&(ea.hasOwnProperty(b)?(_!=null&&b==="onScroll"&&D("scroll",a),d||g===_||(d=[])):(d=d||[]).push(b,_))}s&&(d=d||[]).push("style",s);var b=d;(e.updateQueue=b)&&(e.flags|=4)}};Cj=function(a,e,s,o){s!==o&&(e.flags|=4)};function Dj(a,e){if(!I)switch(a.tailMode){case"hidden":e=a.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?a.tail=null:s.sibling=null;break;case"collapsed":s=a.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?e||a.tail===null?a.tail=null:a.tail.sibling=null:o.sibling=null}}function S(a){var e=a.alternate!==null&&a.alternate.child===a.child,s=0,o=0;if(e)for(var c=a.child;c!==null;)s|=c.lanes|c.childLanes,o|=c.subtreeFlags&14680064,o|=c.flags&14680064,c.return=a,c=c.sibling;else for(c=a.child;c!==null;)s|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=a,c=c.sibling;return a.subtreeFlags|=o,a.childLanes=s,e}function Ej(a,e,s){var o=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(e),null;case 1:return Zf(e.type)&&$f(),S(e),null;case 3:return o=e.stateNode,zh(),E$1(Wf),E$1(H),Eh(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(a===null||a.child===null)&&(Gg(e)?e.flags|=4:a===null||a.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(a,e),S(e),null;case 5:Bh(e);var c=xh(wh.current);if(s=e.type,a!==null&&e.stateNode!=null)Bj(a,e,s,o,c),a.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!o){if(e.stateNode===null)throw Error(p(166));return S(e),null}if(a=xh(uh.current),Gg(e)){o=e.stateNode,s=e.type;var d=e.memoizedProps;switch(o[Of]=e,o[Pf]=d,a=(e.mode&1)!==0,s){case"dialog":D("cancel",o),D("close",o);break;case"iframe":case"object":case"embed":D("load",o);break;case"video":case"audio":for(c=0;c<lf.length;c++)D(lf[c],o);break;case"source":D("error",o);break;case"img":case"image":case"link":D("error",o),D("load",o);break;case"details":D("toggle",o);break;case"input":Za(o,d),D("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!d.multiple},D("invalid",o);break;case"textarea":hb(o,d),D("invalid",o)}ub(s,d),c=null;for(var h in d)if(d.hasOwnProperty(h)){var g=d[h];h==="children"?typeof g=="string"?o.textContent!==g&&(d.suppressHydrationWarning!==!0&&Af(o.textContent,g,a),c=["children",g]):typeof g=="number"&&o.textContent!==""+g&&(d.suppressHydrationWarning!==!0&&Af(o.textContent,g,a),c=["children",""+g]):ea.hasOwnProperty(h)&&g!=null&&h==="onScroll"&&D("scroll",o)}switch(s){case"input":Va(o),db$1(o,d,!0);break;case"textarea":Va(o),jb(o);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(o.onclick=Bf)}o=c,e.updateQueue=o,o!==null&&(e.flags|=4)}else{h=c.nodeType===9?c:c.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=kb(s)),a==="http://www.w3.org/1999/xhtml"?s==="script"?(a=h.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof o.is=="string"?a=h.createElement(s,{is:o.is}):(a=h.createElement(s),s==="select"&&(h=a,o.multiple?h.multiple=!0:o.size&&(h.size=o.size))):a=h.createElementNS(a,s),a[Of]=e,a[Pf]=o,zj(a,e,!1,!1),e.stateNode=a;e:{switch(h=vb(s,o),s){case"dialog":D("cancel",a),D("close",a),c=o;break;case"iframe":case"object":case"embed":D("load",a),c=o;break;case"video":case"audio":for(c=0;c<lf.length;c++)D(lf[c],a);c=o;break;case"source":D("error",a),c=o;break;case"img":case"image":case"link":D("error",a),D("load",a),c=o;break;case"details":D("toggle",a),c=o;break;case"input":Za(a,o),c=Ya(a,o),D("invalid",a);break;case"option":c=o;break;case"select":a._wrapperState={wasMultiple:!!o.multiple},c=A({},o,{value:void 0}),D("invalid",a);break;case"textarea":hb(a,o),c=gb(a,o),D("invalid",a);break;default:c=o}ub(s,c),g=c;for(d in g)if(g.hasOwnProperty(d)){var _=g[d];d==="style"?sb(a,_):d==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&nb(a,_)):d==="children"?typeof _=="string"?(s!=="textarea"||_!=="")&&ob(a,_):typeof _=="number"&&ob(a,""+_):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ea.hasOwnProperty(d)?_!=null&&d==="onScroll"&&D("scroll",a):_!=null&&ta(a,d,_,h))}switch(s){case"input":Va(a),db$1(a,o,!1);break;case"textarea":Va(a),jb(a);break;case"option":o.value!=null&&a.setAttribute("value",""+Sa(o.value));break;case"select":a.multiple=!!o.multiple,d=o.value,d!=null?fb(a,!!o.multiple,d,!1):o.defaultValue!=null&&fb(a,!!o.multiple,o.defaultValue,!0);break;default:typeof c.onClick=="function"&&(a.onclick=Bf)}switch(s){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return S(e),null;case 6:if(a&&e.stateNode!=null)Cj(a,e,a.memoizedProps,o);else{if(typeof o!="string"&&e.stateNode===null)throw Error(p(166));if(s=xh(wh.current),xh(uh.current),Gg(e)){if(o=e.stateNode,s=e.memoizedProps,o[Of]=e,(d=o.nodeValue!==s)&&(a=xg,a!==null))switch(a.tag){case 3:Af(o.nodeValue,s,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Af(o.nodeValue,s,(a.mode&1)!==0)}d&&(e.flags|=4)}else o=(s.nodeType===9?s:s.ownerDocument).createTextNode(o),o[Of]=e,e.stateNode=o}return S(e),null;case 13:if(E$1(L),o=e.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(I&&yg!==null&&e.mode&1&&!(e.flags&128))Hg(),Ig(),e.flags|=98560,d=!1;else if(d=Gg(e),o!==null&&o.dehydrated!==null){if(a===null){if(!d)throw Error(p(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(p(317));d[Of]=e}else Ig(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;S(e),d=!1}else zg!==null&&(Fj(zg),zg=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(o=o!==null,o!==(a!==null&&a.memoizedState!==null)&&o&&(e.child.flags|=8192,e.mode&1&&(a===null||L.current&1?T===0&&(T=3):tj())),e.updateQueue!==null&&(e.flags|=4),S(e),null);case 4:return zh(),Aj(a,e),a===null&&sf(e.stateNode.containerInfo),S(e),null;case 10:return ah(e.type._context),S(e),null;case 17:return Zf(e.type)&&$f(),S(e),null;case 19:if(E$1(L),d=e.memoizedState,d===null)return S(e),null;if(o=(e.flags&128)!==0,h=d.rendering,h===null)if(o)Dj(d,!1);else{if(T!==0||a!==null&&a.flags&128)for(a=e.child;a!==null;){if(h=Ch(a),h!==null){for(e.flags|=128,Dj(d,!1),o=h.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),e.subtreeFlags=0,o=s,s=e.child;s!==null;)d=s,a=o,d.flags&=14680066,h=d.alternate,h===null?(d.childLanes=0,d.lanes=a,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=h.childLanes,d.lanes=h.lanes,d.child=h.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=h.memoizedProps,d.memoizedState=h.memoizedState,d.updateQueue=h.updateQueue,d.type=h.type,a=h.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s=s.sibling;return G(L,L.current&1|2),e.child}a=a.sibling}d.tail!==null&&B()>Gj&&(e.flags|=128,o=!0,Dj(d,!1),e.lanes=4194304)}else{if(!o)if(a=Ch(h),a!==null){if(e.flags|=128,o=!0,s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),Dj(d,!0),d.tail===null&&d.tailMode==="hidden"&&!h.alternate&&!I)return S(e),null}else 2*B()-d.renderingStartTime>Gj&&s!==1073741824&&(e.flags|=128,o=!0,Dj(d,!1),e.lanes=4194304);d.isBackwards?(h.sibling=e.child,e.child=h):(s=d.last,s!==null?s.sibling=h:e.child=h,d.last=h)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=B(),e.sibling=null,s=L.current,G(L,o?s&1|2:s&1),e):(S(e),null);case 22:case 23:return Hj(),o=e.memoizedState!==null,a!==null&&a.memoizedState!==null!==o&&(e.flags|=8192),o&&e.mode&1?fj&1073741824&&(S(e),e.subtreeFlags&6&&(e.flags|=8192)):S(e),null;case 24:return null;case 25:return null}throw Error(p(156,e.tag))}function Ij(a,e){switch(wg(e),e.tag){case 1:return Zf(e.type)&&$f(),a=e.flags,a&65536?(e.flags=a&-65537|128,e):null;case 3:return zh(),E$1(Wf),E$1(H),Eh(),a=e.flags,a&65536&&!(a&128)?(e.flags=a&-65537|128,e):null;case 5:return Bh(e),null;case 13:if(E$1(L),a=e.memoizedState,a!==null&&a.dehydrated!==null){if(e.alternate===null)throw Error(p(340));Ig()}return a=e.flags,a&65536?(e.flags=a&-65537|128,e):null;case 19:return E$1(L),null;case 4:return zh(),null;case 10:return ah(e.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(a,e){var s=a.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(o){W(a,e,o)}else s.current=null}function Mj(a,e,s){try{s()}catch(o){W(a,e,o)}}var Nj=!1;function Oj(a,e){if(Cf=dd,a=Me(),Ne(a)){if("selectionStart"in a)var s={start:a.selectionStart,end:a.selectionEnd};else e:{s=(s=a.ownerDocument)&&s.defaultView||window;var o=s.getSelection&&s.getSelection();if(o&&o.rangeCount!==0){s=o.anchorNode;var c=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,g=-1,_=-1,b=0,$=0,j=a,_e=null;t:for(;;){for(var tt;j!==s||c!==0&&j.nodeType!==3||(g=h+c),j!==d||o!==0&&j.nodeType!==3||(_=h+o),j.nodeType===3&&(h+=j.nodeValue.length),(tt=j.firstChild)!==null;)_e=j,j=tt;for(;;){if(j===a)break t;if(_e===s&&++b===c&&(g=h),_e===d&&++$===o&&(_=h),(tt=j.nextSibling)!==null)break;j=_e,_e=j.parentNode}j=tt}s=g===-1||_===-1?null:{start:g,end:_}}else s=null}s=s||{start:0,end:0}}else s=null;for(Df={focusedElem:a,selectionRange:s},dd=!1,V=e;V!==null;)if(e=V,a=e.child,(e.subtreeFlags&1028)!==0&&a!==null)a.return=e,V=a;else for(;V!==null;){e=V;try{var rt=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(rt!==null){var nt=rt.memoizedProps,st=rt.memoizedState,at=e.stateNode,ot=at.getSnapshotBeforeUpdate(e.elementType===e.type?nt:Ci(e.type,nt),st);at.__reactInternalSnapshotBeforeUpdate=ot}break;case 3:var ut=e.stateNode.containerInfo;ut.nodeType===1?ut.textContent="":ut.nodeType===9&&ut.documentElement&&ut.removeChild(ut.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(mt){W(e,e.return,mt)}if(a=e.sibling,a!==null){a.return=e.return,V=a;break}V=e.return}return rt=Nj,Nj=!1,rt}function Pj(a,e,s){var o=e.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0,d!==void 0&&Mj(e,s,d)}c=c.next}while(c!==o)}}function Qj(a,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&a)===a){var o=s.create;s.destroy=o()}s=s.next}while(s!==e)}}function Rj(a){var e=a.ref;if(e!==null){var s=a.stateNode;switch(a.tag){case 5:a=s;break;default:a=s}typeof e=="function"?e(a):e.current=a}}function Sj(a){var e=a.alternate;e!==null&&(a.alternate=null,Sj(e)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(e=a.stateNode,e!==null&&(delete e[Of],delete e[Pf],delete e[of],delete e[Qf],delete e[Rf])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Tj(a){return a.tag===5||a.tag===3||a.tag===4}function Uj(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Tj(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Vj(a,e,s){var o=a.tag;if(o===5||o===6)a=a.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(a,e):s.insertBefore(a,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(a,s)):(e=s,e.appendChild(a)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Bf));else if(o!==4&&(a=a.child,a!==null))for(Vj(a,e,s),a=a.sibling;a!==null;)Vj(a,e,s),a=a.sibling}function Wj(a,e,s){var o=a.tag;if(o===5||o===6)a=a.stateNode,e?s.insertBefore(a,e):s.appendChild(a);else if(o!==4&&(a=a.child,a!==null))for(Wj(a,e,s),a=a.sibling;a!==null;)Wj(a,e,s),a=a.sibling}var X=null,Xj=!1;function Yj(a,e,s){for(s=s.child;s!==null;)Zj(a,e,s),s=s.sibling}function Zj(a,e,s){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,s)}catch{}switch(s.tag){case 5:U||Lj(s,e);case 6:var o=X,c=Xj;X=null,Yj(a,e,s),X=o,Xj=c,X!==null&&(Xj?(a=X,s=s.stateNode,a.nodeType===8?a.parentNode.removeChild(s):a.removeChild(s)):X.removeChild(s.stateNode));break;case 18:X!==null&&(Xj?(a=X,s=s.stateNode,a.nodeType===8?Kf(a.parentNode,s):a.nodeType===1&&Kf(a,s),bd(a)):Kf(X,s.stateNode));break;case 4:o=X,c=Xj,X=s.stateNode.containerInfo,Xj=!0,Yj(a,e,s),X=o,Xj=c;break;case 0:case 11:case 14:case 15:if(!U&&(o=s.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){c=o=o.next;do{var d=c,h=d.destroy;d=d.tag,h!==void 0&&(d&2||d&4)&&Mj(s,e,h),c=c.next}while(c!==o)}Yj(a,e,s);break;case 1:if(!U&&(Lj(s,e),o=s.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=s.memoizedProps,o.state=s.memoizedState,o.componentWillUnmount()}catch(g){W(s,e,g)}Yj(a,e,s);break;case 21:Yj(a,e,s);break;case 22:s.mode&1?(U=(o=U)||s.memoizedState!==null,Yj(a,e,s),U=o):Yj(a,e,s);break;default:Yj(a,e,s)}}function ak(a){var e=a.updateQueue;if(e!==null){a.updateQueue=null;var s=a.stateNode;s===null&&(s=a.stateNode=new Kj),e.forEach(function(o){var c=bk.bind(null,a,o);s.has(o)||(s.add(o),o.then(c,c))})}}function ck(a,e){var s=e.deletions;if(s!==null)for(var o=0;o<s.length;o++){var c=s[o];try{var d=a,h=e,g=h;e:for(;g!==null;){switch(g.tag){case 5:X=g.stateNode,Xj=!1;break e;case 3:X=g.stateNode.containerInfo,Xj=!0;break e;case 4:X=g.stateNode.containerInfo,Xj=!0;break e}g=g.return}if(X===null)throw Error(p(160));Zj(d,h,c),X=null,Xj=!1;var _=c.alternate;_!==null&&(_.return=null),c.return=null}catch(b){W(c,e,b)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)dk(e,a),e=e.sibling}function dk(a,e){var s=a.alternate,o=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(ck(e,a),ek(a),o&4){try{Pj(3,a,a.return),Qj(3,a)}catch(nt){W(a,a.return,nt)}try{Pj(5,a,a.return)}catch(nt){W(a,a.return,nt)}}break;case 1:ck(e,a),ek(a),o&512&&s!==null&&Lj(s,s.return);break;case 5:if(ck(e,a),ek(a),o&512&&s!==null&&Lj(s,s.return),a.flags&32){var c=a.stateNode;try{ob(c,"")}catch(nt){W(a,a.return,nt)}}if(o&4&&(c=a.stateNode,c!=null)){var d=a.memoizedProps,h=s!==null?s.memoizedProps:d,g=a.type,_=a.updateQueue;if(a.updateQueue=null,_!==null)try{g==="input"&&d.type==="radio"&&d.name!=null&&ab(c,d),vb(g,h);var b=vb(g,d);for(h=0;h<_.length;h+=2){var $=_[h],j=_[h+1];$==="style"?sb(c,j):$==="dangerouslySetInnerHTML"?nb(c,j):$==="children"?ob(c,j):ta(c,$,j,b)}switch(g){case"input":bb(c,d);break;case"textarea":ib(c,d);break;case"select":var _e=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var tt=d.value;tt!=null?fb(c,!!d.multiple,tt,!1):_e!==!!d.multiple&&(d.defaultValue!=null?fb(c,!!d.multiple,d.defaultValue,!0):fb(c,!!d.multiple,d.multiple?[]:"",!1))}c[Pf]=d}catch(nt){W(a,a.return,nt)}}break;case 6:if(ck(e,a),ek(a),o&4){if(a.stateNode===null)throw Error(p(162));c=a.stateNode,d=a.memoizedProps;try{c.nodeValue=d}catch(nt){W(a,a.return,nt)}}break;case 3:if(ck(e,a),ek(a),o&4&&s!==null&&s.memoizedState.isDehydrated)try{bd(e.containerInfo)}catch(nt){W(a,a.return,nt)}break;case 4:ck(e,a),ek(a);break;case 13:ck(e,a),ek(a),c=a.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(fk=B())),o&4&&ak(a);break;case 22:if($=s!==null&&s.memoizedState!==null,a.mode&1?(U=(b=U)||$,ck(e,a),U=b):ck(e,a),ek(a),o&8192){if(b=a.memoizedState!==null,(a.stateNode.isHidden=b)&&!$&&a.mode&1)for(V=a,$=a.child;$!==null;){for(j=V=$;V!==null;){switch(_e=V,tt=_e.child,_e.tag){case 0:case 11:case 14:case 15:Pj(4,_e,_e.return);break;case 1:Lj(_e,_e.return);var rt=_e.stateNode;if(typeof rt.componentWillUnmount=="function"){o=_e,s=_e.return;try{e=o,rt.props=e.memoizedProps,rt.state=e.memoizedState,rt.componentWillUnmount()}catch(nt){W(o,s,nt)}}break;case 5:Lj(_e,_e.return);break;case 22:if(_e.memoizedState!==null){gk(j);continue}}tt!==null?(tt.return=_e,V=tt):gk(j)}$=$.sibling}e:for($=null,j=a;;){if(j.tag===5){if($===null){$=j;try{c=j.stateNode,b?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(g=j.stateNode,_=j.memoizedProps.style,h=_!=null&&_.hasOwnProperty("display")?_.display:null,g.style.display=rb("display",h))}catch(nt){W(a,a.return,nt)}}}else if(j.tag===6){if($===null)try{j.stateNode.nodeValue=b?"":j.memoizedProps}catch(nt){W(a,a.return,nt)}}else if((j.tag!==22&&j.tag!==23||j.memoizedState===null||j===a)&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===a)break e;for(;j.sibling===null;){if(j.return===null||j.return===a)break e;$===j&&($=null),j=j.return}$===j&&($=null),j.sibling.return=j.return,j=j.sibling}}break;case 19:ck(e,a),ek(a),o&4&&ak(a);break;case 21:break;default:ck(e,a),ek(a)}}function ek(a){var e=a.flags;if(e&2){try{e:{for(var s=a.return;s!==null;){if(Tj(s)){var o=s;break e}s=s.return}throw Error(p(160))}switch(o.tag){case 5:var c=o.stateNode;o.flags&32&&(ob(c,""),o.flags&=-33);var d=Uj(a);Wj(a,d,c);break;case 3:case 4:var h=o.stateNode.containerInfo,g=Uj(a);Vj(a,g,h);break;default:throw Error(p(161))}}catch(_){W(a,a.return,_)}a.flags&=-3}e&4096&&(a.flags&=-4097)}function hk(a,e,s){V=a,ik(a)}function ik(a,e,s){for(var o=(a.mode&1)!==0;V!==null;){var c=V,d=c.child;if(c.tag===22&&o){var h=c.memoizedState!==null||Jj;if(!h){var g=c.alternate,_=g!==null&&g.memoizedState!==null||U;g=Jj;var b=U;if(Jj=h,(U=_)&&!b)for(V=c;V!==null;)h=V,_=h.child,h.tag===22&&h.memoizedState!==null?jk(c):_!==null?(_.return=h,V=_):jk(c);for(;d!==null;)V=d,ik(d),d=d.sibling;V=c,Jj=g,U=b}kk(a)}else c.subtreeFlags&8772&&d!==null?(d.return=c,V=d):kk(a)}}function kk(a){for(;V!==null;){var e=V;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:U||Qj(5,e);break;case 1:var o=e.stateNode;if(e.flags&4&&!U)if(s===null)o.componentDidMount();else{var c=e.elementType===e.type?s.memoizedProps:Ci(e.type,s.memoizedProps);o.componentDidUpdate(c,s.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&sh(e,d,o);break;case 3:var h=e.updateQueue;if(h!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}sh(e,h,s)}break;case 5:var g=e.stateNode;if(s===null&&e.flags&4){s=g;var _=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&s.focus();break;case"img":_.src&&(s.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var b=e.alternate;if(b!==null){var $=b.memoizedState;if($!==null){var j=$.dehydrated;j!==null&&bd(j)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||e.flags&512&&Rj(e)}catch(_e){W(e,e.return,_e)}}if(e===a){V=null;break}if(s=e.sibling,s!==null){s.return=e.return,V=s;break}V=e.return}}function gk(a){for(;V!==null;){var e=V;if(e===a){V=null;break}var s=e.sibling;if(s!==null){s.return=e.return,V=s;break}V=e.return}}function jk(a){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{Qj(4,e)}catch(_){W(e,s,_)}break;case 1:var o=e.stateNode;if(typeof o.componentDidMount=="function"){var c=e.return;try{o.componentDidMount()}catch(_){W(e,c,_)}}var d=e.return;try{Rj(e)}catch(_){W(e,d,_)}break;case 5:var h=e.return;try{Rj(e)}catch(_){W(e,h,_)}}}catch(_){W(e,e.return,_)}if(e===a){V=null;break}var g=e.sibling;if(g!==null){g.return=e.return,V=g;break}V=e.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$1(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(a){return a.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(a=C,a!==0||(a=window.event,a=a===void 0?16:jd(a.type)),a):1}function gi(a,e,s,o){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(a,s,o),(!(K&2)||a!==Q)&&(a===Q&&(!(K&2)&&(qk|=s),T===4&&Ck(a,Z)),Dk(a,o),s===1&&K===0&&!(e.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(a,e){var s=a.callbackNode;wc(a,e);var o=uc(a,a===Q?Z:0);if(o===0)s!==null&&bc(s),a.callbackNode=null,a.callbackPriority=0;else if(e=o&-o,a.callbackPriority!==e){if(s!=null&&bc(s),e===1)a.tag===0?ig(Ek.bind(null,a)):hg(Ek.bind(null,a)),Jf(function(){!(K&6)&&jg()}),s=null;else{switch(Dc(o)){case 1:s=fc;break;case 4:s=gc;break;case 16:s=hc;break;case 536870912:s=jc;break;default:s=hc}s=Fk(s,Gk.bind(null,a))}a.callbackPriority=e,a.callbackNode=s}}function Gk(a,e){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var s=a.callbackNode;if(Hk()&&a.callbackNode!==s)return null;var o=uc(a,a===Q?Z:0);if(o===0)return null;if(o&30||o&a.expiredLanes||e)e=Ik(a,o);else{e=o;var c=K;K|=2;var d=Jk();(Q!==a||Z!==e)&&(uk=null,Gj=B()+500,Kk(a,e));do try{Lk();break}catch(g){Mk(a,g)}while(!0);$g(),mk.current=d,K=c,Y!==null?e=0:(Q=null,Z=0,e=T)}if(e!==0){if(e===2&&(c=xc(a),c!==0&&(o=c,e=Nk(a,c))),e===1)throw s=pk,Kk(a,0),Ck(a,o),Dk(a,B()),s;if(e===6)Ck(a,o);else{if(c=a.current.alternate,!(o&30)&&!Ok(c)&&(e=Ik(a,o),e===2&&(d=xc(a),d!==0&&(o=d,e=Nk(a,d))),e===1))throw s=pk,Kk(a,0),Ck(a,o),Dk(a,B()),s;switch(a.finishedWork=c,a.finishedLanes=o,e){case 0:case 1:throw Error(p(345));case 2:Pk(a,tk,uk);break;case 3:if(Ck(a,o),(o&130023424)===o&&(e=fk+500-B(),10<e)){if(uc(a,0)!==0)break;if(c=a.suspendedLanes,(c&o)!==o){R$1(),a.pingedLanes|=a.suspendedLanes&c;break}a.timeoutHandle=Ff(Pk.bind(null,a,tk,uk),e);break}Pk(a,tk,uk);break;case 4:if(Ck(a,o),(o&4194240)===o)break;for(e=a.eventTimes,c=-1;0<o;){var h=31-oc(o);d=1<<h,h=e[h],h>c&&(c=h),o&=~d}if(o=c,o=B()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*lk(o/1960))-o,10<o){a.timeoutHandle=Ff(Pk.bind(null,a,tk,uk),o);break}Pk(a,tk,uk);break;case 5:Pk(a,tk,uk);break;default:throw Error(p(329))}}}return Dk(a,B()),a.callbackNode===s?Gk.bind(null,a):null}function Nk(a,e){var s=sk;return a.current.memoizedState.isDehydrated&&(Kk(a,e).flags|=256),a=Ik(a,e),a!==2&&(e=tk,tk=s,e!==null&&Fj(e)),a}function Fj(a){tk===null?tk=a:tk.push.apply(tk,a)}function Ok(a){for(var e=a;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var o=0;o<s.length;o++){var c=s[o],d=c.getSnapshot;c=c.value;try{if(!He(d(),c))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===a)break;for(;e.sibling===null;){if(e.return===null||e.return===a)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ck(a,e){for(e&=~rk,e&=~qk,a.suspendedLanes|=e,a.pingedLanes&=~e,a=a.expirationTimes;0<e;){var s=31-oc(e),o=1<<s;a[s]=-1,e&=~o}}function Ek(a){if(K&6)throw Error(p(327));Hk();var e=uc(a,0);if(!(e&1))return Dk(a,B()),null;var s=Ik(a,e);if(a.tag!==0&&s===2){var o=xc(a);o!==0&&(e=o,s=Nk(a,o))}if(s===1)throw s=pk,Kk(a,0),Ck(a,e),Dk(a,B()),s;if(s===6)throw Error(p(345));return a.finishedWork=a.current.alternate,a.finishedLanes=e,Pk(a,tk,uk),Dk(a,B()),null}function Qk(a,e){var s=K;K|=1;try{return a(e)}finally{K=s,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(a){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var e=K;K|=1;var s=ok.transition,o=C;try{if(ok.transition=null,C=1,a)return a()}finally{C=o,ok.transition=s,K=e,!(K&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(a,e){a.finishedWork=null,a.finishedLanes=0;var s=a.timeoutHandle;if(s!==-1&&(a.timeoutHandle=-1,Gf(s)),Y!==null)for(s=Y.return;s!==null;){var o=s;switch(wg(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H),Eh();break;case 5:Bh(o);break;case 4:zh();break;case 13:E$1(L);break;case 19:E$1(L);break;case 10:ah(o.type._context);break;case 22:case 23:Hj()}s=s.return}if(Q=a,Y=a=Pg(a.current,null),Z=fj=e,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(e=0;e<fh.length;e++)if(s=fh[e],o=s.interleaved,o!==null){s.interleaved=null;var c=o.next,d=s.pending;if(d!==null){var h=d.next;d.next=c,o.next=h}s.pending=o}fh=null}return a}function Mk(a,e){do{var s=Y;try{if($g(),Fh.current=Rh,Ih){for(var o=M.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,s===null||s.return===null){T=1,pk=e,Y=null;break}e:{var d=a,h=s.return,g=s,_=e;if(e=Z,g.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var b=_,$=g,j=$.tag;if(!($.mode&1)&&(j===0||j===11||j===15)){var _e=$.alternate;_e?($.updateQueue=_e.updateQueue,$.memoizedState=_e.memoizedState,$.lanes=_e.lanes):($.updateQueue=null,$.memoizedState=null)}var tt=Ui(h);if(tt!==null){tt.flags&=-257,Vi(tt,h,g,d,e),tt.mode&1&&Si(d,b,e),e=tt,_=b;var rt=e.updateQueue;if(rt===null){var nt=new Set;nt.add(_),e.updateQueue=nt}else rt.add(_);break e}else{if(!(e&1)){Si(d,b,e),tj();break e}_=Error(p(426))}}else if(I&&g.mode&1){var st=Ui(h);if(st!==null){!(st.flags&65536)&&(st.flags|=256),Vi(st,h,g,d,e),Jg(Ji(_,g));break e}}d=_=Ji(_,g),T!==4&&(T=2),sk===null?sk=[d]:sk.push(d),d=h;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var at=Ni(d,_,e);ph(d,at);break e;case 1:g=_;var ot=d.type,ut=d.stateNode;if(!(d.flags&128)&&(typeof ot.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(Ri===null||!Ri.has(ut)))){d.flags|=65536,e&=-e,d.lanes|=e;var mt=Qi(d,g,e);ph(d,mt);break e}}d=d.return}while(d!==null)}Sk(s)}catch(yt){e=yt,Y===s&&s!==null&&(Y=s=s.return);continue}break}while(!0)}function Jk(){var a=mk.current;return mk.current=Rh,a===null?Rh:a}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(a,e){var s=K;K|=2;var o=Jk();(Q!==a||Z!==e)&&(uk=null,Kk(a,e));do try{Tk();break}catch(c){Mk(a,c)}while(!0);if($g(),K=s,mk.current=o,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(a){var e=Vk(a.alternate,a,fj);a.memoizedProps=a.pendingProps,e===null?Sk(a):Y=e,nk.current=null}function Sk(a){var e=a;do{var s=e.alternate;if(a=e.return,e.flags&32768){if(s=Ij(s,e),s!==null){s.flags&=32767,Y=s;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{T=6,Y=null;return}}else if(s=Ej(s,e,fj),s!==null){Y=s;return}if(e=e.sibling,e!==null){Y=e;return}Y=e=a}while(e!==null);T===0&&(T=5)}function Pk(a,e,s){var o=C,c=ok.transition;try{ok.transition=null,C=1,Wk(a,e,s,o)}finally{ok.transition=c,C=o}return null}function Wk(a,e,s,o){do Hk();while(wk!==null);if(K&6)throw Error(p(327));s=a.finishedWork;var c=a.finishedLanes;if(s===null)return null;if(a.finishedWork=null,a.finishedLanes=0,s===a.current)throw Error(p(177));a.callbackNode=null,a.callbackPriority=0;var d=s.lanes|s.childLanes;if(Bc(a,d),a===Q&&(Y=Q=null,Z=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),d=(s.flags&15990)!==0,s.subtreeFlags&15990||d){d=ok.transition,ok.transition=null;var h=C;C=1;var g=K;K|=4,nk.current=null,Oj(a,s),dk(s,a),Oe(Df),dd=!!Cf,Df=Cf=null,a.current=s,hk(s),dc(),K=g,C=h,ok.transition=d}else a.current=s;if(vk&&(vk=!1,wk=a,xk=c),d=a.pendingLanes,d===0&&(Ri=null),mc(s.stateNode),Dk(a,B()),e!==null)for(o=a.onRecoverableError,s=0;s<e.length;s++)c=e[s],o(c.value,{componentStack:c.stack,digest:c.digest});if(Oi)throw Oi=!1,a=Pi,Pi=null,a;return xk&1&&a.tag!==0&&Hk(),d=a.pendingLanes,d&1?a===zk?yk++:(yk=0,zk=a):yk=0,jg(),null}function Hk(){if(wk!==null){var a=Dc(xk),e=ok.transition,s=C;try{if(ok.transition=null,C=16>a?16:a,wk===null)var o=!1;else{if(a=wk,wk=null,xk=0,K&6)throw Error(p(331));var c=K;for(K|=4,V=a.current;V!==null;){var d=V,h=d.child;if(V.flags&16){var g=d.deletions;if(g!==null){for(var _=0;_<g.length;_++){var b=g[_];for(V=b;V!==null;){var $=V;switch($.tag){case 0:case 11:case 15:Pj(8,$,d)}var j=$.child;if(j!==null)j.return=$,V=j;else for(;V!==null;){$=V;var _e=$.sibling,tt=$.return;if(Sj($),$===b){V=null;break}if(_e!==null){_e.return=tt,V=_e;break}V=tt}}}var rt=d.alternate;if(rt!==null){var nt=rt.child;if(nt!==null){rt.child=null;do{var st=nt.sibling;nt.sibling=null,nt=st}while(nt!==null)}}V=d}}if(d.subtreeFlags&2064&&h!==null)h.return=d,V=h;else e:for(;V!==null;){if(d=V,d.flags&2048)switch(d.tag){case 0:case 11:case 15:Pj(9,d,d.return)}var at=d.sibling;if(at!==null){at.return=d.return,V=at;break e}V=d.return}}var ot=a.current;for(V=ot;V!==null;){h=V;var ut=h.child;if(h.subtreeFlags&2064&&ut!==null)ut.return=h,V=ut;else e:for(h=ot;V!==null;){if(g=V,g.flags&2048)try{switch(g.tag){case 0:case 11:case 15:Qj(9,g)}}catch(yt){W(g,g.return,yt)}if(g===h){V=null;break e}var mt=g.sibling;if(mt!==null){mt.return=g.return,V=mt;break e}V=g.return}}if(K=c,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,a)}catch{}o=!0}return o}finally{C=s,ok.transition=e}}return!1}function Xk(a,e,s){e=Ji(s,e),e=Ni(a,e,1),a=nh(a,e,1),e=R$1(),a!==null&&(Ac(a,1,e),Dk(a,e))}function W(a,e,s){if(a.tag===3)Xk(a,a,s);else for(;e!==null;){if(e.tag===3){Xk(e,a,s);break}else if(e.tag===1){var o=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Ri===null||!Ri.has(o))){a=Ji(s,a),a=Qi(e,a,1),e=nh(e,a,1),a=R$1(),e!==null&&(Ac(e,1,a),Dk(e,a));break}}e=e.return}}function Ti(a,e,s){var o=a.pingCache;o!==null&&o.delete(e),e=R$1(),a.pingedLanes|=a.suspendedLanes&s,Q===a&&(Z&s)===s&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(a,0):rk|=s),Dk(a,e)}function Yk(a,e){e===0&&(a.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var s=R$1();a=ih(a,e),a!==null&&(Ac(a,e,s),Dk(a,s))}function uj(a){var e=a.memoizedState,s=0;e!==null&&(s=e.retryLane),Yk(a,s)}function bk(a,e){var s=0;switch(a.tag){case 13:var o=a.stateNode,c=a.memoizedState;c!==null&&(s=c.retryLane);break;case 19:o=a.stateNode;break;default:throw Error(p(314))}o!==null&&o.delete(e),Yk(a,s)}var Vk;Vk=function(a,e,s){if(a!==null)if(a.memoizedProps!==e.pendingProps||Wf.current)dh=!0;else{if(!(a.lanes&s)&&!(e.flags&128))return dh=!1,yj(a,e,s);dh=!!(a.flags&131072)}else dh=!1,I&&e.flags&1048576&&ug(e,ng,e.index);switch(e.lanes=0,e.tag){case 2:var o=e.type;ij(a,e),a=e.pendingProps;var c=Yf(e,H.current);ch(e,s),c=Nh(null,e,o,a,c,s);var d=Sh();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zf(o)?(d=!0,cg(e)):d=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,kh(e),c.updater=Ei,e.stateNode=c,c._reactInternals=e,Ii(e,o,a,s),e=jj(null,e,o,!0,d,s)):(e.tag=0,I&&d&&vg(e),Xi(null,e,c,s),e=e.child),e;case 16:o=e.elementType;e:{switch(ij(a,e),a=e.pendingProps,c=o._init,o=c(o._payload),e.type=o,c=e.tag=Zk(o),a=Ci(o,a),c){case 0:e=cj(null,e,o,a,s);break e;case 1:e=hj(null,e,o,a,s);break e;case 11:e=Yi(null,e,o,a,s);break e;case 14:e=$i(null,e,o,Ci(o.type,a),s);break e}throw Error(p(306,o,""))}return e;case 0:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Ci(o,c),cj(a,e,o,c,s);case 1:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Ci(o,c),hj(a,e,o,c,s);case 3:e:{if(kj(e),a===null)throw Error(p(387));o=e.pendingProps,d=e.memoizedState,c=d.element,lh(a,e),qh(e,o,null,s);var h=e.memoizedState;if(o=h.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){c=Ji(Error(p(423)),e),e=lj(a,e,o,s,c);break e}else if(o!==c){c=Ji(Error(p(424)),e),e=lj(a,e,o,s,c);break e}else for(yg=Lf(e.stateNode.containerInfo.firstChild),xg=e,I=!0,zg=null,s=Vg(e,null,o,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ig(),o===c){e=Zi(a,e,s);break e}Xi(a,e,o,s)}e=e.child}return e;case 5:return Ah(e),a===null&&Eg(e),o=e.type,c=e.pendingProps,d=a!==null?a.memoizedProps:null,h=c.children,Ef(o,c)?h=null:d!==null&&Ef(o,d)&&(e.flags|=32),gj(a,e),Xi(a,e,h,s),e.child;case 6:return a===null&&Eg(e),null;case 13:return oj(a,e,s);case 4:return yh(e,e.stateNode.containerInfo),o=e.pendingProps,a===null?e.child=Ug(e,null,o,s):Xi(a,e,o,s),e.child;case 11:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Ci(o,c),Yi(a,e,o,c,s);case 7:return Xi(a,e,e.pendingProps,s),e.child;case 8:return Xi(a,e,e.pendingProps.children,s),e.child;case 12:return Xi(a,e,e.pendingProps.children,s),e.child;case 10:e:{if(o=e.type._context,c=e.pendingProps,d=e.memoizedProps,h=c.value,G(Wg,o._currentValue),o._currentValue=h,d!==null)if(He(d.value,h)){if(d.children===c.children&&!Wf.current){e=Zi(a,e,s);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var g=d.dependencies;if(g!==null){h=d.child;for(var _=g.firstContext;_!==null;){if(_.context===o){if(d.tag===1){_=mh(-1,s&-s),_.tag=2;var b=d.updateQueue;if(b!==null){b=b.shared;var $=b.pending;$===null?_.next=_:(_.next=$.next,$.next=_),b.pending=_}}d.lanes|=s,_=d.alternate,_!==null&&(_.lanes|=s),bh(d.return,s,e),g.lanes|=s;break}_=_.next}}else if(d.tag===10)h=d.type===e.type?null:d.child;else if(d.tag===18){if(h=d.return,h===null)throw Error(p(341));h.lanes|=s,g=h.alternate,g!==null&&(g.lanes|=s),bh(h,s,e),h=d.sibling}else h=d.child;if(h!==null)h.return=d;else for(h=d;h!==null;){if(h===e){h=null;break}if(d=h.sibling,d!==null){d.return=h.return,h=d;break}h=h.return}d=h}Xi(a,e,c.children,s),e=e.child}return e;case 9:return c=e.type,o=e.pendingProps.children,ch(e,s),c=eh(c),o=o(c),e.flags|=1,Xi(a,e,o,s),e.child;case 14:return o=e.type,c=Ci(o,e.pendingProps),c=Ci(o.type,c),$i(a,e,o,c,s);case 15:return bj(a,e,e.type,e.pendingProps,s);case 17:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Ci(o,c),ij(a,e),e.tag=1,Zf(o)?(a=!0,cg(e)):a=!1,ch(e,s),Gi(e,o,c),Ii(e,o,c,s),jj(null,e,o,!0,a,s);case 19:return xj(a,e,s);case 22:return dj(a,e,s)}throw Error(p(156,e.tag))};function Fk(a,e){return ac(a,e)}function $k(a,e,s,o){this.tag=a,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(a,e,s,o){return new $k(a,e,s,o)}function aj(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Zk(a){if(typeof a=="function")return aj(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Da)return 11;if(a===Ga)return 14}return 2}function Pg(a,e){var s=a.alternate;return s===null?(s=Bg(a.tag,e,a.key,a.mode),s.elementType=a.elementType,s.type=a.type,s.stateNode=a.stateNode,s.alternate=a,a.alternate=s):(s.pendingProps=e,s.type=a.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=a.flags&14680064,s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=a.sibling,s.index=a.index,s.ref=a.ref,s}function Rg(a,e,s,o,c,d){var h=2;if(o=a,typeof a=="function")aj(a)&&(h=1);else if(typeof a=="string")h=5;else e:switch(a){case ya:return Tg(s.children,c,d,e);case za:h=8,c|=8;break;case Aa:return a=Bg(12,s,e,c|2),a.elementType=Aa,a.lanes=d,a;case Ea:return a=Bg(13,s,e,c),a.elementType=Ea,a.lanes=d,a;case Fa:return a=Bg(19,s,e,c),a.elementType=Fa,a.lanes=d,a;case Ia:return pj(s,c,d,e);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ba:h=10;break e;case Ca:h=9;break e;case Da:h=11;break e;case Ga:h=14;break e;case Ha:h=16,o=null;break e}throw Error(p(130,a==null?a:typeof a,""))}return e=Bg(h,s,e,c),e.elementType=a,e.type=o,e.lanes=d,e}function Tg(a,e,s,o){return a=Bg(7,a,o,e),a.lanes=s,a}function pj(a,e,s,o){return a=Bg(22,a,o,e),a.elementType=Ia,a.lanes=s,a.stateNode={isHidden:!1},a}function Qg(a,e,s){return a=Bg(6,a,null,e),a.lanes=s,a}function Sg(a,e,s){return e=Bg(4,a.children!==null?a.children:[],a.key,e),e.lanes=s,e.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},e}function al(a,e,s,o,c){this.tag=e,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=o,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function bl(a,e,s,o,c,d,h,g,_){return a=new al(a,e,s,g,_),e===1?(e=1,d===!0&&(e|=8)):e=0,d=Bg(3,null,null,e),a.current=d,d.stateNode=a,d.memoizedState={element:o,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(d),a}function cl(a,e,s){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:o==null?null:""+o,children:a,containerInfo:e,implementation:s}}function dl(a){if(!a)return Vf;a=a._reactInternals;e:{if(Vb(a)!==a||a.tag!==1)throw Error(p(170));var e=a;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zf(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(p(171))}if(a.tag===1){var s=a.type;if(Zf(s))return bg(a,s,e)}return e}function el(a,e,s,o,c,d,h,g,_){return a=bl(s,o,!0,a,c,d,h,g,_),a.context=dl(null),s=a.current,o=R$1(),c=yi(s),d=mh(o,c),d.callback=e??null,nh(s,d,c),a.current.lanes=c,Ac(a,c,o),Dk(a,o),a}function fl(a,e,s,o){var c=e.current,d=R$1(),h=yi(c);return s=dl(s),e.context===null?e.context=s:e.pendingContext=s,e=mh(d,h),e.payload={element:a},o=o===void 0?null:o,o!==null&&(e.callback=o),a=nh(c,e,h),a!==null&&(gi(a,c,h,d),oh(a,c,h)),h}function gl(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function hl(a,e){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var s=a.retryLane;a.retryLane=s!==0&&s<e?s:e}}function il(a,e){hl(a,e),(a=a.alternate)&&hl(a,e)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(a){console.error(a)};function ll(a){this._internalRoot=a}ml.prototype.render=ll.prototype.render=function(a){var e=this._internalRoot;if(e===null)throw Error(p(409));fl(a,e,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var e=a.containerInfo;Rk(function(){fl(null,a,null,null)}),e[uf]=null}};function ml(a){this._internalRoot=a}ml.prototype.unstable_scheduleHydration=function(a){if(a){var e=Hc();a={blockedOn:null,target:a,priority:e};for(var s=0;s<Qc.length&&e!==0&&e<Qc[s].priority;s++);Qc.splice(s,0,a),s===0&&Vc(a)}};function nl(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function ol(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(a,e,s,o,c){if(c){if(typeof o=="function"){var d=o;o=function(){var b=gl(h);d.call(b)}}var h=el(e,o,a,0,null,!1,!1,"",pl);return a._reactRootContainer=h,a[uf]=h.current,sf(a.nodeType===8?a.parentNode:a),Rk(),h}for(;c=a.lastChild;)a.removeChild(c);if(typeof o=="function"){var g=o;o=function(){var b=gl(_);g.call(b)}}var _=bl(a,0,!1,null,null,!1,!1,"",pl);return a._reactRootContainer=_,a[uf]=_.current,sf(a.nodeType===8?a.parentNode:a),Rk(function(){fl(e,_,s,o)}),_}function rl(a,e,s,o,c){var d=s._reactRootContainer;if(d){var h=d;if(typeof c=="function"){var g=c;c=function(){var _=gl(h);g.call(_)}}fl(e,h,a,c)}else h=ql(s,e,a,c,o);return gl(h)}Ec=function(a){switch(a.tag){case 3:var e=a.stateNode;if(e.current.memoizedState.isDehydrated){var s=tc(e.pendingLanes);s!==0&&(Cc(e,s|1),Dk(e,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var o=ih(a,1);if(o!==null){var c=R$1();gi(o,a,1,c)}}),il(a,1)}};Fc=function(a){if(a.tag===13){var e=ih(a,134217728);if(e!==null){var s=R$1();gi(e,a,134217728,s)}il(a,134217728)}};Gc=function(a){if(a.tag===13){var e=yi(a),s=ih(a,e);if(s!==null){var o=R$1();gi(s,a,e,o)}il(a,e)}};Hc=function(){return C};Ic=function(a,e){var s=C;try{return C=a,e()}finally{C=s}};yb=function(a,e,s){switch(e){case"input":if(bb(a,s),e=s.name,s.type==="radio"&&e!=null){for(s=a;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var o=s[e];if(o!==a&&o.form===a.form){var c=Db(o);if(!c)throw Error(p(90));Wa(o),bb(o,c)}}}break;case"textarea":ib(a,s);break;case"select":e=s.value,e!=null&&fb(a,!!s.multiple,e,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Zb(a),a===null?null:a.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(a,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(e))throw Error(p(200));return cl(a,e,null,s)};reactDom_production_min.createRoot=function(a,e){if(!nl(a))throw Error(p(299));var s=!1,o="",c=kl;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(o=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=bl(a,1,!1,null,null,s,!1,o,c),a[uf]=e.current,sf(a.nodeType===8?a.parentNode:a),new ll(e)};reactDom_production_min.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var e=a._reactInternals;if(e===void 0)throw typeof a.render=="function"?Error(p(188)):(a=Object.keys(a).join(","),Error(p(268,a)));return a=Zb(e),a=a===null?null:a.stateNode,a};reactDom_production_min.flushSync=function(a){return Rk(a)};reactDom_production_min.hydrate=function(a,e,s){if(!ol(e))throw Error(p(200));return rl(null,a,e,!0,s)};reactDom_production_min.hydrateRoot=function(a,e,s){if(!nl(a))throw Error(p(405));var o=s!=null&&s.hydratedSources||null,c=!1,d="",h=kl;if(s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(h=s.onRecoverableError)),e=el(e,null,a,1,s??null,c,!1,d,h),a[uf]=e.current,sf(a),o)for(a=0;a<o.length;a++)s=o[a],c=s._getVersion,c=c(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,c]:e.mutableSourceEagerHydrationData.push(s,c);return new ml(e)};reactDom_production_min.render=function(a,e,s){if(!ol(e))throw Error(p(200));return rl(null,a,e,!1,s)};reactDom_production_min.unmountComponentAtNode=function(a){if(!ol(a))throw Error(p(40));return a._reactRootContainer?(Rk(function(){rl(null,null,a,!1,function(){a._reactRootContainer=null,a[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(a,e,s,o){if(!ol(s))throw Error(p(200));if(a==null||a._reactInternals===void 0)throw Error(p(38));return rl(a,e,s,!1,o)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(a){console.error(a)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const LayoutGroupContext=reactExports.createContext({});function useConstant(a){const e=reactExports.useRef(null);return e.current===null&&(e.current=a()),e.current}const PresenceContext=reactExports.createContext(null),MotionConfigContext=reactExports.createContext({transformPagePoint:a=>a,isStatic:!1,reducedMotion:"never"});class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(e){const s=this.props.childRef.current;if(s&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=s.offsetHeight||0,o.width=s.offsetWidth||0,o.top=s.offsetTop,o.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:a,isPresent:e}){const s=reactExports.useId(),o=reactExports.useRef(null),c=reactExports.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=reactExports.useContext(MotionConfigContext);return reactExports.useInsertionEffect(()=>{const{width:h,height:g,top:_,left:b}=c.current;if(e||!o.current||!h||!g)return;o.current.dataset.motionPopId=s;const $=document.createElement("style");return d&&($.nonce=d),document.head.appendChild($),$.sheet&&$.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${h}px !important;
            height: ${g}px !important;
            top: ${_}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild($)}},[e]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:e,childRef:o,sizeRef:c,children:reactExports.cloneElement(a,{ref:o})})}const PresenceChild=({children:a,initial:e,isPresent:s,onExitComplete:o,custom:c,presenceAffectsLayout:d,mode:h})=>{const g=useConstant(newChildrenMap),_=reactExports.useId(),b=reactExports.useCallback(j=>{g.set(j,!0);for(const _e of g.values())if(!_e)return;o&&o()},[g,o]),$=reactExports.useMemo(()=>({id:_,initial:e,isPresent:s,custom:c,onExitComplete:b,register:j=>(g.set(j,!1),()=>g.delete(j))}),d?[Math.random(),b]:[s,b]);return reactExports.useMemo(()=>{g.forEach((j,_e)=>g.set(_e,!1))},[s]),reactExports.useEffect(()=>{!s&&!g.size&&o&&o()},[s]),h==="popLayout"&&(a=jsxRuntimeExports.jsx(PopChild,{isPresent:s,children:a})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:$,children:a})};function newChildrenMap(){return new Map}function usePresence(a=!0){const e=reactExports.useContext(PresenceContext);if(e===null)return[!0,null];const{isPresent:s,onExitComplete:o,register:c}=e,d=reactExports.useId();reactExports.useEffect(()=>{a&&c(d)},[a]);const h=reactExports.useCallback(()=>a&&o&&o(d),[d,o,a]);return!s&&o?[!1,h]:[!0]}const getChildKey=a=>a.key||"";function onlyElements(a){const e=[];return reactExports.Children.forEach(a,s=>{reactExports.isValidElement(s)&&e.push(s)}),e}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,AnimatePresence=({children:a,custom:e,initial:s=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:h=!1})=>{const[g,_]=usePresence(h),b=reactExports.useMemo(()=>onlyElements(a),[a]),$=h&&!g?[]:b.map(getChildKey),j=reactExports.useRef(!0),_e=reactExports.useRef(b),tt=useConstant(()=>new Map),[rt,nt]=reactExports.useState(b),[st,at]=reactExports.useState(b);useIsomorphicLayoutEffect(()=>{j.current=!1,_e.current=b;for(let mt=0;mt<st.length;mt++){const yt=getChildKey(st[mt]);$.includes(yt)?tt.delete(yt):tt.get(yt)!==!0&&tt.set(yt,!1)}},[st,$.length,$.join("-")]);const ot=[];if(b!==rt){let mt=[...b];for(let yt=0;yt<st.length;yt++){const Et=st[yt],dt=getChildKey(Et);$.includes(dt)||(mt.splice(yt,0,Et),ot.push(Et))}d==="wait"&&ot.length&&(mt=ot),at(onlyElements(mt)),nt(b);return}const{forceRender:ut}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:st.map(mt=>{const yt=getChildKey(mt),Et=h&&!g?!1:b===st||$.includes(yt),dt=()=>{if(tt.has(yt))tt.set(yt,!0);else return;let gt=!0;tt.forEach(St=>{St||(gt=!1)}),gt&&(ut==null||ut(),at(_e.current),h&&(_==null||_()),o&&o())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:Et,initial:!j.current||s?void 0:!1,custom:Et?void 0:e,presenceAffectsLayout:c,mode:d,onExitComplete:Et?void 0:dt,children:mt},yt)})})},noop$2=a=>a;let invariant=noop$2;function memo(a){let e;return()=>(e===void 0&&(e=a()),e)}const progress=(a,e,s)=>{const o=e-a;return o===0?1:(s-a)/o},secondsToMilliseconds=a=>a*1e3,millisecondsToSeconds=a=>a/1e3,MotionGlobalConfig={useManualTiming:!1};function createRenderStep(a){let e=new Set,s=new Set,o=!1,c=!1;const d=new WeakSet;let h={delta:0,timestamp:0,isProcessing:!1};function g(b){d.has(b)&&(_.schedule(b),a()),b(h)}const _={schedule:(b,$=!1,j=!1)=>{const tt=j&&o?e:s;return $&&d.add(b),tt.has(b)||tt.add(b),b},cancel:b=>{s.delete(b),d.delete(b)},process:b=>{if(h=b,o){c=!0;return}o=!0,[e,s]=[s,e],e.forEach(g),e.clear(),o=!1,c&&(c=!1,_.process(b))}};return _}const stepsOrder=["read","resolveKeyframes","update","preRender","render","postRender"],maxElapsed=40;function createRenderBatcher(a,e){let s=!1,o=!0;const c={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,h=stepsOrder.reduce((at,ot)=>(at[ot]=createRenderStep(d),at),{}),{read:g,resolveKeyframes:_,update:b,preRender:$,render:j,postRender:_e}=h,tt=()=>{const at=performance.now();s=!1,c.delta=o?1e3/60:Math.max(Math.min(at-c.timestamp,maxElapsed),1),c.timestamp=at,c.isProcessing=!0,g.process(c),_.process(c),b.process(c),$.process(c),j.process(c),_e.process(c),c.isProcessing=!1,s&&e&&(o=!1,a(tt))},rt=()=>{s=!0,o=!0,c.isProcessing||a(tt)};return{schedule:stepsOrder.reduce((at,ot)=>{const ut=h[ot];return at[ot]=(mt,yt=!1,Et=!1)=>(s||rt(),ut.schedule(mt,yt,Et)),at},{}),cancel:at=>{for(let ot=0;ot<stepsOrder.length;ot++)h[stepsOrder[ot]].cancel(at)},state:c,steps:h}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop$2,!0),LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const a in featureProps)featureDefinitions[a]={isEnabled:e=>featureProps[a].some(s=>!!e[s])};function loadFeatures(a){for(const e in a)featureDefinitions[e]={...featureDefinitions[e],...a[e]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(a){return a.startsWith("while")||a.startsWith("drag")&&a!=="draggable"||a.startsWith("layout")||a.startsWith("onTap")||a.startsWith("onPan")||a.startsWith("onLayout")||validMotionProps.has(a)}let shouldForward=a=>!isValidMotionProp(a);function loadExternalIsValidProp(a){a&&(shouldForward=e=>e.startsWith("on")?!isValidMotionProp(e):a(e))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(a,e,s){const o={};for(const c in a)c==="values"&&typeof a.values=="object"||(shouldForward(c)||s===!0&&isValidMotionProp(c)||!e&&!isValidMotionProp(c)||a.draggable&&c.startsWith("onDrag"))&&(o[c]=a[c]);return o}function createDOMMotionComponentProxy(a){if(typeof Proxy>"u")return a;const e=new Map,s=(...o)=>a(...o);return new Proxy(s,{get:(o,c)=>c==="create"?a:(e.has(c)||e.set(c,a(c)),e.get(c))})}const MotionContext=reactExports.createContext({});function isVariantLabel(a){return typeof a=="string"||Array.isArray(a)}function isAnimationControls(a){return a!==null&&typeof a=="object"&&typeof a.start=="function"}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(a){return isAnimationControls(a.animate)||variantProps.some(e=>isVariantLabel(a[e]))}function isVariantNode(a){return!!(isControllingVariants(a)||a.variants)}function getCurrentTreeVariants(a,e){if(isControllingVariants(a)){const{initial:s,animate:o}=a;return{initial:s===!1||isVariantLabel(s)?s:void 0,animate:isVariantLabel(o)?o:void 0}}return a.inherit!==!1?e:{}}function useCreateMotionContext(a){const{initial:e,animate:s}=getCurrentTreeVariants(a,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:e,animate:s}),[variantLabelsAsDependency(e),variantLabelsAsDependency(s)])}function variantLabelsAsDependency(a){return Array.isArray(a)?a.join(" "):a}const motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(a){return a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"current")}function useMotionRef(a,e,s){return reactExports.useCallback(o=>{o&&a.onMount&&a.onMount(o),e&&(o?e.mount(o):e.unmount()),s&&(typeof s=="function"?s(o):isRefObject(s)&&(s.current=o))},[e])}const camelToDash=a=>a.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),{schedule:microtask}=createRenderBatcher(queueMicrotask,!1),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(a,e,s,o,c){var d,h;const{visualElement:g}=reactExports.useContext(MotionContext),_=reactExports.useContext(LazyContext),b=reactExports.useContext(PresenceContext),$=reactExports.useContext(MotionConfigContext).reducedMotion,j=reactExports.useRef(null);o=o||_.renderer,!j.current&&o&&(j.current=o(a,{visualState:e,parent:g,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:$}));const _e=j.current,tt=reactExports.useContext(SwitchLayoutGroupContext);_e&&!_e.projection&&c&&(_e.type==="html"||_e.type==="svg")&&createProjectionNode$1(j.current,s,c,tt);const rt=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{_e&&rt.current&&_e.update(s,b)});const nt=s[optimizedAppearDataAttribute],st=reactExports.useRef(!!nt&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,nt))&&((h=window.MotionHasOptimisedAnimation)===null||h===void 0?void 0:h.call(window,nt)));return useIsomorphicLayoutEffect(()=>{_e&&(rt.current=!0,window.MotionIsMounted=!0,_e.updateFeatures(),microtask.render(_e.render),st.current&&_e.animationState&&_e.animationState.animateChanges())}),reactExports.useEffect(()=>{_e&&(!st.current&&_e.animationState&&_e.animationState.animateChanges(),st.current&&(queueMicrotask(()=>{var at;(at=window.MotionHandoffMarkAsComplete)===null||at===void 0||at.call(window,nt)}),st.current=!1))}),_e}function createProjectionNode$1(a,e,s,o){const{layoutId:c,layout:d,drag:h,dragConstraints:g,layoutScroll:_,layoutRoot:b}=e;a.projection=new s(a.latestValues,e["data-framer-portal-id"]?void 0:getClosestProjectingNode(a.parent)),a.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!h||g&&isRefObject(g),visualElement:a,animationType:typeof d=="string"?d:"both",initialPromotionConfig:o,layoutScroll:_,layoutRoot:b})}function getClosestProjectingNode(a){if(a)return a.options.allowProjection!==!1?a.projection:getClosestProjectingNode(a.parent)}function createRendererMotionComponent({preloadedFeatures:a,createVisualElement:e,useRender:s,useVisualState:o,Component:c}){var d,h;a&&loadFeatures(a);function g(b,$){let j;const _e={...reactExports.useContext(MotionConfigContext),...b,layoutId:useLayoutId(b)},{isStatic:tt}=_e,rt=useCreateMotionContext(b),nt=o(b,tt);if(!tt&&isBrowser){useStrictMode();const st=getProjectionFunctionality(_e);j=st.MeasureLayout,rt.visualElement=useVisualElement(c,nt,_e,e,st.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:rt,children:[j&&rt.visualElement?jsxRuntimeExports.jsx(j,{visualElement:rt.visualElement,..._e}):null,s(c,b,useMotionRef(nt,rt.visualElement,$),nt,tt,rt.visualElement)]})}g.displayName=`motion.${typeof c=="string"?c:`create(${(h=(d=c.displayName)!==null&&d!==void 0?d:c.name)!==null&&h!==void 0?h:""})`}`;const _=reactExports.forwardRef(g);return _[motionComponentSymbol]=c,_}function useLayoutId({layoutId:a}){const e=reactExports.useContext(LayoutGroupContext).id;return e&&a!==void 0?e+"-"+a:a}function useStrictMode(a,e){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(a){const{drag:e,layout:s}=featureDefinitions;if(!e&&!s)return{};const o={...e,...s};return{MeasureLayout:e!=null&&e.isEnabled(a)||s!=null&&s.isEnabled(a)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(a){return typeof a!="string"||a.includes("-")?!1:!!(lowercaseSVGElements.indexOf(a)>-1||/[A-Z]/u.test(a))}function getValueState(a){const e=[{},{}];return a==null||a.values.forEach((s,o)=>{e[0][o]=s.get(),e[1][o]=s.getVelocity()}),e}function resolveVariantFromProps(a,e,s,o){if(typeof e=="function"){const[c,d]=getValueState(o);e=e(s!==void 0?s:a.custom,c,d)}if(typeof e=="string"&&(e=a.variants&&a.variants[e]),typeof e=="function"){const[c,d]=getValueState(o);e=e(s!==void 0?s:a.custom,c,d)}return e}const isKeyframesTarget=a=>Array.isArray(a),isCustomValue=a=>!!(a&&typeof a=="object"&&a.mix&&a.toValue),resolveFinalValueInKeyframes=a=>isKeyframesTarget(a)?a[a.length-1]||0:a,isMotionValue=a=>!!(a&&a.getVelocity);function resolveMotionValue(a){const e=isMotionValue(a)?a.get():a;return isCustomValue(e)?e.toValue():e}function makeState({scrapeMotionValuesFromProps:a,createRenderState:e,onUpdate:s},o,c,d){const h={latestValues:makeLatestValues(o,c,d,a),renderState:e()};return s&&(h.onMount=g=>s({props:o,current:g,...h}),h.onUpdate=g=>s(g)),h}const makeUseVisualState=a=>(e,s)=>{const o=reactExports.useContext(MotionContext),c=reactExports.useContext(PresenceContext),d=()=>makeState(a,e,o,c);return s?d():useConstant(d)};function makeLatestValues(a,e,s,o){const c={},d=o(a,{});for(const _e in d)c[_e]=resolveMotionValue(d[_e]);let{initial:h,animate:g}=a;const _=isControllingVariants(a),b=isVariantNode(a);e&&b&&!_&&a.inherit!==!1&&(h===void 0&&(h=e.initial),g===void 0&&(g=e.animate));let $=s?s.initial===!1:!1;$=$||h===!1;const j=$?g:h;if(j&&typeof j!="boolean"&&!isAnimationControls(j)){const _e=Array.isArray(j)?j:[j];for(let tt=0;tt<_e.length;tt++){const rt=resolveVariantFromProps(a,_e[tt]);if(rt){const{transitionEnd:nt,transition:st,...at}=rt;for(const ot in at){let ut=at[ot];if(Array.isArray(ut)){const mt=$?ut.length-1:0;ut=ut[mt]}ut!==null&&(c[ot]=ut)}for(const ot in nt)c[ot]=nt[ot]}}}return c}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),checkStringStartsWith=a=>e=>typeof e=="string"&&e.startsWith(a),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=a=>startsAsVariableToken(a)?singleCssVariableRegex.test(a.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,getValueAsType=(a,e)=>e&&typeof a=="number"?e.transform(a):a,clamp=(a,e,s)=>s>e?e:s<a?a:s,number={test:a=>typeof a=="number",parse:parseFloat,transform:a=>a},alpha={...number,transform:a=>clamp(0,1,a)},scale={...number,default:1},createUnitType=a=>({test:e=>typeof e=="string"&&e.endsWith(a)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${a}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:a=>percent.parse(a)/100,transform:a=>percent.transform(a*100)},browserNumberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},int={...number,transform:Math.round},numberValueTypes={...browserNumberValueTypes,...transformValueTypes,zIndex:int,size:px,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(a,e,s){let o="",c=!0;for(let d=0;d<numTransforms;d++){const h=transformPropOrder[d],g=a[h];if(g===void 0)continue;let _=!0;if(typeof g=="number"?_=g===(h.startsWith("scale")?1:0):_=parseFloat(g)===0,!_||s){const b=getValueAsType(g,numberValueTypes[h]);if(!_){c=!1;const $=translateAlias[h]||h;o+=`${$}(${b}) `}s&&(e[h]=b)}}return o=o.trim(),s?o=s(e,c?"":o):c&&(o="none"),o}function buildHTMLStyles(a,e,s){const{style:o,vars:c,transformOrigin:d}=a;let h=!1,g=!1;for(const _ in e){const b=e[_];if(transformProps.has(_)){h=!0;continue}else if(isCSSVariableName(_)){c[_]=b;continue}else{const $=getValueAsType(b,numberValueTypes[_]);_.startsWith("origin")?(g=!0,d[_]=$):o[_]=$}}if(e.transform||(h||s?o.transform=buildTransform(e,a.transform,s):o.transform&&(o.transform="none")),g){const{originX:_="50%",originY:b="50%",originZ:$=0}=d;o.transformOrigin=`${_} ${b} ${$}`}}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(a,e,s=1,o=0,c=!0){a.pathLength=1;const d=c?dashKeys:camelKeys;a[d.offset]=px.transform(-o);const h=px.transform(e),g=px.transform(s);a[d.array]=`${h} ${g}`}function calcOrigin$1(a,e,s){return typeof a=="string"?a:px.transform(e+s*a)}function calcSVGTransformOrigin(a,e,s){const o=calcOrigin$1(e,a.x,a.width),c=calcOrigin$1(s,a.y,a.height);return`${o} ${c}`}function buildSVGAttrs(a,{attrX:e,attrY:s,attrScale:o,originX:c,originY:d,pathLength:h,pathSpacing:g=1,pathOffset:_=0,...b},$,j){if(buildHTMLStyles(a,b,j),$){a.style.viewBox&&(a.attrs.viewBox=a.style.viewBox);return}a.attrs=a.style,a.style={};const{attrs:_e,style:tt,dimensions:rt}=a;_e.transform&&(rt&&(tt.transform=_e.transform),delete _e.transform),rt&&(c!==void 0||d!==void 0||tt.transform)&&(tt.transformOrigin=calcSVGTransformOrigin(rt,c!==void 0?c:.5,d!==void 0?d:.5)),e!==void 0&&(_e.x=e),s!==void 0&&(_e.y=s),o!==void 0&&(_e.scale=o),h!==void 0&&buildSVGPath(_e,h,g,_,!1)}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=a=>typeof a=="string"&&a.toLowerCase()==="svg";function renderHTML(a,{style:e,vars:s},o,c){Object.assign(a.style,e,c&&c.getProjectionStyles(o));for(const d in s)a.style.setProperty(d,s[d])}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(a,e,s,o){renderHTML(a,e,void 0,o);for(const c in e.attrs)a.setAttribute(camelCaseAttributes.has(c)?c:camelToDash(c),e.attrs[c])}const scaleCorrectors={};function addScaleCorrector(a){Object.assign(scaleCorrectors,a)}function isForcedMotionValue(a,{layout:e,layoutId:s}){return transformProps.has(a)||a.startsWith("origin")||(e||s!==void 0)&&(!!scaleCorrectors[a]||a==="opacity")}function scrapeMotionValuesFromProps$1(a,e,s){var o;const{style:c}=a,d={};for(const h in c)(isMotionValue(c[h])||e.style&&isMotionValue(e.style[h])||isForcedMotionValue(h,a)||((o=s==null?void 0:s.getValue(h))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(d[h]=c[h]);return d}function scrapeMotionValuesFromProps(a,e,s){const o=scrapeMotionValuesFromProps$1(a,e,s);for(const c in a)if(isMotionValue(a[c])||isMotionValue(e[c])){const d=transformPropOrder.indexOf(c)!==-1?"attr"+c.charAt(0).toUpperCase()+c.substring(1):c;o[d]=a[c]}return o}function updateSVGDimensions(a,e){try{e.dimensions=typeof a.getBBox=="function"?a.getBBox():a.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const layoutProps=["x","y","width","height","cx","cy","r"],svgMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState,onUpdate:({props:a,prevProps:e,current:s,renderState:o,latestValues:c})=>{if(!s)return;let d=!!a.drag;if(!d){for(const g in c)if(transformProps.has(g)){d=!0;break}}if(!d)return;let h=!e;if(e)for(let g=0;g<layoutProps.length;g++){const _=layoutProps[g];a[_]!==e[_]&&(h=!0)}h&&frame.read(()=>{updateSVGDimensions(s,o),frame.render(()=>{buildSVGAttrs(o,c,isSVGTag(s.tagName),a.transformTemplate),renderSVG(s,o)})})}})},htmlMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState})};function copyRawValuesOnly(a,e,s){for(const o in e)!isMotionValue(e[o])&&!isForcedMotionValue(o,s)&&(a[o]=e[o])}function useInitialMotionValues({transformTemplate:a},e){return reactExports.useMemo(()=>{const s=createHtmlRenderState();return buildHTMLStyles(s,e,a),Object.assign({},s.vars,s.style)},[e])}function useStyle(a,e){const s=a.style||{},o={};return copyRawValuesOnly(o,s,a),Object.assign(o,useInitialMotionValues(a,e)),o}function useHTMLProps(a,e){const s={},o=useStyle(a,e);return a.drag&&a.dragListener!==!1&&(s.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=a.drag===!0?"none":`pan-${a.drag==="x"?"y":"x"}`),a.tabIndex===void 0&&(a.onTap||a.onTapStart||a.whileTap)&&(s.tabIndex=0),s.style=o,s}function useSVGProps(a,e,s,o){const c=reactExports.useMemo(()=>{const d=createSvgRenderState();return buildSVGAttrs(d,e,isSVGTag(o),a.transformTemplate),{...d.attrs,style:{...d.style}}},[e]);if(a.style){const d={};copyRawValuesOnly(d,a.style,a),c.style={...d,...c.style}}return c}function createUseRender(a=!1){return(s,o,c,{latestValues:d},h)=>{const _=(isSVGComponent(s)?useSVGProps:useHTMLProps)(o,d,h,s),b=filterProps(o,typeof s=="string",a),$=s!==reactExports.Fragment?{...b,..._,ref:c}:{},{children:j}=o,_e=reactExports.useMemo(()=>isMotionValue(j)?j.get():j,[j]);return reactExports.createElement(s,{...$,children:_e})}}function createMotionComponentFactory(a,e){return function(o,{forwardMotionProps:c}={forwardMotionProps:!1}){const h={...isSVGComponent(o)?svgMotionConfig:htmlMotionConfig,preloadedFeatures:a,useRender:createUseRender(c),createVisualElement:e,Component:o};return createRendererMotionComponent(h)}}function shallowCompare(a,e){if(!Array.isArray(e))return!1;const s=e.length;if(s!==a.length)return!1;for(let o=0;o<s;o++)if(e[o]!==a[o])return!1;return!0}function resolveVariant(a,e,s){const o=a.getProps();return resolveVariantFromProps(o,e,s!==void 0?s:o.custom,a)}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0);class BaseGroupPlaybackControls{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,s){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=s}attachTimeline(e,s){const o=this.animations.map(c=>{if(supportsScrollTimeline()&&c.attachTimeline)return c.attachTimeline(e);if(typeof s=="function")return s(c)});return()=>{o.forEach((c,d)=>{c&&c(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let s=0;s<this.animations.length;s++)e=Math.max(e,this.animations[s].duration);return e}runAll(e){this.animations.forEach(s=>s[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class GroupPlaybackControls extends BaseGroupPlaybackControls{then(e,s){return Promise.all(this.animations).then(e).catch(s)}}function getValueTransition(a,e){return a?a[e]||a.default||a:void 0}const maxGeneratorDuration=2e4;function calcGeneratorDuration(a){let e=0;const s=50;let o=a.next(e);for(;!o.done&&e<maxGeneratorDuration;)e+=s,o=a.next(e);return e>=maxGeneratorDuration?1/0:e}function isGenerator(a){return typeof a=="function"}function attachTimeline(a,e){a.timeline=e,a.onfinish=null}const isBezierDefinition=a=>Array.isArray(a)&&typeof a[0]=="number",supportsFlags={linearEasing:void 0};function memoSupports(a,e){const s=memo(a);return()=>{var o;return(o=supportsFlags[e])!==null&&o!==void 0?o:s()}}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),generateLinearEasing=(a,e,s=10)=>{let o="";const c=Math.max(Math.round(e/s),2);for(let d=0;d<c;d++)o+=a(progress(0,c-1,d))+", ";return`linear(${o.substring(0,o.length-2)})`};function isWaapiSupportedEasing(a){return!!(typeof a=="function"&&supportsLinearEasing()||!a||typeof a=="string"&&(a in supportedWaapiEasing||supportsLinearEasing())||isBezierDefinition(a)||Array.isArray(a)&&a.every(isWaapiSupportedEasing))}const cubicBezierAsString=([a,e,s,o])=>`cubic-bezier(${a}, ${e}, ${s}, ${o})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(a,e){if(a)return typeof a=="function"&&supportsLinearEasing()?generateLinearEasing(a,e):isBezierDefinition(a)?cubicBezierAsString(a):Array.isArray(a)?a.map(s=>mapEasingToNativeEasing(s,e)||supportedWaapiEasing.easeOut):supportedWaapiEasing[a]}const isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function resolveElements(a,e,s){var o;if(a instanceof Element)return[a];if(typeof a=="string"){let c=document;const d=(o=void 0)!==null&&o!==void 0?o:c.querySelectorAll(a);return d?Array.from(d):[]}return Array.from(a)}function setupGesture(a,e){const s=resolveElements(a),o=new AbortController,c={passive:!0,...e,signal:o.signal};return[s,c,()=>o.abort()]}function filterEvents$1(a){return e=>{e.pointerType==="touch"||isDragActive()||a(e)}}function hover(a,e,s={}){const[o,c,d]=setupGesture(a,s),h=filterEvents$1(g=>{const{target:_}=g,b=e(g);if(typeof b!="function"||!_)return;const $=filterEvents$1(j=>{b(j),_.removeEventListener("pointerleave",$)});_.addEventListener("pointerleave",$,c)});return o.forEach(g=>{g.addEventListener("pointerenter",h,c)}),d}const isNodeOrChild=(a,e)=>e?a===e?!0:isNodeOrChild(a,e.parentElement):!1,isPrimaryPointer=a=>a.pointerType==="mouse"?typeof a.button!="number"||a.button<=0:a.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(a){return focusableElements.has(a.tagName)||a.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(a){return e=>{e.key==="Enter"&&a(e)}}function firePointerEvent(a,e){a.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(a,e)=>{const s=a.currentTarget;if(!s)return;const o=filterEvents(()=>{if(isPressing.has(s))return;firePointerEvent(s,"down");const c=filterEvents(()=>{firePointerEvent(s,"up")}),d=()=>firePointerEvent(s,"cancel");s.addEventListener("keyup",c,e),s.addEventListener("blur",d,e)});s.addEventListener("keydown",o,e),s.addEventListener("blur",()=>s.removeEventListener("keydown",o),e)};function isValidPressEvent(a){return isPrimaryPointer(a)&&!isDragActive()}function press(a,e,s={}){const[o,c,d]=setupGesture(a,s),h=g=>{const _=g.currentTarget;if(!isValidPressEvent(g)||isPressing.has(_))return;isPressing.add(_);const b=e(g),$=(tt,rt)=>{window.removeEventListener("pointerup",j),window.removeEventListener("pointercancel",_e),!(!isValidPressEvent(tt)||!isPressing.has(_))&&(isPressing.delete(_),typeof b=="function"&&b(tt,{success:rt}))},j=tt=>{$(tt,s.useGlobalTarget||isNodeOrChild(_,tt.target))},_e=tt=>{$(tt,!1)};window.addEventListener("pointerup",j,c),window.addEventListener("pointercancel",_e,c)};return o.forEach(g=>{!isElementKeyboardAccessible(g)&&g.getAttribute("tabindex")===null&&(g.tabIndex=0),(s.useGlobalTarget?window:g).addEventListener("pointerdown",h,c),g.addEventListener("focus",b=>enableKeyboardPress(b,c),c)}),d}function setDragLock(a){return a==="x"||a==="y"?isDragging[a]?null:(isDragging[a]=!0,()=>{isDragging[a]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]);let now$1;function clearTime(){now$1=void 0}const time={now:()=>(now$1===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now$1),set:a=>{now$1=a,queueMicrotask(clearTime)}};function addUniqueItem(a,e){a.indexOf(e)===-1&&a.push(e)}function removeItem(a,e){const s=a.indexOf(e);s>-1&&a.splice(s,1)}class SubscriptionManager{constructor(){this.subscriptions=[]}add(e){return addUniqueItem(this.subscriptions,e),()=>removeItem(this.subscriptions,e)}notify(e,s,o){const c=this.subscriptions.length;if(c)if(c===1)this.subscriptions[0](e,s,o);else for(let d=0;d<c;d++){const h=this.subscriptions[d];h&&h(e,s,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function velocityPerSecond(a,e){return e?a*(1e3/e):0}const MAX_VELOCITY_DELTA=30,isFloat=a=>!isNaN(parseFloat(a));class MotionValue{constructor(e,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,c=!0)=>{const d=time.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),c&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=s.owner}setCurrent(e){this.current=e,this.updatedAt=time.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,s){this.events[e]||(this.events[e]=new SubscriptionManager);const o=this.events[e].add(s);return e==="change"?()=>{o(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,s){this.passiveEffect=e,this.stopPassiveEffect=s}set(e,s=!0){!s||!this.passiveEffect?this.updateAndNotify(e,s):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,s,o){this.set(s),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,s=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(e){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=e(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(a,e){return new MotionValue(a,e)}function setMotionValue(a,e,s){a.hasValue(e)?a.getValue(e).set(s):a.addValue(e,motionValue(s))}function setTarget(a,e){const s=resolveVariant(a,e);let{transitionEnd:o={},transition:c={},...d}=s||{};d={...d,...o};for(const h in d){const g=resolveFinalValueInKeyframes(d[h]);setMotionValue(a,h,g)}}function isWillChangeMotionValue(a){return!!(isMotionValue(a)&&a.add)}function addValueToWillChange(a,e){const s=a.getValue("willChange");if(isWillChangeMotionValue(s))return s.add(e)}function getOptimisedAppearId(a){return a.props[optimizedAppearDataAttribute]}const calcBezier=(a,e,s)=>(((1-3*s+3*e)*a+(3*s-6*e))*a+3*e)*a,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(a,e,s,o,c){let d,h,g=0;do h=e+(s-e)/2,d=calcBezier(h,o,c)-a,d>0?s=h:e=h;while(Math.abs(d)>subdivisionPrecision&&++g<subdivisionMaxIterations);return h}function cubicBezier(a,e,s,o){if(a===e&&s===o)return noop$2;const c=d=>binarySubdivide(d,0,1,a,s);return d=>d===0||d===1?d:calcBezier(c(d),e,o)}const mirrorEasing=a=>e=>e<=.5?a(2*e)/2:(2-a(2*(1-e)))/2,reverseEasing=a=>e=>1-a(1-e),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=a=>(a*=2)<1?.5*backIn(a):.5*(2-Math.pow(2,-10*(a-1))),circIn=a=>1-Math.sin(Math.acos(a)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),isZeroValueString=a=>/^0[^.\s]+$/u.test(a);function isNone(a){return typeof a=="number"?a===0:a!==null?a==="none"||a==="0"||isZeroValueString(a):!0}const sanitize=a=>Math.round(a*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(a){return a==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(a,e)=>s=>!!(typeof s=="string"&&singleColorRegex.test(s)&&s.startsWith(a)||e&&!isNullish(s)&&Object.prototype.hasOwnProperty.call(s,e)),splitColor=(a,e,s)=>o=>{if(typeof o!="string")return o;const[c,d,h,g]=o.match(floatRegex);return{[a]:parseFloat(c),[e]:parseFloat(d),[s]:parseFloat(h),alpha:g!==void 0?parseFloat(g):1}},clampRgbUnit=a=>clamp(0,255,a),rgbUnit={...number,transform:a=>Math.round(clampRgbUnit(a))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:a,green:e,blue:s,alpha:o=1})=>"rgba("+rgbUnit.transform(a)+", "+rgbUnit.transform(e)+", "+rgbUnit.transform(s)+", "+sanitize(alpha.transform(o))+")"};function parseHex(a){let e="",s="",o="",c="";return a.length>5?(e=a.substring(1,3),s=a.substring(3,5),o=a.substring(5,7),c=a.substring(7,9)):(e=a.substring(1,2),s=a.substring(2,3),o=a.substring(3,4),c=a.substring(4,5),e+=e,s+=s,o+=o,c+=c),{red:parseInt(e,16),green:parseInt(s,16),blue:parseInt(o,16),alpha:c?parseInt(c,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:a,saturation:e,lightness:s,alpha:o=1})=>"hsla("+Math.round(a)+", "+percent.transform(sanitize(e))+", "+percent.transform(sanitize(s))+", "+sanitize(alpha.transform(o))+")"},color={test:a=>rgba.test(a)||hex.test(a)||hsla.test(a),parse:a=>rgba.test(a)?rgba.parse(a):hsla.test(a)?hsla.parse(a):hex.parse(a),transform:a=>typeof a=="string"?a:a.hasOwnProperty("red")?rgba.transform(a):hsla.transform(a)},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test$2(a){var e,s;return isNaN(a)&&typeof a=="string"&&(((e=a.match(floatRegex))===null||e===void 0?void 0:e.length)||0)+(((s=a.match(colorRegex))===null||s===void 0?void 0:s.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(a){const e=a.toString(),s=[],o={color:[],number:[],var:[]},c=[];let d=0;const g=e.replace(complexRegex,_=>(color.test(_)?(o.color.push(d),c.push(COLOR_TOKEN),s.push(color.parse(_))):_.startsWith(VAR_FUNCTION_TOKEN)?(o.var.push(d),c.push(VAR_TOKEN),s.push(_)):(o.number.push(d),c.push(NUMBER_TOKEN),s.push(parseFloat(_))),++d,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:s,split:g,indexes:o,types:c}}function parseComplexValue(a){return analyseComplexValue(a).values}function createTransformer(a){const{split:e,types:s}=analyseComplexValue(a),o=e.length;return c=>{let d="";for(let h=0;h<o;h++)if(d+=e[h],c[h]!==void 0){const g=s[h];g===NUMBER_TOKEN?d+=sanitize(c[h]):g===COLOR_TOKEN?d+=color.transform(c[h]):d+=c[h]}return d}}const convertNumbersToZero=a=>typeof a=="number"?0:a;function getAnimatableNone$1(a){const e=parseComplexValue(a);return createTransformer(a)(e.map(convertNumbersToZero))}const complex={test:test$2,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1},maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(a){const[e,s]=a.slice(0,-1).split("(");if(e==="drop-shadow")return a;const[o]=s.match(floatRegex)||[];if(!o)return a;const c=s.replace(o,"");let d=maxDefaults.has(e)?1:0;return o!==s&&(d*=100),e+"("+d+c+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter$1={...complex,getAnimatableNone:a=>{const e=a.match(functionRegex);return e?e.map(applyDefaultFilter).join(" "):a}},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter:filter$1,WebkitFilter:filter$1},getDefaultValueType=a=>defaultValueTypes[a];function getAnimatableNone(a,e){let s=getDefaultValueType(a);return s!==filter$1&&(s=complex),s.getAnimatableNone?s.getAnimatableNone(e):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(a,e,s){let o=0,c;for(;o<a.length&&!c;){const d=a[o];typeof d=="string"&&!invalidTemplates.has(d)&&analyseComplexValue(d).values.length&&(c=a[o]),o++}if(c&&s)for(const d of e)a[d]=getAnimatableNone(s,c)}const isNumOrPxType=a=>a===number||a===px,getPosFromMatrix=(a,e)=>parseFloat(a.split(", ")[e]),getTranslateFromMatrix=(a,e)=>(s,{transform:o})=>{if(o==="none"||!o)return 0;const c=o.match(/^matrix3d\((.+)\)$/u);if(c)return getPosFromMatrix(c[1],e);{const d=o.match(/^matrix\((.+)\)$/u);return d?getPosFromMatrix(d[1],a):0}},transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(a=>!transformKeys.has(a));function removeNonTranslationalTransform(a){const e=[];return nonTranslationalTransformKeys.forEach(s=>{const o=a.getValue(s);o!==void 0&&(e.push([s,o.get()]),o.set(s.startsWith("scale")?1:0))}),e}const positionalValues={width:({x:a},{paddingLeft:e="0",paddingRight:s="0"})=>a.max-a.min-parseFloat(e)-parseFloat(s),height:({y:a},{paddingTop:e="0",paddingBottom:s="0"})=>a.max-a.min-parseFloat(e)-parseFloat(s),top:(a,{top:e})=>parseFloat(e),left:(a,{left:e})=>parseFloat(e),bottom:({y:a},{top:e})=>parseFloat(e)+(a.max-a.min),right:({x:a},{left:e})=>parseFloat(e)+(a.max-a.min),x:getTranslateFromMatrix(4,13),y:getTranslateFromMatrix(5,14)};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const a=Array.from(toResolve).filter(o=>o.needsMeasurement),e=new Set(a.map(o=>o.element)),s=new Map;e.forEach(o=>{const c=removeNonTranslationalTransform(o);c.length&&(s.set(o,c),o.render())}),a.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const c=s.get(o);c&&c.forEach(([d,h])=>{var g;(g=o.getValue(d))===null||g===void 0||g.set(h)})}),a.forEach(o=>o.measureEndState()),a.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(a=>a.complete()),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(a=>{a.readKeyframes(),a.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){readAllKeyframes(),measureAllKeyframes()}class KeyframeResolver{constructor(e,s,o,c,d,h=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=s,this.name=o,this.motionValue=c,this.element=d,this.isAsync=h}scheduleResolve(){this.isScheduled=!0,this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:s,element:o,motionValue:c}=this;for(let d=0;d<e.length;d++)if(e[d]===null)if(d===0){const h=c==null?void 0:c.get(),g=e[e.length-1];if(h!==void 0)e[0]=h;else if(o&&s){const _=o.readValue(s,g);_!=null&&(e[0]=_)}e[0]===void 0&&(e[0]=g),c&&h===void 0&&c.set(e[0])}else e[d]=e[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),toResolve.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,toResolve.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const isNumericalString=a=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(a),splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(a){const e=splitCSSVariableRegex.exec(a);if(!e)return[,];const[,s,o,c]=e;return[`--${s??o}`,c]}function getVariableValue(a,e,s=1){const[o,c]=parseCSSVariable(a);if(!o)return;const d=window.getComputedStyle(e).getPropertyValue(o);if(d){const h=d.trim();return isNumericalString(h)?parseFloat(h):h}return isCSSVariableToken(c)?getVariableValue(c,e,s+1):c}const testValueType=a=>e=>e.test(a),auto={test:a=>a==="auto",parse:a=>a},dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=a=>dimensionValueTypes.find(testValueType(a));class DOMKeyframesResolver extends KeyframeResolver{constructor(e,s,o,c,d){super(e,s,o,c,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:s,name:o}=this;if(!s||!s.current)return;super.readKeyframes();for(let _=0;_<e.length;_++){let b=e[_];if(typeof b=="string"&&(b=b.trim(),isCSSVariableToken(b))){const $=getVariableValue(b,s.current);$!==void 0&&(e[_]=$),_===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(o)||e.length!==2)return;const[c,d]=e,h=findDimensionValueType(c),g=findDimensionValueType(d);if(h!==g)if(isNumOrPxType(h)&&isNumOrPxType(g))for(let _=0;_<e.length;_++){const b=e[_];typeof b=="string"&&(e[_]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:s}=this,o=[];for(let c=0;c<e.length;c++)isNone(e[c])&&o.push(c);o.length&&makeNoneKeyframesAnimatable(e,o,s)}measureInitialState(){const{element:e,unresolvedKeyframes:s,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[o](e.measureViewportBox(),window.getComputedStyle(e.current)),s[0]=this.measuredOrigin;const c=s[s.length-1];c!==void 0&&e.getValue(o,c).jump(c,!1)}measureEndState(){var e;const{element:s,name:o,unresolvedKeyframes:c}=this;if(!s||!s.current)return;const d=s.getValue(o);d&&d.jump(this.measuredOrigin,!1);const h=c.length-1,g=c[h];c[h]=positionalValues[o](s.measureViewportBox(),window.getComputedStyle(s.current)),g!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=g),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([_,b])=>{s.getValue(_).set(b)}),this.resolveNoneKeyframes()}}const isAnimatable=(a,e)=>e==="zIndex"?!1:!!(typeof a=="number"||Array.isArray(a)||typeof a=="string"&&(complex.test(a)||a==="0")&&!a.startsWith("url("));function hasKeyframesChanged(a){const e=a[0];if(a.length===1)return!0;for(let s=0;s<a.length;s++)if(a[s]!==e)return!0}function canAnimate(a,e,s,o){const c=a[0];if(c===null)return!1;if(e==="display"||e==="visibility")return!0;const d=a[a.length-1],h=isAnimatable(c,e),g=isAnimatable(d,e);return!h||!g?!1:hasKeyframesChanged(a)||(s==="spring"||isGenerator(s))&&o}const isNotNull=a=>a!==null;function getFinalKeyframe(a,{repeat:e,repeatType:s="loop"},o){const c=a.filter(isNotNull),d=e&&s!=="loop"&&e%2===1?0:c.length-1;return!d||o===void 0?c[d]:o}const MAX_RESOLVE_DELAY=40;class BaseAnimation{constructor({autoplay:e=!0,delay:s=0,type:o="keyframes",repeat:c=0,repeatDelay:d=0,repeatType:h="loop",...g}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=time.now(),this.options={autoplay:e,delay:s,type:o,repeat:c,repeatDelay:d,repeatType:h,...g},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&flushKeyframeResolvers(),this._resolved}onKeyframesResolved(e,s){this.resolvedAt=time.now(),this.hasAttemptedResolve=!0;const{name:o,type:c,velocity:d,delay:h,onComplete:g,onUpdate:_,isGenerator:b}=this.options;if(!b&&!canAnimate(e,o,c,d))if(h)this.options.duration=0;else{_&&_(getFinalKeyframe(e,this.options,s)),g&&g(),this.resolveFinishedPromise();return}const $=this.initPlayback(e,s);$!==!1&&(this._resolved={keyframes:e,finalKeyframe:s,...$},this.onPostResolved())}onPostResolved(){}then(e,s){return this.currentFinishedPromise.then(e,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const mixNumber$1=(a,e,s)=>a+(e-a)*s;function hueToRgb(a,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?a+(e-a)*6*s:s<1/2?e:s<2/3?a+(e-a)*(2/3-s)*6:a}function hslaToRgba({hue:a,saturation:e,lightness:s,alpha:o}){a/=360,e/=100,s/=100;let c=0,d=0,h=0;if(!e)c=d=h=s;else{const g=s<.5?s*(1+e):s+e-s*e,_=2*s-g;c=hueToRgb(_,g,a+1/3),d=hueToRgb(_,g,a),h=hueToRgb(_,g,a-1/3)}return{red:Math.round(c*255),green:Math.round(d*255),blue:Math.round(h*255),alpha:o}}function mixImmediate(a,e){return s=>s>0?e:a}const mixLinearColor=(a,e,s)=>{const o=a*a,c=s*(e*e-o)+o;return c<0?0:Math.sqrt(c)},colorTypes=[hex,rgba,hsla],getColorType=a=>colorTypes.find(e=>e.test(a));function asRGBA(a){const e=getColorType(a);if(!e)return!1;let s=e.parse(a);return e===hsla&&(s=hslaToRgba(s)),s}const mixColor=(a,e)=>{const s=asRGBA(a),o=asRGBA(e);if(!s||!o)return mixImmediate(a,e);const c={...s};return d=>(c.red=mixLinearColor(s.red,o.red,d),c.green=mixLinearColor(s.green,o.green,d),c.blue=mixLinearColor(s.blue,o.blue,d),c.alpha=mixNumber$1(s.alpha,o.alpha,d),rgba.transform(c))},combineFunctions=(a,e)=>s=>e(a(s)),pipe$1=(...a)=>a.reduce(combineFunctions),invisibleValues=new Set(["none","hidden"]);function mixVisibility(a,e){return invisibleValues.has(a)?s=>s<=0?a:e:s=>s>=1?e:a}function mixNumber(a,e){return s=>mixNumber$1(a,e,s)}function getMixer(a){return typeof a=="number"?mixNumber:typeof a=="string"?isCSSVariableToken(a)?mixImmediate:color.test(a)?mixColor:mixComplex:Array.isArray(a)?mixArray:typeof a=="object"?color.test(a)?mixColor:mixObject:mixImmediate}function mixArray(a,e){const s=[...a],o=s.length,c=a.map((d,h)=>getMixer(d)(d,e[h]));return d=>{for(let h=0;h<o;h++)s[h]=c[h](d);return s}}function mixObject(a,e){const s={...a,...e},o={};for(const c in s)a[c]!==void 0&&e[c]!==void 0&&(o[c]=getMixer(a[c])(a[c],e[c]));return c=>{for(const d in o)s[d]=o[d](c);return s}}function matchOrder(a,e){var s;const o=[],c={color:0,var:0,number:0};for(let d=0;d<e.values.length;d++){const h=e.types[d],g=a.indexes[h][c[h]],_=(s=a.values[g])!==null&&s!==void 0?s:0;o[d]=_,c[h]++}return o}const mixComplex=(a,e)=>{const s=complex.createTransformer(e),o=analyseComplexValue(a),c=analyseComplexValue(e);return o.indexes.var.length===c.indexes.var.length&&o.indexes.color.length===c.indexes.color.length&&o.indexes.number.length>=c.indexes.number.length?invisibleValues.has(a)&&!c.values.length||invisibleValues.has(e)&&!o.values.length?mixVisibility(a,e):pipe$1(mixArray(matchOrder(o,c),c.values),s):mixImmediate(a,e)};function mix(a,e,s){return typeof a=="number"&&typeof e=="number"&&typeof s=="number"?mixNumber$1(a,e,s):getMixer(a)(a,e)}const velocitySampleDuration=5;function calcGeneratorVelocity(a,e,s){const o=Math.max(e-velocitySampleDuration,0);return velocityPerSecond(s-a(o),e-o)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:a=springDefaults.duration,bounce:e=springDefaults.bounce,velocity:s=springDefaults.velocity,mass:o=springDefaults.mass}){let c,d,h=1-e;h=clamp(springDefaults.minDamping,springDefaults.maxDamping,h),a=clamp(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(a)),h<1?(c=b=>{const $=b*h,j=$*a,_e=$-s,tt=calcAngularFreq(b,h),rt=Math.exp(-j);return safeMin-_e/tt*rt},d=b=>{const j=b*h*a,_e=j*s+s,tt=Math.pow(h,2)*Math.pow(b,2)*a,rt=Math.exp(-j),nt=calcAngularFreq(Math.pow(b,2),h);return(-c(b)+safeMin>0?-1:1)*((_e-tt)*rt)/nt}):(c=b=>{const $=Math.exp(-b*a),j=(b-s)*a+1;return-safeMin+$*j},d=b=>{const $=Math.exp(-b*a),j=(s-b)*(a*a);return $*j});const g=5/a,_=approximateRoot(c,d,g);if(a=secondsToMilliseconds(a),isNaN(_))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:a};{const b=Math.pow(_,2)*o;return{stiffness:b,damping:h*2*Math.sqrt(o*b),duration:a}}}const rootIterations=12;function approximateRoot(a,e,s){let o=s;for(let c=1;c<rootIterations;c++)o=o-a(o)/e(o);return o}function calcAngularFreq(a,e){return a*Math.sqrt(1-e*e)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(a,e){return e.some(s=>a[s]!==void 0)}function getSpringOptions(a){let e={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...a};if(!isSpringType(a,physicsKeys)&&isSpringType(a,durationKeys))if(a.visualDuration){const s=a.visualDuration,o=2*Math.PI/(s*1.2),c=o*o,d=2*clamp(.05,1,1-(a.bounce||0))*Math.sqrt(c);e={...e,mass:springDefaults.mass,stiffness:c,damping:d}}else{const s=findSpring(a);e={...e,...s,mass:springDefaults.mass},e.isResolvedFromDuration=!0}return e}function spring(a=springDefaults.visualDuration,e=springDefaults.bounce){const s=typeof a!="object"?{visualDuration:a,keyframes:[0,1],bounce:e}:a;let{restSpeed:o,restDelta:c}=s;const d=s.keyframes[0],h=s.keyframes[s.keyframes.length-1],g={done:!1,value:d},{stiffness:_,damping:b,mass:$,duration:j,velocity:_e,isResolvedFromDuration:tt}=getSpringOptions({...s,velocity:-millisecondsToSeconds(s.velocity||0)}),rt=_e||0,nt=b/(2*Math.sqrt(_*$)),st=h-d,at=millisecondsToSeconds(Math.sqrt(_/$)),ot=Math.abs(st)<5;o||(o=ot?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),c||(c=ot?springDefaults.restDelta.granular:springDefaults.restDelta.default);let ut;if(nt<1){const yt=calcAngularFreq(at,nt);ut=Et=>{const dt=Math.exp(-nt*at*Et);return h-dt*((rt+nt*at*st)/yt*Math.sin(yt*Et)+st*Math.cos(yt*Et))}}else if(nt===1)ut=yt=>h-Math.exp(-at*yt)*(st+(rt+at*st)*yt);else{const yt=at*Math.sqrt(nt*nt-1);ut=Et=>{const dt=Math.exp(-nt*at*Et),gt=Math.min(yt*Et,300);return h-dt*((rt+nt*at*st)*Math.sinh(gt)+yt*st*Math.cosh(gt))/yt}}const mt={calculatedDuration:tt&&j||null,next:yt=>{const Et=ut(yt);if(tt)g.done=yt>=j;else{let dt=0;nt<1&&(dt=yt===0?secondsToMilliseconds(rt):calcGeneratorVelocity(ut,yt,Et));const gt=Math.abs(dt)<=o,St=Math.abs(h-Et)<=c;g.done=gt&&St}return g.value=g.done?h:Et,g},toString:()=>{const yt=Math.min(calcGeneratorDuration(mt),maxGeneratorDuration),Et=generateLinearEasing(dt=>mt.next(yt*dt).value,yt,30);return yt+"ms "+Et}};return mt}function inertia({keyframes:a,velocity:e=0,power:s=.8,timeConstant:o=325,bounceDamping:c=10,bounceStiffness:d=500,modifyTarget:h,min:g,max:_,restDelta:b=.5,restSpeed:$}){const j=a[0],_e={done:!1,value:j},tt=gt=>g!==void 0&&gt<g||_!==void 0&&gt>_,rt=gt=>g===void 0?_:_===void 0||Math.abs(g-gt)<Math.abs(_-gt)?g:_;let nt=s*e;const st=j+nt,at=h===void 0?st:h(st);at!==st&&(nt=at-j);const ot=gt=>-nt*Math.exp(-gt/o),ut=gt=>at+ot(gt),mt=gt=>{const St=ot(gt),xt=ut(gt);_e.done=Math.abs(St)<=b,_e.value=_e.done?at:xt};let yt,Et;const dt=gt=>{tt(_e.value)&&(yt=gt,Et=spring({keyframes:[_e.value,rt(_e.value)],velocity:calcGeneratorVelocity(ut,gt,_e.value),damping:c,stiffness:d,restDelta:b,restSpeed:$}))};return dt(0),{calculatedDuration:null,next:gt=>{let St=!1;return!Et&&yt===void 0&&(St=!0,mt(gt),dt(gt)),yt!==void 0&&gt>=yt?Et.next(gt-yt):(!St&&mt(gt),_e)}}}const easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=a=>Array.isArray(a)&&typeof a[0]!="number",easingLookup={linear:noop$2,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},easingDefinitionToFunction=a=>{if(isBezierDefinition(a)){invariant(a.length===4);const[e,s,o,c]=a;return cubicBezier(e,s,o,c)}else if(typeof a=="string")return easingLookup[a];return a};function createMixers(a,e,s){const o=[],c=s||mix,d=a.length-1;for(let h=0;h<d;h++){let g=c(a[h],a[h+1]);if(e){const _=Array.isArray(e)?e[h]||noop$2:e;g=pipe$1(_,g)}o.push(g)}return o}function interpolate(a,e,{clamp:s=!0,ease:o,mixer:c}={}){const d=a.length;if(invariant(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const h=a[0]===a[1];a[0]>a[d-1]&&(a=[...a].reverse(),e=[...e].reverse());const g=createMixers(e,o,c),_=g.length,b=$=>{if(h&&$<a[0])return e[0];let j=0;if(_>1)for(;j<a.length-2&&!($<a[j+1]);j++);const _e=progress(a[j],a[j+1],$);return g[j](_e)};return s?$=>b(clamp(a[0],a[d-1],$)):b}function fillOffset(a,e){const s=a[a.length-1];for(let o=1;o<=e;o++){const c=progress(0,e,o);a.push(mixNumber$1(s,1,c))}}function defaultOffset(a){const e=[0];return fillOffset(e,a.length-1),e}function convertOffsetToTimes(a,e){return a.map(s=>s*e)}function defaultEasing(a,e){return a.map(()=>e||easeInOut).splice(0,a.length-1)}function keyframes({duration:a=300,keyframes:e,times:s,ease:o="easeInOut"}){const c=isEasingArray(o)?o.map(easingDefinitionToFunction):easingDefinitionToFunction(o),d={done:!1,value:e[0]},h=convertOffsetToTimes(s&&s.length===e.length?s:defaultOffset(e),a),g=interpolate(h,e,{ease:Array.isArray(c)?c:defaultEasing(e,c)});return{calculatedDuration:a,next:_=>(d.value=g(_),d.done=_>=a,d)}}const frameloopDriver=a=>{const e=({timestamp:s})=>a(s);return{start:()=>frame.update(e,!0),stop:()=>cancelFrame(e),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generators={decay:inertia,inertia,tween:keyframes,keyframes,spring},percentToProgress=a=>a/100;class MainThreadAnimation extends BaseAnimation{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:_}=this.options;_&&_()};const{name:s,motionValue:o,element:c,keyframes:d}=this.options,h=(c==null?void 0:c.KeyframeResolver)||KeyframeResolver,g=(_,b)=>this.onKeyframesResolved(_,b);this.resolver=new h(d,g,s,o,c),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:s="keyframes",repeat:o=0,repeatDelay:c=0,repeatType:d,velocity:h=0}=this.options,g=isGenerator(s)?s:generators[s]||keyframes;let _,b;g!==keyframes&&typeof e[0]!="number"&&(_=pipe$1(percentToProgress,mix(e[0],e[1])),e=[0,100]);const $=g({...this.options,keyframes:e});d==="mirror"&&(b=g({...this.options,keyframes:[...e].reverse(),velocity:-h})),$.calculatedDuration===null&&($.calculatedDuration=calcGeneratorDuration($));const{calculatedDuration:j}=$,_e=j+c,tt=_e*(o+1)-c;return{generator:$,mirroredGenerator:b,mapPercentToKeyframes:_,calculatedDuration:j,resolvedDuration:_e,totalDuration:tt}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,s=!1){const{resolved:o}=this;if(!o){const{keyframes:gt}=this.options;return{done:!0,value:gt[gt.length-1]}}const{finalKeyframe:c,generator:d,mirroredGenerator:h,mapPercentToKeyframes:g,keyframes:_,calculatedDuration:b,totalDuration:$,resolvedDuration:j}=o;if(this.startTime===null)return d.next(0);const{delay:_e,repeat:tt,repeatType:rt,repeatDelay:nt,onUpdate:st}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-$/this.speed,this.startTime)),s?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const at=this.currentTime-_e*(this.speed>=0?1:-1),ot=this.speed>=0?at<0:at>$;this.currentTime=Math.max(at,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=$);let ut=this.currentTime,mt=d;if(tt){const gt=Math.min(this.currentTime,$)/j;let St=Math.floor(gt),xt=gt%1;!xt&&gt>=1&&(xt=1),xt===1&&St--,St=Math.min(St,tt+1),!!(St%2)&&(rt==="reverse"?(xt=1-xt,nt&&(xt-=nt/j)):rt==="mirror"&&(mt=h)),ut=clamp(0,1,xt)*j}const yt=ot?{done:!1,value:_[0]}:mt.next(ut);g&&(yt.value=g(yt.value));let{done:Et}=yt;!ot&&b!==null&&(Et=this.speed>=0?this.currentTime>=$:this.currentTime<=0);const dt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Et);return dt&&c!==void 0&&(yt.value=getFinalKeyframe(_,this.options,c)),st&&st(yt.value),dt&&this.finish(),yt}get duration(){const{resolved:e}=this;return e?millisecondsToSeconds(e.calculatedDuration):0}get time(){return millisecondsToSeconds(this.currentTime)}set time(e){e=secondsToMilliseconds(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const s=this.playbackSpeed!==e;this.playbackSpeed=e,s&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=frameloopDriver,onPlay:s,startTime:o}=this.options;this.driver||(this.driver=e(d=>this.tick(d))),s&&s();const c=this.driver.now();this.holdTime!==null?this.startTime=c-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=c):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]);function startWaapiAnimation(a,e,s,{delay:o=0,duration:c=300,repeat:d=0,repeatType:h="loop",ease:g="easeInOut",times:_}={}){const b={[e]:s};_&&(b.offset=_);const $=mapEasingToNativeEasing(g,c);return Array.isArray($)&&(b.easing=$),a.animate(b,{delay:o,duration:c,easing:Array.isArray($)?"linear":$,fill:"both",iterations:d+1,direction:h==="reverse"?"alternate":"normal"})}const supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),sampleDelta=10,maxDuration=2e4;function requiresPregeneratedKeyframes(a){return isGenerator(a.type)||a.type==="spring"||!isWaapiSupportedEasing(a.ease)}function pregenerateKeyframes(a,e){const s=new MainThreadAnimation({...e,keyframes:a,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:a[0]};const c=[];let d=0;for(;!o.done&&d<maxDuration;)o=s.sample(d),c.push(o.value),d+=sampleDelta;return{times:void 0,keyframes:c,duration:d-sampleDelta,ease:"linear"}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(a){return a in unsupportedEasingFunctions}class AcceleratedAnimation extends BaseAnimation{constructor(e){super(e);const{name:s,motionValue:o,element:c,keyframes:d}=this.options;this.resolver=new DOMKeyframesResolver(d,(h,g)=>this.onKeyframesResolved(h,g),s,o,c),this.resolver.scheduleResolve()}initPlayback(e,s){let{duration:o=300,times:c,ease:d,type:h,motionValue:g,name:_,startTime:b}=this.options;if(!g.owner||!g.owner.current)return!1;if(typeof d=="string"&&supportsLinearEasing()&&isUnsupportedEase(d)&&(d=unsupportedEasingFunctions[d]),requiresPregeneratedKeyframes(this.options)){const{onComplete:j,onUpdate:_e,motionValue:tt,element:rt,...nt}=this.options,st=pregenerateKeyframes(e,nt);e=st.keyframes,e.length===1&&(e[1]=e[0]),o=st.duration,c=st.times,d=st.ease,h="keyframes"}const $=startWaapiAnimation(g.owner.current,_,e,{...this.options,duration:o,times:c,ease:d});return $.startTime=b??this.calcStartTime(),this.pendingTimeline?(attachTimeline($,this.pendingTimeline),this.pendingTimeline=void 0):$.onfinish=()=>{const{onComplete:j}=this.options;g.set(getFinalKeyframe(e,this.options,s)),j&&j(),this.cancel(),this.resolveFinishedPromise()},{animation:$,duration:o,times:c,type:h,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:s}=e;return millisecondsToSeconds(s)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:s}=e;return millisecondsToSeconds(s.currentTime||0)}set time(e){const{resolved:s}=this;if(!s)return;const{animation:o}=s;o.currentTime=secondsToMilliseconds(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:s}=e;return s.playbackRate}set speed(e){const{resolved:s}=this;if(!s)return;const{animation:o}=s;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:s}=e;return s.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:s}=e;return s.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:s}=this;if(!s)return noop$2;const{animation:o}=s;attachTimeline(o,e)}return noop$2}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:s}=e;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:s}=e;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:s,keyframes:o,duration:c,type:d,ease:h,times:g}=e;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:$,onComplete:j,element:_e,...tt}=this.options,rt=new MainThreadAnimation({...tt,keyframes:o,duration:c,type:d,ease:h,times:g,isGenerator:!0}),nt=secondsToMilliseconds(this.time);b.setWithVelocity(rt.sample(nt-sampleDelta).value,rt.sample(nt).value,sampleDelta)}const{onStop:_}=this.options;_&&_(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:s,name:o,repeatDelay:c,repeatType:d,damping:h,type:g}=e;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:_,transformTemplate:b}=s.owner.getProps();return supportsWaapi()&&o&&acceleratedValues.has(o)&&!_&&!b&&!c&&d!=="mirror"&&h!==0&&g!=="inertia"}}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=a=>({type:"spring",stiffness:550,damping:a===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(a,{keyframes:e})=>e.length>2?keyframesTransition:transformProps.has(a)?a.startsWith("scale")?criticallyDampedSpring(e[1]):underDampedSpring:ease;function isTransitionDefined({when:a,delay:e,delayChildren:s,staggerChildren:o,staggerDirection:c,repeat:d,repeatType:h,repeatDelay:g,from:_,elapsed:b,...$}){return!!Object.keys($).length}const animateMotionValue=(a,e,s,o={},c,d)=>h=>{const g=getValueTransition(o,a)||{},_=g.delay||o.delay||0;let{elapsed:b=0}=o;b=b-secondsToMilliseconds(_);let $={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:e.getVelocity(),...g,delay:-b,onUpdate:_e=>{e.set(_e),g.onUpdate&&g.onUpdate(_e)},onComplete:()=>{h(),g.onComplete&&g.onComplete()},name:a,motionValue:e,element:d?void 0:c};isTransitionDefined(g)||($={...$,...getDefaultTransition(a,$)}),$.duration&&($.duration=secondsToMilliseconds($.duration)),$.repeatDelay&&($.repeatDelay=secondsToMilliseconds($.repeatDelay)),$.from!==void 0&&($.keyframes[0]=$.from);let j=!1;if(($.type===!1||$.duration===0&&!$.repeatDelay)&&($.duration=0,$.delay===0&&(j=!0)),j&&!d&&e.get()!==void 0){const _e=getFinalKeyframe($.keyframes,g);if(_e!==void 0)return frame.update(()=>{$.onUpdate(_e),$.onComplete()}),new GroupPlaybackControls([])}return!d&&AcceleratedAnimation.supports($)?new AcceleratedAnimation($):new MainThreadAnimation($)};function shouldBlockAnimation({protectedKeys:a,needsAnimating:e},s){const o=a.hasOwnProperty(s)&&e[s]!==!0;return e[s]=!1,o}function animateTarget(a,e,{delay:s=0,transitionOverride:o,type:c}={}){var d;let{transition:h=a.getDefaultTransition(),transitionEnd:g,..._}=e;o&&(h=o);const b=[],$=c&&a.animationState&&a.animationState.getState()[c];for(const j in _){const _e=a.getValue(j,(d=a.latestValues[j])!==null&&d!==void 0?d:null),tt=_[j];if(tt===void 0||$&&shouldBlockAnimation($,j))continue;const rt={delay:s,...getValueTransition(h||{},j)};let nt=!1;if(window.MotionHandoffAnimation){const at=getOptimisedAppearId(a);if(at){const ot=window.MotionHandoffAnimation(at,j,frame);ot!==null&&(rt.startTime=ot,nt=!0)}}addValueToWillChange(a,j),_e.start(animateMotionValue(j,_e,tt,a.shouldReduceMotion&&positionalKeys.has(j)?{type:!1}:rt,a,nt));const st=_e.animation;st&&b.push(st)}return g&&Promise.all(b).then(()=>{frame.update(()=>{g&&setTarget(a,g)})}),b}function animateVariant(a,e,s={}){var o;const c=resolveVariant(a,e,s.type==="exit"?(o=a.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:d=a.getDefaultTransition()||{}}=c||{};s.transitionOverride&&(d=s.transitionOverride);const h=c?()=>Promise.all(animateTarget(a,c,s)):()=>Promise.resolve(),g=a.variantChildren&&a.variantChildren.size?(b=0)=>{const{delayChildren:$=0,staggerChildren:j,staggerDirection:_e}=d;return animateChildren(a,e,$+b,j,_e,s)}:()=>Promise.resolve(),{when:_}=d;if(_){const[b,$]=_==="beforeChildren"?[h,g]:[g,h];return b().then(()=>$())}else return Promise.all([h(),g(s.delay)])}function animateChildren(a,e,s=0,o=0,c=1,d){const h=[],g=(a.variantChildren.size-1)*o,_=c===1?(b=0)=>b*o:(b=0)=>g-b*o;return Array.from(a.variantChildren).sort(sortByTreeOrder).forEach((b,$)=>{b.notify("AnimationStart",e),h.push(animateVariant(b,e,{...d,delay:s+_($)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(h)}function sortByTreeOrder(a,e){return a.sortNodePosition(e)}function animateVisualElement(a,e,s={}){a.notify("AnimationStart",e);let o;if(Array.isArray(e)){const c=e.map(d=>animateVariant(a,d,s));o=Promise.all(c)}else if(typeof e=="string")o=animateVariant(a,e,s);else{const c=typeof e=="function"?resolveVariant(a,e,s.custom):e;o=Promise.all(animateTarget(a,c,s))}return o.then(()=>{a.notify("AnimationComplete",e)})}const numVariantProps=variantProps.length;function getVariantContext(a){if(!a)return;if(!a.isControllingVariants){const s=a.parent?getVariantContext(a.parent)||{}:{};return a.props.initial!==void 0&&(s.initial=a.props.initial),s}const e={};for(let s=0;s<numVariantProps;s++){const o=variantProps[s],c=a.props[o];(isVariantLabel(c)||c===!1)&&(e[o]=c)}return e}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(a){return e=>Promise.all(e.map(({animation:s,options:o})=>animateVisualElement(a,s,o)))}function createAnimationState(a){let e=animateList(a),s=createState(),o=!0;const c=_=>(b,$)=>{var j;const _e=resolveVariant(a,$,_==="exit"?(j=a.presenceContext)===null||j===void 0?void 0:j.custom:void 0);if(_e){const{transition:tt,transitionEnd:rt,...nt}=_e;b={...b,...nt,...rt}}return b};function d(_){e=_(a)}function h(_){const{props:b}=a,$=getVariantContext(a.parent)||{},j=[],_e=new Set;let tt={},rt=1/0;for(let st=0;st<numAnimationTypes;st++){const at=reversePriorityOrder[st],ot=s[at],ut=b[at]!==void 0?b[at]:$[at],mt=isVariantLabel(ut),yt=at===_?ot.isActive:null;yt===!1&&(rt=st);let Et=ut===$[at]&&ut!==b[at]&&mt;if(Et&&o&&a.manuallyAnimateOnMount&&(Et=!1),ot.protectedKeys={...tt},!ot.isActive&&yt===null||!ut&&!ot.prevProp||isAnimationControls(ut)||typeof ut=="boolean")continue;const dt=checkVariantsDidChange(ot.prevProp,ut);let gt=dt||at===_&&ot.isActive&&!Et&&mt||st>rt&&mt,St=!1;const xt=Array.isArray(ut)?ut:[ut];let Ct=xt.reduce(c(at),{});yt===!1&&(Ct={});const{prevResolvedValues:Ht={}}=ot,Dt={...Ht,...Ct},rr=tr=>{gt=!0,_e.has(tr)&&(St=!0,_e.delete(tr)),ot.needsAnimating[tr]=!0;const Ft=a.getValue(tr);Ft&&(Ft.liveStyle=!1)};for(const tr in Dt){const Ft=Ct[tr],Yt=Ht[tr];if(tt.hasOwnProperty(tr))continue;let Qt=!1;isKeyframesTarget(Ft)&&isKeyframesTarget(Yt)?Qt=!shallowCompare(Ft,Yt):Qt=Ft!==Yt,Qt?Ft!=null?rr(tr):_e.add(tr):Ft!==void 0&&_e.has(tr)?rr(tr):ot.protectedKeys[tr]=!0}ot.prevProp=ut,ot.prevResolvedValues=Ct,ot.isActive&&(tt={...tt,...Ct}),o&&a.blockInitialAnimation&&(gt=!1),gt&&(!(Et&&dt)||St)&&j.push(...xt.map(tr=>({animation:tr,options:{type:at}})))}if(_e.size){const st={};_e.forEach(at=>{const ot=a.getBaseTarget(at),ut=a.getValue(at);ut&&(ut.liveStyle=!0),st[at]=ot??null}),j.push({animation:st})}let nt=!!j.length;return o&&(b.initial===!1||b.initial===b.animate)&&!a.manuallyAnimateOnMount&&(nt=!1),o=!1,nt?e(j):Promise.resolve()}function g(_,b){var $;if(s[_].isActive===b)return Promise.resolve();($=a.variantChildren)===null||$===void 0||$.forEach(_e=>{var tt;return(tt=_e.animationState)===null||tt===void 0?void 0:tt.setActive(_,b)}),s[_].isActive=b;const j=h(_);for(const _e in s)s[_e].protectedKeys={};return j}return{animateChanges:h,setActive:g,setAnimateFunction:d,getState:()=>s,reset:()=>{s=createState(),o=!0}}}function checkVariantsDidChange(a,e){return typeof e=="string"?e!==a:Array.isArray(e)?!shallowCompare(e,a):!1}function createTypeState(a=!1){return{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(e){this.isMounted=!1,this.node=e}update(){}}class AnimationFeature extends Feature{constructor(e){super(e),e.animationState||(e.animationState=createAnimationState(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();isAnimationControls(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:s}=this.node.prevProps||{};e!==s&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:s}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const c=this.node.animationState.setActive("exit",!e);s&&!e&&c.then(()=>s(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(a,e,s,o={passive:!0}){return a.addEventListener(e,s,o),()=>a.removeEventListener(e,s)}function extractEventInfo(a){return{point:{x:a.pageX,y:a.pageY}}}const addPointerInfo=a=>e=>isPrimaryPointer(e)&&a(e,extractEventInfo(e));function addPointerEvent(a,e,s,o){return addDomEvent(a,e,addPointerInfo(s),o)}const distance=(a,e)=>Math.abs(a-e);function distance2D(a,e){const s=distance(a.x,e.x),o=distance(a.y,e.y);return Math.sqrt(s**2+o**2)}class PanSession{constructor(e,s,{transformPagePoint:o,contextWindow:c,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const j=getPanInfo(this.lastMoveEventInfo,this.history),_e=this.startEvent!==null,tt=distance2D(j.offset,{x:0,y:0})>=3;if(!_e&&!tt)return;const{point:rt}=j,{timestamp:nt}=frameData;this.history.push({...rt,timestamp:nt});const{onStart:st,onMove:at}=this.handlers;_e||(st&&st(this.lastMoveEvent,j),this.startEvent=this.lastMoveEvent),at&&at(this.lastMoveEvent,j)},this.handlePointerMove=(j,_e)=>{this.lastMoveEvent=j,this.lastMoveEventInfo=transformPoint(_e,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(j,_e)=>{this.end();const{onEnd:tt,onSessionEnd:rt,resumeAnimation:nt}=this.handlers;if(this.dragSnapToOrigin&&nt&&nt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const st=getPanInfo(j.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(_e,this.transformPagePoint),this.history);this.startEvent&&tt&&tt(j,st),rt&&rt(j,st)},!isPrimaryPointer(e))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=o,this.contextWindow=c||window;const h=extractEventInfo(e),g=transformPoint(h,this.transformPagePoint),{point:_}=g,{timestamp:b}=frameData;this.history=[{..._,timestamp:b}];const{onSessionStart:$}=s;$&&$(e,getPanInfo(g,this.history)),this.removeListeners=pipe$1(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(a,e){return e?{point:e(a.point)}:a}function subtractPoint(a,e){return{x:a.x-e.x,y:a.y-e.y}}function getPanInfo({point:a},e){return{point:a,delta:subtractPoint(a,lastDevicePoint(e)),offset:subtractPoint(a,startDevicePoint(e)),velocity:getVelocity(e,.1)}}function startDevicePoint(a){return a[0]}function lastDevicePoint(a){return a[a.length-1]}function getVelocity(a,e){if(a.length<2)return{x:0,y:0};let s=a.length-1,o=null;const c=lastDevicePoint(a);for(;s>=0&&(o=a[s],!(c.timestamp-o.timestamp>secondsToMilliseconds(e)));)s--;if(!o)return{x:0,y:0};const d=millisecondsToSeconds(c.timestamp-o.timestamp);if(d===0)return{x:0,y:0};const h={x:(c.x-o.x)/d,y:(c.y-o.y)/d};return h.x===1/0&&(h.x=0),h.y===1/0&&(h.y=0),h}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(a){return a.max-a.min}function isNear(a,e,s){return Math.abs(a-e)<=s}function calcAxisDelta(a,e,s,o=.5){a.origin=o,a.originPoint=mixNumber$1(e.min,e.max,a.origin),a.scale=calcLength(s)/calcLength(e),a.translate=mixNumber$1(s.min,s.max,a.origin)-a.originPoint,(a.scale>=SCALE_MIN&&a.scale<=SCALE_MAX||isNaN(a.scale))&&(a.scale=1),(a.translate>=TRANSLATE_MIN&&a.translate<=TRANSLATE_MAX||isNaN(a.translate))&&(a.translate=0)}function calcBoxDelta(a,e,s,o){calcAxisDelta(a.x,e.x,s.x,o?o.originX:void 0),calcAxisDelta(a.y,e.y,s.y,o?o.originY:void 0)}function calcRelativeAxis(a,e,s){a.min=s.min+e.min,a.max=a.min+calcLength(e)}function calcRelativeBox(a,e,s){calcRelativeAxis(a.x,e.x,s.x),calcRelativeAxis(a.y,e.y,s.y)}function calcRelativeAxisPosition(a,e,s){a.min=e.min-s.min,a.max=a.min+calcLength(e)}function calcRelativePosition(a,e,s){calcRelativeAxisPosition(a.x,e.x,s.x),calcRelativeAxisPosition(a.y,e.y,s.y)}function applyConstraints(a,{min:e,max:s},o){return e!==void 0&&a<e?a=o?mixNumber$1(e,a,o.min):Math.max(a,e):s!==void 0&&a>s&&(a=o?mixNumber$1(s,a,o.max):Math.min(a,s)),a}function calcRelativeAxisConstraints(a,e,s){return{min:e!==void 0?a.min+e:void 0,max:s!==void 0?a.max+s-(a.max-a.min):void 0}}function calcRelativeConstraints(a,{top:e,left:s,bottom:o,right:c}){return{x:calcRelativeAxisConstraints(a.x,s,c),y:calcRelativeAxisConstraints(a.y,e,o)}}function calcViewportAxisConstraints(a,e){let s=e.min-a.min,o=e.max-a.max;return e.max-e.min<a.max-a.min&&([s,o]=[o,s]),{min:s,max:o}}function calcViewportConstraints(a,e){return{x:calcViewportAxisConstraints(a.x,e.x),y:calcViewportAxisConstraints(a.y,e.y)}}function calcOrigin(a,e){let s=.5;const o=calcLength(a),c=calcLength(e);return c>o?s=progress(e.min,e.max-o,a.min):o>c&&(s=progress(a.min,a.max-c,e.min)),clamp(0,1,s)}function rebaseAxisConstraints(a,e){const s={};return e.min!==void 0&&(s.min=e.min-a.min),e.max!==void 0&&(s.max=e.max-a.min),s}const defaultElastic=.35;function resolveDragElastic(a=defaultElastic){return a===!1?a=0:a===!0&&(a=defaultElastic),{x:resolveAxisElastic(a,"left","right"),y:resolveAxisElastic(a,"top","bottom")}}function resolveAxisElastic(a,e,s){return{min:resolvePointElastic(a,e),max:resolvePointElastic(a,s)}}function resolvePointElastic(a,e){return typeof a=="number"?a:a[e]||0}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()});function eachAxis(a){return[a("x"),a("y")]}function convertBoundingBoxToBox({top:a,left:e,right:s,bottom:o}){return{x:{min:e,max:s},y:{min:a,max:o}}}function convertBoxToBoundingBox({x:a,y:e}){return{top:e.min,right:a.max,bottom:e.max,left:a.min}}function transformBoxPoints(a,e){if(!e)return a;const s=e({x:a.left,y:a.top}),o=e({x:a.right,y:a.bottom});return{top:s.y,left:s.x,bottom:o.y,right:o.x}}function isIdentityScale(a){return a===void 0||a===1}function hasScale({scale:a,scaleX:e,scaleY:s}){return!isIdentityScale(a)||!isIdentityScale(e)||!isIdentityScale(s)}function hasTransform(a){return hasScale(a)||has2DTranslate(a)||a.z||a.rotate||a.rotateX||a.rotateY||a.skewX||a.skewY}function has2DTranslate(a){return is2DTranslate(a.x)||is2DTranslate(a.y)}function is2DTranslate(a){return a&&a!=="0%"}function scalePoint(a,e,s){const o=a-s,c=e*o;return s+c}function applyPointDelta(a,e,s,o,c){return c!==void 0&&(a=scalePoint(a,c,o)),scalePoint(a,s,o)+e}function applyAxisDelta(a,e=0,s=1,o,c){a.min=applyPointDelta(a.min,e,s,o,c),a.max=applyPointDelta(a.max,e,s,o,c)}function applyBoxDelta(a,{x:e,y:s}){applyAxisDelta(a.x,e.translate,e.scale,e.originPoint),applyAxisDelta(a.y,s.translate,s.scale,s.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(a,e,s,o=!1){const c=s.length;if(!c)return;e.x=e.y=1;let d,h;for(let g=0;g<c;g++){d=s[g],h=d.projectionDelta;const{visualElement:_}=d.options;_&&_.props.style&&_.props.style.display==="contents"||(o&&d.options.layoutScroll&&d.scroll&&d!==d.root&&transformBox(a,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),h&&(e.x*=h.x.scale,e.y*=h.y.scale,applyBoxDelta(a,h)),o&&hasTransform(d.latestValues)&&transformBox(a,d.latestValues))}e.x<TREE_SCALE_SNAP_MAX&&e.x>TREE_SCALE_SNAP_MIN&&(e.x=1),e.y<TREE_SCALE_SNAP_MAX&&e.y>TREE_SCALE_SNAP_MIN&&(e.y=1)}function translateAxis(a,e){a.min=a.min+e,a.max=a.max+e}function transformAxis(a,e,s,o,c=.5){const d=mixNumber$1(a.min,a.max,c);applyAxisDelta(a,e,s,d,o)}function transformBox(a,e){transformAxis(a.x,e.x,e.scaleX,e.scale,e.originX),transformAxis(a.y,e.y,e.scaleY,e.scale,e.originY)}function measureViewportBox(a,e){return convertBoundingBoxToBox(transformBoxPoints(a.getBoundingClientRect(),e))}function measurePageBox(a,e,s){const o=measureViewportBox(a,s),{scroll:c}=e;return c&&(translateAxis(o.x,c.offset.x),translateAxis(o.y,c.offset.y)),o}const getContextWindow=({current:a})=>a?a.ownerDocument.defaultView:null,elementDragControls=new WeakMap;class VisualElementDragControls{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.visualElement=e}start(e,{snapToCursor:s=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const c=$=>{const{dragSnapToOrigin:j}=this.getProps();j?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(extractEventInfo($).point)},d=($,j)=>{const{drag:_e,dragPropagation:tt,onDragStart:rt}=this.getProps();if(_e&&!tt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(_e),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(st=>{let at=this.getAxisMotionValue(st).get()||0;if(percent.test(at)){const{projection:ot}=this.visualElement;if(ot&&ot.layout){const ut=ot.layout.layoutBox[st];ut&&(at=calcLength(ut)*(parseFloat(at)/100))}}this.originPoint[st]=at}),rt&&frame.postRender(()=>rt($,j)),addValueToWillChange(this.visualElement,"transform");const{animationState:nt}=this.visualElement;nt&&nt.setActive("whileDrag",!0)},h=($,j)=>{const{dragPropagation:_e,dragDirectionLock:tt,onDirectionLock:rt,onDrag:nt}=this.getProps();if(!_e&&!this.openDragLock)return;const{offset:st}=j;if(tt&&this.currentDirection===null){this.currentDirection=getCurrentDirection(st),this.currentDirection!==null&&rt&&rt(this.currentDirection);return}this.updateAxis("x",j.point,st),this.updateAxis("y",j.point,st),this.visualElement.render(),nt&&nt($,j)},g=($,j)=>this.stop($,j),_=()=>eachAxis($=>{var j;return this.getAnimationState($)==="paused"&&((j=this.getAxisMotionValue($).animation)===null||j===void 0?void 0:j.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new PanSession(e,{onSessionStart:c,onStart:d,onMove:h,onSessionEnd:g,resumeAnimation:_},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:getContextWindow(this.visualElement)})}stop(e,s){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:c}=s;this.startAnimation(c);const{onDragEnd:d}=this.getProps();d&&frame.postRender(()=>d(e,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:s}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(e,s,o){const{drag:c}=this.getProps();if(!o||!shouldDrag(e,c,this.currentDirection))return;const d=this.getAxisMotionValue(e);let h=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(h=applyConstraints(h,this.constraints[e],this.elastic[e])),d.set(h)}resolveConstraints(){var e;const{dragConstraints:s,dragElastic:o}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,d=this.constraints;s&&isRefObject(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&c?this.constraints=calcRelativeConstraints(c.layoutBox,s):this.constraints=!1,this.elastic=resolveDragElastic(o),d!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(h=>{this.constraints!==!1&&this.getAxisMotionValue(h)&&(this.constraints[h]=rebaseAxisConstraints(c.layoutBox[h],this.constraints[h]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:s}=this.getProps();if(!e||!isRefObject(e))return!1;const o=e.current,{projection:c}=this.visualElement;if(!c||!c.layout)return!1;const d=measurePageBox(o,c.root,this.visualElement.getTransformPagePoint());let h=calcViewportConstraints(c.layout.layoutBox,d);if(s){const g=s(convertBoxToBoundingBox(h));this.hasMutatedConstraints=!!g,g&&(h=convertBoundingBoxToBox(g))}return h}startAnimation(e){const{drag:s,dragMomentum:o,dragElastic:c,dragTransition:d,dragSnapToOrigin:h,onDragTransitionEnd:g}=this.getProps(),_=this.constraints||{},b=eachAxis($=>{if(!shouldDrag($,s,this.currentDirection))return;let j=_&&_[$]||{};h&&(j={min:0,max:0});const _e=c?200:1e6,tt=c?40:1e7,rt={type:"inertia",velocity:o?e[$]:0,bounceStiffness:_e,bounceDamping:tt,timeConstant:750,restDelta:1,restSpeed:10,...d,...j};return this.startAxisValueAnimation($,rt)});return Promise.all(b).then(g)}startAxisValueAnimation(e,s){const o=this.getAxisMotionValue(e);return addValueToWillChange(this.visualElement,e),o.start(animateMotionValue(e,o,0,s,this.visualElement,!1))}stopAnimation(){eachAxis(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){eachAxis(e=>{var s;return(s=this.getAxisMotionValue(e).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(e){var s;return(s=this.getAxisMotionValue(e).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(e){const s=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),c=o[s];return c||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){eachAxis(s=>{const{drag:o}=this.getProps();if(!shouldDrag(s,o,this.currentDirection))return;const{projection:c}=this.visualElement,d=this.getAxisMotionValue(s);if(c&&c.layout){const{min:h,max:g}=c.layout.layoutBox[s];d.set(e[s]-mixNumber$1(h,g,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:s}=this.getProps(),{projection:o}=this.visualElement;if(!isRefObject(s)||!o||!this.constraints)return;this.stopAnimation();const c={x:0,y:0};eachAxis(h=>{const g=this.getAxisMotionValue(h);if(g&&this.constraints!==!1){const _=g.get();c[h]=calcOrigin({min:_,max:_},this.constraints[h])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),eachAxis(h=>{if(!shouldDrag(h,e,null))return;const g=this.getAxisMotionValue(h),{min:_,max:b}=this.constraints[h];g.set(mixNumber$1(_,b,c[h]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const e=this.visualElement.current,s=addPointerEvent(e,"pointerdown",_=>{const{drag:b,dragListener:$=!0}=this.getProps();b&&$&&this.start(_)}),o=()=>{const{dragConstraints:_}=this.getProps();isRefObject(_)&&_.current&&(this.constraints=this.resolveRefConstraints())},{projection:c}=this.visualElement,d=c.addEventListener("measure",o);c&&!c.layout&&(c.root&&c.root.updateScroll(),c.updateLayout()),frame.read(o);const h=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),g=c.addEventListener("didUpdate",({delta:_,hasLayoutChanged:b})=>{this.isDragging&&b&&(eachAxis($=>{const j=this.getAxisMotionValue($);j&&(this.originPoint[$]+=_[$].translate,j.set(j.get()+_[$].translate))}),this.visualElement.render())});return()=>{h(),s(),d(),g&&g()}}getProps(){const e=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:o=!1,dragPropagation:c=!1,dragConstraints:d=!1,dragElastic:h=defaultElastic,dragMomentum:g=!0}=e;return{...e,drag:s,dragDirectionLock:o,dragPropagation:c,dragConstraints:d,dragElastic:h,dragMomentum:g}}}function shouldDrag(a,e,s){return(e===!0||e===a)&&(s===null||s===a)}function getCurrentDirection(a,e=10){let s=null;return Math.abs(a.y)>e?s="y":Math.abs(a.x)>e&&(s="x"),s}class DragGesture extends Feature{constructor(e){super(e),this.removeGroupControls=noop$2,this.removeListeners=noop$2,this.controls=new VisualElementDragControls(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop$2}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=a=>(e,s)=>{a&&frame.postRender(()=>a(e,s))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop$2}onPointerDown(e){this.session=new PanSession(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:s,onPan:o,onPanEnd:c}=this.node.getProps();return{onSessionStart:asyncHandler(e),onStart:asyncHandler(s),onMove:o,onEnd:(d,h)=>{delete this.session,c&&frame.postRender(()=>c(d,h))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(a,e){return e.max===e.min?0:a/(e.max-e.min)*100}const correctBorderRadius={correct:(a,e)=>{if(!e.target)return a;if(typeof a=="string")if(px.test(a))a=parseFloat(a);else return a;const s=pixelsToPercent(a,e.target.x),o=pixelsToPercent(a,e.target.y);return`${s}% ${o}%`}},correctBoxShadow={correct:(a,{treeScale:e,projectionDelta:s})=>{const o=a,c=complex.parse(a);if(c.length>5)return o;const d=complex.createTransformer(a),h=typeof c[0]!="number"?1:0,g=s.x.scale*e.x,_=s.y.scale*e.y;c[0+h]/=g,c[1+h]/=_;const b=mixNumber$1(g,_,.5);return typeof c[2+h]=="number"&&(c[2+h]/=b),typeof c[3+h]=="number"&&(c[3+h]/=b),d(c)}};class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:o,layoutId:c}=this.props,{projection:d}=e;addScaleCorrector(defaultScaleCorrectors),d&&(s.group&&s.group.add(d),o&&o.register&&c&&o.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:s,visualElement:o,drag:c,isPresent:d}=this.props,h=o.projection;return h&&(h.isPresent=d,c||e.layoutDependency!==s||s===void 0?h.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?h.promote():h.relegate()||frame.postRender(()=>{const g=h.getStack();(!g||!g.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),microtask.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:o}=this.props,{projection:c}=e;c&&(c.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(c),o&&o.deregister&&o.deregister(c))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function MeasureLayout(a){const[e,s]=usePresence(),o=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...a,layoutGroup:o,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:e,safeToRemove:s})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function animateSingleValue(a,e,s){const o=isMotionValue(a)?a:motionValue(a);return o.start(animateMotionValue("",o,e,s)),o.animation}function isSVGElement(a){return a instanceof SVGElement&&a.tagName!=="svg"}const compareByDepth=(a,e)=>a.depth-e.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(e){addUniqueItem(this.children,e),this.isDirty=!0}remove(e){removeItem(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(e)}}function delay(a,e){const s=time.now(),o=({timestamp:c})=>{const d=c-s;d>=e&&(cancelFrame(o),a(d-e))};return frame.read(o,!0),()=>cancelFrame(o)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=a=>typeof a=="string"?parseFloat(a):a,isPx=a=>typeof a=="number"||px.test(a);function mixValues(a,e,s,o,c,d){c?(a.opacity=mixNumber$1(0,s.opacity!==void 0?s.opacity:1,easeCrossfadeIn(o)),a.opacityExit=mixNumber$1(e.opacity!==void 0?e.opacity:1,0,easeCrossfadeOut(o))):d&&(a.opacity=mixNumber$1(e.opacity!==void 0?e.opacity:1,s.opacity!==void 0?s.opacity:1,o));for(let h=0;h<numBorders;h++){const g=`border${borders[h]}Radius`;let _=getRadius(e,g),b=getRadius(s,g);if(_===void 0&&b===void 0)continue;_||(_=0),b||(b=0),_===0||b===0||isPx(_)===isPx(b)?(a[g]=Math.max(mixNumber$1(asNumber(_),asNumber(b),o),0),(percent.test(b)||percent.test(_))&&(a[g]+="%")):a[g]=b}(e.rotate||s.rotate)&&(a.rotate=mixNumber$1(e.rotate||0,s.rotate||0,o))}function getRadius(a,e){return a[e]!==void 0?a[e]:a.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop$2);function compress(a,e,s){return o=>o<a?0:o>e?1:s(progress(a,e,o))}function copyAxisInto(a,e){a.min=e.min,a.max=e.max}function copyBoxInto(a,e){copyAxisInto(a.x,e.x),copyAxisInto(a.y,e.y)}function copyAxisDeltaInto(a,e){a.translate=e.translate,a.scale=e.scale,a.originPoint=e.originPoint,a.origin=e.origin}function removePointDelta(a,e,s,o,c){return a-=e,a=scalePoint(a,1/s,o),c!==void 0&&(a=scalePoint(a,1/c,o)),a}function removeAxisDelta(a,e=0,s=1,o=.5,c,d=a,h=a){if(percent.test(e)&&(e=parseFloat(e),e=mixNumber$1(h.min,h.max,e/100)-h.min),typeof e!="number")return;let g=mixNumber$1(d.min,d.max,o);a===d&&(g-=e),a.min=removePointDelta(a.min,e,s,g,c),a.max=removePointDelta(a.max,e,s,g,c)}function removeAxisTransforms(a,e,[s,o,c],d,h){removeAxisDelta(a,e[s],e[o],e[c],e.scale,d,h)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(a,e,s,o){removeAxisTransforms(a.x,e,xKeys,s?s.x:void 0,o?o.x:void 0),removeAxisTransforms(a.y,e,yKeys,s?s.y:void 0,o?o.y:void 0)}function isAxisDeltaZero(a){return a.translate===0&&a.scale===1}function isDeltaZero(a){return isAxisDeltaZero(a.x)&&isAxisDeltaZero(a.y)}function axisEquals(a,e){return a.min===e.min&&a.max===e.max}function boxEquals(a,e){return axisEquals(a.x,e.x)&&axisEquals(a.y,e.y)}function axisEqualsRounded(a,e){return Math.round(a.min)===Math.round(e.min)&&Math.round(a.max)===Math.round(e.max)}function boxEqualsRounded(a,e){return axisEqualsRounded(a.x,e.x)&&axisEqualsRounded(a.y,e.y)}function aspectRatio(a){return calcLength(a.x)/calcLength(a.y)}function axisDeltaEquals(a,e){return a.translate===e.translate&&a.scale===e.scale&&a.originPoint===e.originPoint}class NodeStack{constructor(){this.members=[]}add(e){addUniqueItem(this.members,e),e.scheduleRender()}remove(e){if(removeItem(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(e){const s=this.members.findIndex(c=>e===c);if(s===0)return!1;let o;for(let c=s;c>=0;c--){const d=this.members[c];if(d.isPresent!==!1){o=d;break}}return o?(this.promote(o),!0):!1}promote(e,s){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,s&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:c}=e.options;c===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:s,resumingFrom:o}=e;s.onExitComplete&&s.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(a,e,s){let o="";const c=a.x.translate/e.x,d=a.y.translate/e.y,h=(s==null?void 0:s.z)||0;if((c||d||h)&&(o=`translate3d(${c}px, ${d}px, ${h}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),s){const{transformPerspective:b,rotate:$,rotateX:j,rotateY:_e,skewX:tt,skewY:rt}=s;b&&(o=`perspective(${b}px) ${o}`),$&&(o+=`rotate(${$}deg) `),j&&(o+=`rotateX(${j}deg) `),_e&&(o+=`rotateY(${_e}deg) `),tt&&(o+=`skewX(${tt}deg) `),rt&&(o+=`skewY(${rt}deg) `)}const g=a.x.scale*e.x,_=a.y.scale*e.y;return(g!==1||_!==1)&&(o+=`scale(${g}, ${_})`),o||"none"}const metrics={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},isDebug=typeof window<"u"&&window.MotionDebug!==void 0,transformAxes=["","X","Y","Z"],hiddenVisibility={visibility:"hidden"},animationTarget=1e3;let id=0;function resetDistortingTransform(a,e,s,o){const{latestValues:c}=e;c[a]&&(s[a]=c[a],e.setStaticValue(a,0),o&&(o[a]=0))}function cancelTreeOptimisedTransformAnimations(a){if(a.hasCheckedOptimisedAppear=!0,a.root===a)return;const{visualElement:e}=a.options;if(!e)return;const s=getOptimisedAppearId(e);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:c,layoutId:d}=a.options;window.MotionCancelOptimisedAnimation(s,"transform",frame,!(c||d))}const{parent:o}=a;o&&!o.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(o)}function createProjectionNode({attachResizeListener:a,defaultParent:e,measureScroll:s,checkIsScrollRoot:o,resetTransform:c}){return class{constructor(h={},g=e==null?void 0:e()){this.id=id++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,isDebug&&(metrics.totalNodes=metrics.resolvedTargetDeltas=metrics.recalculatedProjection=0),this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes),isDebug&&window.MotionDebug.record(metrics)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=h,this.root=g?g.root||g:this,this.path=g?[...g.path,g]:[],this.parent=g,this.depth=g?g.depth+1:0;for(let _=0;_<this.path.length;_++)this.path[_].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(h,g){return this.eventHandlers.has(h)||this.eventHandlers.set(h,new SubscriptionManager),this.eventHandlers.get(h).add(g)}notifyListeners(h,...g){const _=this.eventHandlers.get(h);_&&_.notify(...g)}hasListeners(h){return this.eventHandlers.has(h)}mount(h,g=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=isSVGElement(h),this.instance=h;const{layoutId:_,layout:b,visualElement:$}=this.options;if($&&!$.current&&$.mount(h),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),g&&(b||_)&&(this.isLayoutDirty=!0),a){let j;const _e=()=>this.root.updateBlockedByResize=!1;a(h,()=>{this.root.updateBlockedByResize=!0,j&&j(),j=delay(_e,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation))})}_&&this.root.registerSharedNode(_,this),this.options.animate!==!1&&$&&(_||b)&&this.addEventListener("didUpdate",({delta:j,hasLayoutChanged:_e,hasRelativeTargetChanged:tt,layout:rt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const nt=this.options.transition||$.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:st,onLayoutAnimationComplete:at}=$.getProps(),ot=!this.targetLayout||!boxEqualsRounded(this.targetLayout,rt)||tt,ut=!_e&&tt;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ut||_e&&(ot||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(j,ut);const mt={...getValueTransition(nt,"layout"),onPlay:st,onComplete:at};($.shouldReduceMotion||this.options.layoutRoot)&&(mt.delay=0,mt.type=!1),this.startAnimation(mt)}else _e||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=rt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const h=this.getStack();h&&h.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:h}=this.options;return h&&h.getProps().transformTemplate}willUpdate(h=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let $=0;$<this.path.length;$++){const j=this.path[$];j.shouldResetTransform=!0,j.updateScroll("snapshot"),j.options.layoutRoot&&j.willUpdate(!1)}const{layoutId:g,layout:_}=this.options;if(g===void 0&&!_)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),h&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}this.isUpdating||this.nodes.forEach(clearIsLayoutDirty),this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate),this.clearAllSnapshots();const g=time.now();frameData.delta=clamp(0,1e3/60,g-frameData.timestamp),frameData.timestamp=g,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let _=0;_<this.path.length;_++)this.path[_].updateScroll();const h=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:g}=this.options;g&&g.notify("LayoutMeasure",this.layout.layoutBox,h?h.layoutBox:void 0)}updateScroll(h="measure"){let g=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===h&&(g=!1),g){const _=o(this.instance);this.scroll={animationId:this.root.animationId,phase:h,isRoot:_,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:_}}}resetTransform(){if(!c)return;const h=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,g=this.projectionDelta&&!isDeltaZero(this.projectionDelta),_=this.getTransformTemplate(),b=_?_(this.latestValues,""):void 0,$=b!==this.prevTransformTemplateValue;h&&(g||hasTransform(this.latestValues)||$)&&(c(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(h=!0){const g=this.measurePageBox();let _=this.removeElementScroll(g);return h&&(_=this.removeTransform(_)),roundBox(_),{animationId:this.root.animationId,measuredBox:g,layoutBox:_,latestValues:{},source:this.id}}measurePageBox(){var h;const{visualElement:g}=this.options;if(!g)return createBox();const _=g.measureViewportBox();if(!(((h=this.scroll)===null||h===void 0?void 0:h.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:$}=this.root;$&&(translateAxis(_.x,$.offset.x),translateAxis(_.y,$.offset.y))}return _}removeElementScroll(h){var g;const _=createBox();if(copyBoxInto(_,h),!((g=this.scroll)===null||g===void 0)&&g.wasRoot)return _;for(let b=0;b<this.path.length;b++){const $=this.path[b],{scroll:j,options:_e}=$;$!==this.root&&j&&_e.layoutScroll&&(j.wasRoot&&copyBoxInto(_,h),translateAxis(_.x,j.offset.x),translateAxis(_.y,j.offset.y))}return _}applyTransform(h,g=!1){const _=createBox();copyBoxInto(_,h);for(let b=0;b<this.path.length;b++){const $=this.path[b];!g&&$.options.layoutScroll&&$.scroll&&$!==$.root&&transformBox(_,{x:-$.scroll.offset.x,y:-$.scroll.offset.y}),hasTransform($.latestValues)&&transformBox(_,$.latestValues)}return hasTransform(this.latestValues)&&transformBox(_,this.latestValues),_}removeTransform(h){const g=createBox();copyBoxInto(g,h);for(let _=0;_<this.path.length;_++){const b=this.path[_];if(!b.instance||!hasTransform(b.latestValues))continue;hasScale(b.latestValues)&&b.updateSnapshot();const $=createBox(),j=b.measurePageBox();copyBoxInto($,j),removeBoxTransforms(g,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,$)}return hasTransform(this.latestValues)&&removeBoxTransforms(g,this.latestValues),g}setTargetDelta(h){this.targetDelta=h,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(h){this.options={...this.options,...h,crossfade:h.crossfade!==void 0?h.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(h=!1){var g;const _=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=_.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=_.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=_.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==_;if(!(h||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((g=this.parent)===null||g===void 0)&&g.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:j,layoutId:_e}=this.options;if(!(!this.layout||!(j||_e))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const tt=this.getClosestProjectingParent();tt&&tt.layout&&this.animationProgress!==1?(this.relativeParent=tt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,tt.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const tt=this.getClosestProjectingParent();tt&&!!tt.resumingFrom==!!this.resumingFrom&&!tt.options.layoutScroll&&tt.target&&this.animationProgress!==1?(this.relativeParent=tt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,tt.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}isDebug&&metrics.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var h;const g=this.getLead(),_=!!this.resumingFrom||this!==g;let b=!0;if((this.isProjectionDirty||!((h=this.parent)===null||h===void 0)&&h.isProjectionDirty)&&(b=!1),_&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(b=!1),b)return;const{layout:$,layoutId:j}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!($||j))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const _e=this.treeScale.x,tt=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,_),g.layout&&!g.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(g.target=g.layout.layoutBox,g.targetWithTransforms=createBox());const{target:rt}=g;if(!rt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,rt,this.latestValues),(this.treeScale.x!==_e||this.treeScale.y!==tt||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",rt)),isDebug&&metrics.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(h=!0){var g;if((g=this.options.visualElement)===null||g===void 0||g.scheduleRender(),h){const _=this.getStack();_&&_.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(h,g=!1){const _=this.snapshot,b=_?_.latestValues:{},$={...this.latestValues},j=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!g;const _e=createBox(),tt=_?_.source:void 0,rt=this.layout?this.layout.source:void 0,nt=tt!==rt,st=this.getStack(),at=!st||st.members.length<=1,ot=!!(nt&&!at&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let ut;this.mixTargetDelta=mt=>{const yt=mt/1e3;mixAxisDelta(j.x,h.x,yt),mixAxisDelta(j.y,h.y,yt),this.setTargetDelta(j),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(_e,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,_e,yt),ut&&boxEquals(this.relativeTarget,ut)&&(this.isProjectionDirty=!1),ut||(ut=createBox()),copyBoxInto(ut,this.relativeTarget)),nt&&(this.animationValues=$,mixValues($,b,this.latestValues,yt,ot,at)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=yt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(h){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.currentAnimation=animateSingleValue(0,animationTarget,{...h,onUpdate:g=>{this.mixTargetDelta(g),h.onUpdate&&h.onUpdate(g)},onComplete:()=>{h.onComplete&&h.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const h=this.getStack();h&&h.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const h=this.getLead();let{targetWithTransforms:g,target:_,layout:b,latestValues:$}=h;if(!(!g||!_||!b)){if(this!==h&&this.layout&&b&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,b.layoutBox)){_=this.target||createBox();const j=calcLength(this.layout.layoutBox.x);_.x.min=h.target.x.min,_.x.max=_.x.min+j;const _e=calcLength(this.layout.layoutBox.y);_.y.min=h.target.y.min,_.y.max=_.y.min+_e}copyBoxInto(g,_),transformBox(g,$),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,g,$)}}registerSharedNode(h,g){this.sharedNodes.has(h)||this.sharedNodes.set(h,new NodeStack),this.sharedNodes.get(h).add(g);const b=g.options.initialPromotionConfig;g.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(g):void 0})}isLead(){const h=this.getStack();return h?h.lead===this:!0}getLead(){var h;const{layoutId:g}=this.options;return g?((h=this.getStack())===null||h===void 0?void 0:h.lead)||this:this}getPrevLead(){var h;const{layoutId:g}=this.options;return g?(h=this.getStack())===null||h===void 0?void 0:h.prevLead:void 0}getStack(){const{layoutId:h}=this.options;if(h)return this.root.sharedNodes.get(h)}promote({needsReset:h,transition:g,preserveFollowOpacity:_}={}){const b=this.getStack();b&&b.promote(this,_),h&&(this.projectionDelta=void 0,this.needsReset=!0),g&&this.setOptions({transition:g})}relegate(){const h=this.getStack();return h?h.relegate(this):!1}resetSkewAndRotation(){const{visualElement:h}=this.options;if(!h)return;let g=!1;const{latestValues:_}=h;if((_.z||_.rotate||_.rotateX||_.rotateY||_.rotateZ||_.skewX||_.skewY)&&(g=!0),!g)return;const b={};_.z&&resetDistortingTransform("z",h,b,this.animationValues);for(let $=0;$<transformAxes.length;$++)resetDistortingTransform(`rotate${transformAxes[$]}`,h,b,this.animationValues),resetDistortingTransform(`skew${transformAxes[$]}`,h,b,this.animationValues);h.render();for(const $ in b)h.setStaticValue($,b[$]),this.animationValues&&(this.animationValues[$]=b[$]);h.scheduleRender()}getProjectionStyles(h){var g,_;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hiddenVisibility;const b={visibility:""},$=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=resolveMotionValue(h==null?void 0:h.pointerEvents)||"",b.transform=$?$(this.latestValues,""):"none",b;const j=this.getLead();if(!this.projectionDelta||!this.layout||!j.target){const nt={};return this.options.layoutId&&(nt.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,nt.pointerEvents=resolveMotionValue(h==null?void 0:h.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(nt.transform=$?$({},""):"none",this.hasProjected=!1),nt}const _e=j.animationValues||j.latestValues;this.applyTransformsToTarget(),b.transform=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,_e),$&&(b.transform=$(_e,b.transform));const{x:tt,y:rt}=this.projectionDelta;b.transformOrigin=`${tt.origin*100}% ${rt.origin*100}% 0`,j.animationValues?b.opacity=j===this?(_=(g=_e.opacity)!==null&&g!==void 0?g:this.latestValues.opacity)!==null&&_!==void 0?_:1:this.preserveOpacity?this.latestValues.opacity:_e.opacityExit:b.opacity=j===this?_e.opacity!==void 0?_e.opacity:"":_e.opacityExit!==void 0?_e.opacityExit:0;for(const nt in scaleCorrectors){if(_e[nt]===void 0)continue;const{correct:st,applyTo:at}=scaleCorrectors[nt],ot=b.transform==="none"?_e[nt]:st(_e[nt],j);if(at){const ut=at.length;for(let mt=0;mt<ut;mt++)b[at[mt]]=ot}else b[nt]=ot}return this.options.layoutId&&(b.pointerEvents=j===this?resolveMotionValue(h==null?void 0:h.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(h=>{var g;return(g=h.currentAnimation)===null||g===void 0?void 0:g.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(a){a.updateLayout()}function notifyLayoutUpdate(a){var e;const s=((e=a.resumeFrom)===null||e===void 0?void 0:e.snapshot)||a.snapshot;if(a.isLead()&&a.layout&&s&&a.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:c}=a.layout,{animationType:d}=a.options,h=s.source!==a.layout.source;d==="size"?eachAxis(j=>{const _e=h?s.measuredBox[j]:s.layoutBox[j],tt=calcLength(_e);_e.min=o[j].min,_e.max=_e.min+tt}):shouldAnimatePositionOnly(d,s.layoutBox,o)&&eachAxis(j=>{const _e=h?s.measuredBox[j]:s.layoutBox[j],tt=calcLength(o[j]);_e.max=_e.min+tt,a.relativeTarget&&!a.currentAnimation&&(a.isProjectionDirty=!0,a.relativeTarget[j].max=a.relativeTarget[j].min+tt)});const g=createDelta();calcBoxDelta(g,o,s.layoutBox);const _=createDelta();h?calcBoxDelta(_,a.applyTransform(c,!0),s.measuredBox):calcBoxDelta(_,o,s.layoutBox);const b=!isDeltaZero(g);let $=!1;if(!a.resumeFrom){const j=a.getClosestProjectingParent();if(j&&!j.resumeFrom){const{snapshot:_e,layout:tt}=j;if(_e&&tt){const rt=createBox();calcRelativePosition(rt,s.layoutBox,_e.layoutBox);const nt=createBox();calcRelativePosition(nt,o,tt.layoutBox),boxEqualsRounded(rt,nt)||($=!0),j.options.layoutRoot&&(a.relativeTarget=nt,a.relativeTargetOrigin=rt,a.relativeParent=j)}}}a.notifyListeners("didUpdate",{layout:o,snapshot:s,delta:_,layoutDelta:g,hasLayoutChanged:b,hasRelativeTargetChanged:$})}else if(a.isLead()){const{onExitComplete:o}=a.options;o&&o()}a.options.transition=void 0}function propagateDirtyNodes(a){isDebug&&metrics.totalNodes++,a.parent&&(a.isProjecting()||(a.isProjectionDirty=a.parent.isProjectionDirty),a.isSharedProjectionDirty||(a.isSharedProjectionDirty=!!(a.isProjectionDirty||a.parent.isProjectionDirty||a.parent.isSharedProjectionDirty)),a.isTransformDirty||(a.isTransformDirty=a.parent.isTransformDirty))}function cleanDirtyNodes(a){a.isProjectionDirty=a.isSharedProjectionDirty=a.isTransformDirty=!1}function clearSnapshot(a){a.clearSnapshot()}function clearMeasurements(a){a.clearMeasurements()}function clearIsLayoutDirty(a){a.isLayoutDirty=!1}function resetTransformStyle(a){const{visualElement:e}=a.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),a.resetTransform()}function finishAnimation(a){a.finishAnimation(),a.targetDelta=a.relativeTarget=a.target=void 0,a.isProjectionDirty=!0}function resolveTargetDelta(a){a.resolveTargetDelta()}function calcProjection(a){a.calcProjection()}function resetSkewAndRotation(a){a.resetSkewAndRotation()}function removeLeadSnapshots(a){a.removeLeadSnapshot()}function mixAxisDelta(a,e,s){a.translate=mixNumber$1(e.translate,0,s),a.scale=mixNumber$1(e.scale,1,s),a.origin=e.origin,a.originPoint=e.originPoint}function mixAxis(a,e,s,o){a.min=mixNumber$1(e.min,s.min,o),a.max=mixNumber$1(e.max,s.max,o)}function mixBox(a,e,s,o){mixAxis(a.x,e.x,s.x,o),mixAxis(a.y,e.y,s.y,o)}function hasOpacityCrossfade(a){return a.animationValues&&a.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=a=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(a),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop$2;function roundAxis(a){a.min=roundPoint(a.min),a.max=roundPoint(a.max)}function roundBox(a){roundAxis(a.x),roundAxis(a.y)}function shouldAnimatePositionOnly(a,e,s){return a==="position"||a==="preserve-aspect"&&!isNear(aspectRatio(e),aspectRatio(s),.2)}function checkNodeWasScrollRoot(a){var e;return a!==a.root&&((e=a.scroll)===null||e===void 0?void 0:e.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(a,e)=>addDomEvent(a,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:a=>({x:a.scrollLeft,y:a.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const a=new DocumentProjectionNode({});a.mount(window),a.setOptions({layoutScroll:!0}),rootProjectionNode.current=a}return rootProjectionNode.current},resetTransform:(a,e)=>{a.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:a=>window.getComputedStyle(a).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(a,e,s){const{props:o}=a;a.animationState&&o.whileHover&&a.animationState.setActive("whileHover",s==="Start");const c="onHover"+s,d=o[c];d&&frame.postRender(()=>d(e,extractEventInfo(e)))}class HoverGesture extends Feature{mount(){const{current:e}=this.node;e&&(this.unmount=hover(e,s=>(handleHoverEvent(this.node,s,"Start"),o=>handleHoverEvent(this.node,o,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe$1(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(a,e,s){const{props:o}=a;a.animationState&&o.whileTap&&a.animationState.setActive("whileTap",s==="Start");const c="onTap"+(s==="End"?"":s),d=o[c];d&&frame.postRender(()=>d(e,extractEventInfo(e)))}class PressGesture extends Feature{mount(){const{current:e}=this.node;e&&(this.unmount=press(e,s=>(handlePressEvent(this.node,s,"Start"),(o,{success:c})=>handlePressEvent(this.node,o,c?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=a=>{const e=observerCallbacks.get(a.target);e&&e(a)},fireAllObserverCallbacks=a=>{a.forEach(fireObserverCallback)};function initIntersectionObserver({root:a,...e}){const s=a||document;observers.has(s)||observers.set(s,{});const o=observers.get(s),c=JSON.stringify(e);return o[c]||(o[c]=new IntersectionObserver(fireAllObserverCallbacks,{root:a,...e})),o[c]}function observeIntersection(a,e,s){const o=initIntersectionObserver(e);return observerCallbacks.set(a,s),o.observe(a),()=>{observerCallbacks.delete(a),o.unobserve(a)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:s,margin:o,amount:c="some",once:d}=e,h={root:s?s.current:void 0,rootMargin:o,threshold:typeof c=="number"?c:thresholdNames[c]},g=_=>{const{isIntersecting:b}=_;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:$,onViewportLeave:j}=this.node.getProps(),_e=b?$:j;_e&&_e(_)};return observeIntersection(this.node.current,h,g)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:s}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(e,s))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:a={}},{viewport:e={}}={}){return s=>a[s]!==e[s]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const a=window.matchMedia("(prefers-reduced-motion)"),e=()=>prefersReducedMotion.current=a.matches;a.addListener(e),e()}else prefersReducedMotion.current=!1}const valueTypes=[...dimensionValueTypes,color,complex],findValueType=a=>valueTypes.find(testValueType(a)),visualElementStore=new WeakMap;function updateMotionValuesFromProps(a,e,s){for(const o in e){const c=e[o],d=s[o];if(isMotionValue(c))a.addValue(o,c);else if(isMotionValue(d))a.addValue(o,motionValue(c,{owner:a}));else if(d!==c)if(a.hasValue(o)){const h=a.getValue(o);h.liveStyle===!0?h.jump(c):h.hasAnimated||h.set(c)}else{const h=a.getStaticValue(o);a.addValue(o,motionValue(h!==void 0?h:c,{owner:a}))}}for(const o in s)e[o]===void 0&&a.removeValue(o);return e}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(e,s,o){return{}}constructor({parent:e,props:s,presenceContext:o,reducedMotionConfig:c,blockInitialAnimation:d,visualState:h},g={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const tt=time.now();this.renderScheduledAt<tt&&(this.renderScheduledAt=tt,frame.render(this.render,!1,!0))};const{latestValues:_,renderState:b,onUpdate:$}=h;this.onUpdate=$,this.latestValues=_,this.baseTarget={..._},this.initialValues=s.initial?{..._}:{},this.renderState=b,this.parent=e,this.props=s,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=c,this.options=g,this.blockInitialAnimation=!!d,this.isControllingVariants=isControllingVariants(s),this.isVariantNode=isVariantNode(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:j,..._e}=this.scrapeMotionValuesFromProps(s,{},this);for(const tt in _e){const rt=_e[tt];_[tt]!==void 0&&isMotionValue(rt)&&rt.set(_[tt],!1)}}mount(e){this.current=e,visualElementStore.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,o)=>this.bindToMotionValue(o,s)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){visualElementStore.delete(this.current),this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const s=this.features[e];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(e,s){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=transformProps.has(e),c=s.on("change",g=>{this.latestValues[e]=g,this.props.onUpdate&&frame.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let h;window.MotionCheckAppearSync&&(h=window.MotionCheckAppearSync(this,e,s)),this.valueSubscriptions.set(e,()=>{c(),d(),h&&h(),s.owner&&s.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in featureDefinitions){const s=featureDefinitions[e];if(!s)continue;const{isEnabled:o,Feature:c}=s;if(!this.features[e]&&c&&o(this.props)&&(this.features[e]=new c(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,s){this.latestValues[e]=s}update(e,s){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let o=0;o<propEventHandlers.length;o++){const c=propEventHandlers[o];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);const d="on"+c,h=e[d];h&&(this.propEventSubscriptions[c]=this.on(c,h))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(e),()=>s.variantChildren.delete(e)}addValue(e,s){const o=this.values.get(e);s!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,s),this.values.set(e,s),this.latestValues[e]=s.get())}removeValue(e){this.values.delete(e);const s=this.valueSubscriptions.get(e);s&&(s(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,s){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&s!==void 0&&(o=motionValue(s===null?void 0:s,{owner:this}),this.addValue(e,o)),o}readValue(e,s){var o;let c=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return c!=null&&(typeof c=="string"&&(isNumericalString(c)||isZeroValueString(c))?c=parseFloat(c):!findValueType(c)&&complex.test(s)&&(c=getAnimatableNone(e,s)),this.setBaseTarget(e,isMotionValue(c)?c.get():c)),isMotionValue(c)?c.get():c}setBaseTarget(e,s){this.baseTarget[e]=s}getBaseTarget(e){var s;const{initial:o}=this.props;let c;if(typeof o=="string"||typeof o=="object"){const h=resolveVariantFromProps(this.props,o,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);h&&(c=h[e])}if(o&&c!==void 0)return c;const d=this.getBaseTargetFromProps(this.props,e);return d!==void 0&&!isMotionValue(d)?d:this.initialValues[e]!==void 0&&c===void 0?void 0:this.baseTarget[e]}on(e,s){return this.events[e]||(this.events[e]=new SubscriptionManager),this.events[e].add(s)}notify(e,...s){this.events[e]&&this.events[e].notify(...s)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(e,s){return e.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(e,s){return e.style?e.style[s]:void 0}removeValueFromRenderState(e,{vars:s,style:o}){delete s[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;isMotionValue(e)&&(this.childSubscription=e.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function getComputedStyle(a){return window.getComputedStyle(a)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(e,s){if(transformProps.has(s)){const o=getDefaultValueType(s);return o&&o.default||0}else{const o=getComputedStyle(e),c=(isCSSVariableName(s)?o.getPropertyValue(s):o[s])||0;return typeof c=="string"?c.trim():c}}measureInstanceViewportBox(e,{transformPagePoint:s}){return measureViewportBox(e,s)}build(e,s,o){buildHTMLStyles(e,s,o.transformTemplate)}scrapeMotionValuesFromProps(e,s,o){return scrapeMotionValuesFromProps$1(e,s,o)}}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(e,s){return e[s]}readValueFromInstance(e,s){if(transformProps.has(s)){const o=getDefaultValueType(s);return o&&o.default||0}return s=camelCaseAttributes.has(s)?s:camelToDash(s),e.getAttribute(s)}scrapeMotionValuesFromProps(e,s,o){return scrapeMotionValuesFromProps(e,s,o)}build(e,s,o){buildSVGAttrs(e,s,this.isSVGTag,o.transformTemplate)}renderInstance(e,s,o,c){renderSVG(e,s,o,c)}mount(e){this.isSVGTag=isSVGTag(e.tagName),super.mount(e)}}const createDomVisualElement=(a,e)=>isSVGComponent(a)?new SVGVisualElement(e):new HTMLVisualElement(e,{allowProjection:a!==reactExports.Fragment}),createMotionComponent=createMotionComponentFactory({...animations,...gestureAnimations,...drag,...layout},createDomVisualElement),motion=createDOMMotionComponentProxy(createMotionComponent);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),createLucideIcon=(a,e)=>{const s=reactExports.forwardRef(({color:o="currentColor",size:c=24,strokeWidth:d=2,absoluteStrokeWidth:h,className:g="",children:_,...b},$)=>reactExports.createElement("svg",{ref:$,...defaultAttributes,width:c,height:c,stroke:o,strokeWidth:h?Number(d)*24/Number(c):d,className:["lucide",`lucide-${toKebabCase(a)}`,g].join(" "),...b},[...e.map(([j,_e])=>reactExports.createElement(j,_e)),...Array.isArray(_)?_:[_]]));return s.displayName=`${a}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronDown=createLucideIcon("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clock=createLucideIcon("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Download=createLucideIcon("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FolderPlus=createLucideIcon("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Grid3x3=createLucideIcon("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heart=createLucideIcon("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Home=createLucideIcon("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ListMusic=createLucideIcon("ListMusic",[["path",{d:"M21 15V6",key:"h1cx4g"}],["path",{d:"M18.5 18a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z",key:"8saifv"}],["path",{d:"M12 12H3",key:"18klou"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M12 18H3",key:"11ftsu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Loader2=createLucideIcon("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Maximize2=createLucideIcon("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageSquareQuote=createLucideIcon("MessageSquareQuote",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M8 12a2 2 0 0 0 2-2V8H8",key:"1jfesj"}],["path",{d:"M14 12a2 2 0 0 0 2-2V8h-2",key:"1dq9mh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Music=createLucideIcon("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pause=createLucideIcon("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PlaySquare=createLucideIcon("PlaySquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"m9 8 6 4-6 4Z",key:"f1r3lt"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Play=createLucideIcon("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Radio=createLucideIcon("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Search=createLucideIcon("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SkipBack=createLucideIcon("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SkipForward=createLucideIcon("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Volume2=createLucideIcon("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wand2=createLucideIcon("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);function r(a){var e,s,o="";if(typeof a=="string"||typeof a=="number")o+=a;else if(typeof a=="object")if(Array.isArray(a)){var c=a.length;for(e=0;e<c;e++)a[e]&&(s=r(a[e]))&&(o&&(o+=" "),o+=s)}else for(s in a)a[s]&&(o&&(o+=" "),o+=s);return o}function clsx(){for(var a,e,s=0,o="",c=arguments.length;s<c;s++)(a=arguments[s])&&(e=r(a))&&(o&&(o+=" "),o+=e);return o}const createStoreImpl=a=>{let e;const s=new Set,o=(b,$)=>{const j=typeof b=="function"?b(e):b;if(!Object.is(j,e)){const _e=e;e=$??(typeof j!="object"||j===null)?j:Object.assign({},e,j),s.forEach(tt=>tt(e,_e))}},c=()=>e,g={setState:o,getState:c,getInitialState:()=>_,subscribe:b=>(s.add(b),()=>s.delete(b))},_=e=a(o,c,g);return g},createStore=a=>a?createStoreImpl(a):createStoreImpl,identity=a=>a;function useStore(a,e=identity){const s=React.useSyncExternalStore(a.subscribe,React.useCallback(()=>e(a.getState()),[a,e]),React.useCallback(()=>e(a.getInitialState()),[a,e]));return React.useDebugValue(s),s}const createImpl=a=>{const e=createStore(a),s=o=>useStore(e,o);return Object.assign(s,e),s},create=a=>a?createImpl(a):createImpl;var dexie_min={exports:{}};(function(a,e){(function(s,o){a.exports=o()})(commonjsGlobal,function(){var s=function(et,it){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(lt,ht){lt.__proto__=ht}||function(lt,ht){for(var pt in ht)Object.prototype.hasOwnProperty.call(ht,pt)&&(lt[pt]=ht[pt])})(et,it)},o=function(){return(o=Object.assign||function(et){for(var it,lt=1,ht=arguments.length;lt<ht;lt++)for(var pt in it=arguments[lt])Object.prototype.hasOwnProperty.call(it,pt)&&(et[pt]=it[pt]);return et}).apply(this,arguments)};function c(et,it,lt){for(var ht,pt=0,vt=it.length;pt<vt;pt++)!ht&&pt in it||((ht=ht||Array.prototype.slice.call(it,0,pt))[pt]=it[pt]);return et.concat(ht||Array.prototype.slice.call(it))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,h=Object.keys,g=Array.isArray;function _(et,it){return typeof it!="object"||h(it).forEach(function(lt){et[lt]=it[lt]}),et}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var b=Object.getPrototypeOf,$={}.hasOwnProperty;function j(et,it){return $.call(et,it)}function _e(et,it){typeof it=="function"&&(it=it(b(et))),(typeof Reflect>"u"?h:Reflect.ownKeys)(it).forEach(function(lt){rt(et,lt,it[lt])})}var tt=Object.defineProperty;function rt(et,it,lt,ht){tt(et,it,_(lt&&j(lt,"get")&&typeof lt.get=="function"?{get:lt.get,set:lt.set,configurable:!0}:{value:lt,configurable:!0,writable:!0},ht))}function nt(et){return{from:function(it){return et.prototype=Object.create(it.prototype),rt(et.prototype,"constructor",et),{extend:_e.bind(null,et.prototype)}}}}var st=Object.getOwnPropertyDescriptor,at=[].slice;function ot(et,it,lt){return at.call(et,it,lt)}function ut(et,it){return it(et)}function mt(et){if(!et)throw new Error("Assertion Failed")}function yt(et){d.setImmediate?setImmediate(et):setTimeout(et,0)}function Et(et,it){if(typeof it=="string"&&j(et,it))return et[it];if(!it)return et;if(typeof it!="string"){for(var lt=[],ht=0,pt=it.length;ht<pt;++ht){var vt=Et(et,it[ht]);lt.push(vt)}return lt}var bt=it.indexOf(".");if(bt!==-1){var It=et[it.substr(0,bt)];return It==null?void 0:Et(It,it.substr(bt+1))}}function dt(et,it,lt){if(et&&it!==void 0&&!("isFrozen"in Object&&Object.isFrozen(et)))if(typeof it!="string"&&"length"in it){mt(typeof lt!="string"&&"length"in lt);for(var ht=0,pt=it.length;ht<pt;++ht)dt(et,it[ht],lt[ht])}else{var vt,bt,It=it.indexOf(".");It!==-1?(vt=it.substr(0,It),(bt=it.substr(It+1))===""?lt===void 0?g(et)&&!isNaN(parseInt(vt))?et.splice(vt,1):delete et[vt]:et[vt]=lt:dt(It=!(It=et[vt])||!j(et,vt)?et[vt]={}:It,bt,lt)):lt===void 0?g(et)&&!isNaN(parseInt(it))?et.splice(it,1):delete et[it]:et[it]=lt}}function gt(et){var it,lt={};for(it in et)j(et,it)&&(lt[it]=et[it]);return lt}var St=[].concat;function xt(et){return St.apply([],et)}var Zr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(xt([8,16,32,64].map(function(et){return["Int","Uint","Float"].map(function(it){return it+et+"Array"})}))).filter(function(et){return d[et]}),Ct=new Set(Zr.map(function(et){return d[et]})),Ht=null;function Dt(et){return Ht=new WeakMap,et=function it(lt){if(!lt||typeof lt!="object")return lt;var ht=Ht.get(lt);if(ht)return ht;if(g(lt)){ht=[],Ht.set(lt,ht);for(var pt=0,vt=lt.length;pt<vt;++pt)ht.push(it(lt[pt]))}else if(Ct.has(lt.constructor))ht=lt;else{var bt,It=b(lt);for(bt in ht=It===Object.prototype?{}:Object.create(It),Ht.set(lt,ht),lt)j(lt,bt)&&(ht[bt]=it(lt[bt]))}return ht}(et),Ht=null,et}var rr={}.toString;function er(et){return rr.call(et).slice(8,-1)}var qt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",tr=typeof qt=="symbol"?function(et){var it;return et!=null&&(it=et[qt])&&it.apply(et)}:function(){return null};function Ft(et,it){return it=et.indexOf(it),0<=it&&et.splice(it,1),0<=it}var Yt={};function Qt(et){var it,lt,ht,pt;if(arguments.length===1){if(g(et))return et.slice();if(this===Yt&&typeof et=="string")return[et];if(pt=tr(et)){for(lt=[];!(ht=pt.next()).done;)lt.push(ht.value);return lt}if(et==null)return[et];if(typeof(it=et.length)!="number")return[et];for(lt=new Array(it);it--;)lt[it]=et[it];return lt}for(it=arguments.length,lt=new Array(it);it--;)lt[it]=arguments[it];return lt}var zt=typeof Symbol<"u"?function(et){return et[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Xr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],dn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xr),Xt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function sr(et,it){this.name=et,this.message=it}function Er(et,it){return et+". Errors: "+Object.keys(it).map(function(lt){return it[lt].toString()}).filter(function(lt,ht,pt){return pt.indexOf(lt)===ht}).join(`
`)}function Sr(et,it,lt,ht){this.failures=it,this.failedKeys=ht,this.successCount=lt,this.message=Er(et,it)}function _r(et,it){this.name="BulkError",this.failures=Object.keys(it).map(function(lt){return it[lt]}),this.failuresByPos=it,this.message=Er(et,this.failures)}nt(sr).from(Error).extend({toString:function(){return this.name+": "+this.message}}),nt(Sr).from(sr),nt(_r).from(sr);var Fr=dn.reduce(function(et,it){return et[it]=it+"Error",et},{}),$r=sr,yr=dn.reduce(function(et,it){var lt=it+"Error";function ht(pt,vt){this.name=lt,pt?typeof pt=="string"?(this.message="".concat(pt).concat(vt?`
 `+vt:""),this.inner=vt||null):typeof pt=="object"&&(this.message="".concat(pt.name," ").concat(pt.message),this.inner=pt):(this.message=Xt[it]||lt,this.inner=null)}return nt(ht).from($r),et[it]=ht,et},{});yr.Syntax=SyntaxError,yr.Type=TypeError,yr.Range=RangeError;var qr=Xr.reduce(function(et,it){return et[it+"Error"]=yr[it],et},{}),Yr=dn.reduce(function(et,it){return["Syntax","Type","Range"].indexOf(it)===-1&&(et[it+"Error"]=yr[it]),et},{});function Pr(){}function Bt(et){return et}function Vt(et,it){return et==null||et===Bt?it:function(lt){return it(et(lt))}}function ir(et,it){return function(){et.apply(this,arguments),it.apply(this,arguments)}}function ar(et,it){return et===Pr?it:function(){var lt=et.apply(this,arguments);lt!==void 0&&(arguments[0]=lt);var ht=this.onsuccess,pt=this.onerror;this.onsuccess=null,this.onerror=null;var vt=it.apply(this,arguments);return ht&&(this.onsuccess=this.onsuccess?ir(ht,this.onsuccess):ht),pt&&(this.onerror=this.onerror?ir(pt,this.onerror):pt),vt!==void 0?vt:lt}}function pr(et,it){return et===Pr?it:function(){et.apply(this,arguments);var lt=this.onsuccess,ht=this.onerror;this.onsuccess=this.onerror=null,it.apply(this,arguments),lt&&(this.onsuccess=this.onsuccess?ir(lt,this.onsuccess):lt),ht&&(this.onerror=this.onerror?ir(ht,this.onerror):ht)}}function kr(et,it){return et===Pr?it:function(lt){var ht=et.apply(this,arguments);_(lt,ht);var pt=this.onsuccess,vt=this.onerror;return this.onsuccess=null,this.onerror=null,lt=it.apply(this,arguments),pt&&(this.onsuccess=this.onsuccess?ir(pt,this.onsuccess):pt),vt&&(this.onerror=this.onerror?ir(vt,this.onerror):vt),ht===void 0?lt===void 0?void 0:lt:_(ht,lt)}}function Or(et,it){return et===Pr?it:function(){return it.apply(this,arguments)!==!1&&et.apply(this,arguments)}}function Ar(et,it){return et===Pr?it:function(){var lt=et.apply(this,arguments);if(lt&&typeof lt.then=="function"){for(var ht=this,pt=arguments.length,vt=new Array(pt);pt--;)vt[pt]=arguments[pt];return lt.then(function(){return it.apply(ht,vt)})}return it.apply(this,arguments)}}Yr.ModifyError=Sr,Yr.DexieError=sr,Yr.BulkError=_r;var Ur=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function xr(et){Ur=et}var Hr={},sn=100,Zr=typeof Promise>"u"?[]:function(){var et=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[et,b(et),et];var it=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[it,b(it),et]}(),Xr=Zr[0],dn=Zr[1],Zr=Zr[2],dn=dn&&dn.then,Tt=Xr&&Xr.constructor,ct=!!Zr,ft=function(et,it){Gr.push([et,it]),Pt&&(queueMicrotask(_t),Pt=!1)},At=!0,Pt=!0,Kt=[],Jt=[],wr=Bt,Br={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Pr,pgp:!1,env:{},finalize:Pr},dr=Br,Gr=[],Lr=0,Sn=[];function vr(et){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var it=this._PSD=dr;if(typeof et!="function"){if(et!==Hr)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Un(this,this._value))}this._state=null,this._value=null,++it.ref,function lt(ht,pt){try{pt(function(vt){if(ht._state===null){if(vt===ht)throw new TypeError("A promise cannot be resolved with itself.");var bt=ht._lib&&wt();vt&&typeof vt.then=="function"?lt(ht,function(It,Rt){vt instanceof vr?vt._then(It,Rt):vt.then(It,Rt)}):(ht._state=!0,ht._value=vt,Xn(ht)),bt&&lr()}},Un.bind(null,ht))}catch(vt){Un(ht,vt)}}(this,et)}var Dn={get:function(){var et=dr,it=Mn;function lt(ht,pt){var vt=this,bt=!et.global&&(et!==dr||it!==Mn),It=bt&&!un(),Rt=new vr(function(Lt,$t){bn(vt,new Ln(Hs(ht,et,bt,It),Hs(pt,et,bt,It),Lt,$t,et))});return this._consoleTask&&(Rt._consoleTask=this._consoleTask),Rt}return lt.prototype=Hr,lt},set:function(et){rt(this,"then",et&&et.prototype===Hr?Dn:{get:function(){return et},set:Dn.set})}};function Ln(et,it,lt,ht,pt){this.onFulfilled=typeof et=="function"?et:null,this.onRejected=typeof it=="function"?it:null,this.resolve=lt,this.reject=ht,this.psd=pt}function Un(et,it){var lt,ht;Jt.push(it),et._state===null&&(lt=et._lib&&wt(),it=wr(it),et._state=!1,et._value=it,ht=et,Kt.some(function(pt){return pt._value===ht._value})||Kt.push(ht),Xn(et),lt&&lr())}function Xn(et){var it=et._listeners;et._listeners=[];for(var lt=0,ht=it.length;lt<ht;++lt)bn(et,it[lt]);var pt=et._PSD;--pt.ref||pt.finalize(),Lr===0&&(++Lr,ft(function(){--Lr==0&&cr()},[]))}function bn(et,it){if(et._state!==null){var lt=et._state?it.onFulfilled:it.onRejected;if(lt===null)return(et._state?it.resolve:it.reject)(et._value);++it.psd.ref,++Lr,ft(Qn,[lt,et,it])}else et._listeners.push(it)}function Qn(et,it,lt){try{var ht,pt=it._value;!it._state&&Jt.length&&(Jt=[]),ht=Ur&&it._consoleTask?it._consoleTask.run(function(){return et(pt)}):et(pt),it._state||Jt.indexOf(pt)!==-1||function(vt){for(var bt=Kt.length;bt;)if(Kt[--bt]._value===vt._value)return Kt.splice(bt,1)}(it),lt.resolve(ht)}catch(vt){lt.reject(vt)}finally{--Lr==0&&cr(),--lt.psd.ref||lt.psd.finalize()}}function _t(){wn(Br,function(){wt()&&lr()})}function wt(){var et=At;return Pt=At=!1,et}function lr(){var et,it,lt;do for(;0<Gr.length;)for(et=Gr,Gr=[],lt=et.length,it=0;it<lt;++it){var ht=et[it];ht[0].apply(null,ht[1])}while(0<Gr.length);Pt=At=!0}function cr(){var et=Kt;Kt=[],et.forEach(function(ht){ht._PSD.onunhandled.call(null,ht._value,ht)});for(var it=Sn.slice(0),lt=it.length;lt;)it[--lt]()}function br(et){return new vr(Hr,!1,et)}function Cr(et,it){var lt=dr;return function(){var ht=wt(),pt=dr;try{return Jr(lt,!0),et.apply(this,arguments)}catch(vt){it&&it(vt)}finally{Jr(pt,!1),ht&&lr()}}}_e(vr.prototype,{then:Dn,_then:function(et,it){bn(this,new Ln(null,null,et,it,dr))},catch:function(et){if(arguments.length===1)return this.then(null,et);var it=et,lt=arguments[1];return typeof it=="function"?this.then(null,function(ht){return(ht instanceof it?lt:br)(ht)}):this.then(null,function(ht){return(ht&&ht.name===it?lt:br)(ht)})},finally:function(et){return this.then(function(it){return vr.resolve(et()).then(function(){return it})},function(it){return vr.resolve(et()).then(function(){return br(it)})})},timeout:function(et,it){var lt=this;return et<1/0?new vr(function(ht,pt){var vt=setTimeout(function(){return pt(new yr.Timeout(it))},et);lt.then(ht,pt).finally(clearTimeout.bind(null,vt))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&rt(vr.prototype,Symbol.toStringTag,"Dexie.Promise"),Br.env=cn(),_e(vr,{all:function(){var et=Qt.apply(null,arguments).map(vn);return new vr(function(it,lt){et.length===0&&it([]);var ht=et.length;et.forEach(function(pt,vt){return vr.resolve(pt).then(function(bt){et[vt]=bt,--ht||it(et)},lt)})})},resolve:function(et){return et instanceof vr?et:et&&typeof et.then=="function"?new vr(function(it,lt){et.then(it,lt)}):new vr(Hr,!0,et)},reject:br,race:function(){var et=Qt.apply(null,arguments).map(vn);return new vr(function(it,lt){et.map(function(ht){return vr.resolve(ht).then(it,lt)})})},PSD:{get:function(){return dr},set:function(et){return dr=et}},totalEchoes:{get:function(){return Mn}},newPSD:fn,usePSD:wn,scheduler:{get:function(){return ft},set:function(et){ft=et}},rejectionMapper:{get:function(){return wr},set:function(et){wr=et}},follow:function(et,it){return new vr(function(lt,ht){return fn(function(pt,vt){var bt=dr;bt.unhandleds=[],bt.onunhandled=vt,bt.finalize=ir(function(){var It,Rt=this;It=function(){Rt.unhandleds.length===0?pt():vt(Rt.unhandleds[0])},Sn.push(function Lt(){It(),Sn.splice(Sn.indexOf(Lt),1)}),++Lr,ft(function(){--Lr==0&&cr()},[])},bt.finalize),et()},it,lt,ht)})}}),Tt&&(Tt.allSettled&&rt(vr,"allSettled",function(){var et=Qt.apply(null,arguments).map(vn);return new vr(function(it){et.length===0&&it([]);var lt=et.length,ht=new Array(lt);et.forEach(function(pt,vt){return vr.resolve(pt).then(function(bt){return ht[vt]={status:"fulfilled",value:bt}},function(bt){return ht[vt]={status:"rejected",reason:bt}}).then(function(){return--lt||it(ht)})})})}),Tt.any&&typeof AggregateError<"u"&&rt(vr,"any",function(){var et=Qt.apply(null,arguments).map(vn);return new vr(function(it,lt){et.length===0&&lt(new AggregateError([]));var ht=et.length,pt=new Array(ht);et.forEach(function(vt,bt){return vr.resolve(vt).then(function(It){return it(It)},function(It){pt[bt]=It,--ht||lt(new AggregateError(pt))})})})}),Tt.withResolvers&&(vr.withResolvers=Tt.withResolvers));var Vr={awaits:0,echoes:0,id:0},Zn=0,ln=[],_n=0,Mn=0,Jn=0;function fn(et,it,lt,ht){var pt=dr,vt=Object.create(pt);return vt.parent=pt,vt.ref=0,vt.global=!1,vt.id=++Jn,Br.env,vt.env=ct?{Promise:vr,PromiseProp:{value:vr,configurable:!0,writable:!0},all:vr.all,race:vr.race,allSettled:vr.allSettled,any:vr.any,resolve:vr.resolve,reject:vr.reject}:{},it&&_(vt,it),++pt.ref,vt.finalize=function(){--this.parent.ref||this.parent.finalize()},ht=wn(vt,et,lt,ht),vt.ref===0&&vt.finalize(),ht}function hn(){return Vr.id||(Vr.id=++Zn),++Vr.awaits,Vr.echoes+=sn,Vr.id}function un(){return!!Vr.awaits&&(--Vr.awaits==0&&(Vr.id=0),Vr.echoes=Vr.awaits*sn,!0)}function vn(et){return Vr.echoes&&et&&et.constructor===Tt?(hn(),et.then(function(it){return un(),it},function(it){return un(),Kr(it)})):et}function An(){var et=ln[ln.length-1];ln.pop(),Jr(et,!1)}function Jr(et,it){var lt,ht=dr;(it?!Vr.echoes||_n++&&et===dr:!_n||--_n&&et===dr)||queueMicrotask(it?(function(pt){++Mn,Vr.echoes&&--Vr.echoes!=0||(Vr.echoes=Vr.awaits=Vr.id=0),ln.push(dr),Jr(pt,!0)}).bind(null,et):An),et!==dr&&(dr=et,ht===Br&&(Br.env=cn()),ct&&(lt=Br.env.Promise,it=et.env,(ht.global||et.global)&&(Object.defineProperty(d,"Promise",it.PromiseProp),lt.all=it.all,lt.race=it.race,lt.resolve=it.resolve,lt.reject=it.reject,it.allSettled&&(lt.allSettled=it.allSettled),it.any&&(lt.any=it.any))))}function cn(){var et=d.Promise;return ct?{Promise:et,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:et.all,race:et.race,allSettled:et.allSettled,any:et.any,resolve:et.resolve,reject:et.reject}:{}}function wn(et,it,lt,ht,pt){var vt=dr;try{return Jr(et,!0),it(lt,ht,pt)}finally{Jr(vt,!1)}}function Hs(et,it,lt,ht){return typeof et!="function"?et:function(){var pt=dr;lt&&hn(),Jr(it,!0);try{return et.apply(this,arguments)}finally{Jr(pt,!1),ht&&queueMicrotask(un)}}}function vs(et){Promise===Tt&&Vr.echoes===0?_n===0?et():enqueueNativeMicroTask(et):setTimeout(et,0)}(""+dn).indexOf("[native code]")===-1&&(hn=un=Pr);var Kr=vr.reject,In="",gn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ks="String expected.",Fn=[],_i="__dbnames",Es="readonly",Ts="readwrite";function kn(et,it){return et?it?function(){return et.apply(this,arguments)&&it.apply(this,arguments)}:et:it}var Ws={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function es(et){return typeof et!="string"||/\./.test(et)?function(it){return it}:function(it){return it[et]===void 0&&et in it&&delete(it=Dt(it))[et],it}}function qs(){throw yr.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Nr(et,it){try{var lt=Ys(et),ht=Ys(it);if(lt!==ht)return lt==="Array"?1:ht==="Array"?-1:lt==="binary"?1:ht==="binary"?-1:lt==="string"?1:ht==="string"?-1:lt==="Date"?1:ht!=="Date"?NaN:-1;switch(lt){case"number":case"Date":case"string":return it<et?1:et<it?-1:0;case"binary":return function(pt,vt){for(var bt=pt.length,It=vt.length,Rt=bt<It?bt:It,Lt=0;Lt<Rt;++Lt)if(pt[Lt]!==vt[Lt])return pt[Lt]<vt[Lt]?-1:1;return bt===It?0:bt<It?-1:1}(Xs(et),Xs(it));case"Array":return function(pt,vt){for(var bt=pt.length,It=vt.length,Rt=bt<It?bt:It,Lt=0;Lt<Rt;++Lt){var $t=Nr(pt[Lt],vt[Lt]);if($t!==0)return $t}return bt===It?0:bt<It?-1:1}(et,it)}}catch{}return NaN}function Ys(et){var it=typeof et;return it!="object"?it:ArrayBuffer.isView(et)?"binary":(et=er(et),et==="ArrayBuffer"?"binary":et)}function Xs(et){return et instanceof Uint8Array?et:ArrayBuffer.isView(et)?new Uint8Array(et.buffer,et.byteOffset,et.byteLength):new Uint8Array(et)}function ts(et,it,lt){var ht=et.schema.yProps;return ht?(it&&0<lt.numFailures&&(it=it.filter(function(pt,vt){return!lt.failures[vt]})),Promise.all(ht.map(function(pt){return pt=pt.updatesTable,it?et.db.table(pt).where("k").anyOf(it).delete():et.db.table(pt).clear()})).then(function(){return lt})):lt}var jn=(Qs.prototype.execute=function(et){var it=this["@@propmod"];if(it.add!==void 0){var lt=it.add;if(g(lt))return c(c([],g(et)?et:[],!0),lt).sort();if(typeof lt=="number")return(Number(et)||0)+lt;if(typeof lt=="bigint")try{return BigInt(et)+lt}catch{return BigInt(0)+lt}throw new TypeError("Invalid term ".concat(lt))}if(it.remove!==void 0){var ht=it.remove;if(g(ht))return g(et)?et.filter(function(pt){return!ht.includes(pt)}).sort():[];if(typeof ht=="number")return Number(et)-ht;if(typeof ht=="bigint")try{return BigInt(et)-ht}catch{return BigInt(0)-ht}throw new TypeError("Invalid subtrahend ".concat(ht))}return lt=(lt=it.replacePrefix)===null||lt===void 0?void 0:lt[0],lt&&typeof et=="string"&&et.startsWith(lt)?it.replacePrefix[1]+et.substring(lt.length):et},Qs);function Qs(et){this["@@propmod"]=et}function Zs(et,it){for(var lt=h(it),ht=lt.length,pt=!1,vt=0;vt<ht;++vt){var bt=lt[vt],It=it[bt],Rt=Et(et,bt);It instanceof jn?(dt(et,bt,It.execute(Rt)),pt=!0):Rt!==It&&(dt(et,bt,It),pt=!0)}return pt}var Js=(zr.prototype._trans=function(et,it,lt){var ht=this._tx||dr.trans,pt=this.name,vt=Ur&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(et==="readonly"?"read":"write"," ").concat(this.name));function bt(Lt,$t,kt){if(!kt.schema[pt])throw new yr.NotFound("Table "+pt+" not part of transaction");return it(kt.idbtrans,kt)}var It=wt();try{var Rt=ht&&ht.db._novip===this.db._novip?ht===dr.trans?ht._promise(et,bt,lt):fn(function(){return ht._promise(et,bt,lt)},{trans:ht,transless:dr.transless||dr}):function Lt($t,kt,jt,Mt){if($t.idbdb&&($t._state.openComplete||dr.letThrough||$t._vip)){var Ot=$t._createTransaction(kt,jt,$t._dbSchema);try{Ot.create(),$t._state.PR1398_maxLoop=3}catch(Nt){return Nt.name===Fr.InvalidState&&$t.isOpen()&&0<--$t._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),$t.close({disableAutoOpen:!1}),$t.open().then(function(){return Lt($t,kt,jt,Mt)})):Kr(Nt)}return Ot._promise(kt,function(Nt,Ut){return fn(function(){return dr.trans=Ot,Mt(Nt,Ut,Ot)})}).then(function(Nt){if(kt==="readwrite")try{Ot.idbtrans.commit()}catch{}return kt==="readonly"?Nt:Ot._completion.then(function(){return Nt})})}if($t._state.openComplete)return Kr(new yr.DatabaseClosed($t._state.dbOpenError));if(!$t._state.isBeingOpened){if(!$t._state.autoOpen)return Kr(new yr.DatabaseClosed);$t.open().catch(Pr)}return $t._state.dbReadyPromise.then(function(){return Lt($t,kt,jt,Mt)})}(this.db,et,[this.name],bt);return vt&&(Rt._consoleTask=vt,Rt=Rt.catch(function(Lt){return console.trace(Lt),Kr(Lt)})),Rt}finally{It&&lr()}},zr.prototype.get=function(et,it){var lt=this;return et&&et.constructor===Object?this.where(et).first(it):et==null?Kr(new yr.Type("Invalid argument to Table.get()")):this._trans("readonly",function(ht){return lt.core.get({trans:ht,key:et}).then(function(pt){return lt.hook.reading.fire(pt)})}).then(it)},zr.prototype.where=function(et){if(typeof et=="string")return new this.db.WhereClause(this,et);if(g(et))return new this.db.WhereClause(this,"[".concat(et.join("+"),"]"));var it=h(et);if(it.length===1)return this.where(it[0]).equals(et[it[0]]);var lt=this.schema.indexes.concat(this.schema.primKey).filter(function(It){if(It.compound&&it.every(function(Lt){return 0<=It.keyPath.indexOf(Lt)})){for(var Rt=0;Rt<it.length;++Rt)if(it.indexOf(It.keyPath[Rt])===-1)return!1;return!0}return!1}).sort(function(It,Rt){return It.keyPath.length-Rt.keyPath.length})[0];if(lt&&this.db._maxKey!==In){var vt=lt.keyPath.slice(0,it.length);return this.where(vt).equals(vt.map(function(Rt){return et[Rt]}))}!lt&&Ur&&console.warn("The query ".concat(JSON.stringify(et)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(it.join("+"),"]"));var ht=this.schema.idxByName;function pt(It,Rt){return Nr(It,Rt)===0}var bt=it.reduce(function(kt,Rt){var Lt=kt[0],$t=kt[1],kt=ht[Rt],jt=et[Rt];return[Lt||kt,Lt||!kt?kn($t,kt&&kt.multi?function(Mt){return Mt=Et(Mt,Rt),g(Mt)&&Mt.some(function(Ot){return pt(jt,Ot)})}:function(Mt){return pt(jt,Et(Mt,Rt))}):$t]},[null,null]),vt=bt[0],bt=bt[1];return vt?this.where(vt.name).equals(et[vt.keyPath]).filter(bt):lt?this.filter(bt):this.where(it).equals("")},zr.prototype.filter=function(et){return this.toCollection().and(et)},zr.prototype.count=function(et){return this.toCollection().count(et)},zr.prototype.offset=function(et){return this.toCollection().offset(et)},zr.prototype.limit=function(et){return this.toCollection().limit(et)},zr.prototype.each=function(et){return this.toCollection().each(et)},zr.prototype.toArray=function(et){return this.toCollection().toArray(et)},zr.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},zr.prototype.orderBy=function(et){return new this.db.Collection(new this.db.WhereClause(this,g(et)?"[".concat(et.join("+"),"]"):et))},zr.prototype.reverse=function(){return this.toCollection().reverse()},zr.prototype.mapToClass=function(et){var it,lt=this.db,ht=this.name;function pt(){return it!==null&&it.apply(this,arguments)||this}(this.schema.mappedClass=et).prototype instanceof qs&&(function(Rt,Lt){if(typeof Lt!="function"&&Lt!==null)throw new TypeError("Class extends value "+String(Lt)+" is not a constructor or null");function $t(){this.constructor=Rt}s(Rt,Lt),Rt.prototype=Lt===null?Object.create(Lt):($t.prototype=Lt.prototype,new $t)}(pt,it=et),Object.defineProperty(pt.prototype,"db",{get:function(){return lt},enumerable:!1,configurable:!0}),pt.prototype.table=function(){return ht},et=pt);for(var vt=new Set,bt=et.prototype;bt;bt=b(bt))Object.getOwnPropertyNames(bt).forEach(function(Rt){return vt.add(Rt)});function It(Rt){if(!Rt)return Rt;var Lt,$t=Object.create(et.prototype);for(Lt in Rt)if(!vt.has(Lt))try{$t[Lt]=Rt[Lt]}catch{}return $t}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=It,this.hook("reading",It),et},zr.prototype.defineClass=function(){return this.mapToClass(function(et){_(this,et)})},zr.prototype.add=function(et,it){var lt=this,ht=this.schema.primKey,pt=ht.auto,vt=ht.keyPath,bt=et;return vt&&pt&&(bt=es(vt)(et)),this._trans("readwrite",function(It){return lt.core.mutate({trans:It,type:"add",keys:it!=null?[it]:null,values:[bt]})}).then(function(It){return It.numFailures?vr.reject(It.failures[0]):It.lastResult}).then(function(It){if(vt)try{dt(et,vt,It)}catch{}return It})},zr.prototype.upsert=function(et,it){var lt=this,ht=this.schema.primKey.keyPath;return this._trans("readwrite",function(pt){return lt.core.get({trans:pt,key:et}).then(function(vt){var bt=vt??{};return Zs(bt,it),ht&&dt(bt,ht,et),lt.core.mutate({trans:pt,type:"put",values:[bt],keys:[et],upsert:!0,updates:{keys:[et],changeSpecs:[it]}}).then(function(It){return It.numFailures?vr.reject(It.failures[0]):!!vt})})})},zr.prototype.update=function(et,it){return typeof et!="object"||g(et)?this.where(":id").equals(et).modify(it):(et=Et(et,this.schema.primKey.keyPath),et===void 0?Kr(new yr.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(et).modify(it))},zr.prototype.put=function(et,it){var lt=this,ht=this.schema.primKey,pt=ht.auto,vt=ht.keyPath,bt=et;return vt&&pt&&(bt=es(vt)(et)),this._trans("readwrite",function(It){return lt.core.mutate({trans:It,type:"put",values:[bt],keys:it!=null?[it]:null})}).then(function(It){return It.numFailures?vr.reject(It.failures[0]):It.lastResult}).then(function(It){if(vt)try{dt(et,vt,It)}catch{}return It})},zr.prototype.delete=function(et){var it=this;return this._trans("readwrite",function(lt){return it.core.mutate({trans:lt,type:"delete",keys:[et]}).then(function(ht){return ts(it,[et],ht)}).then(function(ht){return ht.numFailures?vr.reject(ht.failures[0]):void 0})})},zr.prototype.clear=function(){var et=this;return this._trans("readwrite",function(it){return et.core.mutate({trans:it,type:"deleteRange",range:Ws}).then(function(lt){return ts(et,null,lt)})}).then(function(it){return it.numFailures?vr.reject(it.failures[0]):void 0})},zr.prototype.bulkGet=function(et){var it=this;return this._trans("readonly",function(lt){return it.core.getMany({keys:et,trans:lt}).then(function(ht){return ht.map(function(pt){return it.hook.reading.fire(pt)})})})},zr.prototype.bulkAdd=function(et,it,lt){var ht=this,pt=Array.isArray(it)?it:void 0,vt=(lt=lt||(pt?void 0:it))?lt.allKeys:void 0;return this._trans("readwrite",function(bt){var Lt=ht.schema.primKey,It=Lt.auto,Lt=Lt.keyPath;if(Lt&&pt)throw new yr.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(pt&&pt.length!==et.length)throw new yr.InvalidArgument("Arguments objects and keys must have the same length");var Rt=et.length,Lt=Lt&&It?et.map(es(Lt)):et;return ht.core.mutate({trans:bt,type:"add",keys:pt,values:Lt,wantResults:vt}).then(function(Ot){var kt=Ot.numFailures,jt=Ot.results,Mt=Ot.lastResult,Ot=Ot.failures;if(kt===0)return vt?jt:Mt;throw new _r("".concat(ht.name,".bulkAdd(): ").concat(kt," of ").concat(Rt," operations failed"),Ot)})})},zr.prototype.bulkPut=function(et,it,lt){var ht=this,pt=Array.isArray(it)?it:void 0,vt=(lt=lt||(pt?void 0:it))?lt.allKeys:void 0;return this._trans("readwrite",function(bt){var Lt=ht.schema.primKey,It=Lt.auto,Lt=Lt.keyPath;if(Lt&&pt)throw new yr.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(pt&&pt.length!==et.length)throw new yr.InvalidArgument("Arguments objects and keys must have the same length");var Rt=et.length,Lt=Lt&&It?et.map(es(Lt)):et;return ht.core.mutate({trans:bt,type:"put",keys:pt,values:Lt,wantResults:vt}).then(function(Ot){var kt=Ot.numFailures,jt=Ot.results,Mt=Ot.lastResult,Ot=Ot.failures;if(kt===0)return vt?jt:Mt;throw new _r("".concat(ht.name,".bulkPut(): ").concat(kt," of ").concat(Rt," operations failed"),Ot)})})},zr.prototype.bulkUpdate=function(et){var it=this,lt=this.core,ht=et.map(function(bt){return bt.key}),pt=et.map(function(bt){return bt.changes}),vt=[];return this._trans("readwrite",function(bt){return lt.getMany({trans:bt,keys:ht,cache:"clone"}).then(function(It){var Rt=[],Lt=[];et.forEach(function(kt,jt){var Mt=kt.key,Ot=kt.changes,Nt=It[jt];if(Nt){for(var Ut=0,Gt=Object.keys(Ot);Ut<Gt.length;Ut++){var Wt=Gt[Ut],Zt=Ot[Wt];if(Wt===it.schema.primKey.keyPath){if(Nr(Zt,Mt)!==0)throw new yr.Constraint("Cannot update primary key in bulkUpdate()")}else dt(Nt,Wt,Zt)}vt.push(jt),Rt.push(Mt),Lt.push(Nt)}});var $t=Rt.length;return lt.mutate({trans:bt,type:"put",keys:Rt,values:Lt,updates:{keys:ht,changeSpecs:pt}}).then(function(kt){var jt=kt.numFailures,Mt=kt.failures;if(jt===0)return $t;for(var Ot=0,Nt=Object.keys(Mt);Ot<Nt.length;Ot++){var Ut,Gt=Nt[Ot],Wt=vt[Number(Gt)];Wt!=null&&(Ut=Mt[Gt],delete Mt[Gt],Mt[Wt]=Ut)}throw new _r("".concat(it.name,".bulkUpdate(): ").concat(jt," of ").concat($t," operations failed"),Mt)})})})},zr.prototype.bulkDelete=function(et){var it=this,lt=et.length;return this._trans("readwrite",function(ht){return it.core.mutate({trans:ht,type:"delete",keys:et}).then(function(pt){return ts(it,et,pt)})}).then(function(bt){var pt=bt.numFailures,vt=bt.lastResult,bt=bt.failures;if(pt===0)return vt;throw new _r("".concat(it.name,".bulkDelete(): ").concat(pt," of ").concat(lt," operations failed"),bt)})},zr);function zr(){}function Vn(et){function it(bt,It){if(It){for(var Rt=arguments.length,Lt=new Array(Rt-1);--Rt;)Lt[Rt-1]=arguments[Rt];return lt[bt].subscribe.apply(null,Lt),et}if(typeof bt=="string")return lt[bt]}var lt={};it.addEventType=vt;for(var ht=1,pt=arguments.length;ht<pt;++ht)vt(arguments[ht]);return it;function vt(bt,It,Rt){if(typeof bt!="object"){var Lt;It=It||Or;var $t={subscribers:[],fire:Rt=Rt||Pr,subscribe:function(kt){$t.subscribers.indexOf(kt)===-1&&($t.subscribers.push(kt),$t.fire=It($t.fire,kt))},unsubscribe:function(kt){$t.subscribers=$t.subscribers.filter(function(jt){return jt!==kt}),$t.fire=$t.subscribers.reduce(It,Rt)}};return lt[bt]=it[bt]=$t}h(Lt=bt).forEach(function(kt){var jt=Lt[kt];if(g(jt))vt(kt,Lt[kt][0],Lt[kt][1]);else{if(jt!=="asap")throw new yr.InvalidArgument("Invalid event config");var Mt=vt(kt,Bt,function(){for(var Ot=arguments.length,Nt=new Array(Ot);Ot--;)Nt[Ot]=arguments[Ot];Mt.subscribers.forEach(function(Ut){yt(function(){Ut.apply(null,Nt)})})})}})}}function Gn(et,it){return nt(it).from({prototype:et}),it}function On(et,it){return!(et.filter||et.algorithm||et.or)&&(it?et.justLimit:!et.replayFilter)}function xs(et,it){et.filter=kn(et.filter,it)}function Ss(et,it,lt){var ht=et.replayFilter;et.replayFilter=ht?function(){return kn(ht(),it())}:it,et.justLimit=lt&&!ht}function rs(et,it){if(et.isPrimKey)return it.primaryKey;var lt=it.getIndexByKeyPath(et.index);if(!lt)throw new yr.Schema("KeyPath "+et.index+" on object store "+it.name+" is not indexed");return lt}function na(et,it,lt){var ht=rs(et,it.schema);return it.openCursor({trans:lt,values:!et.keysOnly,reverse:et.dir==="prev",unique:!!et.unique,query:{index:ht,range:et.range}})}function ns(et,it,lt,ht){var pt=et.replayFilter?kn(et.filter,et.replayFilter()):et.filter;if(et.or){var vt={},bt=function(It,Rt,Lt){var $t,kt;pt&&!pt(Rt,Lt,function(jt){return Rt.stop(jt)},function(jt){return Rt.fail(jt)})||((kt=""+($t=Rt.primaryKey))=="[object ArrayBuffer]"&&(kt=""+new Uint8Array($t)),j(vt,kt)||(vt[kt]=!0,it(It,Rt,Lt)))};return Promise.all([et.or._iterate(bt,lt),ga(na(et,ht,lt),et.algorithm,bt,!et.keysOnly&&et.valueMapper)])}return ga(na(et,ht,lt),kn(et.algorithm,pt),it,!et.keysOnly&&et.valueMapper)}function ga(et,it,lt,ht){var pt=Cr(ht?function(vt,bt,It){return lt(ht(vt),bt,It)}:lt);return et.then(function(vt){if(vt)return vt.start(function(){var bt=function(){return vt.continue()};it&&!it(vt,function(It){return bt=It},function(It){vt.stop(It),bt=Pr},function(It){vt.fail(It),bt=Pr})||pt(vt.value,vt,function(It){return bt=It}),bt()})})}var yo=(jr.prototype._read=function(et,it){var lt=this._ctx;return lt.error?lt.table._trans(null,Kr.bind(null,lt.error)):lt.table._trans("readonly",et).then(it)},jr.prototype._write=function(et){var it=this._ctx;return it.error?it.table._trans(null,Kr.bind(null,it.error)):it.table._trans("readwrite",et,"locked")},jr.prototype._addAlgorithm=function(et){var it=this._ctx;it.algorithm=kn(it.algorithm,et)},jr.prototype._iterate=function(et,it){return ns(this._ctx,et,it,this._ctx.table.core)},jr.prototype.clone=function(et){var it=Object.create(this.constructor.prototype),lt=Object.create(this._ctx);return et&&_(lt,et),it._ctx=lt,it},jr.prototype.raw=function(){return this._ctx.valueMapper=null,this},jr.prototype.each=function(et){var it=this._ctx;return this._read(function(lt){return ns(it,et,lt,it.table.core)})},jr.prototype.count=function(et){var it=this;return this._read(function(lt){var ht=it._ctx,pt=ht.table.core;if(On(ht,!0))return pt.count({trans:lt,query:{index:rs(ht,pt.schema),range:ht.range}}).then(function(bt){return Math.min(bt,ht.limit)});var vt=0;return ns(ht,function(){return++vt,!1},lt,pt).then(function(){return vt})}).then(et)},jr.prototype.sortBy=function(et,it){var lt=et.split(".").reverse(),ht=lt[0],pt=lt.length-1;function vt(Rt,Lt){return Lt?vt(Rt[lt[Lt]],Lt-1):Rt[ht]}var bt=this._ctx.dir==="next"?1:-1;function It(Rt,Lt){return Nr(vt(Rt,pt),vt(Lt,pt))*bt}return this.toArray(function(Rt){return Rt.sort(It)}).then(it)},jr.prototype.toArray=function(et){var it=this;return this._read(function(lt){var ht=it._ctx;if(ht.dir==="next"&&On(ht,!0)&&0<ht.limit){var pt=ht.valueMapper,vt=rs(ht,ht.table.core.schema);return ht.table.core.query({trans:lt,limit:ht.limit,values:!0,query:{index:vt,range:ht.range}}).then(function(It){return It=It.result,pt?It.map(pt):It})}var bt=[];return ns(ht,function(It){return bt.push(It)},lt,ht.table.core).then(function(){return bt})},et)},jr.prototype.offset=function(et){var it=this._ctx;return et<=0||(it.offset+=et,On(it)?Ss(it,function(){var lt=et;return function(ht,pt){return lt===0||(lt===1?--lt:pt(function(){ht.advance(lt),lt=0}),!1)}}):Ss(it,function(){var lt=et;return function(){return--lt<0}})),this},jr.prototype.limit=function(et){return this._ctx.limit=Math.min(this._ctx.limit,et),Ss(this._ctx,function(){var it=et;return function(lt,ht,pt){return--it<=0&&ht(pt),0<=it}},!0),this},jr.prototype.until=function(et,it){return xs(this._ctx,function(lt,ht,pt){return!et(lt.value)||(ht(pt),it)}),this},jr.prototype.first=function(et){return this.limit(1).toArray(function(it){return it[0]}).then(et)},jr.prototype.last=function(et){return this.reverse().first(et)},jr.prototype.filter=function(et){var it;return xs(this._ctx,function(lt){return et(lt.value)}),(it=this._ctx).isMatch=kn(it.isMatch,et),this},jr.prototype.and=function(et){return this.filter(et)},jr.prototype.or=function(et){return new this.db.WhereClause(this._ctx.table,et,this)},jr.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},jr.prototype.desc=function(){return this.reverse()},jr.prototype.eachKey=function(et){var it=this._ctx;return it.keysOnly=!it.isMatch,this.each(function(lt,ht){et(ht.key,ht)})},jr.prototype.eachUniqueKey=function(et){return this._ctx.unique="unique",this.eachKey(et)},jr.prototype.eachPrimaryKey=function(et){var it=this._ctx;return it.keysOnly=!it.isMatch,this.each(function(lt,ht){et(ht.primaryKey,ht)})},jr.prototype.keys=function(et){var it=this._ctx;it.keysOnly=!it.isMatch;var lt=[];return this.each(function(ht,pt){lt.push(pt.key)}).then(function(){return lt}).then(et)},jr.prototype.primaryKeys=function(et){var it=this._ctx;if(it.dir==="next"&&On(it,!0)&&0<it.limit)return this._read(function(ht){var pt=rs(it,it.table.core.schema);return it.table.core.query({trans:ht,values:!1,limit:it.limit,query:{index:pt,range:it.range}})}).then(function(ht){return ht.result}).then(et);it.keysOnly=!it.isMatch;var lt=[];return this.each(function(ht,pt){lt.push(pt.primaryKey)}).then(function(){return lt}).then(et)},jr.prototype.uniqueKeys=function(et){return this._ctx.unique="unique",this.keys(et)},jr.prototype.firstKey=function(et){return this.limit(1).keys(function(it){return it[0]}).then(et)},jr.prototype.lastKey=function(et){return this.reverse().firstKey(et)},jr.prototype.distinct=function(){var et=this._ctx,et=et.index&&et.table.schema.idxByName[et.index];if(!et||!et.multi)return this;var it={};return xs(this._ctx,function(pt){var ht=pt.primaryKey.toString(),pt=j(it,ht);return it[ht]=!0,!pt}),this},jr.prototype.modify=function(et){var it=this,lt=this._ctx;return this._write(function(ht){var pt=typeof et=="function"?et:function(Nt){return Zs(Nt,et)},vt=lt.table.core,Lt=vt.schema.primaryKey,bt=Lt.outbound,It=Lt.extractKey,Rt=200,Lt=it.db._options.modifyChunkSize;Lt&&(Rt=typeof Lt=="object"?Lt[vt.name]||Lt["*"]||200:Lt);function $t(Nt,Wt){var Gt=Wt.failures,Wt=Wt.numFailures;jt+=Nt-Wt;for(var Zt=0,nr=h(Gt);Zt<nr.length;Zt++){var ur=nr[Zt];kt.push(Gt[ur])}}var kt=[],jt=0,Mt=[],Ot=et===xa;return it.clone().primaryKeys().then(function(Nt){function Ut(Wt){var Zt=Math.min(Rt,Nt.length-Wt),nr=Nt.slice(Wt,Wt+Zt);return(Ot?Promise.resolve([]):vt.getMany({trans:ht,keys:nr,cache:"immutable"})).then(function(ur){var mr=[],or=[],fr=bt?[]:null,gr=Ot?nr:[];if(!Ot)for(var hr=0;hr<Zt;++hr){var Tr=ur[hr],Rr={value:Dt(Tr),primKey:Nt[Wt+hr]};pt.call(Rr,Rr.value,Rr)!==!1&&(Rr.value==null?gr.push(Nt[Wt+hr]):bt||Nr(It(Tr),It(Rr.value))===0?(or.push(Rr.value),bt&&fr.push(Nt[Wt+hr])):(gr.push(Nt[Wt+hr]),mr.push(Rr.value)))}return Promise.resolve(0<mr.length&&vt.mutate({trans:ht,type:"add",values:mr}).then(function(Dr){for(var Mr in Dr.failures)gr.splice(parseInt(Mr),1);$t(mr.length,Dr)})).then(function(){return(0<or.length||Gt&&typeof et=="object")&&vt.mutate({trans:ht,type:"put",keys:fr,values:or,criteria:Gt,changeSpec:typeof et!="function"&&et,isAdditionalChunk:0<Wt}).then(function(Dr){return $t(or.length,Dr)})}).then(function(){return(0<gr.length||Gt&&Ot)&&vt.mutate({trans:ht,type:"delete",keys:gr,criteria:Gt,isAdditionalChunk:0<Wt}).then(function(Dr){return ts(lt.table,gr,Dr)}).then(function(Dr){return $t(gr.length,Dr)})}).then(function(){return Nt.length>Wt+Zt&&Ut(Wt+Rt)})})}var Gt=On(lt)&&lt.limit===1/0&&(typeof et!="function"||Ot)&&{index:lt.index,range:lt.range};return Ut(0).then(function(){if(0<kt.length)throw new Sr("Error modifying one or more objects",kt,jt,Mt);return Nt.length})})})},jr.prototype.delete=function(){var et=this._ctx,it=et.range;return!On(et)||et.table.schema.yProps||!et.isPrimKey&&it.type!==3?this.modify(xa):this._write(function(lt){var ht=et.table.core.schema.primaryKey,pt=it;return et.table.core.count({trans:lt,query:{index:ht,range:pt}}).then(function(vt){return et.table.core.mutate({trans:lt,type:"deleteRange",range:pt}).then(function(Rt){var It=Rt.failures,Rt=Rt.numFailures;if(Rt)throw new Sr("Could not delete some values",Object.keys(It).map(function(Lt){return It[Lt]}),vt-Rt);return vt-Rt})})})},jr);function jr(){}var xa=function(et,it){return it.value=null};function vo(et,it){return et<it?-1:et===it?0:1}function Eo(et,it){return it<et?-1:et===it?0:1}function an(et,it,lt){return et=et instanceof _a?new et.Collection(et):et,et._ctx.error=new(lt||TypeError)(it),et}function Nn(et){return new et.Collection(et,function(){return ba("")}).limit(0)}function is(et,it,lt,ht){var pt,vt,bt,It,Rt,Lt,$t,kt=lt.length;if(!lt.every(function(Ot){return typeof Ot=="string"}))return an(et,Ks);function jt(Ot){pt=Ot==="next"?function(Ut){return Ut.toUpperCase()}:function(Ut){return Ut.toLowerCase()},vt=Ot==="next"?function(Ut){return Ut.toLowerCase()}:function(Ut){return Ut.toUpperCase()},bt=Ot==="next"?vo:Eo;var Nt=lt.map(function(Ut){return{lower:vt(Ut),upper:pt(Ut)}}).sort(function(Ut,Gt){return bt(Ut.lower,Gt.lower)});It=Nt.map(function(Ut){return Ut.upper}),Rt=Nt.map(function(Ut){return Ut.lower}),$t=(Lt=Ot)==="next"?"":ht}jt("next"),et=new et.Collection(et,function(){return En(It[0],Rt[kt-1]+ht)}),et._ondirectionchange=function(Ot){jt(Ot)};var Mt=0;return et._addAlgorithm(function(Ot,Nt,Ut){var Gt=Ot.key;if(typeof Gt!="string")return!1;var Wt=vt(Gt);if(it(Wt,Rt,Mt))return!0;for(var Zt=null,nr=Mt;nr<kt;++nr){var ur=function(mr,or,fr,gr,hr,Tr){for(var Rr=Math.min(mr.length,gr.length),Dr=-1,Mr=0;Mr<Rr;++Mr){var on=or[Mr];if(on!==gr[Mr])return hr(mr[Mr],fr[Mr])<0?mr.substr(0,Mr)+fr[Mr]+fr.substr(Mr+1):hr(mr[Mr],gr[Mr])<0?mr.substr(0,Mr)+gr[Mr]+fr.substr(Mr+1):0<=Dr?mr.substr(0,Dr)+or[Dr]+fr.substr(Dr+1):null;hr(mr[Mr],on)<0&&(Dr=Mr)}return Rr<gr.length&&Tr==="next"?mr+fr.substr(mr.length):Rr<mr.length&&Tr==="prev"?mr.substr(0,fr.length):Dr<0?null:mr.substr(0,Dr)+gr[Dr]+fr.substr(Dr+1)}(Gt,Wt,It[nr],Rt[nr],bt,Lt);ur===null&&Zt===null?Mt=nr+1:(Zt===null||0<bt(Zt,ur))&&(Zt=ur)}return Nt(Zt!==null?function(){Ot.continue(Zt+$t)}:Ut),!1}),et}function En(et,it,lt,ht){return{type:2,lower:et,upper:it,lowerOpen:lt,upperOpen:ht}}function ba(et){return{type:1,lower:et,upper:et}}var _a=(Object.defineProperty(Qr.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Qr.prototype.between=function(et,it,lt,ht){lt=lt!==!1,ht=ht===!0;try{return 0<this._cmp(et,it)||this._cmp(et,it)===0&&(lt||ht)&&(!lt||!ht)?Nn(this):new this.Collection(this,function(){return En(et,it,!lt,!ht)})}catch{return an(this,gn)}},Qr.prototype.equals=function(et){return et==null?an(this,gn):new this.Collection(this,function(){return ba(et)})},Qr.prototype.above=function(et){return et==null?an(this,gn):new this.Collection(this,function(){return En(et,void 0,!0)})},Qr.prototype.aboveOrEqual=function(et){return et==null?an(this,gn):new this.Collection(this,function(){return En(et,void 0,!1)})},Qr.prototype.below=function(et){return et==null?an(this,gn):new this.Collection(this,function(){return En(void 0,et,!1,!0)})},Qr.prototype.belowOrEqual=function(et){return et==null?an(this,gn):new this.Collection(this,function(){return En(void 0,et)})},Qr.prototype.startsWith=function(et){return typeof et!="string"?an(this,Ks):this.between(et,et+In,!0,!0)},Qr.prototype.startsWithIgnoreCase=function(et){return et===""?this.startsWith(et):is(this,function(it,lt){return it.indexOf(lt[0])===0},[et],In)},Qr.prototype.equalsIgnoreCase=function(et){return is(this,function(it,lt){return it===lt[0]},[et],"")},Qr.prototype.anyOfIgnoreCase=function(){var et=Qt.apply(Yt,arguments);return et.length===0?Nn(this):is(this,function(it,lt){return lt.indexOf(it)!==-1},et,"")},Qr.prototype.startsWithAnyOfIgnoreCase=function(){var et=Qt.apply(Yt,arguments);return et.length===0?Nn(this):is(this,function(it,lt){return lt.some(function(ht){return it.indexOf(ht)===0})},et,In)},Qr.prototype.anyOf=function(){var et=this,it=Qt.apply(Yt,arguments),lt=this._cmp;try{it.sort(lt)}catch{return an(this,gn)}if(it.length===0)return Nn(this);var ht=new this.Collection(this,function(){return En(it[0],it[it.length-1])});ht._ondirectionchange=function(vt){lt=vt==="next"?et._ascending:et._descending,it.sort(lt)};var pt=0;return ht._addAlgorithm(function(vt,bt,It){for(var Rt=vt.key;0<lt(Rt,it[pt]);)if(++pt===it.length)return bt(It),!1;return lt(Rt,it[pt])===0||(bt(function(){vt.continue(it[pt])}),!1)}),ht},Qr.prototype.notEqual=function(et){return this.inAnyRange([[-1/0,et],[et,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Qr.prototype.noneOf=function(){var et=Qt.apply(Yt,arguments);if(et.length===0)return new this.Collection(this);try{et.sort(this._ascending)}catch{return an(this,gn)}var it=et.reduce(function(lt,ht){return lt?lt.concat([[lt[lt.length-1][1],ht]]):[[-1/0,ht]]},null);return it.push([et[et.length-1],this.db._maxKey]),this.inAnyRange(it,{includeLowers:!1,includeUppers:!1})},Qr.prototype.inAnyRange=function(Gt,it){var lt=this,ht=this._cmp,pt=this._ascending,vt=this._descending,bt=this._min,It=this._max;if(Gt.length===0)return Nn(this);if(!Gt.every(function(Wt){return Wt[0]!==void 0&&Wt[1]!==void 0&&pt(Wt[0],Wt[1])<=0}))return an(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",yr.InvalidArgument);var Rt=!it||it.includeLowers!==!1,Lt=it&&it.includeUppers===!0,$t,kt=pt;function jt(Wt,Zt){return kt(Wt[0],Zt[0])}try{($t=Gt.reduce(function(Wt,Zt){for(var nr=0,ur=Wt.length;nr<ur;++nr){var mr=Wt[nr];if(ht(Zt[0],mr[1])<0&&0<ht(Zt[1],mr[0])){mr[0]=bt(mr[0],Zt[0]),mr[1]=It(mr[1],Zt[1]);break}}return nr===ur&&Wt.push(Zt),Wt},[])).sort(jt)}catch{return an(this,gn)}var Mt=0,Ot=Lt?function(Wt){return 0<pt(Wt,$t[Mt][1])}:function(Wt){return 0<=pt(Wt,$t[Mt][1])},Nt=Rt?function(Wt){return 0<vt(Wt,$t[Mt][0])}:function(Wt){return 0<=vt(Wt,$t[Mt][0])},Ut=Ot,Gt=new this.Collection(this,function(){return En($t[0][0],$t[$t.length-1][1],!Rt,!Lt)});return Gt._ondirectionchange=function(Wt){kt=Wt==="next"?(Ut=Ot,pt):(Ut=Nt,vt),$t.sort(jt)},Gt._addAlgorithm(function(Wt,Zt,nr){for(var ur,mr=Wt.key;Ut(mr);)if(++Mt===$t.length)return Zt(nr),!1;return!Ot(ur=mr)&&!Nt(ur)||(lt._cmp(mr,$t[Mt][1])===0||lt._cmp(mr,$t[Mt][0])===0||Zt(function(){kt===pt?Wt.continue($t[Mt][0]):Wt.continue($t[Mt][1])}),!1)}),Gt},Qr.prototype.startsWithAnyOf=function(){var et=Qt.apply(Yt,arguments);return et.every(function(it){return typeof it=="string"})?et.length===0?Nn(this):this.inAnyRange(et.map(function(it){return[it,it+In]})):an(this,"startsWithAnyOf() only works with strings")},Qr);function Qr(){}function pn(et){return Cr(function(it){return zn(it),et(it.target.error),!1})}function zn(et){et.stopPropagation&&et.stopPropagation(),et.preventDefault&&et.preventDefault()}var Hn="storagemutated",bs="x-storagemutated-1",Tn=Vn(null,Hn),To=(mn.prototype._lock=function(){return mt(!dr.global),++this._reculock,this._reculock!==1||dr.global||(dr.lockOwnerFor=this),this},mn.prototype._unlock=function(){if(mt(!dr.global),--this._reculock==0)for(dr.global||(dr.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var et=this._blockedFuncs.shift();try{wn(et[1],et[0])}catch{}}return this},mn.prototype._locked=function(){return this._reculock&&dr.lockOwnerFor!==this},mn.prototype.create=function(et){var it=this;if(!this.mode)return this;var lt=this.db.idbdb,ht=this.db._state.dbOpenError;if(mt(!this.idbtrans),!et&&!lt)switch(ht&&ht.name){case"DatabaseClosedError":throw new yr.DatabaseClosed(ht);case"MissingAPIError":throw new yr.MissingAPI(ht.message,ht);default:throw new yr.OpenFailed(ht)}if(!this.active)throw new yr.TransactionInactive;return mt(this._completion._state===null),(et=this.idbtrans=et||(this.db.core||lt).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Cr(function(pt){zn(pt),it._reject(et.error)}),et.onabort=Cr(function(pt){zn(pt),it.active&&it._reject(new yr.Abort(et.error)),it.active=!1,it.on("abort").fire(pt)}),et.oncomplete=Cr(function(){it.active=!1,it._resolve(),"mutatedParts"in et&&Tn.storagemutated.fire(et.mutatedParts)}),this},mn.prototype._promise=function(et,it,lt){var ht=this;if(et==="readwrite"&&this.mode!=="readwrite")return Kr(new yr.ReadOnly("Transaction is readonly"));if(!this.active)return Kr(new yr.TransactionInactive);if(this._locked())return new vr(function(vt,bt){ht._blockedFuncs.push([function(){ht._promise(et,it,lt).then(vt,bt)},dr])});if(lt)return fn(function(){var vt=new vr(function(bt,It){ht._lock();var Rt=it(bt,It,ht);Rt&&Rt.then&&Rt.then(bt,It)});return vt.finally(function(){return ht._unlock()}),vt._lib=!0,vt});var pt=new vr(function(vt,bt){var It=it(vt,bt,ht);It&&It.then&&It.then(vt,bt)});return pt._lib=!0,pt},mn.prototype._root=function(){return this.parent?this.parent._root():this},mn.prototype.waitFor=function(et){var it,lt=this._root(),ht=vr.resolve(et);lt._waitingFor?lt._waitingFor=lt._waitingFor.then(function(){return ht}):(lt._waitingFor=ht,lt._waitingQueue=[],it=lt.idbtrans.objectStore(lt.storeNames[0]),function vt(){for(++lt._spinCount;lt._waitingQueue.length;)lt._waitingQueue.shift()();lt._waitingFor&&(it.get(-1/0).onsuccess=vt)}());var pt=lt._waitingFor;return new vr(function(vt,bt){ht.then(function(It){return lt._waitingQueue.push(Cr(vt.bind(null,It)))},function(It){return lt._waitingQueue.push(Cr(bt.bind(null,It)))}).finally(function(){lt._waitingFor===pt&&(lt._waitingFor=null)})})},mn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new yr.Abort))},mn.prototype.table=function(et){var it=this._memoizedTables||(this._memoizedTables={});if(j(it,et))return it[et];var lt=this.schema[et];if(!lt)throw new yr.NotFound("Table "+et+" not part of transaction");return lt=new this.db.Table(et,lt,this),lt.core=this.db.core.table(et),it[et]=lt},mn);function mn(){}function _s(et,it,lt,ht,pt,vt,bt,It){return{name:et,keyPath:it,unique:lt,multi:ht,auto:pt,compound:vt,src:(lt&&!bt?"&":"")+(ht?"*":"")+(pt?"++":"")+$a(it),type:It}}function $a(et){return typeof et=="string"?et:et?"["+[].join.call(et,"+")+"]":""}function As(et,it,lt){return{name:et,primKey:it,indexes:lt,mappedClass:null,idxByName:(ht=function(pt){return[pt.name,pt]},lt.reduce(function(pt,vt,bt){return bt=ht(vt,bt),bt&&(pt[bt[0]]=bt[1]),pt},{}))};var ht}var Kn=function(et){try{return et.only([[]]),Kn=function(){return[[]]},[[]]}catch{return Kn=function(){return In},In}};function ws(et){return et==null?function(){}:typeof et=="string"?(it=et).split(".").length===1?function(lt){return lt[it]}:function(lt){return Et(lt,it)}:function(lt){return Et(lt,et)};var it}function eo(et){return[].slice.call(et)}var xo=0;function Wn(et){return et==null?":id":typeof et=="string"?et:"[".concat(et.join("+"),"]")}function So(et,it,Rt){function ht(Ut){if(Ut.type===3)return null;if(Ut.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var Mt=Ut.lower,Ot=Ut.upper,Nt=Ut.lowerOpen,Ut=Ut.upperOpen;return Mt===void 0?Ot===void 0?null:it.upperBound(Ot,!!Ut):Ot===void 0?it.lowerBound(Mt,!!Nt):it.bound(Mt,Ot,!!Nt,!!Ut)}function pt(jt){var Mt,Ot=jt.name;return{name:Ot,schema:jt,mutate:function(Nt){var Ut=Nt.trans,Gt=Nt.type,Wt=Nt.keys,Zt=Nt.values,nr=Nt.range;return new Promise(function(ur,mr){ur=Cr(ur);var or=Ut.objectStore(Ot),fr=or.keyPath==null,gr=Gt==="put"||Gt==="add";if(!gr&&Gt!=="delete"&&Gt!=="deleteRange")throw new Error("Invalid operation type: "+Gt);var hr,Tr=(Wt||Zt||{length:1}).length;if(Wt&&Zt&&Wt.length!==Zt.length)throw new Error("Given keys array must have same length as given values array.");if(Tr===0)return ur({numFailures:0,failures:{},results:[],lastResult:void 0});function Rr(nn){++on,zn(nn)}var Dr=[],Mr=[],on=0;if(Gt==="deleteRange"){if(nr.type===4)return ur({numFailures:on,failures:Mr,results:[],lastResult:void 0});nr.type===3?Dr.push(hr=or.clear()):Dr.push(hr=or.delete(ht(nr)))}else{var fr=gr?fr?[Zt,Wt]:[Zt,null]:[Wt,null],Ir=fr[0],tn=fr[1];if(gr)for(var rn=0;rn<Tr;++rn)Dr.push(hr=tn&&tn[rn]!==void 0?or[Gt](Ir[rn],tn[rn]):or[Gt](Ir[rn])),hr.onerror=Rr;else for(rn=0;rn<Tr;++rn)Dr.push(hr=or[Gt](Ir[rn])),hr.onerror=Rr}function ys(nn){nn=nn.target.result,Dr.forEach(function(Pn,zs){return Pn.error!=null&&(Mr[zs]=Pn.error)}),ur({numFailures:on,failures:Mr,results:Gt==="delete"?Wt:Dr.map(function(Pn){return Pn.result}),lastResult:nn})}hr.onerror=function(nn){Rr(nn),ys(nn)},hr.onsuccess=ys})},getMany:function(Nt){var Ut=Nt.trans,Gt=Nt.keys;return new Promise(function(Wt,Zt){Wt=Cr(Wt);for(var nr,ur=Ut.objectStore(Ot),mr=Gt.length,or=new Array(mr),fr=0,gr=0,hr=function(Dr){Dr=Dr.target,or[Dr._pos]=Dr.result,++gr===fr&&Wt(or)},Tr=pn(Zt),Rr=0;Rr<mr;++Rr)Gt[Rr]!=null&&((nr=ur.get(Gt[Rr]))._pos=Rr,nr.onsuccess=hr,nr.onerror=Tr,++fr);fr===0&&Wt(or)})},get:function(Nt){var Ut=Nt.trans,Gt=Nt.key;return new Promise(function(Wt,Zt){Wt=Cr(Wt);var nr=Ut.objectStore(Ot).get(Gt);nr.onsuccess=function(ur){return Wt(ur.target.result)},nr.onerror=pn(Zt)})},query:(Mt=Lt,function(Nt){return new Promise(function(Ut,Gt){Ut=Cr(Ut);var Wt,Zt,nr,fr=Nt.trans,ur=Nt.values,mr=Nt.limit,hr=Nt.query,or=mr===1/0?void 0:mr,gr=hr.index,hr=hr.range,fr=fr.objectStore(Ot),gr=gr.isPrimaryKey?fr:fr.index(gr.name),hr=ht(hr);if(mr===0)return Ut({result:[]});Mt?((or=ur?gr.getAll(hr,or):gr.getAllKeys(hr,or)).onsuccess=function(Tr){return Ut({result:Tr.target.result})},or.onerror=pn(Gt)):(Wt=0,Zt=!ur&&"openKeyCursor"in gr?gr.openKeyCursor(hr):gr.openCursor(hr),nr=[],Zt.onsuccess=function(Tr){var Rr=Zt.result;return Rr?(nr.push(ur?Rr.value:Rr.primaryKey),++Wt===mr?Ut({result:nr}):void Rr.continue()):Ut({result:nr})},Zt.onerror=pn(Gt))})}),openCursor:function(Nt){var Ut=Nt.trans,Gt=Nt.values,Wt=Nt.query,Zt=Nt.reverse,nr=Nt.unique;return new Promise(function(ur,mr){ur=Cr(ur);var gr=Wt.index,or=Wt.range,fr=Ut.objectStore(Ot),fr=gr.isPrimaryKey?fr:fr.index(gr.name),gr=Zt?nr?"prevunique":"prev":nr?"nextunique":"next",hr=!Gt&&"openKeyCursor"in fr?fr.openKeyCursor(ht(or),gr):fr.openCursor(ht(or),gr);hr.onerror=pn(mr),hr.onsuccess=Cr(function(Tr){var Rr,Dr,Mr,on,Ir=hr.result;Ir?(Ir.___id=++xo,Ir.done=!1,Rr=Ir.continue.bind(Ir),Dr=(Dr=Ir.continuePrimaryKey)&&Dr.bind(Ir),Mr=Ir.advance.bind(Ir),on=function(){throw new Error("Cursor not stopped")},Ir.trans=Ut,Ir.stop=Ir.continue=Ir.continuePrimaryKey=Ir.advance=function(){throw new Error("Cursor not started")},Ir.fail=Cr(mr),Ir.next=function(){var tn=this,rn=1;return this.start(function(){return rn--?tn.continue():tn.stop()}).then(function(){return tn})},Ir.start=function(tn){function rn(){if(hr.result)try{tn()}catch(nn){Ir.fail(nn)}else Ir.done=!0,Ir.start=function(){throw new Error("Cursor behind last entry")},Ir.stop()}var ys=new Promise(function(nn,Pn){nn=Cr(nn),hr.onerror=pn(Pn),Ir.fail=Pn,Ir.stop=function(zs){Ir.stop=Ir.continue=Ir.continuePrimaryKey=Ir.advance=on,nn(zs)}});return hr.onsuccess=Cr(function(nn){hr.onsuccess=rn,rn()}),Ir.continue=Rr,Ir.continuePrimaryKey=Dr,Ir.advance=Mr,rn(),ys},ur(Ir)):ur(null)},mr)})},count:function(Nt){var Ut=Nt.query,Gt=Nt.trans,Wt=Ut.index,Zt=Ut.range;return new Promise(function(nr,ur){var mr=Gt.objectStore(Ot),or=Wt.isPrimaryKey?mr:mr.index(Wt.name),mr=ht(Zt),or=mr?or.count(mr):or.count();or.onsuccess=Cr(function(fr){return nr(fr.target.result)}),or.onerror=pn(ur)})}}}var vt,bt,It,$t=(bt=Rt,It=eo((vt=et).objectStoreNames),{schema:{name:vt.name,tables:It.map(function(jt){return bt.objectStore(jt)}).map(function(jt){var Mt=jt.keyPath,Ut=jt.autoIncrement,Ot=g(Mt),Nt={},Ut={name:jt.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Mt==null,compound:Ot,keyPath:Mt,autoIncrement:Ut,unique:!0,extractKey:ws(Mt)},indexes:eo(jt.indexNames).map(function(Gt){return jt.index(Gt)}).map(function(nr){var Wt=nr.name,Zt=nr.unique,ur=nr.multiEntry,nr=nr.keyPath,ur={name:Wt,compound:g(nr),keyPath:nr,unique:Zt,multiEntry:ur,extractKey:ws(nr)};return Nt[Wn(nr)]=ur}),getIndexByKeyPath:function(Gt){return Nt[Wn(Gt)]}};return Nt[":id"]=Ut.primaryKey,Mt!=null&&(Nt[Wn(Mt)]=Ut.primaryKey),Ut})},hasGetAll:0<It.length&&"getAll"in bt.objectStore(It[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),Rt=$t.schema,Lt=$t.hasGetAll,$t=Rt.tables.map(pt),kt={};return $t.forEach(function(jt){return kt[jt.name]=jt}),{stack:"dbcore",transaction:et.transaction.bind(et),table:function(jt){if(!kt[jt])throw new Error("Table '".concat(jt,"' not found"));return kt[jt]},MIN_KEY:-1/0,MAX_KEY:Kn(it),schema:Rt}}function bo(et,it,lt,ht){var pt=lt.IDBKeyRange;return lt.indexedDB,{dbcore:(ht=So(it,pt,ht),et.dbcore.reduce(function(vt,bt){return bt=bt.create,o(o({},vt),bt(vt))},ht))}}function ss(et,ht){var lt=ht.db,ht=bo(et._middlewares,lt,et._deps,ht);et.core=ht.dbcore,et.tables.forEach(function(pt){var vt=pt.name;et.core.schema.tables.some(function(bt){return bt.name===vt})&&(pt.core=et.core.table(vt),et[vt]instanceof et.Table&&(et[vt].core=pt.core))})}function as(et,it,lt,ht){lt.forEach(function(pt){var vt=ht[pt];it.forEach(function(bt){var It=function Rt(Lt,$t){return st(Lt,$t)||(Lt=b(Lt))&&Rt(Lt,$t)}(bt,pt);(!It||"value"in It&&It.value===void 0)&&(bt===et.Transaction.prototype||bt instanceof et.Transaction?rt(bt,pt,{get:function(){return this.table(pt)},set:function(Rt){tt(this,pt,{value:Rt,writable:!0,configurable:!0,enumerable:!0})}}):bt[pt]=new et.Table(pt,vt))})})}function Is(et,it){it.forEach(function(lt){for(var ht in lt)lt[ht]instanceof et.Table&&delete lt[ht]})}function _o(et,it){return et._cfg.version-it._cfg.version}function Ao(et,it,lt,ht){var pt=et._dbSchema;lt.objectStoreNames.contains("$meta")&&!pt.$meta&&(pt.$meta=As("$meta",ro("")[0],[]),et._storeNames.push("$meta"));var vt=et._createTransaction("readwrite",et._storeNames,pt);vt.create(lt),vt._completion.catch(ht);var bt=vt._reject.bind(vt),It=dr.transless||dr;fn(function(){return dr.trans=vt,dr.transless=It,it!==0?(ss(et,lt),Lt=it,((Rt=vt).storeNames.includes("$meta")?Rt.table("$meta").get("version").then(function($t){return $t??Lt}):vr.resolve(Lt)).then(function($t){return jt=$t,Mt=vt,Ot=lt,Nt=[],$t=(kt=et)._versions,Ut=kt._dbSchema=ls(0,kt.idbdb,Ot),($t=$t.filter(function(Gt){return Gt._cfg.version>=jt})).length!==0?($t.forEach(function(Gt){Nt.push(function(){var Wt=Ut,Zt=Gt._cfg.dbschema;us(kt,Wt,Ot),us(kt,Zt,Ot),Ut=kt._dbSchema=Zt;var nr=ks(Wt,Zt);nr.add.forEach(function(gr){Rs(Ot,gr[0],gr[1].primKey,gr[1].indexes)}),nr.change.forEach(function(gr){if(gr.recreate)throw new yr.Upgrade("Not yet support for changing primary key");var hr=Ot.objectStore(gr.name);gr.add.forEach(function(Tr){return os(hr,Tr)}),gr.change.forEach(function(Tr){hr.deleteIndex(Tr.name),os(hr,Tr)}),gr.del.forEach(function(Tr){return hr.deleteIndex(Tr)})});var ur=Gt._cfg.contentUpgrade;if(ur&&Gt._cfg.version>jt){ss(kt,Ot),Mt._memoizedTables={};var mr=gt(Zt);nr.del.forEach(function(gr){mr[gr]=Wt[gr]}),Is(kt,[kt.Transaction.prototype]),as(kt,[kt.Transaction.prototype],h(mr),mr),Mt.schema=mr;var or,fr=zt(ur);return fr&&hn(),nr=vr.follow(function(){var gr;(or=ur(Mt))&&fr&&(gr=un.bind(null,null),or.then(gr,gr))}),or&&typeof or.then=="function"?vr.resolve(or):nr.then(function(){return or})}}),Nt.push(function(Wt){var Zt,nr,ur=Gt._cfg.dbschema;Zt=ur,nr=Wt,[].slice.call(nr.db.objectStoreNames).forEach(function(mr){return Zt[mr]==null&&nr.db.deleteObjectStore(mr)}),Is(kt,[kt.Transaction.prototype]),as(kt,[kt.Transaction.prototype],kt._storeNames,kt._dbSchema),Mt.schema=kt._dbSchema}),Nt.push(function(Wt){kt.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(kt.idbdb.version/10)===Gt._cfg.version?(kt.idbdb.deleteObjectStore("$meta"),delete kt._dbSchema.$meta,kt._storeNames=kt._storeNames.filter(function(Zt){return Zt!=="$meta"})):Wt.objectStore("$meta").put(Gt._cfg.version,"version"))})}),function Gt(){return Nt.length?vr.resolve(Nt.shift()(Mt.idbtrans)).then(Gt):vr.resolve()}().then(function(){to(Ut,Ot)})):vr.resolve();var kt,jt,Mt,Ot,Nt,Ut}).catch(bt)):(h(pt).forEach(function($t){Rs(lt,$t,pt[$t].primKey,pt[$t].indexes)}),ss(et,lt),void vr.follow(function(){return et.on.populate.fire(vt)}).catch(bt));var Rt,Lt})}function wo(et,it){to(et._dbSchema,it),it.db.version%10!=0||it.objectStoreNames.contains("$meta")||it.db.createObjectStore("$meta").add(Math.ceil(it.db.version/10-1),"version");var lt=ls(0,et.idbdb,it);us(et,et._dbSchema,it);for(var ht=0,pt=ks(lt,et._dbSchema).change;ht<pt.length;ht++){var vt=function(bt){if(bt.change.length||bt.recreate)return console.warn("Unable to patch indexes of table ".concat(bt.name," because it has changes on the type of index or primary key.")),{value:void 0};var It=it.objectStore(bt.name);bt.add.forEach(function(Rt){Ur&&console.debug("Dexie upgrade patch: Creating missing index ".concat(bt.name,".").concat(Rt.src)),os(It,Rt)})}(pt[ht]);if(typeof vt=="object")return vt.value}}function ks(et,it){var lt,ht={del:[],add:[],change:[]};for(lt in et)it[lt]||ht.del.push(lt);for(lt in it){var pt=et[lt],vt=it[lt];if(pt){var bt={name:lt,def:vt,recreate:!1,del:[],add:[],change:[]};if(""+(pt.primKey.keyPath||"")!=""+(vt.primKey.keyPath||"")||pt.primKey.auto!==vt.primKey.auto)bt.recreate=!0,ht.change.push(bt);else{var It=pt.idxByName,Rt=vt.idxByName,Lt=void 0;for(Lt in It)Rt[Lt]||bt.del.push(Lt);for(Lt in Rt){var $t=It[Lt],kt=Rt[Lt];$t?$t.src!==kt.src&&bt.change.push(kt):bt.add.push(kt)}(0<bt.del.length||0<bt.add.length||0<bt.change.length)&&ht.change.push(bt)}}else ht.add.push([lt,vt])}return ht}function Rs(et,it,lt,ht){var pt=et.db.createObjectStore(it,lt.keyPath?{keyPath:lt.keyPath,autoIncrement:lt.auto}:{autoIncrement:lt.auto});return ht.forEach(function(vt){return os(pt,vt)}),pt}function to(et,it){h(et).forEach(function(lt){it.db.objectStoreNames.contains(lt)||(Ur&&console.debug("Dexie: Creating missing table",lt),Rs(it,lt,et[lt].primKey,et[lt].indexes))})}function os(et,it){et.createIndex(it.name,it.keyPath,{unique:it.unique,multiEntry:it.multi})}function ls(et,it,lt){var ht={};return ot(it.objectStoreNames,0).forEach(function(pt){for(var vt=lt.objectStore(pt),bt=_s($a(Lt=vt.keyPath),Lt||"",!0,!1,!!vt.autoIncrement,Lt&&typeof Lt!="string",!0),It=[],Rt=0;Rt<vt.indexNames.length;++Rt){var $t=vt.index(vt.indexNames[Rt]),Lt=$t.keyPath,$t=_s($t.name,Lt,!!$t.unique,!!$t.multiEntry,!1,Lt&&typeof Lt!="string",!1);It.push($t)}ht[pt]=As(pt,bt,It)}),ht}function us(et,it,lt){for(var ht=lt.db.objectStoreNames,pt=0;pt<ht.length;++pt){var vt=ht[pt],bt=lt.objectStore(vt);et._hasGetAll="getAll"in bt;for(var It=0;It<bt.indexNames.length;++It){var Rt=bt.indexNames[It],Lt=bt.index(Rt).keyPath,$t=typeof Lt=="string"?Lt:"["+ot(Lt).join("+")+"]";!it[vt]||(Lt=it[vt].idxByName[$t])&&(Lt.name=Rt,delete it[vt].idxByName[$t],it[vt].idxByName[Rt]=Lt)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(et._hasGetAll=!1)}function ro(et){return et.split(",").map(function(it,lt){var vt=it.split(":"),ht=(pt=vt[1])===null||pt===void 0?void 0:pt.trim(),pt=(it=vt[0].trim()).replace(/([&*]|\+\+)/g,""),vt=/^\[/.test(pt)?pt.match(/^\[(.*)\]$/)[1].split("+"):pt;return _s(pt,vt||null,/\&/.test(it),/\*/.test(it),/\+\+/.test(it),g(vt),lt===0,ht)})}var Io=($n.prototype._createTableSchema=As,$n.prototype._parseIndexSyntax=ro,$n.prototype._parseStoresSpec=function(et,it){var lt=this;h(et).forEach(function(ht){if(et[ht]!==null){var pt=lt._parseIndexSyntax(et[ht]),vt=pt.shift();if(!vt)throw new yr.Schema("Invalid schema for table "+ht+": "+et[ht]);if(vt.unique=!0,vt.multi)throw new yr.Schema("Primary key cannot be multiEntry*");pt.forEach(function(bt){if(bt.auto)throw new yr.Schema("Only primary key can be marked as autoIncrement (++)");if(!bt.keyPath)throw new yr.Schema("Index must have a name and cannot be an empty string")}),pt=lt._createTableSchema(ht,vt,pt),it[ht]=pt}})},$n.prototype.stores=function(lt){var it=this.db;this._cfg.storesSource=this._cfg.storesSource?_(this._cfg.storesSource,lt):lt;var lt=it._versions,ht={},pt={};return lt.forEach(function(vt){_(ht,vt._cfg.storesSource),pt=vt._cfg.dbschema={},vt._parseStoresSpec(ht,pt)}),it._dbSchema=pt,Is(it,[it._allTables,it,it.Transaction.prototype]),as(it,[it._allTables,it,it.Transaction.prototype,this._cfg.tables],h(pt),pt),it._storeNames=h(pt),this},$n.prototype.upgrade=function(et){return this._cfg.contentUpgrade=Ar(this._cfg.contentUpgrade||Pr,et),this},$n);function $n(){}function Cs(et,it){var lt=et._dbNamesDB;return lt||(lt=et._dbNamesDB=new yn(_i,{addons:[],indexedDB:et,IDBKeyRange:it})).version(1).stores({dbnames:"name"}),lt.table("dbnames")}function Ps(et){return et&&typeof et.databases=="function"}function Ds(et){return fn(function(){return dr.letThrough=!0,et()})}function Ls(et){return!("from"in et)}var en=function(et,it){if(!this){var lt=new en;return et&&"d"in et&&_(lt,et),lt}_(this,arguments.length?{d:1,from:et,to:1<arguments.length?it:et}:{d:0})};function qn(et,it,lt){var ht=Nr(it,lt);if(!isNaN(ht)){if(0<ht)throw RangeError();if(Ls(et))return _(et,{from:it,to:lt,d:1});var pt=et.l,ht=et.r;if(Nr(lt,et.from)<0)return pt?qn(pt,it,lt):et.l={from:it,to:lt,d:1,l:null,r:null},io(et);if(0<Nr(it,et.to))return ht?qn(ht,it,lt):et.r={from:it,to:lt,d:1,l:null,r:null},io(et);Nr(it,et.from)<0&&(et.from=it,et.l=null,et.d=ht?ht.d+1:1),0<Nr(lt,et.to)&&(et.to=lt,et.r=null,et.d=et.l?et.l.d+1:1),lt=!et.r,pt&&!et.l&&Yn(et,pt),ht&&lt&&Yn(et,ht)}}function Yn(et,it){Ls(it)||function lt(ht,Rt){var vt=Rt.from,bt=Rt.to,It=Rt.l,Rt=Rt.r;qn(ht,vt,bt),It&&lt(ht,It),Rt&&lt(ht,Rt)}(et,it)}function no(et,it){var lt=cs(it),ht=lt.next();if(ht.done)return!1;for(var pt=ht.value,vt=cs(et),bt=vt.next(pt.from),It=bt.value;!ht.done&&!bt.done;){if(Nr(It.from,pt.to)<=0&&0<=Nr(It.to,pt.from))return!0;Nr(pt.from,It.from)<0?pt=(ht=lt.next(It.from)).value:It=(bt=vt.next(pt.from)).value}return!1}function cs(et){var it=Ls(et)?null:{s:0,n:et};return{next:function(lt){for(var ht=0<arguments.length;it;)switch(it.s){case 0:if(it.s=1,ht)for(;it.n.l&&Nr(lt,it.n.from)<0;)it={up:it,n:it.n.l,s:1};else for(;it.n.l;)it={up:it,n:it.n.l,s:1};case 1:if(it.s=2,!ht||Nr(lt,it.n.to)<=0)return{value:it.n,done:!1};case 2:if(it.n.r){it.s=3,it={up:it,n:it.n.r,s:0};continue}case 3:it=it.up}return{done:!0}}}}function io(et){var it,lt,ht=(((it=et.r)===null||it===void 0?void 0:it.d)||0)-(((lt=et.l)===null||lt===void 0?void 0:lt.d)||0),pt=1<ht?"r":ht<-1?"l":"";pt&&(it=pt=="r"?"l":"r",lt=o({},et),ht=et[pt],et.from=ht.from,et.to=ht.to,et[pt]=ht[pt],lt[pt]=ht[it],(et[it]=lt).d=so(lt)),et.d=so(et)}function so(lt){var it=lt.r,lt=lt.l;return(it?lt?Math.max(it.d,lt.d):it.d:lt?lt.d:0)+1}function ds(et,it){return h(it).forEach(function(lt){et[lt]?Yn(et[lt],it[lt]):et[lt]=function ht(pt){var vt,bt,It={};for(vt in pt)j(pt,vt)&&(bt=pt[vt],It[vt]=!bt||typeof bt!="object"||Ct.has(bt.constructor)?bt:ht(bt));return It}(it[lt])}),et}function Ms(et,it){return et.all||it.all||Object.keys(et).some(function(lt){return it[lt]&&no(it[lt],et[lt])})}_e(en.prototype,((dn={add:function(et){return Yn(this,et),this},addKey:function(et){return qn(this,et,et),this},addKeys:function(et){var it=this;return et.forEach(function(lt){return qn(it,lt,lt)}),this},hasKey:function(et){var it=cs(this).next(et).value;return it&&Nr(it.from,et)<=0&&0<=Nr(it.to,et)}})[qt]=function(){return cs(this)},dn));var Rn={},Fs={},Os=!1;function fs(et){ds(Fs,et),Os||(Os=!0,setTimeout(function(){Os=!1,Ns(Fs,!(Fs={}))},0))}function Ns(et,it){it===void 0&&(it=!1);var lt=new Set;if(et.all)for(var ht=0,pt=Object.values(Rn);ht<pt.length;ht++)ao(bt=pt[ht],et,lt,it);else for(var vt in et){var bt,It=/^idb\:\/\/(.*)\/(.*)\//.exec(vt);It&&(vt=It[1],It=It[2],(bt=Rn["idb://".concat(vt,"/").concat(It)])&&ao(bt,et,lt,it))}lt.forEach(function(Rt){return Rt()})}function ao(et,it,lt,ht){for(var pt=[],vt=0,bt=Object.entries(et.queries.query);vt<bt.length;vt++){for(var It=bt[vt],Rt=It[0],Lt=[],$t=0,kt=It[1];$t<kt.length;$t++){var jt=kt[$t];Ms(it,jt.obsSet)?jt.subscribers.forEach(function(Ut){return lt.add(Ut)}):ht&&Lt.push(jt)}ht&&pt.push([Rt,Lt])}if(ht)for(var Mt=0,Ot=pt;Mt<Ot.length;Mt++){var Nt=Ot[Mt],Rt=Nt[0],Lt=Nt[1];et.queries.query[Rt]=Lt}}function ko(et){var it=et._state,lt=et._deps.indexedDB;if(it.isBeingOpened||et.idbdb)return it.dbReadyPromise.then(function(){return it.dbOpenError?Kr(it.dbOpenError):et});it.isBeingOpened=!0,it.dbOpenError=null,it.openComplete=!1;var ht=it.openCanceller,pt=Math.round(10*et.verno),vt=!1;function bt(){if(it.openCanceller!==ht)throw new yr.DatabaseClosed("db.open() was cancelled")}function It(){return new vr(function(jt,Mt){if(bt(),!lt)throw new yr.MissingAPI;var Ot=et.name,Nt=it.autoSchema||!pt?lt.open(Ot):lt.open(Ot,pt);if(!Nt)throw new yr.MissingAPI;Nt.onerror=pn(Mt),Nt.onblocked=Cr(et._fireOnBlocked),Nt.onupgradeneeded=Cr(function(Ut){var Gt;$t=Nt.transaction,it.autoSchema&&!et._options.allowEmptyDB?(Nt.onerror=zn,$t.abort(),Nt.result.close(),(Gt=lt.deleteDatabase(Ot)).onsuccess=Gt.onerror=Cr(function(){Mt(new yr.NoSuchDatabase("Database ".concat(Ot," doesnt exist")))})):($t.onerror=pn(Mt),Ut=Ut.oldVersion>Math.pow(2,62)?0:Ut.oldVersion,kt=Ut<1,et.idbdb=Nt.result,vt&&wo(et,$t),Ao(et,Ut/10,$t,Mt))},Mt),Nt.onsuccess=Cr(function(){$t=null;var Ut,Gt,Wt,Zt,nr,ur=et.idbdb=Nt.result,mr=ot(ur.objectStoreNames);if(0<mr.length)try{var or=ur.transaction((Zt=mr).length===1?Zt[0]:Zt,"readonly");if(it.autoSchema)Gt=ur,Wt=or,(Ut=et).verno=Gt.version/10,Wt=Ut._dbSchema=ls(0,Gt,Wt),Ut._storeNames=ot(Gt.objectStoreNames,0),as(Ut,[Ut._allTables],h(Wt),Wt);else if(us(et,et._dbSchema,or),((nr=ks(ls(0,(nr=et).idbdb,or),nr._dbSchema)).add.length||nr.change.some(function(fr){return fr.add.length||fr.change.length}))&&!vt)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),ur.close(),pt=ur.version+1,vt=!0,jt(It());ss(et,or)}catch{}Fn.push(et),ur.onversionchange=Cr(function(fr){it.vcFired=!0,et.on("versionchange").fire(fr)}),ur.onclose=Cr(function(){et.close({disableAutoOpen:!1})}),kt&&(nr=et._deps,or=Ot,ur=nr.indexedDB,nr=nr.IDBKeyRange,Ps(ur)||or===_i||Cs(ur,nr).put({name:or}).catch(Pr)),jt()},Mt)}).catch(function(jt){switch(jt==null?void 0:jt.name){case"UnknownError":if(0<it.PR1398_maxLoop)return it.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),It();break;case"VersionError":if(0<pt)return pt=0,It()}return vr.reject(jt)})}var Rt,Lt=it.dbReadyResolve,$t=null,kt=!1;return vr.race([ht,(typeof navigator>"u"?vr.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(jt){function Mt(){return indexedDB.databases().finally(jt)}Rt=setInterval(Mt,100),Mt()}).finally(function(){return clearInterval(Rt)}):Promise.resolve()).then(It)]).then(function(){return bt(),it.onReadyBeingFired=[],vr.resolve(Ds(function(){return et.on.ready.fire(et.vip)})).then(function jt(){if(0<it.onReadyBeingFired.length){var Mt=it.onReadyBeingFired.reduce(Ar,Pr);return it.onReadyBeingFired=[],vr.resolve(Ds(function(){return Mt(et.vip)})).then(jt)}})}).finally(function(){it.openCanceller===ht&&(it.onReadyBeingFired=null,it.isBeingOpened=!1)}).catch(function(jt){it.dbOpenError=jt;try{$t&&$t.abort()}catch{}return ht===it.openCanceller&&et._close(),Kr(jt)}).finally(function(){it.openComplete=!0,Lt()}).then(function(){var jt;return kt&&(jt={},et.tables.forEach(function(Mt){Mt.schema.indexes.forEach(function(Ot){Ot.name&&(jt["idb://".concat(et.name,"/").concat(Mt.name,"/").concat(Ot.name)]=new en(-1/0,[[[]]]))}),jt["idb://".concat(et.name,"/").concat(Mt.name,"/")]=jt["idb://".concat(et.name,"/").concat(Mt.name,"/:dels")]=new en(-1/0,[[[]]])}),Tn(Hn).fire(jt),Ns(jt,!0)),et})}function $s(et){function it(vt){return et.next(vt)}var lt=pt(it),ht=pt(function(vt){return et.throw(vt)});function pt(vt){return function(Rt){var It=vt(Rt),Rt=It.value;return It.done?Rt:Rt&&typeof Rt.then=="function"?Rt.then(lt,ht):g(Rt)?Promise.all(Rt).then(lt,ht):lt(Rt)}}return pt(it)()}function hs(et,it,lt){for(var ht=g(et)?et.slice():[et],pt=0;pt<lt;++pt)ht.push(it);return ht}var Ro={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(et){return o(o({},et),{table:function(it){var lt=et.table(it),ht=lt.schema,pt={},vt=[];function bt(kt,jt,Mt){var Ot=Wn(kt),Nt=pt[Ot]=pt[Ot]||[],Ut=kt==null?0:typeof kt=="string"?1:kt.length,Gt=0<jt,Gt=o(o({},Mt),{name:Gt?"".concat(Ot,"(virtual-from:").concat(Mt.name,")"):Mt.name,lowLevelIndex:Mt,isVirtual:Gt,keyTail:jt,keyLength:Ut,extractKey:ws(kt),unique:!Gt&&Mt.unique});return Nt.push(Gt),Gt.isPrimaryKey||vt.push(Gt),1<Ut&&bt(Ut===2?kt[0]:kt.slice(0,Ut-1),jt+1,Mt),Nt.sort(function(Wt,Zt){return Wt.keyTail-Zt.keyTail}),Gt}it=bt(ht.primaryKey.keyPath,0,ht.primaryKey),pt[":id"]=[it];for(var It=0,Rt=ht.indexes;It<Rt.length;It++){var Lt=Rt[It];bt(Lt.keyPath,0,Lt)}function $t(kt){var jt,Mt=kt.query.index;return Mt.isVirtual?o(o({},kt),{query:{index:Mt.lowLevelIndex,range:(jt=kt.query.range,Mt=Mt.keyTail,{type:jt.type===1?2:jt.type,lower:hs(jt.lower,jt.lowerOpen?et.MAX_KEY:et.MIN_KEY,Mt),lowerOpen:!0,upper:hs(jt.upper,jt.upperOpen?et.MIN_KEY:et.MAX_KEY,Mt),upperOpen:!0})}}):kt}return o(o({},lt),{schema:o(o({},ht),{primaryKey:it,indexes:vt,getIndexByKeyPath:function(kt){return(kt=pt[Wn(kt)])&&kt[0]}}),count:function(kt){return lt.count($t(kt))},query:function(kt){return lt.query($t(kt))},openCursor:function(kt){var jt=kt.query.index,Mt=jt.keyTail,Ot=jt.isVirtual,Nt=jt.keyLength;return Ot?lt.openCursor($t(kt)).then(function(Gt){return Gt&&Ut(Gt)}):lt.openCursor(kt);function Ut(Gt){return Object.create(Gt,{continue:{value:function(Wt){Wt!=null?Gt.continue(hs(Wt,kt.reverse?et.MAX_KEY:et.MIN_KEY,Mt)):kt.unique?Gt.continue(Gt.key.slice(0,Nt).concat(kt.reverse?et.MIN_KEY:et.MAX_KEY,Mt)):Gt.continue()}},continuePrimaryKey:{value:function(Wt,Zt){Gt.continuePrimaryKey(hs(Wt,et.MAX_KEY,Mt),Zt)}},primaryKey:{get:function(){return Gt.primaryKey}},key:{get:function(){var Wt=Gt.key;return Nt===1?Wt[0]:Wt.slice(0,Nt)}},value:{get:function(){return Gt.value}}})}}})}})}};function Bs(et,it,lt,ht){return lt=lt||{},ht=ht||"",h(et).forEach(function(pt){var vt,bt,It;j(it,pt)?(vt=et[pt],bt=it[pt],typeof vt=="object"&&typeof bt=="object"&&vt&&bt?(It=er(vt))!==er(bt)?lt[ht+pt]=it[pt]:It==="Object"?Bs(vt,bt,lt,ht+pt+"."):vt!==bt&&(lt[ht+pt]=it[pt]):vt!==bt&&(lt[ht+pt]=it[pt])):lt[ht+pt]=void 0}),h(it).forEach(function(pt){j(et,pt)||(lt[ht+pt]=it[pt])}),lt}function Us(et,it){return it.type==="delete"?it.keys:it.keys||it.values.map(et.extractKey)}var Co={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(et){return o(o({},et),{table:function(it){var lt=et.table(it),ht=lt.schema.primaryKey;return o(o({},lt),{mutate:function(pt){var vt=dr.trans,bt=vt.table(it).hook,It=bt.deleting,Rt=bt.creating,Lt=bt.updating;switch(pt.type){case"add":if(Rt.fire===Pr)break;return vt._promise("readwrite",function(){return $t(pt)},!0);case"put":if(Rt.fire===Pr&&Lt.fire===Pr)break;return vt._promise("readwrite",function(){return $t(pt)},!0);case"delete":if(It.fire===Pr)break;return vt._promise("readwrite",function(){return $t(pt)},!0);case"deleteRange":if(It.fire===Pr)break;return vt._promise("readwrite",function(){return function kt(jt,Mt,Ot){return lt.query({trans:jt,values:!1,query:{index:ht,range:Mt},limit:Ot}).then(function(Nt){var Ut=Nt.result;return $t({type:"delete",keys:Ut,trans:jt}).then(function(Gt){return 0<Gt.numFailures?Promise.reject(Gt.failures[0]):Ut.length<Ot?{failures:[],numFailures:0,lastResult:void 0}:kt(jt,o(o({},Mt),{lower:Ut[Ut.length-1],lowerOpen:!0}),Ot)})})}(pt.trans,pt.range,1e4)},!0)}return lt.mutate(pt);function $t(kt){var jt,Mt,Ot,Nt=dr.trans,Ut=kt.keys||Us(ht,kt);if(!Ut)throw new Error("Keys missing");return(kt=kt.type==="add"||kt.type==="put"?o(o({},kt),{keys:Ut}):o({},kt)).type!=="delete"&&(kt.values=c([],kt.values)),kt.keys&&(kt.keys=c([],kt.keys)),jt=lt,Ot=Ut,((Mt=kt).type==="add"?Promise.resolve([]):jt.getMany({trans:Mt.trans,keys:Ot,cache:"immutable"})).then(function(Gt){var Wt=Ut.map(function(Zt,nr){var ur,mr,or,fr=Gt[nr],gr={onerror:null,onsuccess:null};return kt.type==="delete"?It.fire.call(gr,Zt,fr,Nt):kt.type==="add"||fr===void 0?(ur=Rt.fire.call(gr,Zt,kt.values[nr],Nt),Zt==null&&ur!=null&&(kt.keys[nr]=Zt=ur,ht.outbound||dt(kt.values[nr],ht.keyPath,Zt))):(ur=Bs(fr,kt.values[nr]),(mr=Lt.fire.call(gr,ur,Zt,fr,Nt))&&(or=kt.values[nr],Object.keys(mr).forEach(function(hr){j(or,hr)?or[hr]=mr[hr]:dt(or,hr,mr[hr])}))),gr});return lt.mutate(kt).then(function(Zt){for(var nr=Zt.failures,ur=Zt.results,mr=Zt.numFailures,Zt=Zt.lastResult,or=0;or<Ut.length;++or){var fr=(ur||Ut)[or],gr=Wt[or];fr==null?gr.onerror&&gr.onerror(nr[or]):gr.onsuccess&&gr.onsuccess(kt.type==="put"&&Gt[or]?kt.values[or]:fr)}return{failures:nr,results:ur,numFailures:mr,lastResult:Zt}}).catch(function(Zt){return Wt.forEach(function(nr){return nr.onerror&&nr.onerror(Zt)}),Promise.reject(Zt)})})}}})}})}};function oo(et,it,lt){try{if(!it||it.keys.length<et.length)return null;for(var ht=[],pt=0,vt=0;pt<it.keys.length&&vt<et.length;++pt)Nr(it.keys[pt],et[vt])===0&&(ht.push(lt?Dt(it.values[pt]):it.values[pt]),++vt);return ht.length===et.length?ht:null}catch{return null}}var Po={stack:"dbcore",level:-1,create:function(et){return{table:function(it){var lt=et.table(it);return o(o({},lt),{getMany:function(ht){if(!ht.cache)return lt.getMany(ht);var pt=oo(ht.keys,ht.trans._cache,ht.cache==="clone");return pt?vr.resolve(pt):lt.getMany(ht).then(function(vt){return ht.trans._cache={keys:ht.keys,values:ht.cache==="clone"?Dt(vt):vt},vt})},mutate:function(ht){return ht.type!=="add"&&(ht.trans._cache=null),lt.mutate(ht)}})}}}};function lo(et,it){return et.trans.mode==="readonly"&&!!et.subscr&&!et.trans.explicit&&et.trans.db._options.cache!=="disabled"&&!it.schema.primaryKey.outbound}function uo(et,it){switch(et){case"query":return it.values&&!it.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Do={stack:"dbcore",level:0,name:"Observability",create:function(et){var it=et.schema.name,lt=new en(et.MIN_KEY,et.MAX_KEY);return o(o({},et),{transaction:function(ht,pt,vt){if(dr.subscr&&pt!=="readonly")throw new yr.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(dr.querier));return et.transaction(ht,pt,vt)},table:function(ht){var pt=et.table(ht),vt=pt.schema,bt=vt.primaryKey,kt=vt.indexes,It=bt.extractKey,Rt=bt.outbound,Lt=bt.autoIncrement&&kt.filter(function(Mt){return Mt.compound&&Mt.keyPath.includes(bt.keyPath)}),$t=o(o({},pt),{mutate:function(Mt){function Ot(hr){return hr="idb://".concat(it,"/").concat(ht,"/").concat(hr),Zt[hr]||(Zt[hr]=new en)}var Nt,Ut,Gt,Wt=Mt.trans,Zt=Mt.mutatedParts||(Mt.mutatedParts={}),nr=Ot(""),ur=Ot(":dels"),mr=Mt.type,gr=Mt.type==="deleteRange"?[Mt.range]:Mt.type==="delete"?[Mt.keys]:Mt.values.length<50?[Us(bt,Mt).filter(function(hr){return hr}),Mt.values]:[],or=gr[0],fr=gr[1],gr=Mt.trans._cache;return g(or)?(nr.addKeys(or),(gr=mr==="delete"||or.length===fr.length?oo(or,gr):null)||ur.addKeys(or),(gr||fr)&&(Nt=Ot,Ut=gr,Gt=fr,vt.indexes.forEach(function(hr){var Tr=Nt(hr.name||"");function Rr(Mr){return Mr!=null?hr.extractKey(Mr):null}function Dr(Mr){return hr.multiEntry&&g(Mr)?Mr.forEach(function(on){return Tr.addKey(on)}):Tr.addKey(Mr)}(Ut||Gt).forEach(function(Mr,tn){var Ir=Ut&&Rr(Ut[tn]),tn=Gt&&Rr(Gt[tn]);Nr(Ir,tn)!==0&&(Ir!=null&&Dr(Ir),tn!=null&&Dr(tn))})}))):or?(fr={from:(fr=or.lower)!==null&&fr!==void 0?fr:et.MIN_KEY,to:(fr=or.upper)!==null&&fr!==void 0?fr:et.MAX_KEY},ur.add(fr),nr.add(fr)):(nr.add(lt),ur.add(lt),vt.indexes.forEach(function(hr){return Ot(hr.name).add(lt)})),pt.mutate(Mt).then(function(hr){return!or||Mt.type!=="add"&&Mt.type!=="put"||(nr.addKeys(hr.results),Lt&&Lt.forEach(function(Tr){for(var Rr=Mt.values.map(function(Ir){return Tr.extractKey(Ir)}),Dr=Tr.keyPath.findIndex(function(Ir){return Ir===bt.keyPath}),Mr=0,on=hr.results.length;Mr<on;++Mr)Rr[Mr][Dr]=hr.results[Mr];Ot(Tr.name).addKeys(Rr)})),Wt.mutatedParts=ds(Wt.mutatedParts||{},Zt),hr})}}),kt=function(Ot){var Nt=Ot.query,Ot=Nt.index,Nt=Nt.range;return[Ot,new en((Ot=Nt.lower)!==null&&Ot!==void 0?Ot:et.MIN_KEY,(Nt=Nt.upper)!==null&&Nt!==void 0?Nt:et.MAX_KEY)]},jt={get:function(Mt){return[bt,new en(Mt.key)]},getMany:function(Mt){return[bt,new en().addKeys(Mt.keys)]},count:kt,query:kt,openCursor:kt};return h(jt).forEach(function(Mt){$t[Mt]=function(Ot){var Nt=dr.subscr,Ut=!!Nt,Gt=lo(dr,pt)&&uo(Mt,Ot)?Ot.obsSet={}:Nt;if(Ut){var Wt=function(fr){return fr="idb://".concat(it,"/").concat(ht,"/").concat(fr),Gt[fr]||(Gt[fr]=new en)},Zt=Wt(""),nr=Wt(":dels"),Nt=jt[Mt](Ot),Ut=Nt[0],Nt=Nt[1];if((Mt==="query"&&Ut.isPrimaryKey&&!Ot.values?nr:Wt(Ut.name||"")).add(Nt),!Ut.isPrimaryKey){if(Mt!=="count"){var ur=Mt==="query"&&Rt&&Ot.values&&pt.query(o(o({},Ot),{values:!1}));return pt[Mt].apply(this,arguments).then(function(fr){if(Mt==="query"){if(Rt&&Ot.values)return ur.then(function(Rr){return Rr=Rr.result,Zt.addKeys(Rr),fr});var gr=Ot.values?fr.result.map(It):fr.result;(Ot.values?Zt:nr).addKeys(gr)}else if(Mt==="openCursor"){var hr=fr,Tr=Ot.values;return hr&&Object.create(hr,{key:{get:function(){return nr.addKey(hr.primaryKey),hr.key}},primaryKey:{get:function(){var Rr=hr.primaryKey;return nr.addKey(Rr),Rr}},value:{get:function(){return Tr&&Zt.addKey(hr.primaryKey),hr.value}}})}return fr})}nr.add(lt)}}return pt[Mt].apply(this,arguments)}}),$t}})}};function co(et,it,lt){if(lt.numFailures===0)return it;if(it.type==="deleteRange")return null;var ht=it.keys?it.keys.length:"values"in it&&it.values?it.values.length:1;return lt.numFailures===ht?null:(it=o({},it),g(it.keys)&&(it.keys=it.keys.filter(function(pt,vt){return!(vt in lt.failures)})),"values"in it&&g(it.values)&&(it.values=it.values.filter(function(pt,vt){return!(vt in lt.failures)})),it)}function js(et,it){return lt=et,((ht=it).lower===void 0||(ht.lowerOpen?0<Nr(lt,ht.lower):0<=Nr(lt,ht.lower)))&&(et=et,(it=it).upper===void 0||(it.upperOpen?Nr(et,it.upper)<0:Nr(et,it.upper)<=0));var lt,ht}function fo(et,it,jt,ht,pt,vt){if(!jt||jt.length===0)return et;var bt=it.query.index,It=bt.multiEntry,Rt=it.query.range,Lt=ht.schema.primaryKey.extractKey,$t=bt.extractKey,kt=(bt.lowLevelIndex||bt).extractKey,jt=jt.reduce(function(Mt,Ot){var Nt=Mt,Ut=[];if(Ot.type==="add"||Ot.type==="put")for(var Gt=new en,Wt=Ot.values.length-1;0<=Wt;--Wt){var Zt,nr=Ot.values[Wt],ur=Lt(nr);Gt.hasKey(ur)||(Zt=$t(nr),(It&&g(Zt)?Zt.some(function(hr){return js(hr,Rt)}):js(Zt,Rt))&&(Gt.addKey(ur),Ut.push(nr)))}switch(Ot.type){case"add":var mr=new en().addKeys(it.values?Mt.map(function(Tr){return Lt(Tr)}):Mt),Nt=Mt.concat(it.values?Ut.filter(function(Tr){return Tr=Lt(Tr),!mr.hasKey(Tr)&&(mr.addKey(Tr),!0)}):Ut.map(function(Tr){return Lt(Tr)}).filter(function(Tr){return!mr.hasKey(Tr)&&(mr.addKey(Tr),!0)}));break;case"put":var or=new en().addKeys(Ot.values.map(function(Tr){return Lt(Tr)}));Nt=Mt.filter(function(Tr){return!or.hasKey(it.values?Lt(Tr):Tr)}).concat(it.values?Ut:Ut.map(function(Tr){return Lt(Tr)}));break;case"delete":var fr=new en().addKeys(Ot.keys);Nt=Mt.filter(function(Tr){return!fr.hasKey(it.values?Lt(Tr):Tr)});break;case"deleteRange":var gr=Ot.range;Nt=Mt.filter(function(Tr){return!js(Lt(Tr),gr)})}return Nt},et);return jt===et?et:(jt.sort(function(Mt,Ot){return Nr(kt(Mt),kt(Ot))||Nr(Lt(Mt),Lt(Ot))}),it.limit&&it.limit<1/0&&(jt.length>it.limit?jt.length=it.limit:et.length===it.limit&&jt.length<it.limit&&(pt.dirty=!0)),vt?Object.freeze(jt):jt)}function ho(et,it){return Nr(et.lower,it.lower)===0&&Nr(et.upper,it.upper)===0&&!!et.lowerOpen==!!it.lowerOpen&&!!et.upperOpen==!!it.upperOpen}function Lo(et,it){return function(lt,ht,pt,vt){if(lt===void 0)return ht!==void 0?-1:0;if(ht===void 0)return 1;if((ht=Nr(lt,ht))===0){if(pt&&vt)return 0;if(pt)return 1;if(vt)return-1}return ht}(et.lower,it.lower,et.lowerOpen,it.lowerOpen)<=0&&0<=function(lt,ht,pt,vt){if(lt===void 0)return ht!==void 0?1:0;if(ht===void 0)return-1;if((ht=Nr(lt,ht))===0){if(pt&&vt)return 0;if(pt)return-1;if(vt)return 1}return ht}(et.upper,it.upper,et.upperOpen,it.upperOpen)}function Mo(et,it,lt,ht){et.subscribers.add(lt),ht.addEventListener("abort",function(){var pt,vt;et.subscribers.delete(lt),et.subscribers.size===0&&(pt=et,vt=it,setTimeout(function(){pt.subscribers.size===0&&Ft(vt,pt)},3e3))})}var Fo={stack:"dbcore",level:0,name:"Cache",create:function(et){var it=et.schema.name;return o(o({},et),{transaction:function(lt,ht,pt){var vt,bt,It=et.transaction(lt,ht,pt);return ht==="readwrite"&&(bt=(vt=new AbortController).signal,pt=function(Rt){return function(){if(vt.abort(),ht==="readwrite"){for(var Lt=new Set,$t=0,kt=lt;$t<kt.length;$t++){var jt=kt[$t],Mt=Rn["idb://".concat(it,"/").concat(jt)];if(Mt){var Ot=et.table(jt),Nt=Mt.optimisticOps.filter(function(Tr){return Tr.trans===It});if(It._explicit&&Rt&&It.mutatedParts)for(var Ut=0,Gt=Object.values(Mt.queries.query);Ut<Gt.length;Ut++)for(var Wt=0,Zt=(mr=Gt[Ut]).slice();Wt<Zt.length;Wt++)Ms((or=Zt[Wt]).obsSet,It.mutatedParts)&&(Ft(mr,or),or.subscribers.forEach(function(Tr){return Lt.add(Tr)}));else if(0<Nt.length){Mt.optimisticOps=Mt.optimisticOps.filter(function(Tr){return Tr.trans!==It});for(var nr=0,ur=Object.values(Mt.queries.query);nr<ur.length;nr++)for(var mr,or,fr,gr=0,hr=(mr=ur[nr]).slice();gr<hr.length;gr++)(or=hr[gr]).res!=null&&It.mutatedParts&&(Rt&&!or.dirty?(fr=Object.isFrozen(or.res),fr=fo(or.res,or.req,Nt,Ot,or,fr),or.dirty?(Ft(mr,or),or.subscribers.forEach(function(Tr){return Lt.add(Tr)})):fr!==or.res&&(or.res=fr,or.promise=vr.resolve({result:fr}))):(or.dirty&&Ft(mr,or),or.subscribers.forEach(function(Tr){return Lt.add(Tr)})))}}}Lt.forEach(function(Tr){return Tr()})}}},It.addEventListener("abort",pt(!1),{signal:bt}),It.addEventListener("error",pt(!1),{signal:bt}),It.addEventListener("complete",pt(!0),{signal:bt})),It},table:function(lt){var ht=et.table(lt),pt=ht.schema.primaryKey;return o(o({},ht),{mutate:function(vt){var bt=dr.trans;if(pt.outbound||bt.db._options.cache==="disabled"||bt.explicit||bt.idbtrans.mode!=="readwrite")return ht.mutate(vt);var It=Rn["idb://".concat(it,"/").concat(lt)];return It?(bt=ht.mutate(vt),vt.type!=="add"&&vt.type!=="put"||!(50<=vt.values.length||Us(pt,vt).some(function(Rt){return Rt==null}))?(It.optimisticOps.push(vt),vt.mutatedParts&&fs(vt.mutatedParts),bt.then(function(Rt){0<Rt.numFailures&&(Ft(It.optimisticOps,vt),(Rt=co(0,vt,Rt))&&It.optimisticOps.push(Rt),vt.mutatedParts&&fs(vt.mutatedParts))}),bt.catch(function(){Ft(It.optimisticOps,vt),vt.mutatedParts&&fs(vt.mutatedParts)})):bt.then(function(Rt){var Lt=co(0,o(o({},vt),{values:vt.values.map(function($t,kt){var jt;return Rt.failures[kt]?$t:($t=(jt=pt.keyPath)!==null&&jt!==void 0&&jt.includes(".")?Dt($t):o({},$t),dt($t,pt.keyPath,Rt.results[kt]),$t)})}),Rt);It.optimisticOps.push(Lt),queueMicrotask(function(){return vt.mutatedParts&&fs(vt.mutatedParts)})}),bt):ht.mutate(vt)},query:function(vt){if(!lo(dr,ht)||!uo("query",vt))return ht.query(vt);var bt=((Lt=dr.trans)===null||Lt===void 0?void 0:Lt.db._options.cache)==="immutable",kt=dr,It=kt.requery,Rt=kt.signal,Lt=function(Ot,Nt,Ut,Gt){var Wt=Rn["idb://".concat(Ot,"/").concat(Nt)];if(!Wt)return[];if(!(Nt=Wt.queries[Ut]))return[null,!1,Wt,null];var Zt=Nt[(Gt.query?Gt.query.index.name:null)||""];if(!Zt)return[null,!1,Wt,null];switch(Ut){case"query":var nr=Zt.find(function(ur){return ur.req.limit===Gt.limit&&ur.req.values===Gt.values&&ho(ur.req.query.range,Gt.query.range)});return nr?[nr,!0,Wt,Zt]:[Zt.find(function(ur){return("limit"in ur.req?ur.req.limit:1/0)>=Gt.limit&&(!Gt.values||ur.req.values)&&Lo(ur.req.query.range,Gt.query.range)}),!1,Wt,Zt];case"count":return nr=Zt.find(function(ur){return ho(ur.req.query.range,Gt.query.range)}),[nr,!!nr,Wt,Zt]}}(it,lt,"query",vt),$t=Lt[0],kt=Lt[1],jt=Lt[2],Mt=Lt[3];return $t&&kt?$t.obsSet=vt.obsSet:(kt=ht.query(vt).then(function(Ot){var Nt=Ot.result;if($t&&($t.res=Nt),bt){for(var Ut=0,Gt=Nt.length;Ut<Gt;++Ut)Object.freeze(Nt[Ut]);Object.freeze(Nt)}else Ot.result=Dt(Nt);return Ot}).catch(function(Ot){return Mt&&$t&&Ft(Mt,$t),Promise.reject(Ot)}),$t={obsSet:vt.obsSet,promise:kt,subscribers:new Set,type:"query",req:vt,dirty:!1},Mt?Mt.push($t):(Mt=[$t],(jt=jt||(Rn["idb://".concat(it,"/").concat(lt)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[vt.query.index.name||""]=Mt)),Mo($t,Mt,It,Rt),$t.promise.then(function(Ot){return{result:fo(Ot.result,vt,jt==null?void 0:jt.optimisticOps,ht,$t,bt)}})}})}})}};function ps(et,it){return new Proxy(et,{get:function(lt,ht,pt){return ht==="db"?it:Reflect.get(lt,ht,pt)}})}var yn=(Wr.prototype.version=function(et){if(isNaN(et)||et<.1)throw new yr.Type("Given version is not a positive number");if(et=Math.round(10*et)/10,this.idbdb||this._state.isBeingOpened)throw new yr.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,et);var it=this._versions,lt=it.filter(function(ht){return ht._cfg.version===et})[0];return lt||(lt=new this.Version(et),it.push(lt),it.sort(_o),lt.stores({}),this._state.autoSchema=!1,lt)},Wr.prototype._whenReady=function(et){var it=this;return this.idbdb&&(this._state.openComplete||dr.letThrough||this._vip)?et():new vr(function(lt,ht){if(it._state.openComplete)return ht(new yr.DatabaseClosed(it._state.dbOpenError));if(!it._state.isBeingOpened){if(!it._state.autoOpen)return void ht(new yr.DatabaseClosed);it.open().catch(Pr)}it._state.dbReadyPromise.then(lt,ht)}).then(et)},Wr.prototype.use=function(et){var it=et.stack,lt=et.create,ht=et.level,pt=et.name;return pt&&this.unuse({stack:it,name:pt}),et=this._middlewares[it]||(this._middlewares[it]=[]),et.push({stack:it,create:lt,level:ht??10,name:pt}),et.sort(function(vt,bt){return vt.level-bt.level}),this},Wr.prototype.unuse=function(et){var it=et.stack,lt=et.name,ht=et.create;return it&&this._middlewares[it]&&(this._middlewares[it]=this._middlewares[it].filter(function(pt){return ht?pt.create!==ht:!!lt&&pt.name!==lt})),this},Wr.prototype.open=function(){var et=this;return wn(Br,function(){return ko(et)})},Wr.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var et=this._state,it=Fn.indexOf(this);if(0<=it&&Fn.splice(it,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}et.isBeingOpened||(et.dbReadyPromise=new vr(function(lt){et.dbReadyResolve=lt}),et.openCanceller=new vr(function(lt,ht){et.cancelOpen=ht}))},Wr.prototype.close=function(lt){var it=(lt===void 0?{disableAutoOpen:!0}:lt).disableAutoOpen,lt=this._state;it?(lt.isBeingOpened&&lt.cancelOpen(new yr.DatabaseClosed),this._close(),lt.autoOpen=!1,lt.dbOpenError=new yr.DatabaseClosed):(this._close(),lt.autoOpen=this._options.autoOpen||lt.isBeingOpened,lt.openComplete=!1,lt.dbOpenError=null)},Wr.prototype.delete=function(et){var it=this;et===void 0&&(et={disableAutoOpen:!0});var lt=0<arguments.length&&typeof arguments[0]!="object",ht=this._state;return new vr(function(pt,vt){function bt(){it.close(et);var It=it._deps.indexedDB.deleteDatabase(it.name);It.onsuccess=Cr(function(){var Rt,Lt,$t;Rt=it._deps,Lt=it.name,$t=Rt.indexedDB,Rt=Rt.IDBKeyRange,Ps($t)||Lt===_i||Cs($t,Rt).delete(Lt).catch(Pr),pt()}),It.onerror=pn(vt),It.onblocked=it._fireOnBlocked}if(lt)throw new yr.InvalidArgument("Invalid closeOptions argument to db.delete()");ht.isBeingOpened?ht.dbReadyPromise.then(bt):bt()})},Wr.prototype.backendDB=function(){return this.idbdb},Wr.prototype.isOpen=function(){return this.idbdb!==null},Wr.prototype.hasBeenClosed=function(){var et=this._state.dbOpenError;return et&&et.name==="DatabaseClosed"},Wr.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Wr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Wr.prototype,"tables",{get:function(){var et=this;return h(this._allTables).map(function(it){return et._allTables[it]})},enumerable:!1,configurable:!0}),Wr.prototype.transaction=function(){var et=(function(it,lt,ht){var pt=arguments.length;if(pt<2)throw new yr.InvalidArgument("Too few arguments");for(var vt=new Array(pt-1);--pt;)vt[pt-1]=arguments[pt];return ht=vt.pop(),[it,xt(vt),ht]}).apply(this,arguments);return this._transaction.apply(this,et)},Wr.prototype._transaction=function(et,it,lt){var ht=this,pt=dr.trans;pt&&pt.db===this&&et.indexOf("!")===-1||(pt=null);var vt,bt,It=et.indexOf("?")!==-1;et=et.replace("!","").replace("?","");try{if(bt=it.map(function(Lt){if(Lt=Lt instanceof ht.Table?Lt.name:Lt,typeof Lt!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Lt}),et=="r"||et===Es)vt=Es;else{if(et!="rw"&&et!=Ts)throw new yr.InvalidArgument("Invalid transaction mode: "+et);vt=Ts}if(pt){if(pt.mode===Es&&vt===Ts){if(!It)throw new yr.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");pt=null}pt&&bt.forEach(function(Lt){if(pt&&pt.storeNames.indexOf(Lt)===-1){if(!It)throw new yr.SubTransaction("Table "+Lt+" not included in parent transaction.");pt=null}}),It&&pt&&!pt.active&&(pt=null)}}catch(Lt){return pt?pt._promise(null,function($t,kt){kt(Lt)}):Kr(Lt)}var Rt=(function Lt($t,kt,jt,Mt,Ot){return vr.resolve().then(function(){var Nt=dr.transless||dr,Ut=$t._createTransaction(kt,jt,$t._dbSchema,Mt);if(Ut.explicit=!0,Nt={trans:Ut,transless:Nt},Mt)Ut.idbtrans=Mt.idbtrans;else try{Ut.create(),Ut.idbtrans._explicit=!0,$t._state.PR1398_maxLoop=3}catch(Zt){return Zt.name===Fr.InvalidState&&$t.isOpen()&&0<--$t._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),$t.close({disableAutoOpen:!1}),$t.open().then(function(){return Lt($t,kt,jt,null,Ot)})):Kr(Zt)}var Gt,Wt=zt(Ot);return Wt&&hn(),Nt=vr.follow(function(){var Zt;(Gt=Ot.call(Ut,Ut))&&(Wt?(Zt=un.bind(null,null),Gt.then(Zt,Zt)):typeof Gt.next=="function"&&typeof Gt.throw=="function"&&(Gt=$s(Gt)))},Nt),(Gt&&typeof Gt.then=="function"?vr.resolve(Gt).then(function(Zt){return Ut.active?Zt:Kr(new yr.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Nt.then(function(){return Gt})).then(function(Zt){return Mt&&Ut._resolve(),Ut._completion.then(function(){return Zt})}).catch(function(Zt){return Ut._reject(Zt),Kr(Zt)})})}).bind(null,this,vt,bt,pt,lt);return pt?pt._promise(vt,Rt,"lock"):dr.trans?wn(dr.transless,function(){return ht._whenReady(Rt)}):this._whenReady(Rt)},Wr.prototype.table=function(et){if(!j(this._allTables,et))throw new yr.InvalidTable("Table ".concat(et," does not exist"));return this._allTables[et]},Wr);function Wr(et,it){var lt=this;this._middlewares={},this.verno=0;var ht=Wr.dependencies;this._options=it=o({addons:Wr.addons,autoOpen:!0,indexedDB:ht.indexedDB,IDBKeyRange:ht.IDBKeyRange,cache:"cloned"},it),this._deps={indexedDB:it.indexedDB,IDBKeyRange:it.IDBKeyRange},ht=it.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var pt,vt,bt,It,Rt,Lt={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Pr,dbReadyPromise:null,cancelOpen:Pr,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:it.autoOpen};Lt.dbReadyPromise=new vr(function(kt){Lt.dbReadyResolve=kt}),Lt.openCanceller=new vr(function(kt,jt){Lt.cancelOpen=jt}),this._state=Lt,this.name=et,this.on=Vn(this,"populate","blocked","versionchange","close",{ready:[Ar,Pr]}),this.once=function(kt,jt){var Mt=function(){for(var Ot=[],Nt=0;Nt<arguments.length;Nt++)Ot[Nt]=arguments[Nt];lt.on(kt).unsubscribe(Mt),jt.apply(lt,Ot)};return lt.on(kt,Mt)},this.on.ready.subscribe=ut(this.on.ready.subscribe,function(kt){return function(jt,Mt){Wr.vip(function(){var Ot,Nt=lt._state;Nt.openComplete?(Nt.dbOpenError||vr.resolve().then(jt),Mt&&kt(jt)):Nt.onReadyBeingFired?(Nt.onReadyBeingFired.push(jt),Mt&&kt(jt)):(kt(jt),Ot=lt,Mt||kt(function Ut(){Ot.on.ready.unsubscribe(jt),Ot.on.ready.unsubscribe(Ut)}))})}}),this.Collection=(pt=this,Gn(yo.prototype,function(Gt,Ut){this.db=pt;var Mt=Ws,Ot=null;if(Ut)try{Mt=Ut()}catch(Wt){Ot=Wt}var Nt=Gt._ctx,Ut=Nt.table,Gt=Ut.hook.reading.fire;this._ctx={table:Ut,index:Nt.index,isPrimKey:!Nt.index||Ut.schema.primKey.keyPath&&Nt.index===Ut.schema.primKey.name,range:Mt,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Ot,or:Nt.or,valueMapper:Gt!==Bt?Gt:null}})),this.Table=(vt=this,Gn(Js.prototype,function(kt,jt,Mt){this.db=vt,this._tx=Mt,this.name=kt,this.schema=jt,this.hook=vt._allTables[kt]?vt._allTables[kt].hook:Vn(null,{creating:[ar,Pr],reading:[Vt,Bt],updating:[kr,Pr],deleting:[pr,Pr]})})),this.Transaction=(bt=this,Gn(To.prototype,function(kt,jt,Mt,Ot,Nt){var Ut=this;kt!=="readonly"&&jt.forEach(function(Gt){Gt=(Gt=Mt[Gt])===null||Gt===void 0?void 0:Gt.yProps,Gt&&(jt=jt.concat(Gt.map(function(Wt){return Wt.updatesTable})))}),this.db=bt,this.mode=kt,this.storeNames=jt,this.schema=Mt,this.chromeTransactionDurability=Ot,this.idbtrans=null,this.on=Vn(this,"complete","error","abort"),this.parent=Nt||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new vr(function(Gt,Wt){Ut._resolve=Gt,Ut._reject=Wt}),this._completion.then(function(){Ut.active=!1,Ut.on.complete.fire()},function(Gt){var Wt=Ut.active;return Ut.active=!1,Ut.on.error.fire(Gt),Ut.parent?Ut.parent._reject(Gt):Wt&&Ut.idbtrans&&Ut.idbtrans.abort(),Kr(Gt)})})),this.Version=(It=this,Gn(Io.prototype,function(kt){this.db=It,this._cfg={version:kt,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(Rt=this,Gn(_a.prototype,function(kt,jt,Mt){if(this.db=Rt,this._ctx={table:kt,index:jt===":id"?null:jt,or:Mt},this._cmp=this._ascending=Nr,this._descending=function(Ot,Nt){return Nr(Nt,Ot)},this._max=function(Ot,Nt){return 0<Nr(Ot,Nt)?Ot:Nt},this._min=function(Ot,Nt){return Nr(Ot,Nt)<0?Ot:Nt},this._IDBKeyRange=Rt._deps.IDBKeyRange,!this._IDBKeyRange)throw new yr.MissingAPI})),this.on("versionchange",function(kt){0<kt.newVersion?console.warn("Another connection wants to upgrade database '".concat(lt.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(lt.name,"'. Closing db now to resume the delete request.")),lt.close({disableAutoOpen:!1})}),this.on("blocked",function(kt){!kt.newVersion||kt.newVersion<kt.oldVersion?console.warn("Dexie.delete('".concat(lt.name,"') was blocked")):console.warn("Upgrade '".concat(lt.name,"' blocked by other connection holding version ").concat(kt.oldVersion/10))}),this._maxKey=Kn(it.IDBKeyRange),this._createTransaction=function(kt,jt,Mt,Ot){return new lt.Transaction(kt,jt,Mt,lt._options.chromeTransactionDurability,Ot)},this._fireOnBlocked=function(kt){lt.on("blocked").fire(kt),Fn.filter(function(jt){return jt.name===lt.name&&jt!==lt&&!jt._state.vcFired}).map(function(jt){return jt.on("versionchange").fire(kt)})},this.use(Po),this.use(Fo),this.use(Do),this.use(Ro),this.use(Co);var $t=new Proxy(this,{get:function(kt,jt,Mt){if(jt==="_vip")return!0;if(jt==="table")return function(Nt){return ps(lt.table(Nt),$t)};var Ot=Reflect.get(kt,jt,Mt);return Ot instanceof Js?ps(Ot,$t):jt==="tables"?Ot.map(function(Nt){return ps(Nt,$t)}):jt==="_createTransaction"?function(){return ps(Ot.apply(this,arguments),$t)}:Ot}});this.vip=$t,ht.forEach(function(kt){return kt(lt)})}var gs,dn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Oo=(Vs.prototype.subscribe=function(et,it,lt){return this._subscribe(et&&typeof et!="function"?et:{next:et,error:it,complete:lt})},Vs.prototype[dn]=function(){return this},Vs);function Vs(et){this._subscribe=et}try{gs={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{gs={indexedDB:null,IDBKeyRange:null}}function po(et){var it,lt=!1,ht=new Oo(function(pt){var vt=zt(et),bt,It=!1,Rt={},Lt={},$t={get closed(){return It},unsubscribe:function(){It||(It=!0,bt&&bt.abort(),kt&&Tn.storagemutated.unsubscribe(Mt))}};pt.start&&pt.start($t);var kt=!1,jt=function(){return vs(Ot)},Mt=function(Nt){ds(Rt,Nt),Ms(Lt,Rt)&&jt()},Ot=function(){var Nt,Ut,Gt;!It&&gs.indexedDB&&(Rt={},Nt={},bt&&bt.abort(),bt=new AbortController,Gt=function(Wt){var Zt=wt();try{vt&&hn();var nr=fn(et,Wt);return nr=vt?nr.finally(un):nr}finally{Zt&&lr()}}(Ut={subscr:Nt,signal:bt.signal,requery:jt,querier:et,trans:null}),Promise.resolve(Gt).then(function(Wt){lt=!0,it=Wt,It||Ut.signal.aborted||(Rt={},function(Zt){for(var nr in Zt)if(j(Zt,nr))return;return 1}(Lt=Nt)||kt||(Tn(Hn,Mt),kt=!0),vs(function(){return!It&&pt.next&&pt.next(Wt)}))},function(Wt){lt=!1,["DatabaseClosedError","AbortError"].includes(Wt==null?void 0:Wt.name)||It||vs(function(){It||pt.error&&pt.error(Wt)})}))};return setTimeout(jt,0),$t});return ht.hasValue=function(){return lt},ht.getValue=function(){return it},ht}var Cn=yn;function Gs(et){var it=xn;try{xn=!0,Tn.storagemutated.fire(et),Ns(et,!0)}finally{xn=it}}_e(Cn,o(o({},Yr),{delete:function(et){return new Cn(et,{addons:[]}).delete()},exists:function(et){return new Cn(et,{addons:[]}).open().then(function(it){return it.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(et){try{return it=Cn.dependencies,lt=it.indexedDB,it=it.IDBKeyRange,(Ps(lt)?Promise.resolve(lt.databases()).then(function(ht){return ht.map(function(pt){return pt.name}).filter(function(pt){return pt!==_i})}):Cs(lt,it).toCollection().primaryKeys()).then(et)}catch{return Kr(new yr.MissingAPI)}var it,lt},defineClass:function(){return function(et){_(this,et)}},ignoreTransaction:function(et){return dr.trans?wn(dr.transless,et):et()},vip:Ds,async:function(et){return function(){try{var it=$s(et.apply(this,arguments));return it&&typeof it.then=="function"?it:vr.resolve(it)}catch(lt){return Kr(lt)}}},spawn:function(et,it,lt){try{var ht=$s(et.apply(lt,it||[]));return ht&&typeof ht.then=="function"?ht:vr.resolve(ht)}catch(pt){return Kr(pt)}},currentTransaction:{get:function(){return dr.trans||null}},waitFor:function(et,it){return it=vr.resolve(typeof et=="function"?Cn.ignoreTransaction(et):et).timeout(it||6e4),dr.trans?dr.trans.waitFor(it):it},Promise:vr,debug:{get:function(){return Ur},set:function(et){xr(et)}},derive:nt,extend:_,props:_e,override:ut,Events:Vn,on:Tn,liveQuery:po,extendObservabilitySet:ds,getByKeyPath:Et,setByKeyPath:dt,delByKeyPath:function(et,it){typeof it=="string"?dt(et,it,void 0):"length"in it&&[].map.call(it,function(lt){dt(et,lt,void 0)})},shallowClone:gt,deepClone:Dt,getObjectDiff:Bs,cmp:Nr,asap:yt,minKey:-1/0,addons:[],connections:Fn,errnames:Fr,dependencies:gs,cache:Rn,semVer:"4.2.1",version:"4.2.1".split(".").map(function(et){return parseInt(et)}).reduce(function(et,it,lt){return et+it/Math.pow(10,2*lt)})})),Cn.maxKey=Kn(Cn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Tn(Hn,function(et){xn||(et=new CustomEvent(bs,{detail:et}),xn=!0,dispatchEvent(et),xn=!1)}),addEventListener(bs,function(et){et=et.detail,xn||Gs(et)}));var Bn,xn=!1,mo=function(){};return typeof BroadcastChannel<"u"&&((mo=function(){(Bn=new BroadcastChannel(bs)).onmessage=function(et){return et.data&&Gs(et.data)}})(),typeof Bn.unref=="function"&&Bn.unref(),Tn(Hn,function(et){xn||Bn.postMessage(et)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(et){if(!yn.disableBfCache&&et.persisted){Ur&&console.debug("Dexie: handling persisted pagehide"),Bn!=null&&Bn.close();for(var it=0,lt=Fn;it<lt.length;it++)lt[it].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(et){!yn.disableBfCache&&et.persisted&&(Ur&&console.debug("Dexie: handling persisted pageshow"),mo(),Gs({all:new en(-1/0,[[]])}))})),vr.rejectionMapper=function(et,it){return!et||et instanceof sr||et instanceof TypeError||et instanceof SyntaxError||!et.name||!qr[et.name]?et:(it=new qr[et.name](it||et.message,et),"stack"in et&&rt(it,"stack",{get:function(){return this.inner.stack}}),it)},xr(Ur),o(yn,Object.freeze({__proto__:null,Dexie:yn,liveQuery:po,Entity:qs,cmp:Nr,PropModification:jn,replacePrefix:function(et,it){return new jn({replacePrefix:[et,it]})},add:function(et){return new jn({add:et})},remove:function(et){return new jn({remove:et})},default:yn,RangeSet:en,mergeRanges:Yn,rangesOverlap:no}),{default:yn}),yn})})(dexie_min);var dexie_minExports=dexie_min.exports;const _Dexie=getDefaultExportFromCjs$1(dexie_minExports),DexieSymbol=Symbol.for("Dexie"),Dexie=globalThis[DexieSymbol]||(globalThis[DexieSymbol]=_Dexie);if(_Dexie.semVer!==Dexie.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${_Dexie.semVer} and ${Dexie.semVer}`);const{liveQuery,mergeRanges,rangesOverlap,RangeSet,cmp,Entity,PropModification,replacePrefix,add,remove,DexieYProvider}=Dexie,db=new Dexie("MusicDatabase");db.version(1).stores({songs:"++id, title, artist, album, duration, liked, fileHandle, [artist+album]",playlists:"++id, name",playlistSongs:"++id, playlistId, songId"});const usePlayerStore=create((a,e)=>({isPlaying:!1,currentSong:null,queue:[],currentIndex:-1,volume:1,duration:0,currentTime:0,isFullScreen:!1,currentView:"home",setCurrentView:s=>a({currentView:s}),setIsPlaying:s=>a({isPlaying:s}),playSong:(s,o=[])=>{const c=o.length>0?o:[s],d=c.findIndex(h=>h.id===s.id);a({currentSong:s,queue:c,currentIndex:d!==-1?d:0,isPlaying:!0})},nextSong:()=>{const{queue:s,currentIndex:o}=e();if(s.length===0)return;const c=(o+1)%s.length;a({currentSong:s[c],currentIndex:c})},prevSong:()=>{const{queue:s,currentIndex:o}=e();if(s.length===0)return;const c=(o-1+s.length)%s.length;a({currentSong:s[c],currentIndex:c})},updateCurrentSongMetadata:s=>a(o=>{if(!o.currentSong)return{};const c={...o.currentSong,...s},d=o.queue.map(h=>h.id===c.id?c:h);return db.songs.update(c.id,s).catch(h=>console.error("Failed to update DB",h)),{currentSong:c,queue:d}}),toggleLike:async s=>{if(!s)return;const o=!s.liked,c={...s,liked:o};await db.songs.update(s.id,{liked:o}),a(d=>{var _;const h=((_=d.currentSong)==null?void 0:_.id)===s.id,g=d.queue.map(b=>b.id===s.id?c:b);return{currentSong:h?c:d.currentSong,queue:g}}),useLibraryStore.setState(d=>({songs:d.songs.map(h=>h.id===s.id?c:h)}))},toggleFullScreen:()=>a(s=>({isFullScreen:!s.isFullScreen})),setVolume:s=>a({volume:s}),setCurrentTime:s=>a({currentTime:s}),setDuration:s=>a({duration:s})})),useLibraryStore=create(a=>({songs:[],isLoading:!1,loadSongs:async()=>{a({isLoading:!0});const e=await db.songs.toArray();a({songs:e,isLoading:!1})},addSongsToLibrary:async e=>{await db.songs.bulkAdd(e);const s=await db.songs.toArray();a({songs:s})}})),SidebarItem=({icon:a,label:e,active:s,onClick:o})=>jsxRuntimeExports.jsxs("div",{onClick:o,className:clsx("flex items-center gap-3 px-4 py-2 rounded-lg cursor-pointer transition-colors text-sm font-medium",s?"bg-white/10 text-white":"text-white/60 hover:text-white hover:bg-white/5"),children:[jsxRuntimeExports.jsx(a,{size:20}),jsxRuntimeExports.jsx("span",{children:e})]}),SidebarGroup=({title:a,children:e})=>jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[a&&jsxRuntimeExports.jsx("h3",{className:"px-4 mb-2 text-xs font-semibold text-white/40 uppercase tracking-wider",children:a}),jsxRuntimeExports.jsx("div",{className:"space-y-1",children:e})]}),Sidebar=()=>{const{currentView:a,setCurrentView:e}=usePlayerStore();return jsxRuntimeExports.jsxs("div",{className:"w-64 h-full bg-[#1c1c1e]/90 backdrop-blur-xl border-r border-white/10 flex flex-col p-4 pt-10",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[jsxRuntimeExports.jsx(Music,{className:"text-pink-500",size:32}),jsxRuntimeExports.jsx("span",{className:"text-xl font-bold",children:"Music"})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40",size:16}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search",className:"w-full bg-white/10 rounded-lg pl-10 pr-4 py-1.5 text-sm text-white placeholder-white/40 focus:outline-none focus:bg-white/20 transition-colors",onFocus:()=>e("home")})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[jsxRuntimeExports.jsxs(SidebarGroup,{children:[jsxRuntimeExports.jsx(SidebarItem,{icon:Home,label:"Search",active:a==="home",onClick:()=>e("home")}),jsxRuntimeExports.jsx(SidebarItem,{icon:Grid3x3,label:"Browse"}),jsxRuntimeExports.jsx(SidebarItem,{icon:Radio,label:"Radio",active:a==="radio",onClick:()=>e("radio")})]}),jsxRuntimeExports.jsxs(SidebarGroup,{title:"Library",children:[jsxRuntimeExports.jsx(SidebarItem,{icon:Clock,label:"Recently Added"}),jsxRuntimeExports.jsx(SidebarItem,{icon:Music,label:"Songs",active:a==="library",onClick:()=>e("library")}),jsxRuntimeExports.jsx(SidebarItem,{icon:PlaySquare,label:"Albums",active:a==="albums",onClick:()=>e("albums")}),jsxRuntimeExports.jsx(SidebarItem,{icon:Heart,label:"Artists"})]}),jsxRuntimeExports.jsxs(SidebarGroup,{title:"Playlists",children:[jsxRuntimeExports.jsx(SidebarItem,{icon:PlaySquare,label:"My Top Rated"}),jsxRuntimeExports.jsx(SidebarItem,{icon:PlaySquare,label:"Workout Mix"})]})]})]})};var lib$3={},browser$2={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var a=1e3,e=a*60,s=e*60,o=s*24,c=o*7,d=o*365.25;ms=function($,j){j=j||{};var _e=typeof $;if(_e==="string"&&$.length>0)return h($);if(_e==="number"&&isFinite($))return j.long?_($):g($);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify($))};function h($){if($=String($),!($.length>100)){var j=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec($);if(j){var _e=parseFloat(j[1]),tt=(j[2]||"ms").toLowerCase();switch(tt){case"years":case"year":case"yrs":case"yr":case"y":return _e*d;case"weeks":case"week":case"w":return _e*c;case"days":case"day":case"d":return _e*o;case"hours":case"hour":case"hrs":case"hr":case"h":return _e*s;case"minutes":case"minute":case"mins":case"min":case"m":return _e*e;case"seconds":case"second":case"secs":case"sec":case"s":return _e*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _e;default:return}}}}function g($){var j=Math.abs($);return j>=o?Math.round($/o)+"d":j>=s?Math.round($/s)+"h":j>=e?Math.round($/e)+"m":j>=a?Math.round($/a)+"s":$+"ms"}function _($){var j=Math.abs($);return j>=o?b($,j,o,"day"):j>=s?b($,j,s,"hour"):j>=e?b($,j,e,"minute"):j>=a?b($,j,a,"second"):$+" ms"}function b($,j,_e,tt){var rt=j>=_e*1.5;return Math.round($/_e)+" "+tt+(rt?"s":"")}return ms}function setup(a){s.debug=s,s.default=s,s.coerce=_,s.disable=h,s.enable=c,s.enabled=g,s.humanize=requireMs(),s.destroy=b,Object.keys(a).forEach($=>{s[$]=a[$]}),s.names=[],s.skips=[],s.formatters={};function e($){let j=0;for(let _e=0;_e<$.length;_e++)j=(j<<5)-j+$.charCodeAt(_e),j|=0;return s.colors[Math.abs(j)%s.colors.length]}s.selectColor=e;function s($){let j,_e=null,tt,rt;function nt(...st){if(!nt.enabled)return;const at=nt,ot=Number(new Date),ut=ot-(j||ot);at.diff=ut,at.prev=j,at.curr=ot,j=ot,st[0]=s.coerce(st[0]),typeof st[0]!="string"&&st.unshift("%O");let mt=0;st[0]=st[0].replace(/%([a-zA-Z%])/g,(Et,dt)=>{if(Et==="%%")return"%";mt++;const gt=s.formatters[dt];if(typeof gt=="function"){const St=st[mt];Et=gt.call(at,St),st.splice(mt,1),mt--}return Et}),s.formatArgs.call(at,st),(at.log||s.log).apply(at,st)}return nt.namespace=$,nt.useColors=s.useColors(),nt.color=s.selectColor($),nt.extend=o,nt.destroy=s.destroy,Object.defineProperty(nt,"enabled",{enumerable:!0,configurable:!1,get:()=>_e!==null?_e:(tt!==s.namespaces&&(tt=s.namespaces,rt=s.enabled($)),rt),set:st=>{_e=st}}),typeof s.init=="function"&&s.init(nt),nt}function o($,j){const _e=s(this.namespace+(typeof j>"u"?":":j)+$);return _e.log=this.log,_e}function c($){s.save($),s.namespaces=$,s.names=[],s.skips=[];const j=(typeof $=="string"?$:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const _e of j)_e[0]==="-"?s.skips.push(_e.slice(1)):s.names.push(_e)}function d($,j){let _e=0,tt=0,rt=-1,nt=0;for(;_e<$.length;)if(tt<j.length&&(j[tt]===$[_e]||j[tt]==="*"))j[tt]==="*"?(rt=tt,nt=_e,tt++):(_e++,tt++);else if(rt!==-1)tt=rt+1,nt++,_e=nt;else return!1;for(;tt<j.length&&j[tt]==="*";)tt++;return tt===j.length}function h(){const $=[...s.names,...s.skips.map(j=>"-"+j)].join(",");return s.enable(""),$}function g($){for(const j of s.skips)if(d($,j))return!1;for(const j of s.names)if(d($,j))return!0;return!1}function _($){return $ instanceof Error?$.stack||$.message:$}function b(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}var common$3=setup;(function(a,e){var s={};e.formatArgs=c,e.save=d,e.load=h,e.useColors=o,e.storage=g(),e.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function o(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let b;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(b[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function c(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+a.exports.humanize(this.diff),!this.useColors)return;const $="color: "+this.color;b.splice(1,0,$,"color: inherit");let j=0,_e=0;b[0].replace(/%[a-zA-Z%]/g,tt=>{tt!=="%%"&&(j++,tt==="%c"&&(_e=j))}),b.splice(_e,0,$)}e.log=console.debug||console.log||(()=>{});function d(b){try{b?e.storage.setItem("debug",b):e.storage.removeItem("debug")}catch{}}function h(){let b;try{b=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=s.DEBUG),b}function g(){try{return localStorage}catch{}}a.exports=common$3(e);const{formatters:_}=a.exports;_.j=function(b){try{return JSON.stringify(b)}catch($){return"[UnexpectedJSONParseError]: "+$.message}}})(browser$2,browser$2.exports);var browserExports$1=browser$2.exports,core$2={},core$1={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib$2={},EndOfFileStream={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.EndOfStreamError=a.defaultMessages=void 0,a.defaultMessages="End-Of-Stream";class e extends Error{constructor(){super(a.defaultMessages)}}a.EndOfStreamError=e})(EndOfFileStream);var StreamReader$1={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0});Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((e,s)=>{this.reject=s,this.resolve=e})}}Deferred$1.Deferred=Deferred;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.StreamReader=a.EndOfStreamError=void 0;const e=EndOfFileStream,s=Deferred$1;var o=EndOfFileStream;Object.defineProperty(a,"EndOfStreamError",{enumerable:!0,get:function(){return o.EndOfStreamError}});const c=1*1024*1024;class d{constructor(g){if(this.s=g,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!g.read||!g.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new e.EndOfStreamError)),this.s.once("error",_=>this.reject(_)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(g,_,b){const $=await this.read(g,_,b);return this.peekQueue.push(g.subarray(_,_+$)),$}async read(g,_,b){if(b===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new e.EndOfStreamError;let $=b,j=0;for(;this.peekQueue.length>0&&$>0;){const _e=this.peekQueue.pop();if(!_e)throw new Error("peekData should be defined");const tt=Math.min(_e.length,$);g.set(_e.subarray(0,tt),_+j),j+=tt,$-=tt,tt<_e.length&&this.peekQueue.push(_e.subarray(tt))}for(;$>0&&!this.endOfStream;){const _e=Math.min($,c),tt=await this.readFromStream(g,_+j,_e);if(j+=tt,tt<_e)break;$-=tt}return j}async readFromStream(g,_,b){const $=this.s.read(b);if($)return g.set($,_),$.length;{const j={buffer:g,offset:_,length:b,deferred:new s.Deferred};return this.deferred=j.deferred,this.s.once("readable",()=>{this.readDeferred(j)}),j.deferred.promise}}readDeferred(g){const _=this.s.read(g.length);_?(g.buffer.set(_,g.offset),g.deferred.resolve(_.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(g)})}reject(g){this.endOfStream=!0,this.deferred&&(this.deferred.reject(g),this.deferred=null)}}a.StreamReader=d})(StreamReader$1);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.StreamReader=a.EndOfStreamError=void 0;var e=EndOfFileStream;Object.defineProperty(a,"EndOfStreamError",{enumerable:!0,get:function(){return e.EndOfStreamError}});var s=StreamReader$1;Object.defineProperty(a,"StreamReader",{enumerable:!0,get:function(){return s.StreamReader}})})(lib$2);Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0});AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$2=lib$2;class AbstractTokenizer{constructor(e){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=e||{}}async readToken(e,s=this.position){const o=Buffer.alloc(e.len);if(await this.readBuffer(o,{position:s})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(o,0)}async peekToken(e,s=this.position){const o=Buffer.alloc(e.len);if(await this.peekBuffer(o,{position:s})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(o,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(this.numBuffer,0)}async ignore(e){if(this.fileInfo.size!==void 0){const s=this.fileInfo.size-this.position;if(e>s)return this.position+=s,s}return this.position+=e,e}async close(){}normalizeOptions(e,s){if(s&&s.position!==void 0&&s.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return s?{mayBeLess:s.mayBeLess===!0,offset:s.offset?s.offset:0,length:s.length?s.length:e.length-(s.offset?s.offset:0),position:s.position?s.position:this.position}:{mayBeLess:!1,offset:0,length:e.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer;Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0});ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib$2,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(e,s){super(s),this.streamReader=new peek_readable_1$1.StreamReader(e)}async getFileInfo(){return this.fileInfo}async readBuffer(e,s){const o=this.normalizeOptions(e,s),c=o.position-this.position;if(c>0)return await this.ignore(c),this.readBuffer(e,s);if(c<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(o.length===0)return 0;const d=await this.streamReader.read(e,o.offset,o.length);if(this.position+=d,(!s||!s.mayBeLess)&&d<o.length)throw new peek_readable_1$1.EndOfStreamError;return d}async peekBuffer(e,s){const o=this.normalizeOptions(e,s);let c=0;if(o.position){const d=o.position-this.position;if(d>0){const h=new Uint8Array(o.length+d);return c=await this.peekBuffer(h,{mayBeLess:o.mayBeLess}),e.set(h.subarray(d),o.offset),c-d}else if(d<0)throw new Error("Cannot peek from a negative offset in a stream")}if(o.length>0){try{c=await this.streamReader.peek(e,o.offset,o.length)}catch(d){if(s&&s.mayBeLess&&d instanceof peek_readable_1$1.EndOfStreamError)return 0;throw d}if(!o.mayBeLess&&c<o.length)throw new peek_readable_1$1.EndOfStreamError}return c}async ignore(e){const s=Math.min(maxBufferSize,e),o=new Uint8Array(s);let c=0;for(;c<e;){const d=e-c,h=await this.readBuffer(o,{length:Math.min(s,d)});if(h<0)return h;c+=h}return c}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0});BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1=lib$2,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(e,s){super(s),this.uint8Array=e,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:e.length}async readBuffer(e,s){if(s&&s.position){if(s.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=s.position}const o=await this.peekBuffer(e,s);return this.position+=o,o}async peekBuffer(e,s){const o=this.normalizeOptions(e,s),c=Math.min(this.uint8Array.length-o.position,o.length);if(!o.mayBeLess&&c<o.length)throw new peek_readable_1.EndOfStreamError;return e.set(this.uint8Array.subarray(o.position,o.position+c),o.offset),c}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.fromBuffer=a.fromStream=a.EndOfStreamError=void 0;const e=ReadStreamTokenizer$1,s=BufferTokenizer$1;var o=lib$2;Object.defineProperty(a,"EndOfStreamError",{enumerable:!0,get:function(){return o.EndOfStreamError}});function c(h,g){return g=g||{},new e.ReadStreamTokenizer(h,g)}a.fromStream=c;function d(h,g){return new s.BufferTokenizer(h,g)}a.fromBuffer=d})(core$1);var ParserFactory$1={},lib$1={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.AnsiStringType=a.StringType=a.BufferType=a.Uint8ArrayType=a.IgnoreType=a.Float80_LE=a.Float80_BE=a.Float64_LE=a.Float64_BE=a.Float32_LE=a.Float32_BE=a.Float16_LE=a.Float16_BE=a.INT64_BE=a.UINT64_BE=a.INT64_LE=a.UINT64_LE=a.INT32_LE=a.INT32_BE=a.INT24_BE=a.INT24_LE=a.INT16_LE=a.INT16_BE=a.INT8=a.UINT32_BE=a.UINT32_LE=a.UINT24_BE=a.UINT24_LE=a.UINT16_BE=a.UINT16_LE=a.UINT8=void 0;const e=ieee754;function s(_){return new DataView(_.buffer,_.byteOffset)}a.UINT8={len:1,get(_,b){return s(_).getUint8(b)},put(_,b,$){return s(_).setUint8(b,$),b+1}},a.UINT16_LE={len:2,get(_,b){return s(_).getUint16(b,!0)},put(_,b,$){return s(_).setUint16(b,$,!0),b+2}},a.UINT16_BE={len:2,get(_,b){return s(_).getUint16(b)},put(_,b,$){return s(_).setUint16(b,$),b+2}},a.UINT24_LE={len:3,get(_,b){const $=s(_);return $.getUint8(b)+($.getUint16(b+1,!0)<<8)},put(_,b,$){const j=s(_);return j.setUint8(b,$&255),j.setUint16(b+1,$>>8,!0),b+3}},a.UINT24_BE={len:3,get(_,b){const $=s(_);return($.getUint16(b)<<8)+$.getUint8(b+2)},put(_,b,$){const j=s(_);return j.setUint16(b,$>>8),j.setUint8(b+2,$&255),b+3}},a.UINT32_LE={len:4,get(_,b){return s(_).getUint32(b,!0)},put(_,b,$){return s(_).setUint32(b,$,!0),b+4}},a.UINT32_BE={len:4,get(_,b){return s(_).getUint32(b)},put(_,b,$){return s(_).setUint32(b,$),b+4}},a.INT8={len:1,get(_,b){return s(_).getInt8(b)},put(_,b,$){return s(_).setInt8(b,$),b+1}},a.INT16_BE={len:2,get(_,b){return s(_).getInt16(b)},put(_,b,$){return s(_).setInt16(b,$),b+2}},a.INT16_LE={len:2,get(_,b){return s(_).getInt16(b,!0)},put(_,b,$){return s(_).setInt16(b,$,!0),b+2}},a.INT24_LE={len:3,get(_,b){const $=a.UINT24_LE.get(_,b);return $>8388607?$-16777216:$},put(_,b,$){const j=s(_);return j.setUint8(b,$&255),j.setUint16(b+1,$>>8,!0),b+3}},a.INT24_BE={len:3,get(_,b){const $=a.UINT24_BE.get(_,b);return $>8388607?$-16777216:$},put(_,b,$){const j=s(_);return j.setUint16(b,$>>8),j.setUint8(b+2,$&255),b+3}},a.INT32_BE={len:4,get(_,b){return s(_).getInt32(b)},put(_,b,$){return s(_).setInt32(b,$),b+4}},a.INT32_LE={len:4,get(_,b){return s(_).getInt32(b,!0)},put(_,b,$){return s(_).setInt32(b,$,!0),b+4}},a.UINT64_LE={len:8,get(_,b){return s(_).getBigUint64(b,!0)},put(_,b,$){return s(_).setBigUint64(b,$,!0),b+8}},a.INT64_LE={len:8,get(_,b){return s(_).getBigInt64(b,!0)},put(_,b,$){return s(_).setBigInt64(b,$,!0),b+8}},a.UINT64_BE={len:8,get(_,b){return s(_).getBigUint64(b)},put(_,b,$){return s(_).setBigUint64(b,$),b+8}},a.INT64_BE={len:8,get(_,b){return s(_).getBigInt64(b)},put(_,b,$){return s(_).setBigInt64(b,$),b+8}},a.Float16_BE={len:2,get(_,b){return e.read(_,b,!1,10,this.len)},put(_,b,$){return e.write(_,$,b,!1,10,this.len),b+this.len}},a.Float16_LE={len:2,get(_,b){return e.read(_,b,!0,10,this.len)},put(_,b,$){return e.write(_,$,b,!0,10,this.len),b+this.len}},a.Float32_BE={len:4,get(_,b){return s(_).getFloat32(b)},put(_,b,$){return s(_).setFloat32(b,$),b+4}},a.Float32_LE={len:4,get(_,b){return s(_).getFloat32(b,!0)},put(_,b,$){return s(_).setFloat32(b,$,!0),b+4}},a.Float64_BE={len:8,get(_,b){return s(_).getFloat64(b)},put(_,b,$){return s(_).setFloat64(b,$),b+8}},a.Float64_LE={len:8,get(_,b){return s(_).getFloat64(b,!0)},put(_,b,$){return s(_).setFloat64(b,$,!0),b+8}},a.Float80_BE={len:10,get(_,b){return e.read(_,b,!1,63,this.len)},put(_,b,$){return e.write(_,$,b,!1,63,this.len),b+this.len}},a.Float80_LE={len:10,get(_,b){return e.read(_,b,!0,63,this.len)},put(_,b,$){return e.write(_,$,b,!0,63,this.len),b+this.len}};class o{constructor(b){this.len=b}get(b,$){}}a.IgnoreType=o;class c{constructor(b){this.len=b}get(b,$){return b.subarray($,$+this.len)}}a.Uint8ArrayType=c;class d{constructor(b){this.len=b}get(b,$){return Buffer.from(b.subarray($,$+this.len))}}a.BufferType=d;class h{constructor(b,$){this.len=b,this.encoding=$}get(b,$){return Buffer.from(b).toString(this.encoding,$,$+this.len)}}a.StringType=h;class g{constructor(b){this.len=b}static decode(b,$,j){let _e="";for(let tt=$;tt<j;++tt)_e+=g.codePointToString(g.singleByteDecoder(b[tt]));return _e}static inRange(b,$,j){return $<=b&&b<=j}static codePointToString(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}static singleByteDecoder(b){if(g.inRange(b,0,127))return b;const $=g.windows1252[b-128];if($===null)throw Error("invaliding encoding");return $}get(b,$=0){return g.decode(b,$,$+this.len)}}a.AnsiStringType=g,g.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib$1);var util$c={};util$c.stringToBytes=a=>[...a].map(e=>e.charCodeAt(0));util$c.tarHeaderChecksumMatches=(a,e=0)=>{const s=parseInt(a.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(s))return!1;let o=8*32;for(let c=e;c<e+148;c++)o+=a[c];for(let c=e+156;c<e+512;c++)o+=a[c];return s===o};util$c.uint32SyncSafeToken={get:(a,e)=>a[e+3]&127|a[e+2]<<7|a[e+1]<<14|a[e]<<21,len:4};var supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token$s=lib$1,strtok3$5=core$1,{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=util$c,supported=supported$1,minimumBytes=4100;async function fromStream(a){const e=await strtok3$5.fromStream(a);try{return await fromTokenizer(e)}finally{await e.close()}}async function fromBuffer(a){if(!(a instanceof Uint8Array||a instanceof ArrayBuffer||Buffer.isBuffer(a)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof a}\``);const e=a instanceof Buffer?a:Buffer.from(a);if(!(e&&e.length>1))return;const s=strtok3$5.fromBuffer(e);return fromTokenizer(s)}function _check(a,e,s){s={offset:0,...s};for(const[o,c]of e.entries())if(s.mask){if(c!==(s.mask[o]&a[o+s.offset]))return!1}else if(c!==a[o+s.offset])return!1;return!0}async function fromTokenizer(a){try{return _fromTokenizer(a)}catch(e){if(!(e instanceof strtok3$5.EndOfStreamError))throw e}}async function _fromTokenizer(a){let e=Buffer.alloc(minimumBytes);const s=12,o=(d,h)=>_check(e,d,h),c=(d,h)=>o(stringToBytes(d),h);if(a.fileInfo.size||(a.fileInfo.size=Number.MAX_SAFE_INTEGER),await a.peekBuffer(e,{length:s,mayBeLess:!0}),o([66,77]))return{ext:"bmp",mime:"image/bmp"};if(o([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(o([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(o([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(o([37,33]))return await a.peekBuffer(e,{length:24,mayBeLess:!0}),c("PS-Adobe-",{offset:2})&&c(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(o([31,160])||o([31,157]))return{ext:"Z",mime:"application/x-compress"};if(o([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(o([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(o([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(o([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(c("ID3")){await a.ignore(6);const d=await a.readToken(uint32SyncSafeToken);return a.position+d>a.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await a.ignore(d),fromTokenizer(a))}if(c("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((e[0]===67||e[0]===70)&&o([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(o([71,73,70]))return{ext:"gif",mime:"image/gif"};if(c("FLIF"))return{ext:"flif",mime:"image/flif"};if(c("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(c("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(c("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(c("FORM"))return{ext:"aif",mime:"audio/aiff"};if(c("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(o([80,75,3,4])){try{for(;a.position+30<a.fileInfo.size;){await a.readBuffer(e,{length:30});const d={compressedSize:e.readUInt32LE(18),uncompressedSize:e.readUInt32LE(22),filenameLength:e.readUInt16LE(26),extraFieldLength:e.readUInt16LE(28)};if(d.filename=await a.readToken(new Token$s.StringType(d.filenameLength,"utf-8")),await a.ignore(d.extraFieldLength),d.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(d.filename.endsWith(".rels")||d.filename.endsWith(".xml"))switch(d.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(d.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(d.filename.startsWith("3D/")&&d.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(d.filename==="mimetype"&&d.compressedSize===d.uncompressedSize)switch(await a.readToken(new Token$s.StringType(d.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if(d.compressedSize===0){let h=-1;for(;h<0&&a.position<a.fileInfo.size;)await a.peekBuffer(e,{mayBeLess:!0}),h=e.indexOf("504B0304",0,"hex"),await a.ignore(h>=0?h:e.length)}else await a.ignore(d.compressedSize)}}catch(d){if(!(d instanceof strtok3$5.EndOfStreamError))throw d}return{ext:"zip",mime:"application/zip"}}if(c("OggS")){await a.ignore(28);const d=Buffer.alloc(8);return await a.readBuffer(d),_check(d,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(d,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(d,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(d,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(d,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(d,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(o([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8))return{ext:"zip",mime:"application/zip"};if(c("ftyp",{offset:4})&&e[8]&96){const d=e.toString("binary",8,12).replace("\0"," ").trim();switch(d){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return d.startsWith("3g")?d.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(c("MThd"))return{ext:"mid",mime:"audio/midi"};if(c("wOFF")&&(o([0,1,0,0],{offset:4})||c("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(c("wOF2")&&(o([0,1,0,0],{offset:4})||c("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(o([212,195,178,161])||o([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(c("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(c("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(c("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(o([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(c("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(c("%PDF")){await a.ignore(1350);const d=10*1024*1024,h=Buffer.alloc(Math.min(d,a.fileInfo.size));return await a.readBuffer(h,{mayBeLess:!0}),h.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(o([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(o([73,73,42,0]))return c("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:o([28,0,254,0],{offset:8})||o([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:o([8,0,0,0],{offset:4})&&(o([45,0,254,0],{offset:8})||o([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(e=Buffer.alloc(24),await a.peekBuffer(e),(o([16,251,134,1],{offset:4})||o([8,0,0,0],{offset:4}))&&o([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(o([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(c("MAC "))return{ext:"ape",mime:"audio/ape"};if(o([26,69,223,163])){async function d(){const $=await a.peekNumber(Token$s.UINT8);let j=128,_e=0;for(;!($&j)&&j!==0;)++_e,j>>=1;const tt=Buffer.alloc(_e+1);return await a.readBuffer(tt),tt}async function h(){const $=await d(),j=await d();j[0]^=128>>j.length-1;const _e=Math.min(6,j.length);return{id:$.readUIntBE(0,$.length),len:j.readUIntBE(j.length-_e,_e)}}async function g($,j){for(;j>0;){const _e=await h();if(_e.id===17026)return a.readToken(new Token$s.StringType(_e.len,"utf-8"));await a.ignore(_e.len),--j}}const _=await h();switch(await g(1,_.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(o([82,73,70,70])){if(o([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(o([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(o([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(c("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(o([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(c("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(c("MSCF")||c("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(o([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(o([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(o([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(o([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(c("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(c("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(o([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(c("IMPM"))return{ext:"it",mime:"audio/x-it"};if(c("-lh0-",{offset:2})||c("-lh1-",{offset:2})||c("-lh2-",{offset:2})||c("-lh3-",{offset:2})||c("-lh4-",{offset:2})||c("-lh5-",{offset:2})||c("-lh6-",{offset:2})||c("-lh7-",{offset:2})||c("-lzs-",{offset:2})||c("-lz4-",{offset:2})||c("-lz5-",{offset:2})||c("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(o([0,0,1,186])){if(o([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(o([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(c("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(o([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(c("<?xml "))return{ext:"xml",mime:"application/xml"};if(o([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(o([82,97,114,33,26,7])&&(e[6]===0||e[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(c("solid "))return{ext:"stl",mime:"model/stl"};if(c("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(c("!<arch>"))return await a.ignore(8),await a.readToken(new Token$s.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(o([137,80,78,71,13,10,26,10])){await a.ignore(8);async function d(){return{length:await a.readToken(Token$s.INT32_BE),type:await a.readToken(new Token$s.StringType(4,"binary"))}}do{const h=await d();if(h.length<0)return;switch(h.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await a.ignore(h.length+4)}}while(a.position+8<a.fileInfo.size);return{ext:"png",mime:"image/png"}}if(o([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(o([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(o([102,114,101,101],{offset:4})||o([109,100,97,116],{offset:4})||o([109,111,111,118],{offset:4})||o([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(o([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(c("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(o([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(o([48,38,178,117,142,102,207,17,166,217])){async function d(){const h=Buffer.alloc(16);return await a.readBuffer(h),{id:h,size:Number(await a.readToken(Token$s.UINT64_LE))}}for(await a.ignore(30);a.position+24<a.fileInfo.size;){const h=await d();let g=h.size-24;if(_check(h.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const _=Buffer.alloc(16);if(g-=await a.readBuffer(_),_check(_,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(_,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await a.ignore(g)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(o([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((o([126,16,4])||o([126,24,4]))&&o([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(o([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(o([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await a.ignore(20),await a.readToken(new Token$s.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(o([255,10])||o([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(o([0,0,1,186])||o([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(o([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(o([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(o([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(o([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await a.peekBuffer(e,{length:Math.min(256,a.fileInfo.size),mayBeLess:!0}),c("BEGIN:")){if(c("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(c("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(c("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(c("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(c("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(o([4,0,0,0])&&e.length>=16){const d=e.readUInt32LE(12);if(d>12&&e.length>=d+16)try{const h=e.slice(16,d+16).toString();if(JSON.parse(h).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(o([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(c("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(o([71],{offset:4})&&(o([71],{offset:192})||o([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(o([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(o([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(o([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(o([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(o([76,80],{offset:34})&&(o([0,0,1],{offset:8})||o([1,0,2],{offset:8})||o([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(o([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await a.peekBuffer(e,{length:Math.min(512,a.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(e))return{ext:"tar",mime:"application/x-tar"};if(o([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(c("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(e.length>=2&&o([255,224],{offset:0,mask:[255,224]})){if(o([16],{offset:1,mask:[22]}))return o([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(o([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(o([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(o([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream$1=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const a=new stream.PassThrough;let e;stream.pipeline?e=stream.pipeline(readableStream,a,()=>{}):e=readableStream.pipe(a);const s=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const o=await fromBuffer(s);a.fileType=o}catch(o){reject(o)}resolve(e)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream:stream$1};Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}});Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}});var core=fileType,contentType={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var PARAM_REGEXP=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,TEXT_REGEXP=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,TOKEN_REGEXP=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,QESC_REGEXP=/\\([\u000b\u0020-\u00ff])/g,QUOTE_REGEXP=/([\\"])/g,TYPE_REGEXP$1=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;contentType.format=format$3;contentType.parse=parse$2;function format$3(a){if(!a||typeof a!="object")throw new TypeError("argument obj is required");var e=a.parameters,s=a.type;if(!s||!TYPE_REGEXP$1.test(s))throw new TypeError("invalid type");var o=s;if(e&&typeof e=="object")for(var c,d=Object.keys(e).sort(),h=0;h<d.length;h++){if(c=d[h],!TOKEN_REGEXP.test(c))throw new TypeError("invalid parameter name");o+="; "+c+"="+qstring(e[c])}return o}function parse$2(a){if(!a)throw new TypeError("argument string is required");var e=typeof a=="object"?getcontenttype(a):a;if(typeof e!="string")throw new TypeError("argument string is required to be a string");var s=e.indexOf(";"),o=s!==-1?e.slice(0,s).trim():e.trim();if(!TYPE_REGEXP$1.test(o))throw new TypeError("invalid media type");var c=new ContentType$1(o.toLowerCase());if(s!==-1){var d,h,g;for(PARAM_REGEXP.lastIndex=s;h=PARAM_REGEXP.exec(e);){if(h.index!==s)throw new TypeError("invalid parameter format");s+=h[0].length,d=h[1].toLowerCase(),g=h[2],g.charCodeAt(0)===34&&(g=g.slice(1,-1),g.indexOf("\\")!==-1&&(g=g.replace(QESC_REGEXP,"$1"))),c.parameters[d]=g}if(s!==e.length)throw new TypeError("invalid parameter format")}return c}function getcontenttype(a){var e;if(typeof a.getHeader=="function"?e=a.getHeader("content-type"):typeof a.headers=="object"&&(e=a.headers&&a.headers["content-type"]),typeof e!="string")throw new TypeError("content-type header is missing from object");return e}function qstring(a){var e=String(a);if(TOKEN_REGEXP.test(e))return e;if(e.length>0&&!TEXT_REGEXP.test(e))throw new TypeError("invalid parameter value");return'"'+e.replace(QUOTE_REGEXP,"\\$1")+'"'}function ContentType$1(a){this.parameters=Object.create(null),this.type=a}var mediaTyper={};/*!
 * media-typer
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var SUBTYPE_NAME_REGEXP=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,TYPE_NAME_REGEXP=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,TYPE_REGEXP=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;mediaTyper.format=format$2;mediaTyper.parse=parse$1;mediaTyper.test=test$1;function format$2(a){if(!a||typeof a!="object")throw new TypeError("argument obj is required");var e=a.subtype,s=a.suffix,o=a.type;if(!o||!TYPE_NAME_REGEXP.test(o))throw new TypeError("invalid type");if(!e||!SUBTYPE_NAME_REGEXP.test(e))throw new TypeError("invalid subtype");var c=o+"/"+e;if(s){if(!TYPE_NAME_REGEXP.test(s))throw new TypeError("invalid suffix");c+="+"+s}return c}function test$1(a){if(!a)throw new TypeError("argument string is required");if(typeof a!="string")throw new TypeError("argument string is required to be a string");return TYPE_REGEXP.test(a.toLowerCase())}function parse$1(a){if(!a)throw new TypeError("argument string is required");if(typeof a!="string")throw new TypeError("argument string is required to be a string");var e=TYPE_REGEXP.exec(a.toLowerCase());if(!e)throw new TypeError("invalid media type");var s=e[1],o=e[2],c,d=o.lastIndexOf("+");return d!==-1&&(c=o.substr(d+1),o=o.substr(0,d)),new MediaType(s,o,c)}function MediaType(a,e,s){this.type=a,this.subtype=e,this.suffix=s}var MetadataCollector$1={},type={},types={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.TrackType=a.TargetType=a.DataType=void 0,function(e){e[e.string=0]="string",e[e.uint=1]="uint",e[e.uid=2]="uid",e[e.bool=3]="bool",e[e.binary=4]="binary",e[e.float=5]="float"}(a.DataType||(a.DataType={})),function(e){e[e.shot=10]="shot",e[e.scene=20]="scene",e[e.track=30]="track",e[e.part=40]="part",e[e.album=50]="album",e[e.edition=60]="edition",e[e.collection=70]="collection"}(a.TargetType||(a.TargetType={})),function(e){e[e.video=1]="video",e[e.audio=2]="audio",e[e.complex=3]="complex",e[e.logo=4]="logo",e[e.subtitle=17]="subtitle",e[e.button=18]="button",e[e.control=32]="control"}(a.TrackType||(a.TrackType={}))})(types);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.TrackType=void 0;var e=types;Object.defineProperty(a,"TrackType",{enumerable:!0,get:function(){return e.TrackType}})})(type);var GenericTagTypes={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.isUnique=a.isSingleton=a.commonTags=void 0,a.commonTags={year:{multiple:!1},track:{multiple:!1},disk:{multiple:!1},title:{multiple:!1},artist:{multiple:!1},artists:{multiple:!0,unique:!0},albumartist:{multiple:!1},album:{multiple:!1},date:{multiple:!1},originaldate:{multiple:!1},originalyear:{multiple:!1},comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:{multiple:!1},subtitle:{multiple:!0},discsubtitle:{multiple:!1},totaltracks:{multiple:!1},totaldiscs:{multiple:!1},compilation:{multiple:!1},rating:{multiple:!0},bpm:{multiple:!1},mood:{multiple:!1},media:{multiple:!1},catalognumber:{multiple:!0,unique:!0},tvShow:{multiple:!1},tvShowSort:{multiple:!1},tvSeason:{multiple:!1},tvEpisode:{multiple:!1},tvEpisodeId:{multiple:!1},tvNetwork:{multiple:!1},podcast:{multiple:!1},podcasturl:{multiple:!1},releasestatus:{multiple:!1},releasetype:{multiple:!0},releasecountry:{multiple:!1},script:{multiple:!1},language:{multiple:!1},copyright:{multiple:!1},license:{multiple:!1},encodedby:{multiple:!1},encodersettings:{multiple:!1},gapless:{multiple:!1},barcode:{multiple:!1},isrc:{multiple:!0},asin:{multiple:!1},musicbrainz_recordingid:{multiple:!1},musicbrainz_trackid:{multiple:!1},musicbrainz_albumid:{multiple:!1},musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:{multiple:!1},musicbrainz_workid:{multiple:!1},musicbrainz_trmid:{multiple:!1},musicbrainz_discid:{multiple:!1},acoustid_id:{multiple:!1},acoustid_fingerprint:{multiple:!1},musicip_puid:{multiple:!1},musicip_fingerprint:{multiple:!1},website:{multiple:!1},"performer:instrument":{multiple:!0,unique:!0},averageLevel:{multiple:!1},peakLevel:{multiple:!1},notes:{multiple:!0,unique:!1},key:{multiple:!1},originalalbum:{multiple:!1},originalartist:{multiple:!1},discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:{multiple:!1},discogs_label_id:{multiple:!1},discogs_master_release_id:{multiple:!1},discogs_votes:{multiple:!1},discogs_rating:{multiple:!1},replaygain_track_peak:{multiple:!1},replaygain_track_gain:{multiple:!1},replaygain_album_peak:{multiple:!1},replaygain_album_gain:{multiple:!1},replaygain_track_minmax:{multiple:!1},replaygain_album_minmax:{multiple:!1},replaygain_undo:{multiple:!1},description:{multiple:!0},longDescription:{multiple:!1},category:{multiple:!0},hdVideo:{multiple:!1},keywords:{multiple:!0},movement:{multiple:!1},movementIndex:{multiple:!1},movementTotal:{multiple:!1},podcastId:{multiple:!1},showMovement:{multiple:!1},stik:{multiple:!1}};function e(o){return a.commonTags.hasOwnProperty(o)&&!a.commonTags[o].multiple}a.isSingleton=e;function s(o){return!a.commonTags[o].multiple||a.commonTags[o].unique}a.isUnique=s})(GenericTagTypes);var CombinedTagMapper$1={},ID3v1TagMap={},GenericTagMapper={};Object.defineProperty(GenericTagMapper,"__esModule",{value:!0});GenericTagMapper.CommonTagMapper=void 0;class CommonTagMapper{static toIntOrNull(e){const s=parseInt(e,10);return isNaN(s)?null:s}static normalizeTrack(e){const s=e.toString().split("/");return{no:parseInt(s[0],10)||null,of:parseInt(s[1],10)||null}}constructor(e,s){this.tagTypes=e,this.tagMap=s}mapGenericTag(e,s){e={id:e.id,value:e.value},this.postMap(e,s);const o=this.getCommonName(e.id);return o?{id:o,value:e.value}:null}getCommonName(e){return this.tagMap[e]}postMap(e,s){}}CommonTagMapper.maxRatingScore=1;GenericTagMapper.CommonTagMapper=CommonTagMapper;Object.defineProperty(ID3v1TagMap,"__esModule",{value:!0});ID3v1TagMap.ID3v1TagMapper=void 0;const GenericTagMapper_1$6=GenericTagMapper,id3v1TagMap={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class ID3v1TagMapper extends GenericTagMapper_1$6.CommonTagMapper{constructor(){super(["ID3v1"],id3v1TagMap)}}ID3v1TagMap.ID3v1TagMapper=ID3v1TagMapper;var ID3v24TagMapper$1={},CaseInsensitiveTagMap$1={};Object.defineProperty(CaseInsensitiveTagMap$1,"__esModule",{value:!0});CaseInsensitiveTagMap$1.CaseInsensitiveTagMap=void 0;const GenericTagMapper_1$5=GenericTagMapper;class CaseInsensitiveTagMap extends GenericTagMapper_1$5.CommonTagMapper{constructor(e,s){const o={};for(const c of Object.keys(s))o[c.toUpperCase()]=s[c];super(e,o)}getCommonName(e){return this.tagMap[e.toUpperCase()]}}CaseInsensitiveTagMap$1.CaseInsensitiveTagMap=CaseInsensitiveTagMap;var Util={};Object.defineProperty(Util,"__esModule",{value:!0});Util.toRatio=Util.dbToRatio=Util.ratioToDb=Util.a2hex=Util.isBitSet=Util.getBitAllignedNumber=Util.stripNulls=Util.decodeString=Util.trimRightNull=Util.findZero=Util.getBit=void 0;function getBit(a,e,s){return(a[e]&1<<s)!==0}Util.getBit=getBit;function findZero(a,e,s,o){let c=e;if(o==="utf16le"){for(;a[c]!==0||a[c+1]!==0;){if(c>=s)return s;c+=2}return c}else{for(;a[c]!==0;){if(c>=s)return s;c++}return c}}Util.findZero=findZero;function trimRightNull(a){const e=a.indexOf("\0");return e===-1?a:a.substr(0,e)}Util.trimRightNull=trimRightNull;function swapBytes(a){const e=a.length;if(e&1)throw new Error("Buffer length must be even");for(let s=0;s<e;s+=2){const o=a[s];a[s]=a[s+1],a[s+1]=o}return a}function decodeString(a,e){if(a[0]===255&&a[1]===254)return decodeString(a.subarray(2),e);if(e==="utf16le"&&a[0]===254&&a[1]===255){if(a.length&1)throw new Error("Expected even number of octets for 16-bit unicode string");return decodeString(swapBytes(a),e)}return Buffer.from(a).toString(e)}Util.decodeString=decodeString;function stripNulls(a){return a=a.replace(/^\x00+/g,""),a=a.replace(/\x00+$/g,""),a}Util.stripNulls=stripNulls;function getBitAllignedNumber(a,e,s,o){const c=e+~~(s/8),d=s%8;let h=a[c];h&=255>>d;const g=8-d,_=o-g;return _<0?h>>=8-d-o:_>0&&(h<<=_,h|=getBitAllignedNumber(a,e,s+g,_)),h}Util.getBitAllignedNumber=getBitAllignedNumber;function isBitSet(a,e,s){return getBitAllignedNumber(a,e,s,1)===1}Util.isBitSet=isBitSet;function a2hex(a){const e=[];for(let s=0,o=a.length;s<o;s++){const c=Number(a.charCodeAt(s)).toString(16);e.push(c.length===1?"0"+c:c)}return e.join(" ")}Util.a2hex=a2hex;function ratioToDb(a){return 10*Math.log10(a)}Util.ratioToDb=ratioToDb;function dbToRatio(a){return Math.pow(10,a/10)}Util.dbToRatio=dbToRatio;function toRatio(a){const e=a.split(" ").map(s=>s.trim().toLowerCase());if(e.length>=1){const s=parseFloat(e[0]);return e.length===2&&e[1]==="db"?{dB:s,ratio:dbToRatio(s)}:{dB:ratioToDb(s),ratio:s}}}Util.toRatio=toRatio;Object.defineProperty(ID3v24TagMapper$1,"__esModule",{value:!0});ID3v24TagMapper$1.ID3v24TagMapper=void 0;const GenericTagMapper_1$4=GenericTagMapper,CaseInsensitiveTagMap_1$2=CaseInsensitiveTagMap$1,util$b=Util,id3v24TagMap={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer","USLT:description":"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"date",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl"};class ID3v24TagMapper extends CaseInsensitiveTagMap_1$2.CaseInsensitiveTagMap{static toRating(e){return{source:e.email,rating:e.rating>0?(e.rating-1)/254*GenericTagMapper_1$4.CommonTagMapper.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],id3v24TagMap)}postMap(e,s){switch(e.id){case"UFID":e.value.owner_identifier==="http://musicbrainz.org"&&(e.id+=":"+e.value.owner_identifier,e.value=util$b.decodeString(e.value.identifier,"latin1"));break;case"PRIV":switch(e.value.owner_identifier){case"AverageLevel":case"PeakValue":e.id+=":"+e.value.owner_identifier,e.value=e.value.data.length===4?e.value.data.readUInt32LE(0):null,e.value===null&&s.addWarning("Failed to parse PRIV:PeakValue");break;default:s.addWarning(`Unknown PRIV owner-identifier: ${e.value.owner_identifier}`)}break;case"COMM":e.value=e.value?e.value.text:null;break;case"POPM":e.value=ID3v24TagMapper.toRating(e.value);break}}}ID3v24TagMapper$1.ID3v24TagMapper=ID3v24TagMapper;var AsfTagMapper$1={};Object.defineProperty(AsfTagMapper$1,"__esModule",{value:!0});AsfTagMapper$1.AsfTagMapper=void 0;const GenericTagMapper_1$3=GenericTagMapper,asfTagMap={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};class AsfTagMapper extends GenericTagMapper_1$3.CommonTagMapper{static toRating(e){return{rating:parseFloat(e+1)/5}}constructor(){super(["asf"],asfTagMap)}postMap(e){switch(e.id){case"WM/SharedUserRating":const s=e.id.split(":");e.value=AsfTagMapper.toRating(e.value),e.id=s[0];break}}}AsfTagMapper$1.AsfTagMapper=AsfTagMapper;var ID3v22TagMapper={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.ID3v22TagMapper=a.id3v22TagMap=void 0;const e=CaseInsensitiveTagMap$1;a.id3v22TagMap={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website","COM:iTunPGAP":"gapless",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class s extends e.CaseInsensitiveTagMap{constructor(){super(["ID3v2.2"],a.id3v22TagMap)}}a.ID3v22TagMapper=s})(ID3v22TagMapper);var APEv2TagMapper$1={};Object.defineProperty(APEv2TagMapper$1,"__esModule",{value:!0});APEv2TagMapper$1.APEv2TagMapper=void 0;const CaseInsensitiveTagMap_1$1=CaseInsensitiveTagMap$1,apev2TagMap={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};class APEv2TagMapper extends CaseInsensitiveTagMap_1$1.CaseInsensitiveTagMap{constructor(){super(["APEv2"],apev2TagMap)}}APEv2TagMapper$1.APEv2TagMapper=APEv2TagMapper;var MP4TagMapper={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.MP4TagMapper=a.tagType=void 0;const e=CaseInsensitiveTagMap$1,s={"nam":"title","ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","alb":"album","day":"date","cmt":"comment","com":"comment",trkn:"track",disk:"disk","gen":"genre",covr:"picture","wrt":"composer","lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear",desc:"description",ldes:"longDescription","mvn":"movement","mvi":"movementIndex","mvc":"movementTotal","wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};a.tagType="iTunes";class o extends e.CaseInsensitiveTagMap{constructor(){super([a.tagType],s)}postMap(d,h){switch(d.id){case"rate":d.value={source:void 0,rating:parseFloat(d.value)/100};break}}}a.MP4TagMapper=o})(MP4TagMapper);var VorbisTagMapper$1={};Object.defineProperty(VorbisTagMapper$1,"__esModule",{value:!0});VorbisTagMapper$1.VorbisTagMapper=void 0;const GenericTagMapper_1$2=GenericTagMapper,vorbisTagMap={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};class VorbisTagMapper extends GenericTagMapper_1$2.CommonTagMapper{static toRating(e,s,o){return{source:e&&e.toLowerCase(),rating:parseFloat(s)/o*GenericTagMapper_1$2.CommonTagMapper.maxRatingScore}}constructor(){super(["vorbis"],vorbisTagMap)}postMap(e){if(e.id==="RATING")e.value=VorbisTagMapper.toRating(void 0,e.value,100);else if(e.id.indexOf("RATING:")===0){const s=e.id.split(":");e.value=VorbisTagMapper.toRating(s[1],e.value,1),e.id=s[0]}}}VorbisTagMapper$1.VorbisTagMapper=VorbisTagMapper;var RiffInfoTagMap={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.RiffInfoTagMapper=a.riffInfoTagMap=void 0;const e=GenericTagMapper;a.riffInfoTagMap={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class s extends e.CommonTagMapper{constructor(){super(["exif"],a.riffInfoTagMap)}}a.RiffInfoTagMapper=s})(RiffInfoTagMap);var MatroskaTagMapper$1={};Object.defineProperty(MatroskaTagMapper$1,"__esModule",{value:!0});MatroskaTagMapper$1.MatroskaTagMapper=void 0;const CaseInsensitiveTagMap_1=CaseInsensitiveTagMap$1,ebmlTagMap={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};class MatroskaTagMapper extends CaseInsensitiveTagMap_1.CaseInsensitiveTagMap{constructor(){super(["matroska"],ebmlTagMap)}}MatroskaTagMapper$1.MatroskaTagMapper=MatroskaTagMapper;var AiffTagMap={};Object.defineProperty(AiffTagMap,"__esModule",{value:!0});AiffTagMap.AiffTagMapper=void 0;const GenericTagMapper_1$1=GenericTagMapper,tagMap={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class AiffTagMapper extends GenericTagMapper_1$1.CommonTagMapper{constructor(){super(["AIFF"],tagMap)}}AiffTagMap.AiffTagMapper=AiffTagMapper;Object.defineProperty(CombinedTagMapper$1,"__esModule",{value:!0});CombinedTagMapper$1.CombinedTagMapper=void 0;const ID3v1TagMap_1=ID3v1TagMap,ID3v24TagMapper_1=ID3v24TagMapper$1,AsfTagMapper_1=AsfTagMapper$1,ID3v22TagMapper_1=ID3v22TagMapper,APEv2TagMapper_1=APEv2TagMapper$1,MP4TagMapper_1=MP4TagMapper,VorbisTagMapper_1=VorbisTagMapper$1,RiffInfoTagMap_1=RiffInfoTagMap,MatroskaTagMapper_1=MatroskaTagMapper$1,AiffTagMap_1=AiffTagMap;class CombinedTagMapper{constructor(){this.tagMappers={},[new ID3v1TagMap_1.ID3v1TagMapper,new ID3v22TagMapper_1.ID3v22TagMapper,new ID3v24TagMapper_1.ID3v24TagMapper,new MP4TagMapper_1.MP4TagMapper,new MP4TagMapper_1.MP4TagMapper,new VorbisTagMapper_1.VorbisTagMapper,new APEv2TagMapper_1.APEv2TagMapper,new AsfTagMapper_1.AsfTagMapper,new RiffInfoTagMap_1.RiffInfoTagMapper,new MatroskaTagMapper_1.MatroskaTagMapper,new AiffTagMap_1.AiffTagMapper].forEach(e=>{this.registerTagMapper(e)})}mapTag(e,s,o){if(this.tagMappers[e])return this.tagMappers[e].mapGenericTag(s,o);throw new Error("No generic tag mapper defined for tag-format: "+e)}registerTagMapper(e){for(const s of e.tagTypes)this.tagMappers[s]=e}}CombinedTagMapper$1.CombinedTagMapper=CombinedTagMapper;Object.defineProperty(MetadataCollector$1,"__esModule",{value:!0});MetadataCollector$1.joinArtists=MetadataCollector$1.MetadataCollector=void 0;const type_1$2=type,debug_1$n=browserExports$1,GenericTagTypes_1=GenericTagTypes,CombinedTagMapper_1=CombinedTagMapper$1,GenericTagMapper_1=GenericTagMapper,Util_1$1=Util,FileType$1=core,debug$n=(0,debug_1$n.default)("music-metadata:collector"),TagPriority=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];class MetadataCollector{constructor(e){this.opts=e,this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new CombinedTagMapper_1.CombinedTagMapper;let s=1;for(const o of TagPriority)this.originPriority[o]=s++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(e){debug$n(`streamInfo: type=${type_1$2.TrackType[e.type]}, codec=${e.codecName}`),this.format.trackInfo.push(e)}setFormat(e,s){debug$n(`format: ${e} = ${s}`),this.format[e]=s,this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:e,value:s}})}addTag(e,s,o){debug$n(`tag ${e}.${s} = ${o}`),this.native[e]||(this.format.tagTypes.push(e),this.native[e]=[]),this.native[e].push({id:s,value:o}),this.toCommon(e,s,o)}addWarning(e){this.quality.warnings.push({message:e})}postMap(e,s){switch(s.id){case"artist":if(this.commonOrigin.artist===this.originPriority[e])return this.postMap("artificial",{id:"artists",value:s.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:s.value});break;case"artists":if((!this.common.artist||this.commonOrigin.artist===this.originPriority.artificial)&&(!this.common.artists||this.common.artists.indexOf(s.value)===-1)){const h=(this.common.artists||[]).concat([s.value]),_={id:"artist",value:joinArtists(h)};this.setGenericTag("artificial",_)}break;case"picture":this.postFixPicture(s.value).then(h=>{h!==null&&(s.value=h,this.setGenericTag(e,s))});return;case"totaltracks":this.common.track.of=GenericTagMapper_1.CommonTagMapper.toIntOrNull(s.value);return;case"totaldiscs":this.common.disk.of=GenericTagMapper_1.CommonTagMapper.toIntOrNull(s.value);return;case"movementTotal":this.common.movementIndex.of=GenericTagMapper_1.CommonTagMapper.toIntOrNull(s.value);return;case"track":case"disk":case"movementIndex":const o=this.common[s.id].of;this.common[s.id]=GenericTagMapper_1.CommonTagMapper.normalizeTrack(s.value),this.common[s.id].of=o??this.common[s.id].of;return;case"bpm":case"year":case"originalyear":s.value=parseInt(s.value,10);break;case"date":const c=parseInt(s.value.substr(0,4),10);isNaN(c)||(this.common.year=c);break;case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":s.value=typeof s.value=="string"?parseInt(s.value,10):s.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":s.value=(0,Util_1$1.toRatio)(s.value);break;case"replaygain_track_minmax":s.value=s.value.split(",").map(h=>parseInt(h,10));break;case"replaygain_undo":const d=s.value.split(",").map(h=>parseInt(h,10));s.value={leftChannel:d[0],rightChannel:d[1]};break;case"gapless":case"compilation":case"podcast":case"showMovement":s.value=s.value==="1"||s.value===1;break;case"isrc":if(this.common[s.id]&&this.common[s.id].indexOf(s.value)!==-1)return;break}s.value!==null&&this.setGenericTag(e,s)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(e){if(e.data&&e.data.length>0){if(!e.format){const s=await FileType$1.fromBuffer(e.data);if(s)e.format=s.mime;else return null}switch(e.format=e.format.toLocaleLowerCase(),e.format){case"image/jpg":e.format="image/jpeg"}return e}return this.addWarning("Empty picture tag found"),null}toCommon(e,s,o){const c={id:s,value:o},d=this.tagMapper.mapTag(e,c,this);d&&this.postMap(e,d)}setGenericTag(e,s){debug$n(`common.${s.id} = ${s.value}`);const o=this.commonOrigin[s.id]||1e3,c=this.originPriority[e];if((0,GenericTagTypes_1.isSingleton)(s.id))if(c<=o)this.common[s.id]=s.value,this.commonOrigin[s.id]=c;else return debug$n(`Ignore native tag (singleton): ${e}.${s.id} = ${s.value}`);else if(c===o)!(0,GenericTagTypes_1.isUnique)(s.id)||this.common[s.id].indexOf(s.value)===-1?this.common[s.id].push(s.value):debug$n(`Ignore duplicate value: ${e}.${s.id} = ${s.value}`);else if(c<o)this.common[s.id]=[s.value],this.commonOrigin[s.id]=c;else return debug$n(`Ignore native tag (list): ${e}.${s.id} = ${s.value}`);this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:s.id,value:s.value}})}}MetadataCollector$1.MetadataCollector=MetadataCollector;function joinArtists(a){return a.length>2?a.slice(0,a.length-1).join(", ")+" & "+a[a.length-1]:a.join(" & ")}MetadataCollector$1.joinArtists=joinArtists;var AiffParser={},ID3v2Parser$1={},FrameParser$1={},ID3v2Token={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.TextEncodingToken=a.ExtendedHeader=a.ID3v2Header=a.UINT32SYNCSAFE=a.AttachedPictureType=void 0;const e=lib$1,s=Util;(function(o){o[o.Other=0]="Other",o[o["32x32 pixels 'file icon' (PNG only)"]=1]="32x32 pixels 'file icon' (PNG only)",o[o["Other file icon"]=2]="Other file icon",o[o["Cover (front)"]=3]="Cover (front)",o[o["Cover (back)"]=4]="Cover (back)",o[o["Leaflet page"]=5]="Leaflet page",o[o["Media (e.g. label side of CD)"]=6]="Media (e.g. label side of CD)",o[o["Lead artist/lead performer/soloist"]=7]="Lead artist/lead performer/soloist",o[o["Artist/performer"]=8]="Artist/performer",o[o.Conductor=9]="Conductor",o[o["Band/Orchestra"]=10]="Band/Orchestra",o[o.Composer=11]="Composer",o[o["Lyricist/text writer"]=12]="Lyricist/text writer",o[o["Recording Location"]=13]="Recording Location",o[o["During recording"]=14]="During recording",o[o["During performance"]=15]="During performance",o[o["Movie/video screen capture"]=16]="Movie/video screen capture",o[o["A bright coloured fish"]=17]="A bright coloured fish",o[o.Illustration=18]="Illustration",o[o["Band/artist logotype"]=19]="Band/artist logotype",o[o["Publisher/Studio logotype"]=20]="Publisher/Studio logotype"})(a.AttachedPictureType||(a.AttachedPictureType={})),a.UINT32SYNCSAFE={get:(o,c)=>o[c+3]&127|o[c+2]<<7|o[c+1]<<14|o[c]<<21,len:4},a.ID3v2Header={len:10,get:(o,c)=>({fileIdentifier:new e.StringType(3,"ascii").get(o,c),version:{major:e.INT8.get(o,c+3),revision:e.INT8.get(o,c+4)},flags:{unsynchronisation:s.getBit(o,c+5,7),isExtendedHeader:s.getBit(o,c+5,6),expIndicator:s.getBit(o,c+5,5),footer:s.getBit(o,c+5,4)},size:a.UINT32SYNCSAFE.get(o,c+6)})},a.ExtendedHeader={len:10,get:(o,c)=>({size:e.UINT32_BE.get(o,c),extendedFlags:e.UINT16_BE.get(o,c+4),sizeOfPadding:e.UINT32_BE.get(o,c+6),crcDataPresent:s.getBit(o,c+4,31)})},a.TextEncodingToken={len:1,get:(o,c)=>{switch(o[c]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf16le",bom:!0};case 2:return{encoding:"utf16le",bom:!1};case 3:return{encoding:"utf8",bom:!1};default:return{encoding:"utf8",bom:!1}}}}})(ID3v2Token);var ID3v1Parser={},BasicParser$1={};Object.defineProperty(BasicParser$1,"__esModule",{value:!0});BasicParser$1.BasicParser=void 0;class BasicParser{init(e,s,o){return this.metadata=e,this.tokenizer=s,this.options=o,this}}BasicParser$1.BasicParser=BasicParser;var APEv2Parser$1={},APEv2Token={},FourCC={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.FourCcToken=void 0;const e=Util,s=/^[\x21-\x7e][\x20-\x7e\x00()]{3}/;a.FourCcToken={len:4,get:(o,c)=>{const d=o.toString("binary",c,c+a.FourCcToken.len);if(!d.match(s))throw new Error(`FourCC contains invalid characters: ${e.a2hex(d)} "${d}"`);return d},put:(o,c,d)=>{const h=Buffer.from(d,"binary");if(h.length!==4)throw new Error("Invalid length");return h.copy(o,c)}}})(FourCC);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.isBitSet=a.parseTagFlags=a.TagField=a.TagItemHeader=a.TagFooter=a.Header=a.DescriptorParser=a.DataType=void 0;const e=lib$1,s=FourCC;(function(h){h[h.text_utf8=0]="text_utf8",h[h.binary=1]="binary",h[h.external_info=2]="external_info",h[h.reserved=3]="reserved"})(a.DataType||(a.DataType={})),a.DescriptorParser={len:52,get:(h,g)=>({ID:s.FourCcToken.get(h,g),version:e.UINT32_LE.get(h,g+4)/1e3,descriptorBytes:e.UINT32_LE.get(h,g+8),headerBytes:e.UINT32_LE.get(h,g+12),seekTableBytes:e.UINT32_LE.get(h,g+16),headerDataBytes:e.UINT32_LE.get(h,g+20),apeFrameDataBytes:e.UINT32_LE.get(h,g+24),apeFrameDataBytesHigh:e.UINT32_LE.get(h,g+28),terminatingDataBytes:e.UINT32_LE.get(h,g+32),fileMD5:new e.Uint8ArrayType(16).get(h,g+36)})},a.Header={len:24,get:(h,g)=>({compressionLevel:e.UINT16_LE.get(h,g),formatFlags:e.UINT16_LE.get(h,g+2),blocksPerFrame:e.UINT32_LE.get(h,g+4),finalFrameBlocks:e.UINT32_LE.get(h,g+8),totalFrames:e.UINT32_LE.get(h,g+12),bitsPerSample:e.UINT16_LE.get(h,g+16),channel:e.UINT16_LE.get(h,g+18),sampleRate:e.UINT32_LE.get(h,g+20)})},a.TagFooter={len:32,get:(h,g)=>({ID:new e.StringType(8,"ascii").get(h,g),version:e.UINT32_LE.get(h,g+8),size:e.UINT32_LE.get(h,g+12),fields:e.UINT32_LE.get(h,g+16),flags:c(e.UINT32_LE.get(h,g+20))})},a.TagItemHeader={len:8,get:(h,g)=>({size:e.UINT32_LE.get(h,g),flags:c(e.UINT32_LE.get(h,g+4))})};const o=h=>new e.Uint8ArrayType(h.size-a.TagFooter.len);a.TagField=o;function c(h){return{containsHeader:d(h,31),containsFooter:d(h,30),isHeader:d(h,31),readOnly:d(h,0),dataType:(h&6)>>1}}a.parseTagFlags=c;function d(h,g){return(h&1<<g)!==0}a.isBitSet=d})(APEv2Token);Object.defineProperty(APEv2Parser$1,"__esModule",{value:!0});APEv2Parser$1.APEv2Parser=void 0;const debug_1$m=browserExports$1,strtok3$4=core$1,token_types_1$2=lib$1,util$a=Util,BasicParser_1$b=BasicParser$1,APEv2Token_1=APEv2Token,debug$m=(0,debug_1$m.default)("music-metadata:parser:APEv2"),tagFormat$1="APEv2",preamble="APETAGEX";class APEv2Parser extends BasicParser_1$b.BasicParser{constructor(){super(...arguments),this.ape={}}static tryParseApeHeader(e,s,o){const c=new APEv2Parser;return c.init(e,s,o),c.tryParseApeHeader()}static calculateDuration(e){let s=e.totalFrames>1?e.blocksPerFrame*(e.totalFrames-1):0;return s+=e.finalFrameBlocks,s/e.sampleRate}static async findApeFooterOffset(e,s){const o=Buffer.alloc(APEv2Token_1.TagFooter.len);await e.randomRead(o,0,APEv2Token_1.TagFooter.len,s-APEv2Token_1.TagFooter.len);const c=APEv2Token_1.TagFooter.get(o,0);if(c.ID==="APETAGEX")return debug$m(`APE footer header at offset=${s}`),{footer:c,offset:s-c.size}}static parseTagFooter(e,s,o){const c=APEv2Token_1.TagFooter.get(s,s.length-APEv2Token_1.TagFooter.len);if(c.ID!==preamble)throw new Error("Unexpected APEv2 Footer ID preamble value.");strtok3$4.fromBuffer(s);const d=new APEv2Parser;return d.init(e,strtok3$4.fromBuffer(s),o),d.parseTags(c)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<APEv2Token_1.TagFooter.len){debug$m("No APEv2 header found, end-of-file reached");return}const e=await this.tokenizer.peekToken(APEv2Token_1.TagFooter);if(e.ID===preamble)return await this.tokenizer.ignore(APEv2Token_1.TagFooter.len),this.parseTags(e);if(debug$m(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const s=this.tokenizer.fileInfo.size-this.tokenizer.position,o=Buffer.alloc(s);return await this.tokenizer.readBuffer(o),APEv2Parser.parseTagFooter(this.metadata,o,this.options)}}async parse(){const e=await this.tokenizer.readToken(APEv2Token_1.DescriptorParser);if(e.ID!=="MAC ")throw new Error("Unexpected descriptor ID");this.ape.descriptor=e;const s=e.descriptorBytes-APEv2Token_1.DescriptorParser.len,o=await(s>0?this.parseDescriptorExpansion(s):this.parseHeader());return await this.tokenizer.ignore(o.forwardBytes),this.tryParseApeHeader()}async parseTags(e){const s=Buffer.alloc(256);let o=e.size-APEv2Token_1.TagFooter.len;debug$m(`Parse APE tags at offset=${this.tokenizer.position}, size=${o}`);for(let c=0;c<e.fields;c++){if(o<APEv2Token_1.TagItemHeader.len){this.metadata.addWarning(`APEv2 Tag-header: ${e.fields-c} items remaining, but no more tag data to read.`);break}const d=await this.tokenizer.readToken(APEv2Token_1.TagItemHeader);o-=APEv2Token_1.TagItemHeader.len+d.size,await this.tokenizer.peekBuffer(s,{length:Math.min(s.length,o)});let h=util$a.findZero(s,0,s.length);const g=await this.tokenizer.readToken(new token_types_1$2.StringType(h,"ascii"));switch(await this.tokenizer.ignore(1),o-=g.length+1,d.flags.dataType){case APEv2Token_1.DataType.text_utf8:{const b=(await this.tokenizer.readToken(new token_types_1$2.StringType(d.size,"utf8"))).split(/\x00/g);for(const $ of b)this.metadata.addTag(tagFormat$1,g,$);break}case APEv2Token_1.DataType.binary:if(this.options.skipCovers)await this.tokenizer.ignore(d.size);else{const _=Buffer.alloc(d.size);await this.tokenizer.readBuffer(_),h=util$a.findZero(_,0,_.length);const b=_.toString("utf8",0,h),$=Buffer.from(_.slice(h+1));this.metadata.addTag(tagFormat$1,g,{description:b,data:$})}break;case APEv2Token_1.DataType.external_info:debug$m(`Ignore external info ${g}`),await this.tokenizer.ignore(d.size);break;case APEv2Token_1.DataType.reserved:debug$m(`Ignore external info ${g}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${g}"`),await this.tokenizer.ignore(d.size);break}}}async parseDescriptorExpansion(e){return await this.tokenizer.ignore(e),this.parseHeader()}async parseHeader(){const e=await this.tokenizer.readToken(APEv2Token_1.Header);return this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("numberOfChannels",e.channel),this.metadata.setFormat("duration",APEv2Parser.calculateDuration(e)),{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}}APEv2Parser$1.APEv2Parser=APEv2Parser;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.hasID3v1Header=a.ID3v1Parser=a.Genres=void 0;const e=browserExports$1,s=lib$1,o=Util,c=BasicParser$1,d=APEv2Parser$1,h=(0,e.default)("music-metadata:parser:ID3v1");a.Genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"];const g={len:128,get:(j,_e)=>{const tt=new _(3).get(j,_e);return tt==="TAG"?{header:tt,title:new _(30).get(j,_e+3),artist:new _(30).get(j,_e+33),album:new _(30).get(j,_e+63),year:new _(4).get(j,_e+93),comment:new _(28).get(j,_e+97),zeroByte:s.UINT8.get(j,_e+127),track:s.UINT8.get(j,_e+126),genre:s.UINT8.get(j,_e+127)}:null}};class _ extends s.StringType{constructor(_e){super(_e,"binary")}get(_e,tt){let rt=super.get(_e,tt);return rt=o.trimRightNull(rt),rt=rt.trim(),rt.length>0?rt:void 0}}class b extends c.BasicParser{static getGenre(_e){if(_e<a.Genres.length)return a.Genres[_e]}async parse(){if(!this.tokenizer.fileInfo.size){h("Skip checking for ID3v1 because the file-size is unknown");return}if(this.options.apeHeader){this.tokenizer.ignore(this.options.apeHeader.offset-this.tokenizer.position);const rt=new d.APEv2Parser;rt.init(this.metadata,this.tokenizer,this.options),await rt.parseTags(this.options.apeHeader.footer)}const _e=this.tokenizer.fileInfo.size-g.len;if(this.tokenizer.position>_e){h("Already consumed the last 128 bytes");return}const tt=await this.tokenizer.readToken(g,_e);if(tt){h("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-g.len);for(const nt of["title","artist","album","comment","track","year"])tt[nt]&&tt[nt]!==""&&this.addTag(nt,tt[nt]);const rt=b.getGenre(tt.genre);rt&&this.addTag("genre",rt)}else h("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-g.len)}addTag(_e,tt){this.metadata.addTag("ID3v1",_e,tt)}}a.ID3v1Parser=b;async function $(j){if(j.fileSize>=128){const _e=Buffer.alloc(3);return await j.randomRead(_e,0,_e.length,j.fileSize-128),_e.toString("binary")==="TAG"}return!1}a.hasID3v1Header=$})(ID3v1Parser);Object.defineProperty(FrameParser$1,"__esModule",{value:!0});FrameParser$1.FrameParser=FrameParser$1.parseGenre=void 0;const debug_1$l=browserExports$1,Token$r=lib$1,util$9=Util,ID3v2Token_1$3=ID3v2Token,ID3v1Parser_1$3=ID3v1Parser,debug$l=(0,debug_1$l.default)("music-metadata:id3v2:frame-parser"),defaultEnc="latin1";function parseGenre(a){const e=[];let s,o="";for(const c of a)if(typeof s=="string")if(c==="("&&s==="")o+="(",s=void 0;else if(c===")"){o!==""&&(e.push(o),o="");const d=parseGenreCode(s);d&&e.push(d),s=void 0}else s+=c;else c==="("?s="":o+=c;return o&&(e.length===0&&o.match(/^\d*$/)&&(o=ID3v1Parser_1$3.Genres[o]),e.push(o)),e}FrameParser$1.parseGenre=parseGenre;function parseGenreCode(a){if(a==="RX")return"Remix";if(a==="CR")return"Cover";if(a.match(/^\d*$/))return ID3v1Parser_1$3.Genres[a]}class FrameParser{constructor(e,s){this.major=e,this.warningCollector=s}readData(e,s,o){if(e.length===0){this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${s}`);return}const{encoding:c,bom:d}=ID3v2Token_1$3.TextEncodingToken.get(e,0),h=e.length;let g=0,_=[];const b=FrameParser.getNullTerminatorLength(c);let $;const j={};switch(debug$l(`Parsing tag type=${s}, encoding=${c}, bom=${d}`),s!=="TXXX"&&s[0]==="T"?"T*":s){case"T*":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":let _e;try{_e=util$9.decodeString(e.slice(1),c).replace(/\x00+$/,"")}catch(nt){this.warningCollector.addWarning(`id3v2.${this.major} type=${s} header has invalid string value: ${nt.message}`)}switch(s){case"TMCL":case"TIPL":case"IPLS":_=this.splitValue(s,_e),_=FrameParser.functionList(_);break;case"TRK":case"TRCK":case"TPOS":_=_e;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":_=this.splitValue(s,_e);break;case"TCO":case"TCON":_=this.splitValue(s,_e).map(nt=>parseGenre(nt)).reduce((nt,st)=>nt.concat(st),[]);break;case"PCS":case"PCST":_=this.major>=4?this.splitValue(s,_e):[_e],_=Array.isArray(_)&&_[0]===""?1:0;break;default:_=this.major>=4?this.splitValue(s,_e):[_e]}break;case"TXXX":_=FrameParser.readIdentifierAndData(e,g+1,h,c),_={description:_.id,text:this.splitValue(s,util$9.decodeString(_.data,c).replace(/\x00+$/,""))};break;case"PIC":case"APIC":if(o){const nt={};switch(g+=1,this.major){case 2:nt.format=util$9.decodeString(e.slice(g,g+3),"latin1"),g+=3;break;case 3:case 4:$=util$9.findZero(e,g,h,defaultEnc),nt.format=util$9.decodeString(e.slice(g,$),defaultEnc),g=$+1;break;default:throw new Error("Warning: unexpected major versionIndex: "+this.major)}nt.format=FrameParser.fixPictureMimeType(nt.format),nt.type=ID3v2Token_1$3.AttachedPictureType[e[g]],g+=1,$=util$9.findZero(e,g,h,c),nt.description=util$9.decodeString(e.slice(g,$),c),g=$+b,nt.data=Buffer.from(e.slice(g,h)),_=nt}break;case"CNT":case"PCNT":_=Token$r.UINT32_BE.get(e,0);break;case"SYLT":for(g+=7,_=[];g<h;){const nt=e.slice(g,g=util$9.findZero(e,g,h,c));g+=5,_.push(util$9.decodeString(nt,c))}break;case"ULT":case"USLT":case"COM":case"COMM":g+=1,j.language=util$9.decodeString(e.slice(g,g+3),defaultEnc),g+=3,$=util$9.findZero(e,g,h,c),j.description=util$9.decodeString(e.slice(g,$),c),g=$+b,j.text=util$9.decodeString(e.slice(g,h),c).replace(/\x00+$/,""),_=[j];break;case"UFID":_=FrameParser.readIdentifierAndData(e,g,h,defaultEnc),_={owner_identifier:_.id,identifier:_.data};break;case"PRIV":_=FrameParser.readIdentifierAndData(e,g,h,defaultEnc),_={owner_identifier:_.id,data:_.data};break;case"POPM":$=util$9.findZero(e,g,h,defaultEnc);const tt=util$9.decodeString(e.slice(g,$),defaultEnc);g=$+1;const rt=h-g;_={email:tt,rating:Token$r.UINT8.get(e,g),counter:rt>=5?Token$r.UINT32_BE.get(e,g+1):void 0};break;case"GEOB":{$=util$9.findZero(e,g+1,h,c);const nt=util$9.decodeString(e.slice(g+1,$),defaultEnc);g=$+1,$=util$9.findZero(e,g,h-g,c);const st=util$9.decodeString(e.slice(g,$),defaultEnc);g=$+1,$=util$9.findZero(e,g,h-g,c);const at=util$9.decodeString(e.slice(g,$),defaultEnc);_={type:nt,filename:st,description:at,data:e.slice(g+1,h)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":_=util$9.decodeString(e.slice(g,$),defaultEnc);break;case"WXXX":{$=util$9.findZero(e,g+1,h,c);const nt=util$9.decodeString(e.slice(g+1,$),c);g=$+(c==="utf16le"?2:1),_={description:nt,url:util$9.decodeString(e.slice(g,h),defaultEnc)};break}case"WFD":case"WFED":_=util$9.decodeString(e.slice(g+1,util$9.findZero(e,g+1,h,c)),c);break;case"MCDI":{_=e.slice(0,h);break}default:debug$l("Warning: unsupported id3v2-tag-type: "+s);break}return _}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase(),e){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const s={};for(let o=0;o+1<e.length;o+=2){const c=e[o+1].split(",");s[e[o]]=s.hasOwnProperty(e[o])?s[e[o]].concat(c):c}return s}splitValue(e,s){let o;return this.major<4?(o=s.split(/\x00/g),o.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):o=s.split(/\//g)):o=s.split(/\x00/g),FrameParser.trimArray(o)}static trimArray(e){return e.map(s=>s.replace(/\x00+$/,"").trim())}static readIdentifierAndData(e,s,o,c){const d=util$9.findZero(e,s,o,c),h=util$9.decodeString(e.slice(s,d),c);return s=d+FrameParser.getNullTerminatorLength(c),{id:h,data:e.slice(s,o)}}static getNullTerminatorLength(e){return e==="utf16le"?2:1}}FrameParser$1.FrameParser=FrameParser;Object.defineProperty(ID3v2Parser$1,"__esModule",{value:!0});ID3v2Parser$1.ID3v2Parser=void 0;const Token$q=lib$1,util$8=Util,FrameParser_1=FrameParser$1,ID3v2Token_1$2=ID3v2Token;class ID3v2Parser{static removeUnsyncBytes(e){let s=0,o=0;for(;s<e.length-1;)s!==o&&(e[o]=e[s]),s+=e[s]===255&&e[s+1]===0?2:1,o++;return s<e.length&&(e[o++]=e[s]),e.slice(0,o)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw new Error("header versionIndex is incorrect")}}static readFrameFlags(e){return{status:{tag_alter_preservation:util$8.getBit(e,0,6),file_alter_preservation:util$8.getBit(e,0,5),read_only:util$8.getBit(e,0,4)},format:{grouping_identity:util$8.getBit(e,1,7),compression:util$8.getBit(e,1,3),encryption:util$8.getBit(e,1,2),unsynchronisation:util$8.getBit(e,1,1),data_length_indicator:util$8.getBit(e,1,0)}}}static readFrameData(e,s,o,c,d){const h=new FrameParser_1.FrameParser(o,d);switch(o){case 2:return h.readData(e,s.id,c);case 3:case 4:return s.flags.format.unsynchronisation&&(e=ID3v2Parser.removeUnsyncBytes(e)),s.flags.format.data_length_indicator&&(e=e.slice(4,e.length)),h.readData(e,s.id,c);default:throw new Error("Unexpected majorVer: "+o)}}static makeDescriptionTagName(e,s){return e+(s?":"+s:"")}async parse(e,s,o){this.tokenizer=s,this.metadata=e,this.options=o;const c=await this.tokenizer.readToken(ID3v2Token_1$2.ID3v2Header);if(c.fileIdentifier!=="ID3")throw new Error("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=c,this.headerType="ID3v2."+c.version.major,c.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(c.size)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(ID3v2Token_1$2.ExtendedHeader),s=e.size-ID3v2Token_1$2.ExtendedHeader.len;return s>0?this.parseExtendedHeaderData(s,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,s){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-s)}async parseId3Data(e){const s=await this.tokenizer.readToken(new Token$q.Uint8ArrayType(e));for(const o of this.parseMetadata(s))if(o.id==="TXXX"){if(o.value)for(const c of o.value.text)this.addTag(ID3v2Parser.makeDescriptionTagName(o.id,o.value.description),c)}else if(o.id==="COM")for(const c of o.value)this.addTag(ID3v2Parser.makeDescriptionTagName(o.id,c.description),c.text);else if(o.id==="COMM")for(const c of o.value)this.addTag(ID3v2Parser.makeDescriptionTagName(o.id,c.description),c);else if(Array.isArray(o.value))for(const c of o.value)this.addTag(o.id,c);else this.addTag(o.id,o.value)}addTag(e,s){this.metadata.addTag(this.headerType,e,s)}parseMetadata(e){let s=0;const o=[];for(;s!==e.length;){const c=ID3v2Parser.getFrameHeaderLength(this.id3Header.version.major);if(s+c>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const d=e.slice(s,s+=c),h=this.readFrameHeader(d,this.id3Header.version.major),g=e.slice(s,s+=h.length),_=ID3v2Parser.readFrameData(g,h,this.id3Header.version.major,!this.options.skipCovers,this.metadata);_&&o.push({id:h.id,value:_})}return o}readFrameHeader(e,s){let o;switch(s){case 2:o={id:Buffer.from(e.slice(0,3)).toString("ascii"),length:Token$q.UINT24_BE.get(e,3)},o.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${o.id}`);break;case 3:case 4:o={id:Buffer.from(e.slice(0,4)).toString("ascii"),length:(s===4?ID3v2Token_1$2.UINT32SYNCSAFE:Token$q.UINT32_BE).get(e,4),flags:ID3v2Parser.readFrameFlags(e.slice(8,10))},o.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${o.id}`);break;default:throw new Error("Unexpected majorVer: "+s)}return o}}ID3v2Parser$1.ID3v2Parser=ID3v2Parser;var AiffToken$1={};Object.defineProperty(AiffToken$1,"__esModule",{value:!0});AiffToken$1.Common=void 0;const Token$p=lib$1,FourCC_1$a=FourCC;class Common{constructor(e,s){this.isAifc=s;const o=s?22:18;if(e.chunkSize<o)throw new Error(`COMMON CHUNK size should always be at least ${o}`);this.len=e.chunkSize}get(e,s){const o=e.readUInt16BE(s+8)-16398,c=e.readUInt16BE(s+8+2),d={numChannels:e.readUInt16BE(s),numSampleFrames:e.readUInt32BE(s+2),sampleSize:e.readUInt16BE(s+6),sampleRate:o<0?c>>Math.abs(o):c<<o};if(this.isAifc){if(d.compressionType=FourCC_1$a.FourCcToken.get(e,s+18),this.len>22){const h=e.readInt8(s+22);if(h>0){const g=(h+1)%2;if(23+h+g===this.len)d.compressionName=new Token$p.StringType(h,"binary").get(e,s+23);else throw new Error("Illegal pstring length")}else d.compressionName=void 0}}else d.compressionName="PCM";return d}}AiffToken$1.Common=Common;var iff$1={};Object.defineProperty(iff$1,"__esModule",{value:!0});iff$1.Header=void 0;const Token$o=lib$1,FourCC_1$9=FourCC;iff$1.Header={len:8,get:(a,e)=>({chunkID:FourCC_1$9.FourCcToken.get(a,e),chunkSize:Number(BigInt(Token$o.UINT32_BE.get(a,e+4)))})};Object.defineProperty(AiffParser,"__esModule",{value:!0});AiffParser.AIFFParser=void 0;const Token$n=lib$1,debug_1$k=browserExports$1,strtok3$3=core$1,ID3v2Parser_1$4=ID3v2Parser$1,FourCC_1$8=FourCC,BasicParser_1$a=BasicParser$1,AiffToken=AiffToken$1,iff=iff$1,debug$k=(0,debug_1$k.default)("music-metadata:parser:aiff"),compressionTypes={NONE:"not compressed	PCM	Apple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float	Apple Computer",alaw:"ALaw 2:1	8-bit ITU-T G.711 A-law",ulaw:"Law 2:1	8-bit ITU-T G.711 -law	Apple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 -law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32	IEEE 32-bit float "};class AIFFParser extends BasicParser_1$a.BasicParser{async parse(){if((await this.tokenizer.readToken(iff.Header)).chunkID!=="FORM")throw new Error("Invalid Chunk-ID, expected 'FORM'");const s=await this.tokenizer.readToken(FourCC_1$8.FourCcToken);switch(s){case"AIFF":this.metadata.setFormat("container",s),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw Error("Unsupported AIFF type: "+s)}this.metadata.setFormat("lossless",!this.isCompressed);try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=iff.Header.len;){debug$k("Reading AIFF chunk at offset="+this.tokenizer.position);const o=await this.tokenizer.readToken(iff.Header),c=2*Math.round(o.chunkSize/2),d=await this.readData(o);await this.tokenizer.ignore(c-d)}}catch(o){if(o instanceof strtok3$3.EndOfStreamError)debug$k("End-of-stream");else throw o}}async readData(e){var s;switch(e.chunkID){case"COMM":const o=await this.tokenizer.readToken(new AiffToken.Common(e,this.isCompressed));return this.metadata.setFormat("bitsPerSample",o.sampleSize),this.metadata.setFormat("sampleRate",o.sampleRate),this.metadata.setFormat("numberOfChannels",o.numChannels),this.metadata.setFormat("numberOfSamples",o.numSampleFrames),this.metadata.setFormat("duration",o.numSampleFrames/o.sampleRate),this.metadata.setFormat("codec",(s=o.compressionName)!==null&&s!==void 0?s:compressionTypes[o.compressionType]),e.chunkSize;case"ID3 ":const c=await this.tokenizer.readToken(new Token$n.Uint8ArrayType(e.chunkSize)),d=strtok3$3.fromBuffer(c);return await new ID3v2Parser_1$4.ID3v2Parser().parse(this.metadata,d,this.options),e.chunkSize;case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*e.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(e);default:return debug$k(`Ignore chunk id=${e.chunkID}, size=${e.chunkSize}`),0}}async readTextChunk(e){return(await this.tokenizer.readToken(new Token$n.StringType(e.chunkSize,"ascii"))).split("\0").map(o=>o.trim()).filter(o=>o&&o.length>0).forEach(o=>{this.metadata.addTag("AIFF",e.chunkID,o.trim())}),e.chunkSize}}AiffParser.AIFFParser=AIFFParser;var AsfParser$1={},GUID$1={};Object.defineProperty(GUID$1,"__esModule",{value:!0});class GUID{static fromBin(e,s=0){return new GUID(this.decode(e,s))}static decode(e,s=0){return(e.readUInt32LE(s).toString(16)+"-"+e.readUInt16LE(s+4).toString(16)+"-"+e.readUInt16LE(s+6).toString(16)+"-"+e.readUInt16BE(s+8).toString(16)+"-"+e.slice(s+10,s+16).toString("hex")).toUpperCase()}static decodeMediaType(e){switch(e.str){case GUID.AudioMedia.str:return"audio";case GUID.VideoMedia.str:return"video";case GUID.CommandMedia.str:return"command";case GUID.Degradable_JPEG_Media.str:return"degradable-jpeg";case GUID.FileTransferMedia.str:return"file-transfer";case GUID.BinaryMedia.str:return"binary"}}static encode(e){const s=Buffer.alloc(16);return s.writeUInt32LE(parseInt(e.slice(0,8),16),0),s.writeUInt16LE(parseInt(e.slice(9,13),16),4),s.writeUInt16LE(parseInt(e.slice(14,18),16),6),Buffer.from(e.slice(19,23),"hex").copy(s,8),Buffer.from(e.slice(24),"hex").copy(s,10),s}constructor(e){this.str=e}equals(e){return this.str===e.str}toBin(){return GUID.encode(this.str)}}GUID.HeaderObject=new GUID("75B22630-668E-11CF-A6D9-00AA0062CE6C");GUID.DataObject=new GUID("75B22636-668E-11CF-A6D9-00AA0062CE6C");GUID.SimpleIndexObject=new GUID("33000890-E5B1-11CF-89F4-00A0C90349CB");GUID.IndexObject=new GUID("D6E229D3-35DA-11D1-9034-00A0C90349BE");GUID.MediaObjectIndexObject=new GUID("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C");GUID.TimecodeIndexObject=new GUID("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C");GUID.FilePropertiesObject=new GUID("8CABDCA1-A947-11CF-8EE4-00C00C205365");GUID.StreamPropertiesObject=new GUID("B7DC0791-A9B7-11CF-8EE6-00C00C205365");GUID.HeaderExtensionObject=new GUID("5FBF03B5-A92E-11CF-8EE3-00C00C205365");GUID.CodecListObject=new GUID("86D15240-311D-11D0-A3A4-00A0C90348F6");GUID.ScriptCommandObject=new GUID("1EFB1A30-0B62-11D0-A39B-00A0C90348F6");GUID.MarkerObject=new GUID("F487CD01-A951-11CF-8EE6-00C00C205365");GUID.BitrateMutualExclusionObject=new GUID("D6E229DC-35DA-11D1-9034-00A0C90349BE");GUID.ErrorCorrectionObject=new GUID("75B22635-668E-11CF-A6D9-00AA0062CE6C");GUID.ContentDescriptionObject=new GUID("75B22633-668E-11CF-A6D9-00AA0062CE6C");GUID.ExtendedContentDescriptionObject=new GUID("D2D0A440-E307-11D2-97F0-00A0C95EA850");GUID.ContentBrandingObject=new GUID("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E");GUID.StreamBitratePropertiesObject=new GUID("7BF875CE-468D-11D1-8D82-006097C9A2B2");GUID.ContentEncryptionObject=new GUID("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E");GUID.ExtendedContentEncryptionObject=new GUID("298AE614-2622-4C17-B935-DAE07EE9289C");GUID.DigitalSignatureObject=new GUID("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E");GUID.PaddingObject=new GUID("1806D474-CADF-4509-A4BA-9AABCB96AAE8");GUID.ExtendedStreamPropertiesObject=new GUID("14E6A5CB-C672-4332-8399-A96952065B5A");GUID.AdvancedMutualExclusionObject=new GUID("A08649CF-4775-4670-8A16-6E35357566CD");GUID.GroupMutualExclusionObject=new GUID("D1465A40-5A79-4338-B71B-E36B8FD6C249");GUID.StreamPrioritizationObject=new GUID("D4FED15B-88D3-454F-81F0-ED5C45999E24");GUID.BandwidthSharingObject=new GUID("A69609E6-517B-11D2-B6AF-00C04FD908E9");GUID.LanguageListObject=new GUID("7C4346A9-EFE0-4BFC-B229-393EDE415C85");GUID.MetadataObject=new GUID("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA");GUID.MetadataLibraryObject=new GUID("44231C94-9498-49D1-A141-1D134E457054");GUID.IndexParametersObject=new GUID("D6E229DF-35DA-11D1-9034-00A0C90349BE");GUID.MediaObjectIndexParametersObject=new GUID("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7");GUID.TimecodeIndexParametersObject=new GUID("F55E496D-9797-4B5D-8C8B-604DFE9BFB24");GUID.CompatibilityObject=new GUID("26F18B5D-4584-47EC-9F5F-0E651F0452C9");GUID.AdvancedContentEncryptionObject=new GUID("43058533-6981-49E6-9B74-AD12CB86D58C");GUID.AudioMedia=new GUID("F8699E40-5B4D-11CF-A8FD-00805F5C442B");GUID.VideoMedia=new GUID("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B");GUID.CommandMedia=new GUID("59DACFC0-59E6-11D0-A3AC-00A0C90348F6");GUID.JFIF_Media=new GUID("B61BE100-5B4E-11CF-A8FD-00805F5C442B");GUID.Degradable_JPEG_Media=new GUID("35907DE0-E415-11CF-A917-00805F5C442B");GUID.FileTransferMedia=new GUID("91BD222C-F21C-497A-8B6D-5AA86BFC0185");GUID.BinaryMedia=new GUID("3AFB65E2-47EF-40F2-AC2C-70A90D71D343");GUID.ASF_Index_Placeholder_Object=new GUID("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2");GUID$1.default=GUID;var AsfObject$1={},AsfUtil$1={};Object.defineProperty(AsfUtil$1,"__esModule",{value:!0});AsfUtil$1.AsfUtil=void 0;const Token$m=lib$1,util$7=Util;class AsfUtil{static getParserForAttr(e){return AsfUtil.attributeParsers[e]}static parseUnicodeAttr(e){return util$7.stripNulls(util$7.decodeString(e,"utf16le"))}static parseByteArrayAttr(e){return Buffer.from(e)}static parseBoolAttr(e,s=0){return AsfUtil.parseWordAttr(e,s)===1}static parseDWordAttr(e,s=0){return e.readUInt32LE(s)}static parseQWordAttr(e,s=0){return Token$m.UINT64_LE.get(e,s)}static parseWordAttr(e,s=0){return e.readUInt16LE(s)}}AsfUtil.attributeParsers=[AsfUtil.parseUnicodeAttr,AsfUtil.parseByteArrayAttr,AsfUtil.parseBoolAttr,AsfUtil.parseDWordAttr,AsfUtil.parseQWordAttr,AsfUtil.parseWordAttr,AsfUtil.parseByteArrayAttr];AsfUtil$1.AsfUtil=AsfUtil;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.WmPictureToken=a.MetadataLibraryObjectState=a.MetadataObjectState=a.ExtendedStreamPropertiesObjectState=a.ExtendedContentDescriptionObjectState=a.ContentDescriptionObjectState=a.readCodecEntries=a.HeaderExtensionObject=a.StreamPropertiesObject=a.FilePropertiesObject=a.IgnoreObjectState=a.State=a.HeaderObjectToken=a.TopLevelHeaderObjectToken=a.DataType=void 0;const e=Util,s=lib$1,o=GUID$1,c=AsfUtil$1,d=ID3v2Token;(function(Et){Et[Et.UnicodeString=0]="UnicodeString",Et[Et.ByteArray=1]="ByteArray",Et[Et.Bool=2]="Bool",Et[Et.DWord=3]="DWord",Et[Et.QWord=4]="QWord",Et[Et.Word=5]="Word"})(a.DataType||(a.DataType={})),a.TopLevelHeaderObjectToken={len:30,get:(Et,dt)=>({objectId:o.default.fromBin(new s.BufferType(16).get(Et,dt)),objectSize:Number(s.UINT64_LE.get(Et,dt+16)),numberOfHeaderObjects:s.UINT32_LE.get(Et,dt+24)})},a.HeaderObjectToken={len:24,get:(Et,dt)=>({objectId:o.default.fromBin(new s.BufferType(16).get(Et,dt)),objectSize:Number(s.UINT64_LE.get(Et,dt+16))})};class h{constructor(dt){this.len=Number(dt.objectSize)-a.HeaderObjectToken.len}postProcessTag(dt,gt,St,xt){if(gt==="WM/Picture")dt.push({id:gt,value:yt.fromBuffer(xt)});else{const Ct=c.AsfUtil.getParserForAttr(St);if(!Ct)throw new Error("unexpected value headerType: "+St);dt.push({id:gt,value:Ct(xt)})}}}a.State=h;class g extends h{constructor(dt){super(dt)}get(dt,gt){return null}}a.IgnoreObjectState=g;class _ extends h{constructor(dt){super(dt)}get(dt,gt){return{fileId:o.default.fromBin(dt,gt),fileSize:s.UINT64_LE.get(dt,gt+16),creationDate:s.UINT64_LE.get(dt,gt+24),dataPacketsCount:s.UINT64_LE.get(dt,gt+32),playDuration:s.UINT64_LE.get(dt,gt+40),sendDuration:s.UINT64_LE.get(dt,gt+48),preroll:s.UINT64_LE.get(dt,gt+56),flags:{broadcast:e.getBit(dt,gt+64,24),seekable:e.getBit(dt,gt+64,25)},minimumDataPacketSize:s.UINT32_LE.get(dt,gt+68),maximumDataPacketSize:s.UINT32_LE.get(dt,gt+72),maximumBitrate:s.UINT32_LE.get(dt,gt+76)}}}_.guid=o.default.FilePropertiesObject,a.FilePropertiesObject=_;class b extends h{constructor(dt){super(dt)}get(dt,gt){return{streamType:o.default.decodeMediaType(o.default.fromBin(dt,gt)),errorCorrectionType:o.default.fromBin(dt,gt+8)}}}b.guid=o.default.StreamPropertiesObject,a.StreamPropertiesObject=b;class ${constructor(){this.len=22}get(dt,gt){return{reserved1:o.default.fromBin(dt,gt),reserved2:dt.readUInt16LE(gt+16),extensionDataSize:dt.readUInt32LE(gt+18)}}}$.guid=o.default.HeaderExtensionObject,a.HeaderExtensionObject=$;const j={len:20,get:(Et,dt)=>({entryCount:Et.readUInt16LE(dt+16)})};async function _e(Et){const dt=await Et.readNumber(s.UINT16_LE);return(await Et.readToken(new s.StringType(dt*2,"utf16le"))).replace("\0","")}async function tt(Et){const dt=await Et.readToken(j),gt=[];for(let St=0;St<dt.entryCount;++St)gt.push(await nt(Et));return gt}a.readCodecEntries=tt;async function rt(Et){const dt=await Et.readNumber(s.UINT16_LE),gt=Buffer.alloc(dt);return await Et.readBuffer(gt),gt}async function nt(Et){const dt=await Et.readNumber(s.UINT16_LE);return{type:{videoCodec:(dt&1)===1,audioCodec:(dt&2)===2},codecName:await _e(Et),description:await _e(Et),information:await rt(Et)}}class st extends h{constructor(dt){super(dt)}get(dt,gt){const St=[];let xt=gt+10;for(let Ct=0;Ct<st.contentDescTags.length;++Ct){const Ht=dt.readUInt16LE(gt+Ct*2);if(Ht>0){const Dt=st.contentDescTags[Ct],rr=xt+Ht;St.push({id:Dt,value:c.AsfUtil.parseUnicodeAttr(dt.slice(xt,rr))}),xt=rr}}return St}}st.guid=o.default.ContentDescriptionObject,st.contentDescTags=["Title","Author","Copyright","Description","Rating"],a.ContentDescriptionObjectState=st;class at extends h{constructor(dt){super(dt)}get(dt,gt){const St=[],xt=dt.readUInt16LE(gt);let Ct=gt+2;for(let Ht=0;Ht<xt;Ht+=1){const Dt=dt.readUInt16LE(Ct);Ct+=2;const rr=c.AsfUtil.parseUnicodeAttr(dt.slice(Ct,Ct+Dt));Ct+=Dt;const er=dt.readUInt16LE(Ct);Ct+=2;const qt=dt.readUInt16LE(Ct);Ct+=2;const tr=dt.slice(Ct,Ct+qt);Ct+=qt,this.postProcessTag(St,rr,er,tr)}return St}}at.guid=o.default.ExtendedContentDescriptionObject,a.ExtendedContentDescriptionObjectState=at;class ot extends h{constructor(dt){super(dt)}get(dt,gt){return{startTime:s.UINT64_LE.get(dt,gt),endTime:s.UINT64_LE.get(dt,gt+8),dataBitrate:dt.readInt32LE(gt+12),bufferSize:dt.readInt32LE(gt+16),initialBufferFullness:dt.readInt32LE(gt+20),alternateDataBitrate:dt.readInt32LE(gt+24),alternateBufferSize:dt.readInt32LE(gt+28),alternateInitialBufferFullness:dt.readInt32LE(gt+32),maximumObjectSize:dt.readInt32LE(gt+36),flags:{reliableFlag:e.getBit(dt,gt+40,0),seekableFlag:e.getBit(dt,gt+40,1),resendLiveCleanpointsFlag:e.getBit(dt,gt+40,2)},streamNumber:dt.readInt16LE(gt+42),streamLanguageId:dt.readInt16LE(gt+44),averageTimePerFrame:dt.readInt32LE(gt+52),streamNameCount:dt.readInt32LE(gt+54),payloadExtensionSystems:dt.readInt32LE(gt+56),streamNames:[],streamPropertiesObject:null}}}ot.guid=o.default.ExtendedStreamPropertiesObject,a.ExtendedStreamPropertiesObjectState=ot;class ut extends h{constructor(dt){super(dt)}get(dt,gt){const St=[],xt=Buffer.from(dt),Ct=xt.readUInt16LE(gt);let Ht=gt+2;for(let Dt=0;Dt<Ct;Dt+=1){Ht+=4;const rr=xt.readUInt16LE(Ht);Ht+=2;const er=xt.readUInt16LE(Ht);Ht+=2;const qt=xt.readUInt32LE(Ht);Ht+=4;const tr=c.AsfUtil.parseUnicodeAttr(xt.slice(Ht,Ht+rr));Ht+=rr;const Ft=xt.slice(Ht,Ht+qt);Ht+=qt,this.postProcessTag(St,tr,er,Ft)}return St}}ut.guid=o.default.MetadataObject,a.MetadataObjectState=ut;class mt extends ut{constructor(dt){super(dt)}}mt.guid=o.default.MetadataLibraryObject,a.MetadataLibraryObjectState=mt;class yt{static fromBase64(dt){return this.fromBuffer(Buffer.from(dt,"base64"))}static fromBuffer(dt){return new yt(dt.length).get(dt,0)}constructor(dt){this.len=dt}get(dt,gt){const St=dt.readUInt8(gt++),xt=dt.readInt32LE(gt);let Ct=5;for(;dt.readUInt16BE(Ct)!==0;)Ct+=2;const Ht=dt.slice(5,Ct).toString("utf16le");for(;dt.readUInt16BE(Ct)!==0;)Ct+=2;const Dt=dt.slice(5,Ct).toString("utf16le");return{type:d.AttachedPictureType[St],format:Ht,description:Dt,size:xt,data:dt.slice(Ct+4)}}}a.WmPictureToken=yt})(AsfObject$1);Object.defineProperty(AsfParser$1,"__esModule",{value:!0});AsfParser$1.AsfParser=void 0;const debug_1$j=browserExports$1,type_1$1=type,GUID_1=GUID$1,AsfObject=AsfObject$1,BasicParser_1$9=BasicParser$1,debug$j=(0,debug_1$j.default)("music-metadata:parser:ASF"),headerType="asf";class AsfParser extends BasicParser_1$9.BasicParser{async parse(){const e=await this.tokenizer.readToken(AsfObject.TopLevelHeaderObjectToken);if(!e.objectId.equals(GUID_1.default.HeaderObject))throw new Error("expected asf header; but was not found; got: "+e.objectId.str);try{await this.parseObjectHeader(e.numberOfHeaderObjects)}catch(s){debug$j("Error while parsing ASF: %s",s)}}async parseObjectHeader(e){let s;do{const o=await this.tokenizer.readToken(AsfObject.HeaderObjectToken);switch(debug$j("header GUID=%s",o.objectId.str),o.objectId.str){case AsfObject.FilePropertiesObject.guid.str:const c=await this.tokenizer.readToken(new AsfObject.FilePropertiesObject(o));this.metadata.setFormat("duration",Number(c.playDuration/BigInt(1e3))/1e4-Number(c.preroll)/1e3),this.metadata.setFormat("bitrate",c.maximumBitrate);break;case AsfObject.StreamPropertiesObject.guid.str:const d=await this.tokenizer.readToken(new AsfObject.StreamPropertiesObject(o));this.metadata.setFormat("container","ASF/"+d.streamType);break;case AsfObject.HeaderExtensionObject.guid.str:const h=await this.tokenizer.readToken(new AsfObject.HeaderExtensionObject);await this.parseExtensionObject(h.extensionDataSize);break;case AsfObject.ContentDescriptionObjectState.guid.str:s=await this.tokenizer.readToken(new AsfObject.ContentDescriptionObjectState(o)),this.addTags(s);break;case AsfObject.ExtendedContentDescriptionObjectState.guid.str:s=await this.tokenizer.readToken(new AsfObject.ExtendedContentDescriptionObjectState(o)),this.addTags(s);break;case GUID_1.default.CodecListObject.str:const g=await AsfObject.readCodecEntries(this.tokenizer);g.forEach(b=>{this.metadata.addStreamInfo({type:b.type.videoCodec?type_1$1.TrackType.video:type_1$1.TrackType.audio,codecName:b.codecName})});const _=g.filter(b=>b.type.audioCodec).map(b=>b.codecName).join("/");this.metadata.setFormat("codec",_);break;case GUID_1.default.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(o.objectSize-AsfObject.HeaderObjectToken.len);break;case GUID_1.default.PaddingObject.str:debug$j("Padding: %s bytes",o.objectSize-AsfObject.HeaderObjectToken.len),await this.tokenizer.ignore(o.objectSize-AsfObject.HeaderObjectToken.len);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+o.objectId.str),debug$j("Ignore ASF-Object-GUID: %s",o.objectId.str),await this.tokenizer.readToken(new AsfObject.IgnoreObjectState(o))}}while(--e)}addTags(e){e.forEach(s=>{this.metadata.addTag(headerType,s.id,s.value)})}async parseExtensionObject(e){do{const s=await this.tokenizer.readToken(AsfObject.HeaderObjectToken),o=s.objectSize-AsfObject.HeaderObjectToken.len;switch(s.objectId.str){case AsfObject.ExtendedStreamPropertiesObjectState.guid.str:await this.tokenizer.readToken(new AsfObject.ExtendedStreamPropertiesObjectState(s));break;case AsfObject.MetadataObjectState.guid.str:const c=await this.tokenizer.readToken(new AsfObject.MetadataObjectState(s));this.addTags(c);break;case AsfObject.MetadataLibraryObjectState.guid.str:const d=await this.tokenizer.readToken(new AsfObject.MetadataLibraryObjectState(s));this.addTags(d);break;case GUID_1.default.PaddingObject.str:await this.tokenizer.ignore(o);break;case GUID_1.default.CompatibilityObject.str:this.tokenizer.ignore(o);break;case GUID_1.default.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(o);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+s.objectId.str),await this.tokenizer.readToken(new AsfObject.IgnoreObjectState(s));break}e-=s.objectSize}while(e>0)}}AsfParser$1.AsfParser=AsfParser;var FlacParser$1={},Vorbis={};Object.defineProperty(Vorbis,"__esModule",{value:!0});Vorbis.IdentificationHeader=Vorbis.CommonHeader=Vorbis.VorbisPictureToken=void 0;const Token$l=lib$1,ID3v2Token_1$1=ID3v2Token;class VorbisPictureToken{static fromBase64(e){return this.fromBuffer(Buffer.from(e,"base64"))}static fromBuffer(e){return new VorbisPictureToken(e.length).get(e,0)}constructor(e){this.len=e}get(e,s){const o=ID3v2Token_1$1.AttachedPictureType[Token$l.UINT32_BE.get(e,s)],c=Token$l.UINT32_BE.get(e,s+=4),d=e.toString("utf-8",s+=4,s+c),h=Token$l.UINT32_BE.get(e,s+=c),g=e.toString("utf-8",s+=4,s+h),_=Token$l.UINT32_BE.get(e,s+=h),b=Token$l.UINT32_BE.get(e,s+=4),$=Token$l.UINT32_BE.get(e,s+=4),j=Token$l.UINT32_BE.get(e,s+=4),_e=Token$l.UINT32_BE.get(e,s+=4),tt=Buffer.from(e.slice(s+=4,s+_e));return{type:o,format:d,description:g,width:_,height:b,colour_depth:$,indexed_color:j,data:tt}}}Vorbis.VorbisPictureToken=VorbisPictureToken;Vorbis.CommonHeader={len:7,get:(a,e)=>({packetType:a.readUInt8(e),vorbis:new Token$l.StringType(6,"ascii").get(a,e+1)})};Vorbis.IdentificationHeader={len:23,get:(a,e)=>{const s=new DataView(a.buffer,a.byteOffset);return{version:s.getUint32(e+0,!0),channelMode:s.getUint8(e+4),sampleRate:s.getUint32(e+5,!0),bitrateMax:s.getUint32(e+9,!0),bitrateNominal:s.getUint32(e+13,!0),bitrateMin:s.getUint32(e+17,!0)}}};var AbstractID3Parser$1={};Object.defineProperty(AbstractID3Parser$1,"__esModule",{value:!0});AbstractID3Parser$1.AbstractID3Parser=void 0;const core_1$2=core$1,debug_1$i=browserExports$1,ID3v2Token_1=ID3v2Token,ID3v2Parser_1$3=ID3v2Parser$1,ID3v1Parser_1$2=ID3v1Parser,BasicParser_1$8=BasicParser$1,debug$i=(0,debug_1$i.default)("music-metadata:parser:ID3");class AbstractID3Parser extends BasicParser_1$8.BasicParser{constructor(){super(...arguments),this.id3parser=new ID3v2Parser_1$3.ID3v2Parser}static async startsWithID3v2Header(e){return(await e.peekToken(ID3v2Token_1.ID3v2Header)).fileIdentifier==="ID3"}async parse(){try{await this.parseID3v2()}catch(e){if(e instanceof core_1$2.EndOfStreamError)debug$i("End-of-stream");else throw e}}finalize(){}async parseID3v2(){await this.tryReadId3v2Headers(),debug$i("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny()?this.finalize():(await new ID3v1Parser_1$2.ID3v1Parser().init(this.metadata,this.tokenizer,this.options).parse(),this.finalize())}async tryReadId3v2Headers(){if((await this.tokenizer.peekToken(ID3v2Token_1.ID3v2Header)).fileIdentifier==="ID3")return debug$i("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}AbstractID3Parser$1.AbstractID3Parser=AbstractID3Parser;var VorbisParser$1={},VorbisDecoder$1={};Object.defineProperty(VorbisDecoder$1,"__esModule",{value:!0});VorbisDecoder$1.VorbisDecoder=void 0;const Token$k=lib$1;class VorbisDecoder{constructor(e,s){this.data=e,this.offset=s}readInt32(){const e=Token$k.UINT32_LE.get(this.data,this.offset);return this.offset+=4,e}readStringUtf8(){const e=this.readInt32(),s=Buffer.from(this.data).toString("utf-8",this.offset,this.offset+e);return this.offset+=e,s}parseUserComment(){const e=this.offset,s=this.readStringUtf8(),o=s.indexOf("=");return{key:s.slice(0,o).toUpperCase(),value:s.slice(o+1),len:this.offset-e}}}VorbisDecoder$1.VorbisDecoder=VorbisDecoder;Object.defineProperty(VorbisParser$1,"__esModule",{value:!0});VorbisParser$1.VorbisParser=void 0;const Token$j=lib$1,debug_1$h=browserExports$1,VorbisDecoder_1$1=VorbisDecoder$1,Vorbis_1$1=Vorbis,debug$h=(0,debug_1$h.default)("music-metadata:parser:ogg:vorbis1");class VorbisParser{constructor(e,s){this.metadata=e,this.options=s,this.pageSegments=[]}parsePage(e,s){if(e.headerType.firstPage)this.parseFirstPage(e,s);else{if(e.headerType.continued){if(this.pageSegments.length===0)throw new Error("Cannot continue on previous page");this.pageSegments.push(s)}if(e.headerType.lastPage||!e.headerType.continued){if(this.pageSegments.length>0){const o=Buffer.concat(this.pageSegments);this.parseFullPage(o)}this.pageSegments=e.headerType.lastPage?[]:[s]}}e.headerType.lastPage&&this.calculateDuration(e)}flush(){this.parseFullPage(Buffer.concat(this.pageSegments))}parseUserComment(e,s){const c=new VorbisDecoder_1$1.VorbisDecoder(e,s).parseUserComment();return this.addTag(c.key,c.value),c.len}addTag(e,s){if(e==="METADATA_BLOCK_PICTURE"&&typeof s=="string"){if(this.options.skipCovers){debug$h("Ignore picture");return}s=Vorbis_1$1.VorbisPictureToken.fromBase64(s),debug$h(`Push picture: id=${e}, format=${s.format}`)}else debug$h(`Push tag: id=${e}, value=${s}`);this.metadata.addTag("vorbis",e,s)}calculateDuration(e){this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",e.absoluteGranulePosition),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate))}parseFirstPage(e,s){this.metadata.setFormat("codec","Vorbis I"),debug$h("Parse first page");const o=Vorbis_1$1.CommonHeader.get(s,0);if(o.vorbis!=="vorbis")throw new Error("Metadata does not look like Vorbis");if(o.packetType===1){const c=Vorbis_1$1.IdentificationHeader.get(s,Vorbis_1$1.CommonHeader.len);this.metadata.setFormat("sampleRate",c.sampleRate),this.metadata.setFormat("bitrate",c.bitrateNominal),this.metadata.setFormat("numberOfChannels",c.channelMode),debug$h("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",c.sampleRate,c.bitrateNominal,c.channelMode)}else throw new Error("First Ogg page should be type 1: the identification header")}parseFullPage(e){const s=Vorbis_1$1.CommonHeader.get(e,0);switch(debug$h("Parse full page: type=%s, byteLength=%s",s.packetType,e.byteLength),s.packetType){case 3:return this.parseUserCommentList(e,Vorbis_1$1.CommonHeader.len)}}parseUserCommentList(e,s){const o=Token$j.UINT32_LE.get(e,s);s+=4,s+=o;let c=Token$j.UINT32_LE.get(e,s);for(s+=4;c-- >0;)s+=this.parseUserComment(e,s)}}VorbisParser$1.VorbisParser=VorbisParser;Object.defineProperty(FlacParser$1,"__esModule",{value:!0});FlacParser$1.FlacParser=void 0;const token_types_1$1=lib$1,debug_1$g=browserExports$1,util$6=Util,Vorbis_1=Vorbis,AbstractID3Parser_1$3=AbstractID3Parser$1,FourCC_1$7=FourCC,VorbisParser_1$3=VorbisParser$1,VorbisDecoder_1=VorbisDecoder$1,debug$g=(0,debug_1$g.default)("music-metadata:parser:FLAC");var BlockType;(function(a){a[a.STREAMINFO=0]="STREAMINFO",a[a.PADDING=1]="PADDING",a[a.APPLICATION=2]="APPLICATION",a[a.SEEKTABLE=3]="SEEKTABLE",a[a.VORBIS_COMMENT=4]="VORBIS_COMMENT",a[a.CUESHEET=5]="CUESHEET",a[a.PICTURE=6]="PICTURE"})(BlockType||(BlockType={}));class FlacParser extends AbstractID3Parser_1$3.AbstractID3Parser{constructor(){super(...arguments),this.padding=0}init(e,s,o){return super.init(e,s,o),this.vorbisParser=new VorbisParser_1$3.VorbisParser(e,o),this}async postId3v2Parse(){if((await this.tokenizer.readToken(FourCC_1$7.FourCcToken)).toString()!=="fLaC")throw new Error("Invalid FLAC preamble");let s;do s=await this.tokenizer.readToken(Metadata.BlockHeader),await this.parseDataBlock(s);while(!s.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const o=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*o/this.metadata.format.duration)}}parseDataBlock(e){switch(debug$g(`blockHeader type=${e.type}, length=${e.length}`),e.type){case BlockType.STREAMINFO:return this.parseBlockStreamInfo(e.length);case BlockType.PADDING:this.padding+=e.length;break;case BlockType.APPLICATION:break;case BlockType.SEEKTABLE:break;case BlockType.VORBIS_COMMENT:return this.parseComment(e.length);case BlockType.CUESHEET:break;case BlockType.PICTURE:return this.parsePicture(e.length).then();default:this.metadata.addWarning("Unknown block type: "+e.type)}return this.tokenizer.ignore(e.length).then()}async parseBlockStreamInfo(e){if(e!==Metadata.BlockStreamInfo.len)throw new Error("Unexpected block-stream-info length");const s=await this.tokenizer.readToken(Metadata.BlockStreamInfo);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",s.channels),this.metadata.setFormat("bitsPerSample",s.bitsPerSample),this.metadata.setFormat("sampleRate",s.sampleRate),s.totalSamples>0&&this.metadata.setFormat("duration",s.totalSamples/s.sampleRate)}async parseComment(e){const s=await this.tokenizer.readToken(new token_types_1$1.Uint8ArrayType(e)),o=new VorbisDecoder_1.VorbisDecoder(s,0);o.readStringUtf8();const c=o.readInt32();for(let d=0;d<c;d++){const h=o.parseUserComment();this.vorbisParser.addTag(h.key,h.value)}}async parsePicture(e){if(this.options.skipCovers)return this.tokenizer.ignore(e);{const s=await this.tokenizer.readToken(new Vorbis_1.VorbisPictureToken(e));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",s)}}}FlacParser$1.FlacParser=FlacParser;class Metadata{}Metadata.BlockHeader={len:4,get:(a,e)=>({lastBlock:util$6.getBit(a,e,7),type:util$6.getBitAllignedNumber(a,e,1,7),length:token_types_1$1.UINT24_BE.get(a,e+1)})};Metadata.BlockStreamInfo={len:34,get:(a,e)=>({minimumBlockSize:token_types_1$1.UINT16_BE.get(a,e),maximumBlockSize:token_types_1$1.UINT16_BE.get(a,e+2)/1e3,minimumFrameSize:token_types_1$1.UINT24_BE.get(a,e+4),maximumFrameSize:token_types_1$1.UINT24_BE.get(a,e+7),sampleRate:token_types_1$1.UINT24_BE.get(a,e+10)>>4,channels:util$6.getBitAllignedNumber(a,e+12,4,3)+1,bitsPerSample:util$6.getBitAllignedNumber(a,e+12,7,5)+1,totalSamples:util$6.getBitAllignedNumber(a,e+13,4,36),fileMD5:new token_types_1$1.Uint8ArrayType(16).get(a,e+18)})};var MP4Parser$1={},Atom$1={},AtomToken$2={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.ChapterText=a.StcoAtom=a.StszAtom=a.StscAtom=a.SampleToChunkToken=a.SttsAtom=a.TimeToSampleToken=a.SoundSampleDescriptionV0=a.SoundSampleDescriptionVersion=a.StsdAtom=a.TrackHeaderAtom=a.NameAtom=a.DataAtom=a.MvhdAtom=a.MdhdAtom=a.FixedLengthAtom=a.mhdr=a.tkhd=a.ftyp=a.ExtendedSize=a.Header=void 0;const e=lib$1,s=browserExports$1,o=FourCC,c=(0,s.default)("music-metadata:parser:MP4:atom");a.Header={len:8,get:(Et,dt)=>{const gt=e.UINT32_BE.get(Et,dt);if(gt<0)throw new Error("Invalid atom header length");return{length:BigInt(gt),name:new e.StringType(4,"binary").get(Et,dt+4)}},put:(Et,dt,gt)=>(e.UINT32_BE.put(Et,dt,Number(gt.length)),o.FourCcToken.put(Et,dt+4,gt.name))},a.ExtendedSize=e.UINT64_BE,a.ftyp={len:4,get:(Et,dt)=>({type:new e.StringType(4,"ascii").get(Et,dt)})},a.tkhd={len:4,get:(Et,dt)=>({type:new e.StringType(4,"ascii").get(Et,dt)})},a.mhdr={len:8,get:(Et,dt)=>({version:e.UINT8.get(Et,dt),flags:e.UINT24_BE.get(Et,dt+1),nextItemID:e.UINT32_BE.get(Et,dt+4)})};class d{constructor(dt,gt,St){if(this.len=dt,dt<gt)throw new Error(`Atom ${St} expected to be ${gt}, but specifies ${dt} bytes long.`);dt>gt&&c(`Warning: atom ${St} expected to be ${gt}, but was actually ${dt} bytes long.`)}}a.FixedLengthAtom=d;const h={len:4,get:(Et,dt)=>{const gt=e.UINT32_BE.get(Et,dt)-2082844800;return new Date(gt*1e3)}};class g extends d{constructor(dt){super(dt,24,"mdhd"),this.len=dt}get(dt,gt){return{version:e.UINT8.get(dt,gt+0),flags:e.UINT24_BE.get(dt,gt+1),creationTime:h.get(dt,gt+4),modificationTime:h.get(dt,gt+8),timeScale:e.UINT32_BE.get(dt,gt+12),duration:e.UINT32_BE.get(dt,gt+16),language:e.UINT16_BE.get(dt,gt+20),quality:e.UINT16_BE.get(dt,gt+22)}}}a.MdhdAtom=g;class _ extends d{constructor(dt){super(dt,100,"mvhd"),this.len=dt}get(dt,gt){return{version:e.UINT8.get(dt,gt),flags:e.UINT24_BE.get(dt,gt+1),creationTime:h.get(dt,gt+4),modificationTime:h.get(dt,gt+8),timeScale:e.UINT32_BE.get(dt,gt+12),duration:e.UINT32_BE.get(dt,gt+16),preferredRate:e.UINT32_BE.get(dt,gt+20),preferredVolume:e.UINT16_BE.get(dt,gt+24),previewTime:e.UINT32_BE.get(dt,gt+72),previewDuration:e.UINT32_BE.get(dt,gt+76),posterTime:e.UINT32_BE.get(dt,gt+80),selectionTime:e.UINT32_BE.get(dt,gt+84),selectionDuration:e.UINT32_BE.get(dt,gt+88),currentTime:e.UINT32_BE.get(dt,gt+92),nextTrackID:e.UINT32_BE.get(dt,gt+96)}}}a.MvhdAtom=_;class b{constructor(dt){this.len=dt}get(dt,gt){return{type:{set:e.UINT8.get(dt,gt+0),type:e.UINT24_BE.get(dt,gt+1)},locale:e.UINT24_BE.get(dt,gt+4),value:Buffer.from(new e.Uint8ArrayType(this.len-8).get(dt,gt+8))}}}a.DataAtom=b;class ${constructor(dt){this.len=dt}get(dt,gt){return{version:e.UINT8.get(dt,gt),flags:e.UINT24_BE.get(dt,gt+1),name:new e.StringType(this.len-4,"utf-8").get(dt,gt+4)}}}a.NameAtom=$;class j{constructor(dt){this.len=dt}get(dt,gt){return{version:e.UINT8.get(dt,gt),flags:e.UINT24_BE.get(dt,gt+1),creationTime:h.get(dt,gt+4),modificationTime:h.get(dt,gt+8),trackId:e.UINT32_BE.get(dt,gt+12),duration:e.UINT32_BE.get(dt,gt+20),layer:e.UINT16_BE.get(dt,gt+24),alternateGroup:e.UINT16_BE.get(dt,gt+26),volume:e.UINT16_BE.get(dt,gt+28)}}}a.TrackHeaderAtom=j;const _e={len:8,get:(Et,dt)=>({version:e.UINT8.get(Et,dt),flags:e.UINT24_BE.get(Et,dt+1),numberOfEntries:e.UINT32_BE.get(Et,dt+4)})};class tt{constructor(dt){this.len=dt}get(dt,gt){return{dataFormat:o.FourCcToken.get(dt,gt),dataReferenceIndex:e.UINT16_BE.get(dt,gt+10),description:new e.Uint8ArrayType(this.len-12).get(dt,gt+12)}}}class rt{constructor(dt){this.len=dt}get(dt,gt){const St=_e.get(dt,gt);gt+=_e.len;const xt=[];for(let Ct=0;Ct<St.numberOfEntries;++Ct){const Ht=e.UINT32_BE.get(dt,gt);gt+=e.UINT32_BE.len,xt.push(new tt(Ht).get(dt,gt)),gt+=Ht}return{header:St,table:xt}}}a.StsdAtom=rt,a.SoundSampleDescriptionVersion={len:8,get(Et,dt){return{version:e.INT16_BE.get(Et,dt),revision:e.INT16_BE.get(Et,dt+2),vendor:e.INT32_BE.get(Et,dt+4)}}},a.SoundSampleDescriptionV0={len:12,get(Et,dt){return{numAudioChannels:e.INT16_BE.get(Et,dt+0),sampleSize:e.INT16_BE.get(Et,dt+2),compressionId:e.INT16_BE.get(Et,dt+4),packetSize:e.INT16_BE.get(Et,dt+6),sampleRate:e.UINT16_BE.get(Et,dt+8)+e.UINT16_BE.get(Et,dt+10)/1e4}}};class nt{constructor(dt,gt){this.len=dt,this.token=gt}get(dt,gt){const St=e.INT32_BE.get(dt,gt+4);return{version:e.INT8.get(dt,gt+0),flags:e.INT24_BE.get(dt,gt+1),numberOfEntries:St,entries:yt(dt,this.token,gt+8,this.len-8,St)}}}a.TimeToSampleToken={len:8,get(Et,dt){return{count:e.INT32_BE.get(Et,dt+0),duration:e.INT32_BE.get(Et,dt+4)}}};class st extends nt{constructor(dt){super(dt,a.TimeToSampleToken),this.len=dt}}a.SttsAtom=st,a.SampleToChunkToken={len:12,get(Et,dt){return{firstChunk:e.INT32_BE.get(Et,dt),samplesPerChunk:e.INT32_BE.get(Et,dt+4),sampleDescriptionId:e.INT32_BE.get(Et,dt+8)}}};class at extends nt{constructor(dt){super(dt,a.SampleToChunkToken),this.len=dt}}a.StscAtom=at;class ot{constructor(dt){this.len=dt}get(dt,gt){const St=e.INT32_BE.get(dt,gt+8);return{version:e.INT8.get(dt,gt),flags:e.INT24_BE.get(dt,gt+1),sampleSize:e.INT32_BE.get(dt,gt+4),numberOfEntries:St,entries:yt(dt,e.INT32_BE,gt+12,this.len-12,St)}}}a.StszAtom=ot;class ut extends nt{constructor(dt){super(dt,e.INT32_BE),this.len=dt}}a.StcoAtom=ut;class mt{constructor(dt){this.len=dt}get(dt,gt){const St=e.INT16_BE.get(dt,gt+0);return new e.StringType(St,"utf-8").get(dt,gt+2)}}a.ChapterText=mt;function yt(Et,dt,gt,St,xt){if(c(`remainingLen=${St}, numberOfEntries=${xt} * token-len=${dt.len}`),St===0)return[];if(St!==xt*dt.len)throw new Error("mismatch number-of-entries with remaining atom-length");const Ct=[];for(let Ht=0;Ht<xt;++Ht)Ct.push(dt.get(Et,gt)),gt+=dt.len;return Ct}})(AtomToken$2);Object.defineProperty(Atom$1,"__esModule",{value:!0});Atom$1.Atom=void 0;const debug_1$f=browserExports$1,AtomToken$1=AtomToken$2,debug$f=(0,debug_1$f.default)("music-metadata:parser:MP4:Atom");class Atom{static async readAtom(e,s,o,c){const d=e.position,h=await e.readToken(AtomToken$1.Header);h.length===BigInt(1)&&(h.length=await e.readToken(AtomToken$1.ExtendedSize));const _=new Atom(h,h.length===BigInt(1),o),b=_.getPayloadLength(c);return debug$f(`parse atom name=${_.atomPath}, extended=${_.extended}, offset=${d}, len=${_.header.length}`),await _.readData(e,s,b),_}constructor(e,s,o){this.header=e,this.extended=s,this.parent=o,this.children=[],this.atomPath=(this.parent?this.parent.atomPath+".":"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(e){return(this.header.length===BigInt(0)?e:Number(this.header.length))-this.getHeaderLength()}async readAtoms(e,s,o){for(;o>0;){const c=await Atom.readAtom(e,s,this,o);this.children.push(c),o-=c.header.length===BigInt(0)?o:Number(c.header.length)}}async readData(e,s,o){switch(this.header.name){case"moov":case"udta":case"trak":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":return this.readAtoms(e,s,this.getPayloadLength(o));case"meta":const d=(await e.peekToken(AtomToken$1.Header)).name==="hdlr"?0:4;return await e.ignore(d),this.readAtoms(e,s,this.getPayloadLength(o)-d);case"mdhd":case"mvhd":case"tkhd":case"stsz":case"mdat":default:return s(this,o)}}}Atom$1.Atom=Atom;Object.defineProperty(MP4Parser$1,"__esModule",{value:!0});MP4Parser$1.MP4Parser=void 0;const debug_1$e=browserExports$1,Token$i=lib$1,BasicParser_1$7=BasicParser$1,ID3v1Parser_1$1=ID3v1Parser,type_1=type,Atom_1=Atom$1,AtomToken=AtomToken$2,debug$e=(0,debug_1$e.default)("music-metadata:parser:MP4"),tagFormat="iTunes",encoderDict={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function distinct(a,e,s){return s.indexOf(a)===e}class MP4Parser extends BasicParser_1$7.BasicParser{constructor(){super(...arguments),this.atomParsers={mvhd:async e=>{const s=await this.tokenizer.readToken(new AtomToken.MvhdAtom(e));this.metadata.setFormat("creationTime",s.creationTime),this.metadata.setFormat("modificationTime",s.modificationTime)},mdhd:async e=>{const s=await this.tokenizer.readToken(new AtomToken.MdhdAtom(e)),o=this.getTrackDescription();o.creationTime=s.creationTime,o.modificationTime=s.modificationTime,o.timeScale=s.timeScale,o.duration=s.duration},chap:async e=>{const s=this.getTrackDescription(),o=[];for(;e>=Token$i.UINT32_BE.len;)o.push(await this.tokenizer.readNumber(Token$i.UINT32_BE)),e-=Token$i.UINT32_BE.len;s.chapterList=o},tkhd:async e=>{const s=await this.tokenizer.readToken(new AtomToken.TrackHeaderAtom(e));this.tracks.push(s)},mdat:async e=>{if(this.audioLengthInBytes=e,this.calculateBitRate(),this.options.includeChapters){const s=this.tracks.filter(o=>o.chapterList);if(s.length===1){const o=s[0].chapterList,c=this.tracks.filter(d=>o.indexOf(d.trackId)!==-1);if(c.length===1)return this.parseChapterTrack(c[0],s[0],e)}}await this.tokenizer.ignore(e)},ftyp:async e=>{const s=[];for(;e>0;){const c=await this.tokenizer.readToken(AtomToken.ftyp);e-=AtomToken.ftyp.len;const d=c.type.replace(/\W/g,"");d.length>0&&s.push(d)}debug$e(`ftyp: ${s.join("/")}`);const o=s.filter(distinct).join("/");this.metadata.setFormat("container",o)},stsd:async e=>{const s=await this.tokenizer.readToken(new AtomToken.StsdAtom(e)),o=this.getTrackDescription();o.soundSampleDescription=s.table.map(c=>this.parseSoundSampleDescription(c))},stsc:async e=>{const s=await this.tokenizer.readToken(new AtomToken.StscAtom(e));this.getTrackDescription().sampleToChunkTable=s.entries},stts:async e=>{const s=await this.tokenizer.readToken(new AtomToken.SttsAtom(e));this.getTrackDescription().timeToSampleTable=s.entries},stsz:async e=>{const s=await this.tokenizer.readToken(new AtomToken.StszAtom(e)),o=this.getTrackDescription();o.sampleSize=s.sampleSize,o.sampleSizeTable=s.entries},stco:async e=>{const s=await this.tokenizer.readToken(new AtomToken.StcoAtom(e));this.getTrackDescription().chunkOffsetTable=s.entries},date:async e=>{const s=await this.tokenizer.readToken(new Token$i.StringType(e,"utf-8"));this.addTag("date",s)}}}static read_BE_Integer(e,s){const o=(s?"INT":"UINT")+e.length*8+(e.length>1?"_BE":""),c=Token$i[o];if(!c)throw new Error('Token for integer type not found: "'+o+'"');return Number(c.get(e,0))}async parse(){this.tracks=[];let e=this.tokenizer.fileInfo.size;for(;!this.tokenizer.fileInfo.size||e>0;){try{if((await this.tokenizer.peekToken(AtomToken.Header)).name==="\0\0\0\0"){const h=`Error at offset=${this.tokenizer.position}: box.id=0`;debug$e(h),this.addWarning(h);break}}catch(d){const h=`Error at offset=${this.tokenizer.position}: ${d.message}`;debug$e(h),this.addWarning(h);break}const c=await Atom_1.Atom.readAtom(this.tokenizer,(d,h)=>this.handleAtom(d,h),null,e);e-=c.header.length===BigInt(0)?e:Number(c.header.length)}const s=[];this.tracks.forEach(c=>{const d=[];c.soundSampleDescription.forEach(h=>{const g={},_=encoderDict[h.dataFormat];if(_?(d.push(_.format),g.codecName=_.format):g.codecName=`<${h.dataFormat}>`,h.description){const{description:b}=h;b.sampleRate>0&&(g.type=type_1.TrackType.audio,g.audio={samplingFrequency:b.sampleRate,bitDepth:b.sampleSize,channels:b.numAudioChannels})}this.metadata.addStreamInfo(g)}),d.length>=1&&s.push(d.join("/"))}),s.length>0&&this.metadata.setFormat("codec",s.filter(distinct).join("+"));const o=this.tracks.filter(c=>c.soundSampleDescription.length>=1&&c.soundSampleDescription[0].description&&c.soundSampleDescription[0].description.numAudioChannels>0);if(o.length>=1){const c=o[0];if(c.timeScale>0){const g=c.duration/c.timeScale;this.metadata.setFormat("duration",g)}const d=c.soundSampleDescription[0];if(d.description&&(this.metadata.setFormat("sampleRate",d.description.sampleRate),this.metadata.setFormat("bitsPerSample",d.description.sampleSize),this.metadata.setFormat("numberOfChannels",d.description.numAudioChannels),c.timeScale===0&&c.timeToSampleTable.length>0)){const _=c.timeToSampleTable.map(b=>b.count*b.duration).reduce((b,$)=>b+$)/d.description.sampleRate;this.metadata.setFormat("duration",_)}const h=encoderDict[d.dataFormat];h&&this.metadata.setFormat("lossless",!h.lossy),this.calculateBitRate()}}async handleAtom(e,s){if(e.parent)switch(e.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(e)}if(this.atomParsers[e.header.name])return this.atomParsers[e.header.name](s);debug$e(`No parser for atom path=${e.atomPath}, payload-len=${s}, ignoring atom`),await this.tokenizer.ignore(s)}getTrackDescription(){return this.tracks[this.tracks.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}addTag(e,s){this.metadata.addTag(tagFormat,e,s)}addWarning(e){debug$e("Warning: "+e),this.metadata.addWarning(e)}parseMetadataItemData(e){let s=e.header.name;return e.readAtoms(this.tokenizer,async(o,c)=>{const d=o.getPayloadLength(c);switch(o.header.name){case"data":return this.parseValueAtom(s,o);case"name":case"mean":case"rate":const h=await this.tokenizer.readToken(new AtomToken.NameAtom(d));s+=":"+h.name;break;default:const g=await this.tokenizer.readToken(new Token$i.BufferType(d));this.addWarning("Unsupported meta-item: "+s+"["+o.header.name+"] => value="+g.toString("hex")+" ascii="+g.toString("ascii"))}},e.getPayloadLength(0))}async parseValueAtom(e,s){const o=await this.tokenizer.readToken(new AtomToken.DataAtom(Number(s.header.length)-AtomToken.Header.len));if(o.type.set!==0)throw new Error("Unsupported type-set != 0: "+o.type.set);switch(o.type.type){case 0:switch(e){case"trkn":case"disk":const c=Token$i.UINT8.get(o.value,3),d=Token$i.UINT8.get(o.value,5);this.addTag(e,c+"/"+d);break;case"gnre":const h=Token$i.UINT8.get(o.value,1),g=ID3v1Parser_1$1.Genres[h-1];this.addTag(e,g);break;case"rate":const _=o.value.toString("ascii");this.addTag(e,_);break;default:debug$e("unknown proprietary value type for: "+s.atomPath)}break;case 1:case 18:this.addTag(e,o.value.toString("utf-8"));break;case 13:if(this.options.skipCovers)break;this.addTag(e,{format:"image/jpeg",data:Buffer.from(o.value)});break;case 14:if(this.options.skipCovers)break;this.addTag(e,{format:"image/png",data:Buffer.from(o.value)});break;case 21:this.addTag(e,MP4Parser.read_BE_Integer(o.value,!0));break;case 22:this.addTag(e,MP4Parser.read_BE_Integer(o.value,!1));break;case 65:this.addTag(e,o.value.readInt8(0));break;case 66:this.addTag(e,o.value.readInt16BE(0));break;case 67:this.addTag(e,o.value.readInt32BE(0));break;default:this.addWarning(`atom key=${e}, has unknown well-known-type (data-type): ${o.type.type}`)}}parseSoundSampleDescription(e){const s={dataFormat:e.dataFormat,dataReferenceIndex:e.dataReferenceIndex};let o=0;const c=AtomToken.SoundSampleDescriptionVersion.get(e.description,o);return o+=AtomToken.SoundSampleDescriptionVersion.len,c.version===0||c.version===1?s.description=AtomToken.SoundSampleDescriptionV0.get(e.description,o):debug$e(`Warning: sound-sample-description ${c} not implemented`),s}async parseChapterTrack(e,s,o){if(!e.sampleSize&&e.chunkOffsetTable.length!==e.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const c=[];for(let d=0;d<e.chunkOffsetTable.length&&o>0;++d){const g=e.chunkOffsetTable[d]-this.tokenizer.position,_=e.sampleSize>0?e.sampleSize:e.sampleSizeTable[d];if(o-=g+_,o<0)throw new Error("Chapter chunk exceeding token length");await this.tokenizer.ignore(g);const b=await this.tokenizer.readToken(new AtomToken.ChapterText(_));debug$e(`Chapter ${d+1}: ${b}`);const $={title:b,sampleOffset:this.findSampleOffset(s,this.tokenizer.position)};debug$e(`Chapter title=${$.title}, offset=${$.sampleOffset}/${this.tracks[0].duration}`),c.push($)}this.metadata.setFormat("chapters",c),await this.tokenizer.ignore(o)}findSampleOffset(e,s){let o=0;e.timeToSampleTable.forEach(d=>{o+=d.count*d.duration}),debug$e(`Total duration=${o}`);let c=0;for(;c<e.chunkOffsetTable.length&&e.chunkOffsetTable[c]<s;)++c;return this.getChunkDuration(c+1,e)}getChunkDuration(e,s){let o=0,c=s.timeToSampleTable[o].count,d=s.timeToSampleTable[o].duration,h=1,g=this.getSamplesPerChunk(h,s.sampleToChunkTable),_=0;for(;h<e;){const b=Math.min(c,g);_+=b*d,c-=b,g-=b,g===0?(++h,g=this.getSamplesPerChunk(h,s.sampleToChunkTable)):(++o,c=s.timeToSampleTable[o].count,d=s.timeToSampleTable[o].duration)}return _}getSamplesPerChunk(e,s){for(let o=0;o<s.length-1;++o)if(e>=s[o].firstChunk&&e<s[o+1].firstChunk)return s[o].samplesPerChunk;return s[s.length-1].samplesPerChunk}}MP4Parser$1.MP4Parser=MP4Parser;var MpegParser$1={},XingTag={},ExtendedLameHeader={},ReplayGainDataFormat={};Object.defineProperty(ReplayGainDataFormat,"__esModule",{value:!0});ReplayGainDataFormat.ReplayGain=void 0;const common$2=Util;var NameCode;(function(a){a[a.not_set=0]="not_set",a[a.radio=1]="radio",a[a.audiophile=2]="audiophile"})(NameCode||(NameCode={}));var ReplayGainOriginator;(function(a){a[a.unspecified=0]="unspecified",a[a.engineer=1]="engineer",a[a.user=2]="user",a[a.automatic=3]="automatic",a[a.rms_average=4]="rms_average"})(ReplayGainOriginator||(ReplayGainOriginator={}));ReplayGainDataFormat.ReplayGain={len:2,get:(a,e)=>{const s=common$2.getBitAllignedNumber(a,e,0,3),o=common$2.getBitAllignedNumber(a,e,6,1),c=common$2.getBitAllignedNumber(a,e,7,9)/10;if(s>0)return{type:common$2.getBitAllignedNumber(a,e,0,3),origin:common$2.getBitAllignedNumber(a,e,3,3),adjustment:o?-c:c}}};Object.defineProperty(ExtendedLameHeader,"__esModule",{value:!0});ExtendedLameHeader.ExtendedLameHeader=void 0;const Token$h=lib$1,common$1=Util,ReplayGainDataFormat_1=ReplayGainDataFormat;ExtendedLameHeader.ExtendedLameHeader={len:27,get:(a,e)=>{const s=Token$h.UINT32_BE.get(a,e+2);return{revision:common$1.getBitAllignedNumber(a,e,0,4),vbr_method:common$1.getBitAllignedNumber(a,e,4,4),lowpass_filter:100*Token$h.UINT8.get(a,e+1),track_peak:s===0?void 0:s/Math.pow(2,23),track_gain:ReplayGainDataFormat_1.ReplayGain.get(a,6),album_gain:ReplayGainDataFormat_1.ReplayGain.get(a,8),music_length:Token$h.UINT32_BE.get(a,e+20),music_crc:Token$h.UINT8.get(a,e+24),header_crc:Token$h.UINT16_BE.get(a,e+24)}}};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.readXingHeader=a.XingHeaderFlags=a.LameEncoderVersion=a.InfoTagHeaderTag=void 0;const e=lib$1,s=Util,o=ExtendedLameHeader;a.InfoTagHeaderTag=new e.StringType(4,"ascii"),a.LameEncoderVersion=new e.StringType(6,"ascii"),a.XingHeaderFlags={len:4,get:(d,h)=>({frames:s.isBitSet(d,h,31),bytes:s.isBitSet(d,h,30),toc:s.isBitSet(d,h,29),vbrScale:s.isBitSet(d,h,28)})};async function c(d){const h=await d.readToken(a.XingHeaderFlags),g={};if(h.frames&&(g.numFrames=await d.readToken(e.UINT32_BE)),h.bytes&&(g.streamSize=await d.readToken(e.UINT32_BE)),h.toc&&(g.toc=Buffer.alloc(100),await d.readBuffer(g.toc)),h.vbrScale&&(g.vbrScale=await d.readToken(e.UINT32_BE)),await d.peekToken(new e.StringType(4,"ascii"))==="LAME"&&(await d.ignore(4),g.lame={version:await d.readToken(new e.StringType(5,"ascii"))},g.lame.version.match(/\d+.\d+/g))){const j=g.lame.version.match(/\d+.\d+/g)[0].split(".").map(_e=>parseInt(_e,10));j[0]>=3&&j[1]>=90&&(g.lame.extended=await d.readToken(o.ExtendedLameHeader))}return g}a.readXingHeader=c})(XingTag);Object.defineProperty(MpegParser$1,"__esModule",{value:!0});MpegParser$1.MpegParser=void 0;const Token$g=lib$1,core_1$1=core$1,debug_1$d=browserExports$1,common=Util,AbstractID3Parser_1$2=AbstractID3Parser$1,XingTag_1=XingTag,debug$d=(0,debug_1$d.default)("music-metadata:parser:mpeg"),maxPeekLen=1024,MPEG4={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,void 0,void 0,-1]},MPEG4_ChannelConfigurations=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class MpegFrameHeader{constructor(e,s){this.versionIndex=common.getBitAllignedNumber(e,s+1,3,2),this.layer=MpegFrameHeader.LayerDescription[common.getBitAllignedNumber(e,s+1,5,2)],this.versionIndex>1&&this.layer===0?this.parseAdtsHeader(e,s):this.parseMpegHeader(e,s),this.isProtectedByCRC=!common.isBitSet(e,s+1,7)}calcDuration(e){return e*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return MpegFrameHeader.samplesInFrameTable[this.version===1?0:1][this.layer]}calculateSideInfoLength(){if(this.layer!==3)return 2;if(this.channelModeIndex===3){if(this.version===1)return 17;if(this.version===2||this.version===2.5)return 9}else{if(this.version===1)return 32;if(this.version===2||this.version===2.5)return 17}}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(e,s){this.container="MPEG",this.bitrateIndex=common.getBitAllignedNumber(e,s+2,0,4),this.sampRateFreqIndex=common.getBitAllignedNumber(e,s+2,4,2),this.padding=common.isBitSet(e,s+2,6),this.privateBit=common.isBitSet(e,s+2,7),this.channelModeIndex=common.getBitAllignedNumber(e,s+3,0,2),this.modeExtension=common.getBitAllignedNumber(e,s+3,2,2),this.isCopyrighted=common.isBitSet(e,s+3,4),this.isOriginalMedia=common.isBitSet(e,s+3,5),this.emphasis=common.getBitAllignedNumber(e,s+3,7,2),this.version=MpegFrameHeader.VersionID[this.versionIndex],this.channelMode=MpegFrameHeader.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const o=this.calcBitrate();if(!o)throw new Error("Cannot determine bit-rate");if(this.bitrate=o*1e3,this.samplingRate=this.calcSamplingRate(),this.samplingRate==null)throw new Error("Cannot determine sampling-rate")}parseAdtsHeader(e,s){debug$d("layer=0 => ADTS"),this.version=this.versionIndex===2?4:2,this.container="ADTS/MPEG-"+this.version;const o=common.getBitAllignedNumber(e,s+2,0,2);this.codec="AAC",this.codecProfile=MPEG4.AudioObjectTypes[o],debug$d(`MPEG-4 audio-codec=${this.codec}`);const c=common.getBitAllignedNumber(e,s+2,2,4);this.samplingRate=MPEG4.SamplingFrequencies[c],debug$d(`sampling-rate=${this.samplingRate}`);const d=common.getBitAllignedNumber(e,s+2,7,3);this.mp4ChannelConfig=MPEG4_ChannelConfigurations[d],debug$d(`channel-config=${this.mp4ChannelConfig.join("+")}`),this.frameLength=common.getBitAllignedNumber(e,s+3,6,2)<<11}calcBitrate(){if(this.bitrateIndex===0||this.bitrateIndex===15)return;const e=`${Math.floor(this.version)}${this.layer}`;return MpegFrameHeader.bitrate_index[this.bitrateIndex][e]}calcSamplingRate(){return this.sampRateFreqIndex===3?null:MpegFrameHeader.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}MpegFrameHeader.SyncByte1=255;MpegFrameHeader.SyncByte2=224;MpegFrameHeader.VersionID=[2.5,null,2,1];MpegFrameHeader.LayerDescription=[0,3,2,1];MpegFrameHeader.ChannelMode=["stereo","joint_stereo","dual_channel","mono"];MpegFrameHeader.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}};MpegFrameHeader.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}};MpegFrameHeader.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];const FrameHeader={len:4,get:(a,e)=>new MpegFrameHeader(a,e)};function getVbrCodecProfile(a){return"V"+Math.floor((100-a)/10)}class MpegParser extends AbstractID3Parser_1$2.AbstractID3Parser{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.calculateEofDuration=!1,this.buf_frame_header=Buffer.alloc(4),this.syncPeek={buf:Buffer.alloc(maxPeekLen),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1);try{let e=!1;for(;!e;)await this.sync(),e=await this.parseCommonMpegHeader()}catch(e){if(e instanceof core_1$1.EndOfStreamError){if(debug$d("End-of-stream"),this.calculateEofDuration){const s=this.frameCount*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",s);const o=s/this.metadata.format.sampleRate;debug$d(`Calculate duration at EOF: ${o} sec.`,o),this.metadata.setFormat("duration",o)}}else throw e}}finalize(){const e=this.metadata.format,s=this.metadata.native.hasOwnProperty("ID3v1");if(e.duration&&this.tokenizer.fileInfo.size){const o=this.tokenizer.fileInfo.size-this.mpegOffset-(s?128:0);e.codecProfile&&e.codecProfile[0]==="V"&&this.metadata.setFormat("bitrate",o*8/e.duration)}else if(this.tokenizer.fileInfo.size&&e.codecProfile==="CBR"){const o=this.tokenizer.fileInfo.size-this.mpegOffset-(s?128:0),c=Math.round(o/this.frame_size)*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",c);const d=c/e.sampleRate;debug$d("Calculate CBR duration based on file size: %s",d),this.metadata.setFormat("duration",d)}}async sync(){let e=!1;for(;;){let s=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:maxPeekLen,mayBeLess:!0}),this.syncPeek.len<=163)throw new core_1$1.EndOfStreamError;for(;;)if(e&&(this.syncPeek.buf[s]&224)===224){this.buf_frame_header[0]=MpegFrameHeader.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[s],await this.tokenizer.ignore(s),debug$d(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(debug$d(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),this.syncFrameCount=this.frameCount;return}else if(e=!1,s=this.syncPeek.buf.indexOf(MpegFrameHeader.SyncByte1,s),s===-1){if(this.syncPeek.len<this.syncPeek.buf.length)throw new core_1$1.EndOfStreamError;await this.tokenizer.ignore(this.syncPeek.len);break}else++s,e=!0}}async parseCommonMpegHeader(){this.frameCount===0&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header,{offset:1,length:3});let e;try{e=FrameHeader.get(this.buf_frame_header,0)}catch(s){return await this.tokenizer.ignore(1),this.metadata.addWarning("Parse error: "+s.message),!1}return await this.tokenizer.ignore(3),this.metadata.setFormat("container",e.container),this.metadata.setFormat("codec",e.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",e.samplingRate),this.frameCount++,e.version>=2&&e.layer===0?this.parseAdts(e):this.parseAudioFrameHeader(e)}async parseAudioFrameHeader(e){this.metadata.setFormat("numberOfChannels",e.channelMode==="mono"?1:2),this.metadata.setFormat("bitrate",e.bitrate),this.frameCount<20*1e4&&debug$d("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,e.layer,e.bitrate,e.samplingRate);const s=e.calcSlotSize();if(s===null)throw new Error("invalid slot_size");const o=e.calcSamplesPerFrame();debug$d(`samples_per_frame=${o}`);const d=o/8*e.bitrate/e.samplingRate+(e.padding?s:0);if(this.frame_size=Math.floor(d),this.audioFrameHeader=e,this.bitrates.push(e.bitrate),this.frameCount===1)return this.offset=FrameHeader.len,await this.skipSideInformation(),!1;if(this.frameCount===3){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=o,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&this.frameCount===4&&(this.samplesPerFrame=o,this.calculateEofDuration=!0),this.offset=4,e.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(e){const s=Buffer.alloc(3);await this.tokenizer.readBuffer(s),e.frameLength+=common.getBitAllignedNumber(s,0,0,11),this.totalDataLength+=e.frameLength,this.samplesPerFrame=1024;const o=e.samplingRate/this.samplesPerFrame,d=8*(this.frameCount===0?0:this.totalDataLength/this.frameCount)*o+.5;if(this.metadata.setFormat("bitrate",d),debug$d(`frame-count=${this.frameCount}, size=${e.frameLength} bytes, bit-rate=${d}`),await this.tokenizer.ignore(e.frameLength>7?e.frameLength-7:1),this.frameCount===3)if(this.metadata.setFormat("codecProfile",e.codecProfile),e.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",e.mp4ChannelConfig.length),this.options.duration)this.calculateEofDuration=!0;else return!0;return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(Token$g.INT16_BE),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){const e=this.audioFrameHeader.calculateSideInfoLength();await this.tokenizer.readToken(new Token$g.Uint8ArrayType(e)),this.offset+=e,await this.readXtraInfoHeader()}async readXtraInfoHeader(){const e=await this.tokenizer.readToken(XingTag_1.InfoTagHeaderTag);switch(this.offset+=XingTag_1.InfoTagHeaderTag.len,e){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":const o=await this.readXingInfoHeader(),c=getVbrCodecProfile(o.vbrScale);return this.metadata.setFormat("codecProfile",c),null;case"Xtra":break;case"LAME":const d=await this.tokenizer.readToken(XingTag_1.LameEncoderVersion);if(this.frame_size>=this.offset+XingTag_1.LameEncoderVersion.len)return this.offset+=XingTag_1.LameEncoderVersion.len,this.metadata.setFormat("tool","LAME "+d),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header");break}const s=this.frame_size-this.offset;return s<0?this.metadata.addWarning("Frame "+this.frameCount+"corrupt: negative frameDataLeft"):await this.skipFrameData(s),null}async readXingInfoHeader(){const e=this.tokenizer.position,s=await(0,XingTag_1.readXingHeader)(this.tokenizer);if(this.offset+=this.tokenizer.position-e,s.lame&&(this.metadata.setFormat("tool","LAME "+common.stripNulls(s.lame.version)),s.lame.extended&&(this.metadata.setFormat("trackPeakLevel",s.lame.extended.track_peak),s.lame.extended.track_gain&&this.metadata.setFormat("trackGain",s.lame.extended.track_gain.adjustment),s.lame.extended.album_gain&&this.metadata.setFormat("albumGain",s.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",s.lame.extended.music_length/1e3))),s.streamSize){const c=this.audioFrameHeader.calcDuration(s.numFrames);return this.metadata.setFormat("duration",c),debug$d("Get duration from Xing header: %s",this.metadata.format.duration),s}const o=this.frame_size-this.offset;return await this.skipFrameData(o),s}async skipFrameData(e){if(e<0)throw new Error("frame-data-left cannot be negative");await this.tokenizer.ignore(e),this.countSkipFrameData+=e}areAllSame(e){const s=e[0];return e.every(o=>o===s)}}MpegParser$1.MpegParser=MpegParser;var musepack={},MpcSv8Parser$1={},StreamVersion8={};Object.defineProperty(StreamVersion8,"__esModule",{value:!0});StreamVersion8.StreamReader=void 0;const Token$f=lib$1,debug_1$c=browserExports$1,util$5=Util,debug$c=(0,debug_1$c.default)("music-metadata:parser:musepack:sv8"),PacketKey=new Token$f.StringType(2,"binary"),SH_part1={len:5,get:(a,e)=>({crc:Token$f.UINT32_LE.get(a,e),streamVersion:Token$f.UINT8.get(a,e+4)})},SH_part3={len:2,get:(a,e)=>({sampleFrequency:[44100,48e3,37800,32e3][util$5.getBitAllignedNumber(a,e,0,3)],maxUsedBands:util$5.getBitAllignedNumber(a,e,3,5),channelCount:util$5.getBitAllignedNumber(a,e+1,0,4)+1,msUsed:util$5.isBitSet(a,e+1,4),audioBlockFrames:util$5.getBitAllignedNumber(a,e+1,5,3)})};class StreamReader{constructor(e){this.tokenizer=e}async readPacketHeader(){const e=await this.tokenizer.readToken(PacketKey),s=await this.readVariableSizeField();return{key:e,payloadLength:s.value-2-s.len}}async readStreamHeader(e){const s={};debug$c(`Reading SH at offset=${this.tokenizer.position}`);const o=await this.tokenizer.readToken(SH_part1);e-=SH_part1.len,Object.assign(s,o),debug$c(`SH.streamVersion = ${o.streamVersion}`);const c=await this.readVariableSizeField();e-=c.len,s.sampleCount=c.value;const d=await this.readVariableSizeField();e-=d.len,s.beginningOfSilence=d.value;const h=await this.tokenizer.readToken(SH_part3);return e-=SH_part3.len,Object.assign(s,h),await this.tokenizer.ignore(e),s}async readVariableSizeField(e=1,s=0){let o=await this.tokenizer.readNumber(Token$f.UINT8);return o&128?(o&=127,o+=s,this.readVariableSizeField(e+1,o<<7)):{len:e,value:s+o}}}StreamVersion8.StreamReader=StreamReader;Object.defineProperty(MpcSv8Parser$1,"__esModule",{value:!0});MpcSv8Parser$1.MpcSv8Parser=void 0;const debug_1$b=browserExports$1,BasicParser_1$6=BasicParser$1,APEv2Parser_1$4=APEv2Parser$1,FourCC_1$6=FourCC,SV8=StreamVersion8,debug$b=(0,debug_1$b.default)("music-metadata:parser:musepack");class MpcSv8Parser extends BasicParser_1$6.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){if(await this.tokenizer.readToken(FourCC_1$6.FourCcToken)!=="MPCK")throw new Error("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const e=new SV8.StreamReader(this.tokenizer);do{const s=await e.readPacketHeader();switch(debug$b(`packet-header key=${s.key}, payloadLength=${s.payloadLength}`),s.key){case"SH":const o=await e.readStreamHeader(s.payloadLength);this.metadata.setFormat("numberOfSamples",o.sampleCount),this.metadata.setFormat("sampleRate",o.sampleFrequency),this.metadata.setFormat("duration",o.sampleCount/o.sampleFrequency),this.metadata.setFormat("numberOfChannels",o.channelCount);break;case"AP":this.audioLength+=s.payloadLength,await this.tokenizer.ignore(s.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(s.payloadLength);break;case"SE":return this.metadata.setFormat("bitrate",this.audioLength*8/this.metadata.format.duration),APEv2Parser_1$4.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options);default:throw new Error(`Unexpected header: ${s.key}`)}}while(!0)}}MpcSv8Parser$1.MpcSv8Parser=MpcSv8Parser;var MpcSv7Parser$1={},BitReader$1={};Object.defineProperty(BitReader$1,"__esModule",{value:!0});BitReader$1.BitReader=void 0;const Token$e=lib$1;class BitReader{constructor(e){this.tokenizer=e,this.pos=0,this.dword=void 0}async read(e){for(;this.dword===void 0;)this.dword=await this.tokenizer.readToken(Token$e.UINT32_LE);let s=this.dword;return this.pos+=e,this.pos<32?(s>>>=32-this.pos,s&(1<<e)-1):(this.pos-=32,this.pos===0?(this.dword=void 0,s&(1<<e)-1):(this.dword=await this.tokenizer.readToken(Token$e.UINT32_LE),this.pos&&(s<<=this.pos,s|=this.dword>>>32-this.pos),s&(1<<e)-1))}async ignore(e){if(this.pos>0){const c=32-this.pos;this.dword=void 0,e-=c,this.pos=0}const s=e%32,o=(e-s)/32;return await this.tokenizer.ignore(o*4),this.read(s)}}BitReader$1.BitReader=BitReader;var StreamVersion7={};Object.defineProperty(StreamVersion7,"__esModule",{value:!0});StreamVersion7.Header=void 0;const Token$d=lib$1,util$4=Util;StreamVersion7.Header={len:6*4,get:(a,e)=>{const s={signature:Buffer.from(a).toString("latin1",e,e+3),streamMinorVersion:util$4.getBitAllignedNumber(a,e+3,0,4),streamMajorVersion:util$4.getBitAllignedNumber(a,e+3,4,4),frameCount:Token$d.UINT32_LE.get(a,e+4),maxLevel:Token$d.UINT16_LE.get(a,e+8),sampleFrequency:[44100,48e3,37800,32e3][util$4.getBitAllignedNumber(a,e+10,0,2)],link:util$4.getBitAllignedNumber(a,e+10,2,2),profile:util$4.getBitAllignedNumber(a,e+10,4,4),maxBand:util$4.getBitAllignedNumber(a,e+11,0,6),intensityStereo:util$4.isBitSet(a,e+11,6),midSideStereo:util$4.isBitSet(a,e+11,7),titlePeak:Token$d.UINT16_LE.get(a,e+12),titleGain:Token$d.UINT16_LE.get(a,e+14),albumPeak:Token$d.UINT16_LE.get(a,e+16),albumGain:Token$d.UINT16_LE.get(a,e+18),lastFrameLength:Token$d.UINT32_LE.get(a,e+20)>>>20&2047,trueGapless:util$4.isBitSet(a,e+23,0)};return s.lastFrameLength=s.trueGapless?Token$d.UINT32_LE.get(a,20)>>>20&2047:0,s}};Object.defineProperty(MpcSv7Parser$1,"__esModule",{value:!0});MpcSv7Parser$1.MpcSv7Parser=void 0;const debug_1$a=browserExports$1,BasicParser_1$5=BasicParser$1,APEv2Parser_1$3=APEv2Parser$1,BitReader_1=BitReader$1,SV7=StreamVersion7,debug$a=(0,debug_1$a.default)("music-metadata:parser:musepack");class MpcSv7Parser extends BasicParser_1$5.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){const e=await this.tokenizer.readToken(SV7.Header);if(e.signature!=="MP+")throw new Error("Unexpected magic number");debug$a(`stream-version=${e.streamMajorVersion}.${e.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",e.sampleFrequency);const s=1152*(e.frameCount-1)+e.lastFrameLength;this.metadata.setFormat("numberOfSamples",s),this.duration=s/e.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new BitReader_1.BitReader(this.tokenizer),this.metadata.setFormat("numberOfChannels",e.midSideStereo||e.intensityStereo?2:1);const o=await this.bitreader.read(8);return this.metadata.setFormat("codec",(o/100).toFixed(2)),await this.skipAudioData(e.frameCount),debug$a(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),APEv2Parser_1$3.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async skipAudioData(e){for(;e-- >0;){const o=await this.bitreader.read(20);this.audioLength+=20+o,await this.bitreader.ignore(o)}const s=await this.bitreader.read(11);this.audioLength+=s,this.metadata.setFormat("bitrate",this.audioLength/this.duration)}}MpcSv7Parser$1.MpcSv7Parser=MpcSv7Parser;Object.defineProperty(musepack,"__esModule",{value:!0});const debug_1$9=browserExports$1,Token$c=lib$1,AbstractID3Parser_1$1=AbstractID3Parser$1,MpcSv8Parser_1=MpcSv8Parser$1,MpcSv7Parser_1=MpcSv7Parser$1,debug$9=(0,debug_1$9.default)("music-metadata:parser:musepack");class MusepackParser extends AbstractID3Parser_1$1.AbstractID3Parser{async postId3v2Parse(){const e=await this.tokenizer.peekToken(new Token$c.StringType(3,"binary"));let s;switch(e){case"MP+":{debug$9("Musepack stream-version 7"),s=new MpcSv7Parser_1.MpcSv7Parser;break}case"MPC":{debug$9("Musepack stream-version 8"),s=new MpcSv8Parser_1.MpcSv8Parser;break}default:throw new Error("Invalid Musepack signature prefix")}return s.init(this.metadata,this.tokenizer,this.options),s.parse()}}musepack.default=MusepackParser;var OggParser$1={},OpusParser$1={},Opus$1={};Object.defineProperty(Opus$1,"__esModule",{value:!0});Opus$1.IdHeader=void 0;const Token$b=lib$1;class IdHeader{constructor(e){if(this.len=e,e<19)throw new Error("ID-header-page 0 should be at least 19 bytes long")}get(e,s){return{magicSignature:new Token$b.StringType(8,"ascii").get(e,s+0),version:e.readUInt8(s+8),channelCount:e.readUInt8(s+9),preSkip:e.readInt16LE(s+10),inputSampleRate:e.readInt32LE(s+12),outputGain:e.readInt16LE(s+16),channelMapping:e.readUInt8(s+18)}}}Opus$1.IdHeader=IdHeader;Object.defineProperty(OpusParser$1,"__esModule",{value:!0});OpusParser$1.OpusParser=void 0;const Token$a=lib$1,VorbisParser_1$2=VorbisParser$1,Opus=Opus$1;class OpusParser extends VorbisParser_1$2.VorbisParser{constructor(e,s,o){super(e,s),this.tokenizer=o,this.lastPos=-1}parseFirstPage(e,s){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new Opus.IdHeader(s.length).get(s,0),this.idHeader.magicSignature!=="OpusHead")throw new Error("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount)}parseFullPage(e){switch(new Token$a.StringType(8,"ascii").get(e,0)){case"OpusTags":this.parseUserCommentList(e,8),this.lastPos=this.tokenizer.position-e.length;break}}calculateDuration(e){if(this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0){const s=e.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",s),this.metadata.setFormat("duration",s/48e3),this.lastPos!==-1&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const o=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*o/this.metadata.format.duration)}}}}OpusParser$1.OpusParser=OpusParser;var SpeexParser$1={},Speex$1={};Object.defineProperty(Speex$1,"__esModule",{value:!0});Speex$1.Header=void 0;const Token$9=lib$1,util$3=Util;Speex$1.Header={len:80,get:(a,e)=>({speex:new Token$9.StringType(8,"ascii").get(a,e+0),version:util$3.trimRightNull(new Token$9.StringType(20,"ascii").get(a,e+8)),version_id:a.readInt32LE(e+28),header_size:a.readInt32LE(e+32),rate:a.readInt32LE(e+36),mode:a.readInt32LE(e+40),mode_bitstream_version:a.readInt32LE(e+44),nb_channels:a.readInt32LE(e+48),bitrate:a.readInt32LE(e+52),frame_size:a.readInt32LE(e+56),vbr:a.readInt32LE(e+60),frames_per_packet:a.readInt32LE(e+64),extra_headers:a.readInt32LE(e+68),reserved1:a.readInt32LE(e+72),reserved2:a.readInt32LE(e+76)})};Object.defineProperty(SpeexParser$1,"__esModule",{value:!0});SpeexParser$1.SpeexParser=void 0;const debug_1$8=browserExports$1,VorbisParser_1$1=VorbisParser$1,Speex=Speex$1,debug$8=(0,debug_1$8.default)("music-metadata:parser:ogg:speex");class SpeexParser extends VorbisParser_1$1.VorbisParser{constructor(e,s,o){super(e,s),this.tokenizer=o}parseFirstPage(e,s){debug$8("First Ogg/Speex page");const o=Speex.Header.get(s,0);this.metadata.setFormat("codec",`Speex ${o.version}`),this.metadata.setFormat("numberOfChannels",o.nb_channels),this.metadata.setFormat("sampleRate",o.rate),o.bitrate!==-1&&this.metadata.setFormat("bitrate",o.bitrate)}}SpeexParser$1.SpeexParser=SpeexParser;var TheoraParser$1={},Theora={};Object.defineProperty(Theora,"__esModule",{value:!0});Theora.IdentificationHeader=void 0;const Token$8=lib$1;Theora.IdentificationHeader={len:42,get:(a,e)=>({id:new Token$8.StringType(7,"ascii").get(a,e),vmaj:a.readUInt8(e+7),vmin:a.readUInt8(e+8),vrev:a.readUInt8(e+9),vmbw:a.readUInt16BE(e+10),vmbh:a.readUInt16BE(e+17),nombr:Token$8.UINT24_BE.get(a,e+37),nqual:a.readUInt8(e+40)})};Object.defineProperty(TheoraParser$1,"__esModule",{value:!0});TheoraParser$1.TheoraParser=void 0;const debug_1$7=browserExports$1,Theora_1=Theora,debug$7=(0,debug_1$7.default)("music-metadata:parser:ogg:theora");class TheoraParser{constructor(e,s,o){this.metadata=e,this.tokenizer=o}parsePage(e,s){e.headerType.firstPage&&this.parseFirstPage(e,s)}flush(){debug$7("flush")}calculateDuration(e){debug$7("duration calculation not implemented")}parseFirstPage(e,s){debug$7("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const o=Theora_1.IdentificationHeader.get(s,0);this.metadata.setFormat("bitrate",o.nombr)}}TheoraParser$1.TheoraParser=TheoraParser;Object.defineProperty(OggParser$1,"__esModule",{value:!0});OggParser$1.OggParser=OggParser$1.SegmentTable=void 0;const Token$7=lib$1,core_1=core$1,debug_1$6=browserExports$1,util$2=Util,FourCC_1$5=FourCC,BasicParser_1$4=BasicParser$1,VorbisParser_1=VorbisParser$1,OpusParser_1=OpusParser$1,SpeexParser_1=SpeexParser$1,TheoraParser_1=TheoraParser$1,debug$6=(0,debug_1$6.default)("music-metadata:parser:ogg");class SegmentTable{static sum(e,s,o){let c=0;for(let d=s;d<s+o;++d)c+=e[d];return c}constructor(e){this.len=e.page_segments}get(e,s){return{totalPageSize:SegmentTable.sum(e,s,this.len)}}}OggParser$1.SegmentTable=SegmentTable;class OggParser extends BasicParser_1$4.BasicParser{async parse(){debug$6("pos=%s, parsePage()",this.tokenizer.position);try{let e;do{if(e=await this.tokenizer.readToken(OggParser.Header),e.capturePattern!=="OggS")throw new Error("Invalid Ogg capture pattern");this.metadata.setFormat("container","Ogg"),this.header=e,this.pageNumber=e.pageSequenceNo,debug$6("page#=%s, Ogg.id=%s",e.pageSequenceNo,e.capturePattern);const s=await this.tokenizer.readToken(new SegmentTable(e));debug$6("totalPageSize=%s",s.totalPageSize);const o=await this.tokenizer.readToken(new Token$7.Uint8ArrayType(s.totalPageSize));if(debug$6("firstPage=%s, lastPage=%s, continued=%s",e.headerType.firstPage,e.headerType.lastPage,e.headerType.continued),e.headerType.firstPage){const c=new Token$7.StringType(7,"ascii").get(Buffer.from(o),0);switch(c){case"vorbis":debug$6("Set page consumer to Ogg/Vorbis"),this.pageConsumer=new VorbisParser_1.VorbisParser(this.metadata,this.options);break;case"OpusHea":debug$6("Set page consumer to Ogg/Opus"),this.pageConsumer=new OpusParser_1.OpusParser(this.metadata,this.options,this.tokenizer);break;case"Speex  ":debug$6("Set page consumer to Ogg/Speex"),this.pageConsumer=new SpeexParser_1.SpeexParser(this.metadata,this.options,this.tokenizer);break;case"fishead":case"\0theora":debug$6("Set page consumer to Ogg/Theora"),this.pageConsumer=new TheoraParser_1.TheoraParser(this.metadata,this.options,this.tokenizer);break;default:throw new Error("gg audio-codec not recognized (id="+c+")")}}this.pageConsumer.parsePage(e,o)}while(!e.headerType.lastPage)}catch(e){if(e instanceof core_1.EndOfStreamError)this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),debug$6("End-of-stream"),this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),this.header&&this.pageConsumer.calculateDuration(this.header);else if(e.message.startsWith("FourCC"))this.pageNumber>0&&(this.metadata.addWarning("Invalid FourCC ID, maybe last OGG-page is not marked with last-page flag"),this.pageConsumer.flush());else throw e}}}OggParser.Header={len:27,get:(a,e)=>({capturePattern:FourCC_1$5.FourCcToken.get(a,e),version:Token$7.UINT8.get(a,e+4),headerType:{continued:util$2.getBit(a,e+5,0),firstPage:util$2.getBit(a,e+5,1),lastPage:util$2.getBit(a,e+5,2)},absoluteGranulePosition:Number(Token$7.UINT64_LE.get(a,e+6)),streamSerialNumber:Token$7.UINT32_LE.get(a,e+14),pageSequenceNo:Token$7.UINT32_LE.get(a,e+18),pageChecksum:Token$7.UINT32_LE.get(a,e+22),page_segments:Token$7.UINT8.get(a,e+26)})};OggParser$1.OggParser=OggParser;var WaveParser$1={},RiffChunk={};Object.defineProperty(RiffChunk,"__esModule",{value:!0});RiffChunk.ListInfoTagValue=RiffChunk.Header=void 0;const Token$6=lib$1;RiffChunk.Header={len:8,get:(a,e)=>({chunkID:a.toString("binary",e,e+4),chunkSize:Token$6.UINT32_LE.get(a,4)})};class ListInfoTagValue{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=this.len&1}get(e,s){return new Token$6.StringType(this.tagHeader.chunkSize,"ascii").get(e,s)}}RiffChunk.ListInfoTagValue=ListInfoTagValue;var WaveChunk$1={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.FactChunk=a.Format=a.WaveFormat=void 0,function(o){o[o.PCM=1]="PCM",o[o.ADPCM=2]="ADPCM",o[o.IEEE_FLOAT=3]="IEEE_FLOAT",o[o.MPEG_ADTS_AAC=5632]="MPEG_ADTS_AAC",o[o.MPEG_LOAS=5634]="MPEG_LOAS",o[o.RAW_AAC1=255]="RAW_AAC1",o[o.DOLBY_AC3_SPDIF=146]="DOLBY_AC3_SPDIF",o[o.DVM=8192]="DVM",o[o.RAW_SPORT=576]="RAW_SPORT",o[o.ESST_AC3=577]="ESST_AC3",o[o.DRM=9]="DRM",o[o.DTS2=8193]="DTS2",o[o.MPEG=80]="MPEG"}(a.WaveFormat||(a.WaveFormat={}));class e{constructor(c){if(c.chunkSize<16)throw new Error("Invalid chunk size");this.len=c.chunkSize}get(c,d){return{wFormatTag:c.readUInt16LE(d),nChannels:c.readUInt16LE(d+2),nSamplesPerSec:c.readUInt32LE(d+4),nAvgBytesPerSec:c.readUInt32LE(d+8),nBlockAlign:c.readUInt16LE(d+12),wBitsPerSample:c.readUInt16LE(d+14)}}}a.Format=e;class s{constructor(c){if(c.chunkSize<4)throw new Error("Invalid fact chunk size.");this.len=c.chunkSize}get(c,d){return{dwSampleLength:c.readUInt32LE(d)}}}a.FactChunk=s})(WaveChunk$1);var BwfChunk={};Object.defineProperty(BwfChunk,"__esModule",{value:!0});BwfChunk.BroadcastAudioExtensionChunk=void 0;const Token$5=lib$1,Util_1=Util;BwfChunk.BroadcastAudioExtensionChunk={len:420,get:(a,e)=>({description:(0,Util_1.stripNulls)(new Token$5.StringType(256,"ascii").get(a,e)).trim(),originator:(0,Util_1.stripNulls)(new Token$5.StringType(32,"ascii").get(a,e+256)).trim(),originatorReference:(0,Util_1.stripNulls)(new Token$5.StringType(32,"ascii").get(a,e+288)).trim(),originationDate:(0,Util_1.stripNulls)(new Token$5.StringType(10,"ascii").get(a,e+320)).trim(),originationTime:(0,Util_1.stripNulls)(new Token$5.StringType(8,"ascii").get(a,e+330)).trim(),timeReferenceLow:Token$5.UINT32_LE.get(a,e+338),timeReferenceHigh:Token$5.UINT32_LE.get(a,e+342),version:Token$5.UINT16_LE.get(a,e+346),umid:new Token$5.Uint8ArrayType(64).get(a,e+348),loudnessValue:Token$5.UINT16_LE.get(a,e+412),maxTruePeakLevel:Token$5.UINT16_LE.get(a,e+414),maxMomentaryLoudness:Token$5.UINT16_LE.get(a,e+416),maxShortTermLoudness:Token$5.UINT16_LE.get(a,e+418)})};Object.defineProperty(WaveParser$1,"__esModule",{value:!0});WaveParser$1.WaveParser=void 0;const strtok3$2=core$1,Token$4=lib$1,debug_1$5=browserExports$1,riff=RiffChunk,WaveChunk=WaveChunk$1,ID3v2Parser_1$2=ID3v2Parser$1,util$1=Util,FourCC_1$4=FourCC,BasicParser_1$3=BasicParser$1,BwfChunk_1=BwfChunk,debug$5=(0,debug_1$5.default)("music-metadata:parser:RIFF");class WaveParser extends BasicParser_1$3.BasicParser{async parse(){const e=await this.tokenizer.readToken(riff.Header);if(debug$5(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),e.chunkID==="RIFF")return this.parseRiffChunk(e.chunkSize).catch(s=>{if(!(s instanceof strtok3$2.EndOfStreamError))throw s})}async parseRiffChunk(e){const s=await this.tokenizer.readToken(FourCC_1$4.FourCcToken);switch(this.metadata.setFormat("container",s),s){case"WAVE":return this.readWaveChunk(e-FourCC_1$4.FourCcToken.len);default:throw new Error(`Unsupported RIFF format: RIFF/${s}`)}}async readWaveChunk(e){for(;e>=riff.Header.len;){const s=await this.tokenizer.readToken(riff.Header);switch(e-=riff.Header.len+s.chunkSize,s.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=s,debug$5(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${s.chunkID}`),s.chunkID){case"LIST":await this.parseListTag(s);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new WaveChunk.FactChunk(s));break;case"fmt ":const o=await this.tokenizer.readToken(new WaveChunk.Format(s));let c=WaveChunk.WaveFormat[o.wFormatTag];c||(debug$5("WAVE/non-PCM format="+o.wFormatTag),c="non-PCM ("+o.wFormatTag+")"),this.metadata.setFormat("codec",c),this.metadata.setFormat("bitsPerSample",o.wBitsPerSample),this.metadata.setFormat("sampleRate",o.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",o.nChannels),this.metadata.setFormat("bitrate",o.nBlockAlign*o.nSamplesPerSec*8),this.blockAlign=o.nBlockAlign;break;case"id3 ":case"ID3 ":const d=await this.tokenizer.readToken(new Token$4.Uint8ArrayType(s.chunkSize)),h=strtok3$2.fromBuffer(d);await new ID3v2Parser_1$2.ID3v2Parser().parse(this.metadata,h,this.options);break;case"data":this.metadata.format.lossless!==!1&&this.metadata.setFormat("lossless",!0);let g=s.chunkSize;if(this.tokenizer.fileInfo.size){const j=this.tokenizer.fileInfo.size-this.tokenizer.position;j<g&&(this.metadata.addWarning("data chunk length exceeding file length"),g=j)}const _=this.fact?this.fact.dwSampleLength:g===4294967295?void 0:g/this.blockAlign;_&&(this.metadata.setFormat("numberOfSamples",_),this.metadata.setFormat("duration",_/this.metadata.format.sampleRate)),this.metadata.format.codec==="ADPCM"?this.metadata.setFormat("bitrate",352e3):this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(s.chunkSize);break;case"bext":const b=await this.tokenizer.readToken(BwfChunk_1.BroadcastAudioExtensionChunk);Object.keys(b).forEach(j=>{this.metadata.addTag("exif","bext."+j,b[j])});const $=s.chunkSize-BwfChunk_1.BroadcastAudioExtensionChunk.len;await this.tokenizer.ignore($);break;case"\0\0\0\0":debug$5(`Ignore padding chunk: RIFF/${s.chunkID} of ${s.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+s.chunkID),await this.tokenizer.ignore(s.chunkSize);break;default:debug$5(`Ignore chunk: RIFF/${s.chunkID} of ${s.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+s.chunkID),await this.tokenizer.ignore(s.chunkSize)}this.header.chunkSize%2===1&&(debug$5("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const s=await this.tokenizer.readToken(new Token$4.StringType(4,"binary"));switch(debug$5("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,s),s){case"INFO":return this.parseRiffInfoTags(e.chunkSize-4);case"adtl":default:return this.metadata.addWarning("Ignore chunk: RIFF/WAVE/LIST/"+s),debug$5("Ignoring chunkID=RIFF/WAVE/LIST/"+s),this.tokenizer.ignore(e.chunkSize-4).then()}}async parseRiffInfoTags(e){for(;e>=8;){const s=await this.tokenizer.readToken(riff.Header),o=new riff.ListInfoTagValue(s),c=await this.tokenizer.readToken(o);this.addTag(s.chunkID,util$1.stripNulls(c)),e-=8+o.len}if(e!==0)throw Error("Illegal remaining size: "+e)}addTag(e,s){this.metadata.addTag("exif",e,s)}}WaveParser$1.WaveParser=WaveParser;var WavPackParser$1={},WavPackToken={};Object.defineProperty(WavPackToken,"__esModule",{value:!0});WavPackToken.WavPack=void 0;const Token$3=lib$1,FourCC_1$3=FourCC,SampleRates=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1];class WavPack{static isBitSet(e,s){return WavPack.getBitAllignedNumber(e,s,1)===1}static getBitAllignedNumber(e,s,o){return e>>>s&4294967295>>>32-o}}WavPack.BlockHeaderToken={len:32,get:(a,e)=>{const s=Token$3.UINT32_LE.get(a,e+24),o={BlockID:FourCC_1$3.FourCcToken.get(a,e),blockSize:Token$3.UINT32_LE.get(a,e+4),version:Token$3.UINT16_LE.get(a,e+8),totalSamples:Token$3.UINT32_LE.get(a,e+12),blockIndex:Token$3.UINT32_LE.get(a,e+16),blockSamples:Token$3.UINT32_LE.get(a,e+20),flags:{bitsPerSample:(1+WavPack.getBitAllignedNumber(s,0,2))*8,isMono:WavPack.isBitSet(s,2),isHybrid:WavPack.isBitSet(s,3),isJointStereo:WavPack.isBitSet(s,4),crossChannel:WavPack.isBitSet(s,5),hybridNoiseShaping:WavPack.isBitSet(s,6),floatingPoint:WavPack.isBitSet(s,7),samplingRate:SampleRates[WavPack.getBitAllignedNumber(s,23,4)],isDSD:WavPack.isBitSet(s,31)},crc:new Token$3.Uint8ArrayType(4).get(a,e+28)};return o.flags.isDSD&&(o.totalSamples*=8),o}};WavPack.MetadataIdToken={len:1,get:(a,e)=>({functionId:WavPack.getBitAllignedNumber(a[e],0,6),isOptional:WavPack.isBitSet(a[e],5),isOddSize:WavPack.isBitSet(a[e],6),largeBlock:WavPack.isBitSet(a[e],7)})};WavPackToken.WavPack=WavPack;Object.defineProperty(WavPackParser$1,"__esModule",{value:!0});WavPackParser$1.WavPackParser=void 0;const Token$2=lib$1,APEv2Parser_1$2=APEv2Parser$1,FourCC_1$2=FourCC,BasicParser_1$2=BasicParser$1,WavPackToken_1=WavPackToken,debug_1$4=browserExports$1,debug$4=(0,debug_1$4.default)("music-metadata:parser:WavPack");class WavPackParser extends BasicParser_1$2.BasicParser{async parse(){return this.audioDataSize=0,await this.parseWavPackBlocks(),APEv2Parser_1$2.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if(await this.tokenizer.peekToken(FourCC_1$2.FourCcToken)!=="wvpk")break;const s=await this.tokenizer.readToken(WavPackToken_1.WavPack.BlockHeaderToken);if(s.BlockID!=="wvpk")throw new Error("Invalid WavPack Block-ID");debug$4(`WavPack header blockIndex=${s.blockIndex}, len=${WavPackToken_1.WavPack.BlockHeaderToken.len}`),s.blockIndex===0&&!this.metadata.format.container&&(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!s.flags.isHybrid),this.metadata.setFormat("bitsPerSample",s.flags.bitsPerSample),s.flags.isDSD||(this.metadata.setFormat("sampleRate",s.flags.samplingRate),this.metadata.setFormat("duration",s.totalSamples/s.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",s.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",s.totalSamples),this.metadata.setFormat("codec",s.flags.isDSD?"DSD":"PCM"));const o=s.blockSize-(WavPackToken_1.WavPack.BlockHeaderToken.len-8);await(s.blockIndex===0?this.parseMetadataSubBlock(s,o):this.tokenizer.ignore(o)),s.blockSamples>0&&(this.audioDataSize+=s.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=WavPackToken_1.WavPack.BlockHeaderToken.len);this.metadata.setFormat("bitrate",this.audioDataSize*8/this.metadata.format.duration)}async parseMetadataSubBlock(e,s){for(;s>WavPackToken_1.WavPack.MetadataIdToken.len;){const o=await this.tokenizer.readToken(WavPackToken_1.WavPack.MetadataIdToken),c=await this.tokenizer.readNumber(o.largeBlock?Token$2.UINT24_LE:Token$2.UINT8),d=Buffer.alloc(c*2-(o.isOddSize?1:0));switch(await this.tokenizer.readBuffer(d),debug$4(`Metadata Sub-Blocks functionId=0x${o.functionId.toString(16)}, id.largeBlock=${o.largeBlock},data-size=${d.length}`),o.functionId){case 0:break;case 14:debug$4("ID_DSD_BLOCK");const h=1<<d.readUInt8(0),g=e.flags.samplingRate*h*8;if(!e.flags.isDSD)throw new Error("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",g),this.metadata.setFormat("duration",e.totalSamples/g);break;case 36:debug$4("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",d);break;case 47:debug$4(`ID_BLOCK_CHECKSUM: checksum=${d.toString("hex")}`);break;default:debug$4(`Ignore unsupported meta-sub-block-id functionId=0x${o.functionId.toString(16)}`);break}s-=WavPackToken_1.WavPack.MetadataIdToken.len+(o.largeBlock?Token$2.UINT24_LE.len:Token$2.UINT8.len)+c*2,debug$4(`remainingLength=${s}`),o.isOddSize&&this.tokenizer.ignore(1)}if(s!==0)throw new Error("metadata-sub-block should fit it remaining length")}}WavPackParser$1.WavPackParser=WavPackParser;var DsfParser$1={},DsfChunk={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.FormatChunk=a.ChannelType=a.DsdChunk=a.ChunkHeader=void 0;const e=lib$1,s=FourCC;a.ChunkHeader={len:12,get:(o,c)=>({id:s.FourCcToken.get(o,c),size:e.UINT64_LE.get(o,c+4)})},a.DsdChunk={len:16,get:(o,c)=>({fileSize:e.INT64_LE.get(o,c),metadataPointer:e.INT64_LE.get(o,c+8)})},function(o){o[o.mono=1]="mono",o[o.stereo=2]="stereo",o[o.channels=3]="channels",o[o.quad=4]="quad",o[o["4 channels"]=5]="4 channels",o[o["5 channels"]=6]="5 channels",o[o["5.1 channels"]=7]="5.1 channels"}(a.ChannelType||(a.ChannelType={})),a.FormatChunk={len:40,get:(o,c)=>({formatVersion:e.INT32_LE.get(o,c),formatID:e.INT32_LE.get(o,c+4),channelType:e.INT32_LE.get(o,c+8),channelNum:e.INT32_LE.get(o,c+12),samplingFrequency:e.INT32_LE.get(o,c+16),bitsPerSample:e.INT32_LE.get(o,c+20),sampleCount:e.INT64_LE.get(o,c+24),blockSizePerChannel:e.INT32_LE.get(o,c+32)})}})(DsfChunk);Object.defineProperty(DsfParser$1,"__esModule",{value:!0});DsfParser$1.DsfParser=void 0;const debug_1$3=browserExports$1,AbstractID3Parser_1=AbstractID3Parser$1,DsfChunk_1=DsfChunk,ID3v2Parser_1$1=ID3v2Parser$1,debug$3=(0,debug_1$3.default)("music-metadata:parser:DSF");class DsfParser extends AbstractID3Parser_1.AbstractID3Parser{async postId3v2Parse(){const e=this.tokenizer.position,s=await this.tokenizer.readToken(DsfChunk_1.ChunkHeader);if(s.id!=="DSD ")throw new Error("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0);const o=await this.tokenizer.readToken(DsfChunk_1.DsdChunk);if(o.metadataPointer===BigInt(0))debug$3("No ID3v2 tag present");else return debug$3(`expect ID3v2 at offset=${o.metadataPointer}`),await this.parseChunks(o.fileSize-s.size),await this.tokenizer.ignore(Number(o.metadataPointer)-this.tokenizer.position-e),new ID3v2Parser_1$1.ID3v2Parser().parse(this.metadata,this.tokenizer,this.options)}async parseChunks(e){for(;e>=DsfChunk_1.ChunkHeader.len;){const s=await this.tokenizer.readToken(DsfChunk_1.ChunkHeader);switch(debug$3(`Parsing chunk name=${s.id} size=${s.size}`),s.id){case"fmt ":const o=await this.tokenizer.readToken(DsfChunk_1.FormatChunk);this.metadata.setFormat("numberOfChannels",o.channelNum),this.metadata.setFormat("sampleRate",o.samplingFrequency),this.metadata.setFormat("bitsPerSample",o.bitsPerSample),this.metadata.setFormat("numberOfSamples",o.sampleCount),this.metadata.setFormat("duration",Number(o.sampleCount)/o.samplingFrequency);const c=o.bitsPerSample*o.samplingFrequency*o.channelNum;this.metadata.setFormat("bitrate",c);return;default:this.tokenizer.ignore(Number(s.size)-DsfChunk_1.ChunkHeader.len);break}e-=s.size}}}DsfParser$1.DsfParser=DsfParser;var DsdiffParser$1={},DsdiffToken={};Object.defineProperty(DsdiffToken,"__esModule",{value:!0});DsdiffToken.ChunkHeader64=void 0;const Token$1=lib$1,FourCC_1$1=FourCC;DsdiffToken.ChunkHeader64={len:12,get:(a,e)=>({chunkID:FourCC_1$1.FourCcToken.get(a,e),chunkSize:Token$1.INT64_BE.get(a,e+4)})};Object.defineProperty(DsdiffParser$1,"__esModule",{value:!0});DsdiffParser$1.DsdiffParser=void 0;const Token=lib$1,debug_1$2=browserExports$1,strtok3$1=core$1,FourCC_1=FourCC,BasicParser_1$1=BasicParser$1,ID3v2Parser_1=ID3v2Parser$1,DsdiffToken_1=DsdiffToken,debug$2=(0,debug_1$2.default)("music-metadata:parser:aiff");class DsdiffParser extends BasicParser_1$1.BasicParser{async parse(){const e=await this.tokenizer.readToken(DsdiffToken_1.ChunkHeader64);if(e.chunkID!=="FRM8")throw new Error("Unexpected chunk-ID");const s=(await this.tokenizer.readToken(FourCC_1.FourCcToken)).trim();switch(s){case"DSD":return this.metadata.setFormat("container",`DSDIFF/${s}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt(FourCC_1.FourCcToken.len));default:throw Error(`Unsupported DSDIFF type: ${s}`)}}async readFmt8Chunks(e){for(;e>=DsdiffToken_1.ChunkHeader64.len;){const s=await this.tokenizer.readToken(DsdiffToken_1.ChunkHeader64);debug$2(`Chunk id=${s.chunkID}`),await this.readData(s),e-=BigInt(DsdiffToken_1.ChunkHeader64.len)+s.chunkSize}}async readData(e){debug$2(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);const s=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":const c=await this.tokenizer.readToken(Token.UINT32_LE);debug$2(`DSDIFF version=${c}`);break;case"PROP":if(await this.tokenizer.readToken(FourCC_1.FourCcToken)!=="SND ")throw new Error("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt(FourCC_1.FourCcToken.len));break;case"ID3":const h=await this.tokenizer.readToken(new Token.Uint8ArrayType(Number(e.chunkSize))),g=strtok3$1.fromBuffer(h);await new ID3v2Parser_1.ID3v2Parser().parse(this.metadata,g,this.options);break;default:debug$2(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);break;case"DSD":this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break}const o=e.chunkSize-BigInt(this.tokenizer.position-s);o>0&&(debug$2(`After Parsing chunk, remaining ${o} bytes`),await this.tokenizer.ignore(Number(o)))}async handleSoundPropertyChunks(e){for(debug$2(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){const s=await this.tokenizer.readToken(DsdiffToken_1.ChunkHeader64);debug$2(`Sound-property-chunk[ID=${s.chunkID}, size=${s.chunkSize}]`);const o=this.tokenizer.position;switch(s.chunkID.trim()){case"FS":const d=await this.tokenizer.readToken(Token.UINT32_BE);this.metadata.setFormat("sampleRate",d);break;case"CHNL":const h=await this.tokenizer.readToken(Token.UINT16_BE);this.metadata.setFormat("numberOfChannels",h),await this.handleChannelChunks(s.chunkSize-BigInt(Token.UINT16_BE.len));break;case"CMPR":const g=(await this.tokenizer.readToken(FourCC_1.FourCcToken)).trim(),_=await this.tokenizer.readToken(Token.UINT8),b=await this.tokenizer.readToken(new Token.StringType(_,"ascii"));g==="DSD"&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${g} (${b})`);break;case"ABSS":const $=await this.tokenizer.readToken(Token.UINT16_BE),j=await this.tokenizer.readToken(Token.UINT8),_e=await this.tokenizer.readToken(Token.UINT8),tt=await this.tokenizer.readToken(Token.UINT32_BE);debug$2(`ABSS ${$}:${j}:${_e}.${tt}`);break;case"LSCO":const rt=await this.tokenizer.readToken(Token.UINT16_BE);debug$2(`LSCO lsConfig=${rt}`);break;case"COMT":default:debug$2(`Unknown sound-property-chunk[ID=${s.chunkID}, size=${s.chunkSize}]`),await this.tokenizer.ignore(Number(s.chunkSize))}const c=s.chunkSize-BigInt(this.tokenizer.position-o);c>0&&(debug$2(`After Parsing sound-property-chunk ${s.chunkSize}, remaining ${c} bytes`),await this.tokenizer.ignore(Number(c))),e-=BigInt(DsdiffToken_1.ChunkHeader64.len)+s.chunkSize,debug$2(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const s=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",s)}}async handleChannelChunks(e){debug$2(`Parsing channel-chunks, remainingSize=${e}`);const s=[];for(;e>=FourCC_1.FourCcToken.len;){const o=await this.tokenizer.readToken(FourCC_1.FourCcToken);debug$2(`Channel[ID=${o}]`),s.push(o),e-=BigInt(FourCC_1.FourCcToken.len)}return debug$2(`Channels: ${s.join(", ")}`),s}}DsdiffParser$1.DsdiffParser=DsdiffParser;var MatroskaParser$1={},MatroskaDtd={};Object.defineProperty(MatroskaDtd,"__esModule",{value:!0});MatroskaDtd.elements=void 0;const types_1$1=types;MatroskaDtd.elements={440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:types_1$1.DataType.uint},17143:{name:"ebmlReadVersion",value:types_1$1.DataType.uint},17138:{name:"ebmlMaxIDWidth",value:types_1$1.DataType.uint},17139:{name:"ebmlMaxSizeWidth",value:types_1$1.DataType.uint},17026:{name:"docType",value:types_1$1.DataType.string},17031:{name:"docTypeVersion",value:types_1$1.DataType.uint},17029:{name:"docTypeReadVersion",value:types_1$1.DataType.uint}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",container:{21419:{name:"seekId",value:types_1$1.DataType.binary},21420:{name:"seekPosition",value:types_1$1.DataType.uint}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:types_1$1.DataType.uid},29572:{name:"filename",value:types_1$1.DataType.string},3979555:{name:"prevUID",value:types_1$1.DataType.uid},3965867:{name:"prevFilename",value:types_1$1.DataType.string},4110627:{name:"nextUID",value:types_1$1.DataType.uid},4096955:{name:"nextFilename",value:types_1$1.DataType.string},2807729:{name:"timecodeScale",value:types_1$1.DataType.uint},17545:{name:"duration",value:types_1$1.DataType.float},17505:{name:"dateUTC",value:types_1$1.DataType.uint},31657:{name:"title",value:types_1$1.DataType.string},19840:{name:"muxingApp",value:types_1$1.DataType.string},22337:{name:"writingApp",value:types_1$1.DataType.string}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:types_1$1.DataType.uid},163:{name:"unknown",value:types_1$1.DataType.binary},167:{name:"position",value:types_1$1.DataType.uid},171:{name:"prevSize",value:types_1$1.DataType.uid}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:types_1$1.DataType.uint},29637:{name:"uid",value:types_1$1.DataType.uid},131:{name:"trackType",value:types_1$1.DataType.uint},185:{name:"flagEnabled",value:types_1$1.DataType.bool},136:{name:"flagDefault",value:types_1$1.DataType.bool},21930:{name:"flagForced",value:types_1$1.DataType.bool},156:{name:"flagLacing",value:types_1$1.DataType.bool},28135:{name:"minCache",value:types_1$1.DataType.uint},28136:{name:"maxCache",value:types_1$1.DataType.uint},2352003:{name:"defaultDuration",value:types_1$1.DataType.uint},2306383:{name:"timecodeScale",value:types_1$1.DataType.float},21358:{name:"name",value:types_1$1.DataType.string},2274716:{name:"language",value:types_1$1.DataType.string},134:{name:"codecID",value:types_1$1.DataType.string},25506:{name:"codecPrivate",value:types_1$1.DataType.binary},2459272:{name:"codecName",value:types_1$1.DataType.string},3839639:{name:"codecSettings",value:types_1$1.DataType.string},3883072:{name:"codecInfoUrl",value:types_1$1.DataType.string},2536e3:{name:"codecDownloadUrl",value:types_1$1.DataType.string},170:{name:"codecDecodeAll",value:types_1$1.DataType.bool},28587:{name:"trackOverlay",value:types_1$1.DataType.uint},224:{name:"video",container:{154:{name:"flagInterlaced",value:types_1$1.DataType.bool},21432:{name:"stereoMode",value:types_1$1.DataType.uint},176:{name:"pixelWidth",value:types_1$1.DataType.uint},186:{name:"pixelHeight",value:types_1$1.DataType.uint},21680:{name:"displayWidth",value:types_1$1.DataType.uint},21690:{name:"displayHeight",value:types_1$1.DataType.uint},21683:{name:"aspectRatioType",value:types_1$1.DataType.uint},3061028:{name:"colourSpace",value:types_1$1.DataType.uint},3126563:{name:"gammaValue",value:types_1$1.DataType.float}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:types_1$1.DataType.float},30901:{name:"outputSamplingFrequency",value:types_1$1.DataType.float},159:{name:"channels",value:types_1$1.DataType.uint},148:{name:"channels",value:types_1$1.DataType.uint},32123:{name:"channelPositions",value:types_1$1.DataType.binary},25188:{name:"bitDepth",value:types_1$1.DataType.uint}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:types_1$1.DataType.uint},20530:{name:"scope",value:types_1$1.DataType.bool},20531:{name:"type",value:types_1$1.DataType.uint},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:types_1$1.DataType.uint},16981:{name:"contentCompSettings",value:types_1$1.DataType.binary}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:types_1$1.DataType.uint},18402:{name:"contentEncKeyID",value:types_1$1.DataType.binary},18403:{name:"contentSignature ",value:types_1$1.DataType.binary},18404:{name:"ContentSigKeyID  ",value:types_1$1.DataType.binary},18405:{name:"contentSigAlgo ",value:types_1$1.DataType.uint},18406:{name:"contentSigHashAlgo ",value:types_1$1.DataType.uint}}},25188:{name:"bitDepth",value:types_1$1.DataType.uint}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:types_1$1.DataType.uid},183:{name:"positions",container:{247:{name:"track",value:types_1$1.DataType.uint},241:{name:"clusterPosition",value:types_1$1.DataType.uint},21368:{name:"blockNumber",value:types_1$1.DataType.uint},234:{name:"codecState",value:types_1$1.DataType.uint},219:{name:"reference",container:{150:{name:"time",value:types_1$1.DataType.uint},151:{name:"cluster",value:types_1$1.DataType.uint},21343:{name:"number",value:types_1$1.DataType.uint},235:{name:"codecState",value:types_1$1.DataType.uint}}},240:{name:"relativePosition",value:types_1$1.DataType.uint}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:types_1$1.DataType.string},18030:{name:"name",value:types_1$1.DataType.string},18016:{name:"mimeType",value:types_1$1.DataType.string},18012:{name:"data",value:types_1$1.DataType.binary},18094:{name:"uid",value:types_1$1.DataType.uid}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:types_1$1.DataType.uid},145:{name:"timeStart",value:types_1$1.DataType.uint},146:{name:"timeEnd",value:types_1$1.DataType.uid},152:{name:"hidden",value:types_1$1.DataType.bool},17816:{name:"enabled",value:types_1$1.DataType.uid},143:{name:"track",container:{137:{name:"trackNumber",value:types_1$1.DataType.uid},128:{name:"display",container:{133:{name:"string",value:types_1$1.DataType.string},17276:{name:"language ",value:types_1$1.DataType.string},17278:{name:"country ",value:types_1$1.DataType.string}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:types_1$1.DataType.uid},25540:{name:"tagChapterUID",value:types_1$1.DataType.uint},25542:{name:"tagAttachmentUID",value:types_1$1.DataType.uid},25546:{name:"targetType",value:types_1$1.DataType.string},26826:{name:"targetTypeValue",value:types_1$1.DataType.uint},25545:{name:"tagEditionUID",value:types_1$1.DataType.uid}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:types_1$1.DataType.string},17543:{name:"string",value:types_1$1.DataType.string},17541:{name:"binary",value:types_1$1.DataType.binary},17530:{name:"language",value:types_1$1.DataType.string},17531:{name:"languageIETF",value:types_1$1.DataType.string},17540:{name:"default",value:types_1$1.DataType.bool}}}}}}}}}};Object.defineProperty(MatroskaParser$1,"__esModule",{value:!0});MatroskaParser$1.MatroskaParser=void 0;const token_types_1=lib$1,debug_1$1=browserExports$1,BasicParser_1=BasicParser$1,types_1=types,matroskaDtd=MatroskaDtd,debug$1=(0,debug_1$1.default)("music-metadata:parser:matroska");class MatroskaParser extends BasicParser_1.BasicParser{constructor(){super(),this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.parserMap.set(types_1.DataType.uint,e=>this.readUint(e)),this.parserMap.set(types_1.DataType.string,e=>this.readString(e)),this.parserMap.set(types_1.DataType.binary,e=>this.readBuffer(e)),this.parserMap.set(types_1.DataType.uid,async e=>await this.readUint(e)===1),this.parserMap.set(types_1.DataType.bool,e=>this.readFlag(e)),this.parserMap.set(types_1.DataType.float,e=>this.readFloat(e))}init(e,s,o){return super.init(e,s,o),this}async parse(){const e=await this.parseContainer(matroskaDtd.elements,this.tokenizer.fileInfo.size,[]);if(this.metadata.setFormat("container",`EBML/${e.ebml.docType}`),e.segment){const s=e.segment.info;if(s){const c=s.timecodeScale?s.timecodeScale:1e6;if(typeof s.duration=="number"){const d=s.duration*c/1e9;this.addTag("segment:title",s.title),this.metadata.setFormat("duration",d)}}const o=e.segment.tracks;if(o&&o.entries){o.entries.forEach(d=>{const h={codecName:d.codecID.replace("A_","").replace("V_",""),codecSettings:d.codecSettings,flagDefault:d.flagDefault,flagLacing:d.flagLacing,flagEnabled:d.flagEnabled,language:d.language,name:d.name,type:d.trackType,audio:d.audio,video:d.video};this.metadata.addStreamInfo(h)});const c=o.entries.filter(d=>d.trackType===types_1.TrackType.audio.valueOf()).reduce((d,h)=>!d||!d.flagDefault&&h.flagDefault||h.trackNumber&&h.trackNumber<d.trackNumber?h:d,null);c&&(this.metadata.setFormat("codec",c.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",c.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",c.audio.channels)),e.segment.tags&&e.segment.tags.tag.forEach(d=>{const h=d.target,g=h!=null&&h.targetTypeValue?types_1.TargetType[h.targetTypeValue]:h!=null&&h.targetType?h.targetType:"track";d.simpleTags.forEach(_=>{const b=_.string?_.string:_.binary;this.addTag(`${g}:${_.name}`,b)})}),e.segment.attachments&&e.segment.attachments.attachedFiles.filter(d=>d.mimeType.startsWith("image/")).map(d=>({data:d.data,format:d.mimeType,description:d.description,name:d.name})).forEach(d=>{this.addTag("picture",d)})}}}async parseContainer(e,s,o){const c={};for(;this.tokenizer.position<s;){let d;try{d=await this.readElement()}catch(g){if(g.message==="End-Of-Stream")break;throw g}const h=e[d.id];if(h)if(debug$1(`Element: name=${h.name}, container=${!!h.container}`),h.container){const g=await this.parseContainer(h.container,d.len>=0?this.tokenizer.position+d.len:-1,o.concat([h.name]));h.multiple?(c[h.name]||(c[h.name]=[]),c[h.name].push(g)):c[h.name]=g}else c[h.name]=await this.parserMap.get(h.value)(d);else switch(d.id){case 236:this.padding+=d.len,await this.tokenizer.ignore(d.len);break;default:debug$1(`parseEbml: path=${o.join("/")}, unknown element: id=${d.id.toString(16)}`),this.padding+=d.len,await this.tokenizer.ignore(d.len)}}return c}async readVintData(e){const s=await this.tokenizer.peekNumber(token_types_1.UINT8);let o=128,c=1;for(;!(s&o);){if(c>e)throw new Error("VINT value exceeding maximum size");++c,o>>=1}const d=Buffer.alloc(c);return await this.tokenizer.readBuffer(d),d}async readElement(){const e=await this.readVintData(this.ebmlMaxIDLength),s=await this.readVintData(this.ebmlMaxSizeLength);s[0]^=128>>s.length-1;const o=Math.min(6,s.length);return{id:e.readUIntBE(0,e.length),len:s.readUIntBE(s.length-o,o)}}isMaxValue(e){if(e.length===this.ebmlMaxSizeLength){for(let s=1;s<this.ebmlMaxSizeLength;++s)if(e[s]!==255)return!1;return!0}return!1}async readFloat(e){switch(e.len){case 0:return 0;case 4:return this.tokenizer.readNumber(token_types_1.Float32_BE);case 8:return this.tokenizer.readNumber(token_types_1.Float64_BE);case 10:return this.tokenizer.readNumber(token_types_1.Float64_BE);default:throw new Error(`Invalid IEEE-754 float length: ${e.len}`)}}async readFlag(e){return await this.readUint(e)===1}async readUint(e){const s=await this.readBuffer(e),o=Math.min(6,e.len);return s.readUIntBE(e.len-o,o)}async readString(e){return(await this.tokenizer.readToken(new token_types_1.StringType(e.len,"utf-8"))).replace(/\00.*$/g,"")}async readBuffer(e){const s=Buffer.alloc(e.len);return await this.tokenizer.readBuffer(s),s}addTag(e,s){this.metadata.addTag("matroska",e,s)}}MatroskaParser$1.MatroskaParser=MatroskaParser;Object.defineProperty(ParserFactory$1,"__esModule",{value:!0});ParserFactory$1.ParserFactory=ParserFactory$1.parseHttpContentType=void 0;const FileType=core,ContentType=contentType,MimeType=mediaTyper,debug_1=browserExports$1,MetadataCollector_1=MetadataCollector$1,AiffParser_1=AiffParser,APEv2Parser_1$1=APEv2Parser$1,AsfParser_1=AsfParser$1,FlacParser_1=FlacParser$1,MP4Parser_1=MP4Parser$1,MpegParser_1=MpegParser$1,musepack_1=musepack,OggParser_1=OggParser$1,WaveParser_1=WaveParser$1,WavPackParser_1=WavPackParser$1,DsfParser_1=DsfParser$1,DsdiffParser_1=DsdiffParser$1,MatroskaParser_1=MatroskaParser$1,debug=(0,debug_1.default)("music-metadata:parser:factory");function parseHttpContentType(a){const e=ContentType.parse(a),s=MimeType.parse(e.type);return{type:s.type,subtype:s.subtype,suffix:s.suffix,parameters:e.parameters}}ParserFactory$1.parseHttpContentType=parseHttpContentType;async function parse(a,e,s={}){const o=await ParserFactory.loadParser(e),c=new MetadataCollector_1.MetadataCollector(s);return await o.init(c,a,s).parse(),c.toCommonMetadata()}class ParserFactory{static async parseOnContentType(e,s){const{mimeType:o,path:c,url:d}=await e.fileInfo,h=ParserFactory.getParserIdForMimeType(o)||ParserFactory.getParserIdForExtension(c)||ParserFactory.getParserIdForExtension(d);return h||debug("No parser found for MIME-type / extension: "+o),this.parse(e,h,s)}static async parse(e,s,o){if(!s){debug("Guess parser on content...");const c=Buffer.alloc(4100);if(await e.peekBuffer(c,{mayBeLess:!0}),e.fileInfo.path&&(s=this.getParserIdForExtension(e.fileInfo.path)),!s){const d=await FileType.fromBuffer(c);if(!d)throw new Error("Failed to determine audio format");if(debug(`Guessed file type is mime=${d.mime}, extension=${d.ext}`),s=ParserFactory.getParserIdForMimeType(d.mime),!s)throw new Error("Guessed MIME-type not supported: "+d.mime)}}return parse(e,s,o)}static getParserIdForExtension(e){if(!e)return;switch(this.getExtension(e).toLocaleLowerCase()||e){case".mp2":case".mp3":case".m2a":case".aac":return"mpeg";case".ape":return"apev2";case".mp4":case".m4a":case".m4b":case".m4pa":case".m4v":case".m4r":case".3gp":return"mp4";case".wma":case".wmv":case".asf":return"asf";case".flac":return"flac";case".ogg":case".ogv":case".oga":case".ogm":case".ogx":case".opus":case".spx":return"ogg";case".aif":case".aiff":case".aifc":return"aiff";case".wav":case".bwf":return"riff";case".wv":case".wvp":return"wavpack";case".mpc":return"musepack";case".dsf":return"dsf";case".dff":return"dsdiff";case".mka":case".mkv":case".mk3d":case".mks":case".webm":return"matroska"}}static async loadParser(e){switch(e){case"aiff":return new AiffParser_1.AIFFParser;case"adts":case"mpeg":return new MpegParser_1.MpegParser;case"apev2":return new APEv2Parser_1$1.APEv2Parser;case"asf":return new AsfParser_1.AsfParser;case"dsf":return new DsfParser_1.DsfParser;case"dsdiff":return new DsdiffParser_1.DsdiffParser;case"flac":return new FlacParser_1.FlacParser;case"mp4":return new MP4Parser_1.MP4Parser;case"musepack":return new musepack_1.default;case"ogg":return new OggParser_1.OggParser;case"riff":return new WaveParser_1.WaveParser;case"wavpack":return new WavPackParser_1.WavPackParser;case"matroska":return new MatroskaParser_1.MatroskaParser;default:throw new Error(`Unknown parser type: ${e}`)}}static getExtension(e){const s=e.lastIndexOf(".");return s===-1?"":e.slice(s)}static getParserIdForMimeType(e){let s;try{s=parseHttpContentType(e)}catch{debug(`Invalid HTTP Content-Type header value: ${e}`);return}const o=s.subtype.indexOf("x-")===0?s.subtype.substring(2):s.subtype;switch(s.type){case"audio":switch(o){case"mp3":case"mpeg":return"mpeg";case"aac":case"aacp":return"adts";case"flac":return"flac";case"ape":case"monkeys-audio":return"apev2";case"mp4":case"m4a":return"mp4";case"ogg":case"opus":case"speex":return"ogg";case"ms-wma":case"ms-wmv":case"ms-asf":return"asf";case"aiff":case"aif":case"aifc":return"aiff";case"vnd.wave":case"wav":case"wave":return"riff";case"wavpack":return"wavpack";case"musepack":return"musepack";case"matroska":case"webm":return"matroska";case"dsf":return"dsf"}break;case"video":switch(o){case"ms-asf":case"ms-wmv":return"asf";case"m4v":case"mp4":return"mp4";case"ogg":return"ogg";case"matroska":case"webm":return"matroska"}break;case"application":switch(o){case"vnd.ms-asf":return"asf";case"ogg":return"ogg"}break}}}ParserFactory$1.ParserFactory=ParserFactory;var RandomUint8ArrayReader$1={};Object.defineProperty(RandomUint8ArrayReader$1,"__esModule",{value:!0});RandomUint8ArrayReader$1.RandomUint8ArrayReader=void 0;class RandomUint8ArrayReader{constructor(e){this.uint8Array=e,this.fileSize=e.length}async randomRead(e,s,o,c){return e.set(this.uint8Array.subarray(c,c+o),s),o}}RandomUint8ArrayReader$1.RandomUint8ArrayReader=RandomUint8ArrayReader;var Lyrics3={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.getLyricsHeaderLength=a.endTag2=void 0,a.endTag2="LYRICS200";async function e(s){if(s.fileSize>=143){const o=Buffer.alloc(15);await s.randomRead(o,0,o.length,s.fileSize-143);const c=o.toString("binary");if(c.substr(6)===a.endTag2)return parseInt(c.substr(0,6),10)+15}return 0}a.getLyricsHeaderLength=e})(Lyrics3);Object.defineProperty(core$2,"__esModule",{value:!0});core$2.scanAppendingHeaders=core$2.selectCover=core$2.ratingToStars=core$2.orderTags=core$2.parseFromTokenizer=core$2.parseBuffer=core$2.parseStream=void 0;const strtok3=core$1,ParserFactory_1=ParserFactory$1,RandomUint8ArrayReader_1=RandomUint8ArrayReader$1,APEv2Parser_1=APEv2Parser$1,ID3v1Parser_1=ID3v1Parser,Lyrics3_1=Lyrics3;function parseStream(a,e,s={}){return parseFromTokenizer(strtok3.fromStream(a,typeof e=="string"?{mimeType:e}:e),s)}core$2.parseStream=parseStream;async function parseBuffer(a,e,s={}){const o=new RandomUint8ArrayReader_1.RandomUint8ArrayReader(a);await scanAppendingHeaders(o,s);const c=strtok3.fromBuffer(a,typeof e=="string"?{mimeType:e}:e);return parseFromTokenizer(c,s)}core$2.parseBuffer=parseBuffer;function parseFromTokenizer(a,e){return ParserFactory_1.ParserFactory.parseOnContentType(a,e)}core$2.parseFromTokenizer=parseFromTokenizer;function orderTags(a){const e={};for(const s of a)(e[s.id]=e[s.id]||[]).push(s.value);return e}core$2.orderTags=orderTags;function ratingToStars(a){return a===void 0?0:1+Math.round(a*4)}core$2.ratingToStars=ratingToStars;function selectCover(a){return a?a.reduce((e,s)=>s.name&&s.name.toLowerCase()in["front","cover","cover (front)"]?s:e):null}core$2.selectCover=selectCover;async function scanAppendingHeaders(a,e={}){let s=a.fileSize;if(await(0,ID3v1Parser_1.hasID3v1Header)(a)){s-=128;const o=await(0,Lyrics3_1.getLyricsHeaderLength)(a);s-=o}e.apeHeader=await APEv2Parser_1.APEv2Parser.findApeFooterOffset(a,s)}core$2.scanAppendingHeaders=scanAppendingHeaders;var lib={},browser$1={exports:{}},stream={exports:{}};let AggregateError$2=class extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);let s="";for(let o=0;o<e.length;o++)s+=`    ${e[o].stack}
`;super(s),this.name="AggregateError",this.errors=e}};var primordials={AggregateError:AggregateError$2,ArrayIsArray(a){return Array.isArray(a)},ArrayPrototypeIncludes(a,e){return a.includes(e)},ArrayPrototypeIndexOf(a,e){return a.indexOf(e)},ArrayPrototypeJoin(a,e){return a.join(e)},ArrayPrototypeMap(a,e){return a.map(e)},ArrayPrototypePop(a,e){return a.pop(e)},ArrayPrototypePush(a,e){return a.push(e)},ArrayPrototypeSlice(a,e,s){return a.slice(e,s)},Error,FunctionPrototypeCall(a,e,...s){return a.call(e,...s)},FunctionPrototypeSymbolHasInstance(a,e){return Function.prototype[Symbol.hasInstance].call(a,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(a,e){return Object.defineProperties(a,e)},ObjectDefineProperty(a,e,s){return Object.defineProperty(a,e,s)},ObjectGetOwnPropertyDescriptor(a,e){return Object.getOwnPropertyDescriptor(a,e)},ObjectKeys(a){return Object.keys(a)},ObjectSetPrototypeOf(a,e){return Object.setPrototypeOf(a,e)},Promise,PromisePrototypeCatch(a,e){return a.catch(e)},PromisePrototypeThen(a,e,s){return a.then(e,s)},PromiseReject(a){return Promise.reject(a)},PromiseResolve(a){return Promise.resolve(a)},ReflectApply:Reflect.apply,RegExpPrototypeTest(a,e){return a.test(e)},SafeSet:Set,String,StringPrototypeSlice(a,e,s){return a.slice(e,s)},StringPrototypeToLowerCase(a){return a.toLowerCase()},StringPrototypeToUpperCase(a){return a.toUpperCase()},StringPrototypeTrim(a){return a.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(a,e,s){return a.set(e,s)},Boolean,Uint8Array},util={exports:{}},inspect$2={format(a,...e){return a.replace(/%([sdifj])/g,function(...[s,o]){const c=e.shift();return o==="f"?c.toFixed(6):o==="j"?JSON.stringify(c):o==="s"&&typeof c=="object"?`${c.constructor!==Object?c.constructor.name:""} {}`.trim():c.toString()})},inspect(a){switch(typeof a){case"string":if(a.includes("'"))if(a.includes('"')){if(!a.includes("`")&&!a.includes("${"))return`\`${a}\``}else return`"${a}"`;return`'${a}'`;case"number":return isNaN(a)?"NaN":Object.is(a,-0)?String(a):a;case"bigint":return`${String(a)}n`;case"boolean":case"undefined":return String(a);case"object":return"{}"}}};const{format:format$1,inspect:inspect$1}=inspect$2,{AggregateError:CustomAggregateError}=primordials,AggregateError$1=globalThis.AggregateError||CustomAggregateError,kIsNodeError=Symbol("kIsNodeError"),kTypes=["string","function","number","object","Function","Object","boolean","bigint","symbol"],classRegExp=/^([A-Z][a-z0-9]*)+$/,nodeInternalPrefix="__node_internal_",codes$1={};function assert(a,e){if(!a)throw new codes$1.ERR_INTERNAL_ASSERTION(e)}function addNumericalSeparator(a){let e="",s=a.length;const o=a[0]==="-"?1:0;for(;s>=o+4;s-=3)e=`_${a.slice(s-3,s)}${e}`;return`${a.slice(0,s)}${e}`}function getMessage(a,e,s){if(typeof e=="function")return assert(e.length<=s.length,`Code: ${a}; The provided arguments length (${s.length}) does not match the required ones (${e.length}).`),e(...s);const o=(e.match(/%[dfijoOs]/g)||[]).length;return assert(o===s.length,`Code: ${a}; The provided arguments length (${s.length}) does not match the required ones (${o}).`),s.length===0?e:format$1(e,...s)}function E(a,e,s){s||(s=Error);class o extends s{constructor(...d){super(getMessage(a,e,d))}toString(){return`${this.name} [${a}]: ${this.message}`}}Object.defineProperties(o.prototype,{name:{value:s.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${a}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),o.prototype.code=a,o.prototype[kIsNodeError]=!0,codes$1[a]=o}function hideStackFrames$1(a){const e=nodeInternalPrefix+a.name;return Object.defineProperty(a,"name",{value:e}),a}function aggregateTwoErrors$2(a,e){if(a&&e&&a!==e){if(Array.isArray(e.errors))return e.errors.push(a),e;const s=new AggregateError$1([e,a],e.message);return s.code=e.code,s}return a||e}let AbortError$5=class extends Error{constructor(e="The operation was aborted",s=void 0){if(s!==void 0&&typeof s!="object")throw new codes$1.ERR_INVALID_ARG_TYPE("options","Object",s);super(e,s),this.code="ABORT_ERR",this.name="AbortError"}};E("ERR_ASSERTION","%s",Error);E("ERR_INVALID_ARG_TYPE",(a,e,s)=>{assert(typeof a=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let o="The ";a.endsWith(" argument")?o+=`${a} `:o+=`"${a}" ${a.includes(".")?"property":"argument"} `,o+="must be ";const c=[],d=[],h=[];for(const _ of e)assert(typeof _=="string","All expected entries have to be of type string"),kTypes.includes(_)?c.push(_.toLowerCase()):classRegExp.test(_)?d.push(_):(assert(_!=="object",'The value "object" should be written as "Object"'),h.push(_));if(d.length>0){const _=c.indexOf("object");_!==-1&&(c.splice(c,_,1),d.push("Object"))}if(c.length>0){switch(c.length){case 1:o+=`of type ${c[0]}`;break;case 2:o+=`one of type ${c[0]} or ${c[1]}`;break;default:{const _=c.pop();o+=`one of type ${c.join(", ")}, or ${_}`}}(d.length>0||h.length>0)&&(o+=" or ")}if(d.length>0){switch(d.length){case 1:o+=`an instance of ${d[0]}`;break;case 2:o+=`an instance of ${d[0]} or ${d[1]}`;break;default:{const _=d.pop();o+=`an instance of ${d.join(", ")}, or ${_}`}}h.length>0&&(o+=" or ")}switch(h.length){case 0:break;case 1:h[0].toLowerCase()!==h[0]&&(o+="an "),o+=`${h[0]}`;break;case 2:o+=`one of ${h[0]} or ${h[1]}`;break;default:{const _=h.pop();o+=`one of ${h.join(", ")}, or ${_}`}}if(s==null)o+=`. Received ${s}`;else if(typeof s=="function"&&s.name)o+=`. Received function ${s.name}`;else if(typeof s=="object"){var g;if((g=s.constructor)!==null&&g!==void 0&&g.name)o+=`. Received an instance of ${s.constructor.name}`;else{const _=inspect$1(s,{depth:-1});o+=`. Received ${_}`}}else{let _=inspect$1(s,{colors:!1});_.length>25&&(_=`${_.slice(0,25)}...`),o+=`. Received type ${typeof s} (${_})`}return o},TypeError);E("ERR_INVALID_ARG_VALUE",(a,e,s="is invalid")=>{let o=inspect$1(e);return o.length>128&&(o=o.slice(0,128)+"..."),`The ${a.includes(".")?"property":"argument"} '${a}' ${s}. Received ${o}`},TypeError);E("ERR_INVALID_RETURN_VALUE",(a,e,s)=>{var o;const c=s!=null&&(o=s.constructor)!==null&&o!==void 0&&o.name?`instance of ${s.constructor.name}`:`type ${typeof s}`;return`Expected ${a} to be returned from the "${e}" function but got ${c}.`},TypeError);E("ERR_MISSING_ARGS",(...a)=>{assert(a.length>0,"At least one arg needs to be specified");let e;const s=a.length;switch(a=(Array.isArray(a)?a:[a]).map(o=>`"${o}"`).join(" or "),s){case 1:e+=`The ${a[0]} argument`;break;case 2:e+=`The ${a[0]} and ${a[1]} arguments`;break;default:{const o=a.pop();e+=`The ${a.join(", ")}, and ${o} arguments`}break}return`${e} must be specified`},TypeError);E("ERR_OUT_OF_RANGE",(a,e,s)=>{assert(e,'Missing "range" argument');let o;if(Number.isInteger(s)&&Math.abs(s)>2**32)o=addNumericalSeparator(String(s));else if(typeof s=="bigint"){o=String(s);const c=BigInt(2)**BigInt(32);(s>c||s<-c)&&(o=addNumericalSeparator(o)),o+="n"}else o=inspect$1(s);return`The value of "${a}" is out of range. It must be ${e}. Received ${o}`},RangeError);E("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);E("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);E("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);E("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);E("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);E("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);E("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);E("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);E("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);E("ERR_STREAM_WRITE_AFTER_END","write after end",Error);E("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var errors={AbortError:AbortError$5,aggregateTwoErrors:hideStackFrames$1(aggregateTwoErrors$2),hideStackFrames:hideStackFrames$1,codes:codes$1},browser={exports:{}},hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser.exports;hasRequiredBrowser=1;const{AbortController:a,AbortSignal:e}=typeof self<"u"?self:typeof window<"u"?window:void 0;return browser.exports=a,browser.exports.AbortSignal=e,browser.exports.default=a,browser.exports}var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function a(e,s,o){return Function.prototype.apply.call(e,s,o)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(a){console&&console.warn&&console.warn(a)}var NumberIsNaN$2=Number.isNaN||function a(e){return e!==e};function EventEmitter$1(){EventEmitter$1.init.call(this)}events.exports=EventEmitter$1;events.exports.once=once$2;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._eventsCount=0;EventEmitter$1.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(EventEmitter$1,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(a){if(typeof a!="number"||a<0||NumberIsNaN$2(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");defaultMaxListeners=a}});EventEmitter$1.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$1.prototype.setMaxListeners=function a(e){if(typeof e!="number"||e<0||NumberIsNaN$2(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(a){return a._maxListeners===void 0?EventEmitter$1.defaultMaxListeners:a._maxListeners}EventEmitter$1.prototype.getMaxListeners=function a(){return _getMaxListeners(this)};EventEmitter$1.prototype.emit=function a(e){for(var s=[],o=1;o<arguments.length;o++)s.push(arguments[o]);var c=e==="error",d=this._events;if(d!==void 0)c=c&&d.error===void 0;else if(!c)return!1;if(c){var h;if(s.length>0&&(h=s[0]),h instanceof Error)throw h;var g=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw g.context=h,g}var _=d[e];if(_===void 0)return!1;if(typeof _=="function")ReflectApply(_,this,s);else for(var b=_.length,$=arrayClone(_,b),o=0;o<b;++o)ReflectApply($[o],this,s);return!0};function _addListener(a,e,s,o){var c,d,h;if(checkListener(s),d=a._events,d===void 0?(d=a._events=Object.create(null),a._eventsCount=0):(d.newListener!==void 0&&(a.emit("newListener",e,s.listener?s.listener:s),d=a._events),h=d[e]),h===void 0)h=d[e]=s,++a._eventsCount;else if(typeof h=="function"?h=d[e]=o?[s,h]:[h,s]:o?h.unshift(s):h.push(s),c=_getMaxListeners(a),c>0&&h.length>c&&!h.warned){h.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=a,g.type=e,g.count=h.length,ProcessEmitWarning(g)}return a}EventEmitter$1.prototype.addListener=function a(e,s){return _addListener(this,e,s,!1)};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.prependListener=function a(e,s){return _addListener(this,e,s,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(a,e,s){var o={fired:!1,wrapFn:void 0,target:a,type:e,listener:s},c=onceWrapper.bind(o);return c.listener=s,o.wrapFn=c,c}EventEmitter$1.prototype.once=function a(e,s){return checkListener(s),this.on(e,_onceWrap(this,e,s)),this};EventEmitter$1.prototype.prependOnceListener=function a(e,s){return checkListener(s),this.prependListener(e,_onceWrap(this,e,s)),this};EventEmitter$1.prototype.removeListener=function a(e,s){var o,c,d,h,g;if(checkListener(s),c=this._events,c===void 0)return this;if(o=c[e],o===void 0)return this;if(o===s||o.listener===s)--this._eventsCount===0?this._events=Object.create(null):(delete c[e],c.removeListener&&this.emit("removeListener",e,o.listener||s));else if(typeof o!="function"){for(d=-1,h=o.length-1;h>=0;h--)if(o[h]===s||o[h].listener===s){g=o[h].listener,d=h;break}if(d<0)return this;d===0?o.shift():spliceOne(o,d),o.length===1&&(c[e]=o[0]),c.removeListener!==void 0&&this.emit("removeListener",e,g||s)}return this};EventEmitter$1.prototype.off=EventEmitter$1.prototype.removeListener;EventEmitter$1.prototype.removeAllListeners=function a(e){var s,o,c;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[e]),this;if(arguments.length===0){var d=Object.keys(o),h;for(c=0;c<d.length;++c)h=d[c],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(s=o[e],typeof s=="function")this.removeListener(e,s);else if(s!==void 0)for(c=s.length-1;c>=0;c--)this.removeListener(e,s[c]);return this};function _listeners(a,e,s){var o=a._events;if(o===void 0)return[];var c=o[e];return c===void 0?[]:typeof c=="function"?s?[c.listener||c]:[c]:s?unwrapListeners(c):arrayClone(c,c.length)}EventEmitter$1.prototype.listeners=function a(e){return _listeners(this,e,!0)};EventEmitter$1.prototype.rawListeners=function a(e){return _listeners(this,e,!1)};EventEmitter$1.listenerCount=function(a,e){return typeof a.listenerCount=="function"?a.listenerCount(e):listenerCount.call(a,e)};EventEmitter$1.prototype.listenerCount=listenerCount;function listenerCount(a){var e=this._events;if(e!==void 0){var s=e[a];if(typeof s=="function")return 1;if(s!==void 0)return s.length}return 0}EventEmitter$1.prototype.eventNames=function a(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(a,e){for(var s=new Array(e),o=0;o<e;++o)s[o]=a[o];return s}function spliceOne(a,e){for(;e+1<a.length;e++)a[e]=a[e+1];a.pop()}function unwrapListeners(a){for(var e=new Array(a.length),s=0;s<e.length;++s)e[s]=a[s].listener||a[s];return e}function once$2(a,e){return new Promise(function(s,o){function c(h){a.removeListener(e,d),o(h)}function d(){typeof a.removeListener=="function"&&a.removeListener("error",c),s([].slice.call(arguments))}eventTargetAgnosticAddListener(a,e,d,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter(a,c,{once:!0})})}function addErrorHandlerIfEventEmitter(a,e,s){typeof a.on=="function"&&eventTargetAgnosticAddListener(a,"error",e,s)}function eventTargetAgnosticAddListener(a,e,s,o){if(typeof a.on=="function")o.once?a.once(e,s):a.on(e,s);else if(typeof a.addEventListener=="function")a.addEventListener(e,function c(d){o.once&&a.removeEventListener(e,c),s(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}var eventsExports=events.exports;(function(a){const e=buffer,{format:s,inspect:o}=inspect$2,{codes:{ERR_INVALID_ARG_TYPE:c}}=errors,{kResistStopPropagation:d,AggregateError:h,SymbolDispose:g}=primordials,_=globalThis.AbortSignal||requireBrowser().AbortSignal,b=globalThis.AbortController||requireBrowser().AbortController,$=Object.getPrototypeOf(async function(){}).constructor,j=globalThis.Blob||e.Blob,_e=typeof j<"u"?function(st){return st instanceof j}:function(st){return!1},tt=(nt,st)=>{if(nt!==void 0&&(nt===null||typeof nt!="object"||!("aborted"in nt)))throw new c(st,"AbortSignal",nt)},rt=(nt,st)=>{if(typeof nt!="function")throw new c(st,"Function",nt)};a.exports={AggregateError:h,kEmptyObject:Object.freeze({}),once(nt){let st=!1;return function(...at){st||(st=!0,nt.apply(this,at))}},createDeferredPromise:function(){let nt,st;return{promise:new Promise((ot,ut)=>{nt=ot,st=ut}),resolve:nt,reject:st}},promisify(nt){return new Promise((st,at)=>{nt((ot,...ut)=>ot?at(ot):st(...ut))})},debuglog(){return function(){}},format:s,inspect:o,types:{isAsyncFunction(nt){return nt instanceof $},isArrayBufferView(nt){return ArrayBuffer.isView(nt)}},isBlob:_e,deprecate(nt,st){return nt},addAbortListener:eventsExports.addAbortListener||function(st,at){if(st===void 0)throw new c("signal","AbortSignal",st);tt(st,"signal"),rt(at,"listener");let ot;return st.aborted?queueMicrotask(()=>at()):(st.addEventListener("abort",at,{__proto__:null,once:!0,[d]:!0}),ot=()=>{st.removeEventListener("abort",at)}),{__proto__:null,[g](){var ut;(ut=ot)===null||ut===void 0||ut()}}},AbortSignalAny:_.any||function(st){if(st.length===1)return st[0];const at=new b,ot=()=>at.abort();return st.forEach(ut=>{tt(ut,"signals"),ut.addEventListener("abort",ot,{once:!0})}),at.signal.addEventListener("abort",()=>{st.forEach(ut=>ut.removeEventListener("abort",ot))},{once:!0}),at.signal}},a.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util);var utilExports=util.exports,operators={};const{ArrayIsArray:ArrayIsArray$2,ArrayPrototypeIncludes,ArrayPrototypeJoin,ArrayPrototypeMap,NumberIsInteger:NumberIsInteger$1,NumberIsNaN:NumberIsNaN$1,NumberMAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER,NumberParseInt,ObjectPrototypeHasOwnProperty,RegExpPrototypeExec,String:String$1,StringPrototypeToUpperCase,StringPrototypeTrim}=primordials,{hideStackFrames,codes:{ERR_SOCKET_BAD_PORT,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$4,ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$3,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$1,ERR_UNKNOWN_SIGNAL}}=errors,{normalizeEncoding:normalizeEncoding$1}=utilExports,{isAsyncFunction,isArrayBufferView:isArrayBufferView$2}=utilExports.types,validateInteger$2=hideStackFrames((a,e,s=NumberMIN_SAFE_INTEGER,o=NumberMAX_SAFE_INTEGER)=>{if(typeof a!="number")throw new ERR_INVALID_ARG_TYPE$4(e,"number",a);if(!NumberIsInteger$1(a))throw new ERR_OUT_OF_RANGE$1(e,"an integer",a);if(a<s||a>o)throw new ERR_OUT_OF_RANGE$1(e,`>= ${s} && <= ${o}`,a)});hideStackFrames((a,e,s=-2147483648,o=2147483647)=>{if(typeof a!="number")throw new ERR_INVALID_ARG_TYPE$4(e,"number",a);if(!NumberIsInteger$1(a))throw new ERR_OUT_OF_RANGE$1(e,"an integer",a);if(a<s||a>o)throw new ERR_OUT_OF_RANGE$1(e,`>= ${s} && <= ${o}`,a)});hideStackFrames((a,e,s=!1)=>{if(typeof a!="number")throw new ERR_INVALID_ARG_TYPE$4(e,"number",a);if(!NumberIsInteger$1(a))throw new ERR_OUT_OF_RANGE$1(e,"an integer",a);const o=s?1:0,c=4294967295;if(a<o||a>c)throw new ERR_OUT_OF_RANGE$1(e,`>= ${o} && <= ${c}`,a)});hideStackFrames((a,e,s)=>{if(!ArrayPrototypeIncludes(s,a)){const c="must be one of: "+ArrayPrototypeJoin(ArrayPrototypeMap(s,d=>typeof d=="string"?`'${d}'`:String$1(d)),", ");throw new ERR_INVALID_ARG_VALUE$3(e,a,c)}});function validateBoolean$1(a,e){if(typeof a!="boolean")throw new ERR_INVALID_ARG_TYPE$4(e,"boolean",a)}function getOwnPropertyValueOrDefault(a,e,s){return a==null||!ObjectPrototypeHasOwnProperty(a,e)?s:a[e]}const validateObject$2=hideStackFrames((a,e,s=null)=>{const o=getOwnPropertyValueOrDefault(s,"allowArray",!1),c=getOwnPropertyValueOrDefault(s,"allowFunction",!1);if(!getOwnPropertyValueOrDefault(s,"nullable",!1)&&a===null||!o&&ArrayIsArray$2(a)||typeof a!="object"&&(!c||typeof a!="function"))throw new ERR_INVALID_ARG_TYPE$4(e,"Object",a)});hideStackFrames((a,e)=>{if(a!=null&&typeof a!="object"&&typeof a!="function")throw new ERR_INVALID_ARG_TYPE$4(e,"a dictionary",a)});hideStackFrames((a,e,s=0)=>{if(!ArrayIsArray$2(a))throw new ERR_INVALID_ARG_TYPE$4(e,"Array",a);if(a.length<s){const o=`must be longer than ${s}`;throw new ERR_INVALID_ARG_VALUE$3(e,a,o)}});hideStackFrames((a,e="buffer")=>{if(!isArrayBufferView$2(a))throw new ERR_INVALID_ARG_TYPE$4(e,["Buffer","TypedArray","DataView"],a)});const validateAbortSignal$3=hideStackFrames((a,e)=>{if(a!==void 0&&(a===null||typeof a!="object"||!("aborted"in a)))throw new ERR_INVALID_ARG_TYPE$4(e,"AbortSignal",a)}),validateFunction$2=hideStackFrames((a,e)=>{if(typeof a!="function")throw new ERR_INVALID_ARG_TYPE$4(e,"Function",a)});hideStackFrames((a,e)=>{if(typeof a!="function"||isAsyncFunction(a))throw new ERR_INVALID_ARG_TYPE$4(e,"Function",a)});hideStackFrames((a,e)=>{if(a!==void 0)throw new ERR_INVALID_ARG_TYPE$4(e,"undefined",a)});var validators$2={validateBoolean:validateBoolean$1,validateFunction:validateFunction$2,validateInteger:validateInteger$2,validateObject:validateObject$2,validateAbortSignal:validateAbortSignal$3},endOfStream={exports:{}};const{SymbolAsyncIterator:SymbolAsyncIterator$2,SymbolIterator:SymbolIterator$2,SymbolFor}=primordials,kIsDestroyed$1=SymbolFor("nodejs.stream.destroyed"),kIsErrored=SymbolFor("nodejs.stream.errored"),kIsReadable=SymbolFor("nodejs.stream.readable"),kIsWritable=SymbolFor("nodejs.stream.writable"),kIsDisturbed=SymbolFor("nodejs.stream.disturbed"),kIsClosedPromise$1=SymbolFor("nodejs.webstream.isClosedPromise"),kControllerErrorFunction=SymbolFor("nodejs.webstream.controllerErrorFunction");function isReadableNodeStream$2(a,e=!1){var s;return!!(a&&typeof a.pipe=="function"&&typeof a.on=="function"&&(!e||typeof a.pause=="function"&&typeof a.resume=="function")&&(!a._writableState||((s=a._readableState)===null||s===void 0?void 0:s.readable)!==!1)&&(!a._writableState||a._readableState))}function isWritableNodeStream$1(a){var e;return!!(a&&typeof a.write=="function"&&typeof a.on=="function"&&(!a._readableState||((e=a._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function isDuplexNodeStream(a){return!!(a&&typeof a.pipe=="function"&&a._readableState&&typeof a.on=="function"&&typeof a.write=="function")}function isNodeStream$4(a){return a&&(a._readableState||a._writableState||typeof a.write=="function"&&typeof a.on=="function"||typeof a.pipe=="function"&&typeof a.on=="function")}function isReadableStream$4(a){return!!(a&&!isNodeStream$4(a)&&typeof a.pipeThrough=="function"&&typeof a.getReader=="function"&&typeof a.cancel=="function")}function isWritableStream$2(a){return!!(a&&!isNodeStream$4(a)&&typeof a.getWriter=="function"&&typeof a.abort=="function")}function isTransformStream$2(a){return!!(a&&!isNodeStream$4(a)&&typeof a.readable=="object"&&typeof a.writable=="object")}function isWebStream$2(a){return isReadableStream$4(a)||isWritableStream$2(a)||isTransformStream$2(a)}function isIterable$2(a,e){return a==null?!1:e===!0?typeof a[SymbolAsyncIterator$2]=="function":e===!1?typeof a[SymbolIterator$2]=="function":typeof a[SymbolAsyncIterator$2]=="function"||typeof a[SymbolIterator$2]=="function"}function isDestroyed$1(a){if(!isNodeStream$4(a))return null;const e=a._writableState,s=a._readableState,o=e||s;return!!(a.destroyed||a[kIsDestroyed$1]||o!=null&&o.destroyed)}function isWritableEnded(a){if(!isWritableNodeStream$1(a))return null;if(a.writableEnded===!0)return!0;const e=a._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isWritableFinished$1(a,e){if(!isWritableNodeStream$1(a))return null;if(a.writableFinished===!0)return!0;const s=a._writableState;return s!=null&&s.errored?!1:typeof(s==null?void 0:s.finished)!="boolean"?null:!!(s.finished||e===!1&&s.ended===!0&&s.length===0)}function isReadableFinished$2(a,e){if(!isReadableNodeStream$2(a))return null;const s=a._readableState;return s!=null&&s.errored?!1:typeof(s==null?void 0:s.endEmitted)!="boolean"?null:!!(s.endEmitted||e===!1&&s.ended===!0&&s.length===0)}function isReadable$3(a){return a&&a[kIsReadable]!=null?a[kIsReadable]:typeof(a==null?void 0:a.readable)!="boolean"?null:isDestroyed$1(a)?!1:isReadableNodeStream$2(a)&&a.readable&&!isReadableFinished$2(a)}function isWritable$3(a){return a&&a[kIsWritable]!=null?a[kIsWritable]:typeof(a==null?void 0:a.writable)!="boolean"?null:isDestroyed$1(a)?!1:isWritableNodeStream$1(a)&&a.writable&&!isWritableEnded(a)}function isFinished$1(a,e){return isNodeStream$4(a)?isDestroyed$1(a)?!0:!((e==null?void 0:e.readable)!==!1&&isReadable$3(a)||(e==null?void 0:e.writable)!==!1&&isWritable$3(a)):null}function isWritableErrored$1(a){var e,s;return isNodeStream$4(a)?a.writableErrored?a.writableErrored:(e=(s=a._writableState)===null||s===void 0?void 0:s.errored)!==null&&e!==void 0?e:null:null}function isReadableErrored$1(a){var e,s;return isNodeStream$4(a)?a.readableErrored?a.readableErrored:(e=(s=a._readableState)===null||s===void 0?void 0:s.errored)!==null&&e!==void 0?e:null:null}function isClosed$1(a){if(!isNodeStream$4(a))return null;if(typeof a.closed=="boolean")return a.closed;const e=a._writableState,s=a._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(s==null?void 0:s.closed)=="boolean"?(e==null?void 0:e.closed)||(s==null?void 0:s.closed):typeof a._closed=="boolean"&&isOutgoingMessage(a)?a._closed:null}function isOutgoingMessage(a){return typeof a._closed=="boolean"&&typeof a._defaultKeepAlive=="boolean"&&typeof a._removedConnection=="boolean"&&typeof a._removedContLen=="boolean"}function isServerResponse(a){return typeof a._sent100=="boolean"&&isOutgoingMessage(a)}function isServerRequest$1(a){var e;return typeof a._consuming=="boolean"&&typeof a._dumped=="boolean"&&((e=a.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function willEmitClose(a){if(!isNodeStream$4(a))return null;const e=a._writableState,s=a._readableState,o=e||s;return!o&&isServerResponse(a)||!!(o&&o.autoDestroy&&o.emitClose&&o.closed===!1)}function isDisturbed(a){var e;return!!(a&&((e=a[kIsDisturbed])!==null&&e!==void 0?e:a.readableDidRead||a.readableAborted))}function isErrored(a){var e,s,o,c,d,h,g,_,b,$;return!!(a&&((e=(s=(o=(c=(d=(h=a[kIsErrored])!==null&&h!==void 0?h:a.readableErrored)!==null&&d!==void 0?d:a.writableErrored)!==null&&c!==void 0?c:(g=a._readableState)===null||g===void 0?void 0:g.errorEmitted)!==null&&o!==void 0?o:(_=a._writableState)===null||_===void 0?void 0:_.errorEmitted)!==null&&s!==void 0?s:(b=a._readableState)===null||b===void 0?void 0:b.errored)!==null&&e!==void 0?e:!(($=a._writableState)===null||$===void 0)&&$.errored))}var utils$2={isDestroyed:isDestroyed$1,kIsDestroyed:kIsDestroyed$1,isDisturbed,isErrored,isReadable:isReadable$3,kIsClosedPromise:kIsClosedPromise$1,kControllerErrorFunction,isClosed:isClosed$1,isDuplexNodeStream,isFinished:isFinished$1,isIterable:isIterable$2,isReadableNodeStream:isReadableNodeStream$2,isReadableStream:isReadableStream$4,isReadableFinished:isReadableFinished$2,isReadableErrored:isReadableErrored$1,isNodeStream:isNodeStream$4,isWebStream:isWebStream$2,isWritable:isWritable$3,isWritableNodeStream:isWritableNodeStream$1,isWritableStream:isWritableStream$2,isWritableFinished:isWritableFinished$1,isWritableErrored:isWritableErrored$1,isServerRequest:isServerRequest$1,willEmitClose,isTransformStream:isTransformStream$2};const process$4=browserExports$2,{AbortError:AbortError$4,codes}=errors,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$3,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$1}=codes,{kEmptyObject,once:once$1}=utilExports,{validateAbortSignal:validateAbortSignal$2,validateFunction:validateFunction$1,validateObject:validateObject$1,validateBoolean}=validators$2,{Promise:Promise$3,PromisePrototypeThen:PromisePrototypeThen$2,SymbolDispose:SymbolDispose$1}=primordials,{isClosed,isReadable:isReadable$2,isReadableNodeStream:isReadableNodeStream$1,isReadableStream:isReadableStream$3,isReadableFinished:isReadableFinished$1,isReadableErrored,isWritable:isWritable$2,isWritableNodeStream,isWritableStream:isWritableStream$1,isWritableFinished,isWritableErrored,isNodeStream:isNodeStream$3,willEmitClose:_willEmitClose,kIsClosedPromise}=utils$2;let addAbortListener$1;function isRequest$2(a){return a.setHeader&&typeof a.abort=="function"}const nop=()=>{};function eos$2(a,e,s){var o,c;if(arguments.length===2?(s=e,e=kEmptyObject):e==null?e=kEmptyObject:validateObject$1(e,"options"),validateFunction$1(s,"callback"),validateAbortSignal$2(e.signal,"options.signal"),s=once$1(s),isReadableStream$3(a)||isWritableStream$1(a))return eosWeb(a,e,s);if(!isNodeStream$3(a))throw new ERR_INVALID_ARG_TYPE$3("stream",["ReadableStream","WritableStream","Stream"],a);const d=(o=e.readable)!==null&&o!==void 0?o:isReadableNodeStream$1(a),h=(c=e.writable)!==null&&c!==void 0?c:isWritableNodeStream(a),g=a._writableState,_=a._readableState,b=()=>{a.writable||_e()};let $=_willEmitClose(a)&&isReadableNodeStream$1(a)===d&&isWritableNodeStream(a)===h,j=isWritableFinished(a,!1);const _e=()=>{j=!0,a.destroyed&&($=!1),!($&&(!a.readable||d))&&(!d||tt)&&s.call(a)};let tt=isReadableFinished$1(a,!1);const rt=()=>{tt=!0,a.destroyed&&($=!1),!($&&(!a.writable||h))&&(!h||j)&&s.call(a)},nt=yt=>{s.call(a,yt)};let st=isClosed(a);const at=()=>{st=!0;const yt=isWritableErrored(a)||isReadableErrored(a);if(yt&&typeof yt!="boolean")return s.call(a,yt);if(d&&!tt&&isReadableNodeStream$1(a,!0)&&!isReadableFinished$1(a,!1))return s.call(a,new ERR_STREAM_PREMATURE_CLOSE$1);if(h&&!j&&!isWritableFinished(a,!1))return s.call(a,new ERR_STREAM_PREMATURE_CLOSE$1);s.call(a)},ot=()=>{st=!0;const yt=isWritableErrored(a)||isReadableErrored(a);if(yt&&typeof yt!="boolean")return s.call(a,yt);s.call(a)},ut=()=>{a.req.on("finish",_e)};isRequest$2(a)?(a.on("complete",_e),$||a.on("abort",at),a.req?ut():a.on("request",ut)):h&&!g&&(a.on("end",b),a.on("close",b)),!$&&typeof a.aborted=="boolean"&&a.on("aborted",at),a.on("end",rt),a.on("finish",_e),e.error!==!1&&a.on("error",nt),a.on("close",at),st?process$4.nextTick(at):g!=null&&g.errorEmitted||_!=null&&_.errorEmitted?$||process$4.nextTick(ot):(!d&&(!$||isReadable$2(a))&&(j||isWritable$2(a)===!1)||!h&&(!$||isWritable$2(a))&&(tt||isReadable$2(a)===!1)||_&&a.req&&a.aborted)&&process$4.nextTick(ot);const mt=()=>{s=nop,a.removeListener("aborted",at),a.removeListener("complete",_e),a.removeListener("abort",at),a.removeListener("request",ut),a.req&&a.req.removeListener("finish",_e),a.removeListener("end",b),a.removeListener("close",b),a.removeListener("finish",_e),a.removeListener("end",rt),a.removeListener("error",nt),a.removeListener("close",at)};if(e.signal&&!st){const yt=()=>{const Et=s;mt(),Et.call(a,new AbortError$4(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)process$4.nextTick(yt);else{addAbortListener$1=addAbortListener$1||utilExports.addAbortListener;const Et=addAbortListener$1(e.signal,yt),dt=s;s=once$1((...gt)=>{Et[SymbolDispose$1](),dt.apply(a,gt)})}}return mt}function eosWeb(a,e,s){let o=!1,c=nop;if(e.signal)if(c=()=>{o=!0,s.call(a,new AbortError$4(void 0,{cause:e.signal.reason}))},e.signal.aborted)process$4.nextTick(c);else{addAbortListener$1=addAbortListener$1||utilExports.addAbortListener;const h=addAbortListener$1(e.signal,c),g=s;s=once$1((..._)=>{h[SymbolDispose$1](),g.apply(a,_)})}const d=(...h)=>{o||process$4.nextTick(()=>s.apply(a,h))};return PromisePrototypeThen$2(a[kIsClosedPromise].promise,d,d),nop}function finished$1(a,e){var s;let o=!1;return e===null&&(e=kEmptyObject),(s=e)!==null&&s!==void 0&&s.cleanup&&(validateBoolean(e.cleanup,"cleanup"),o=e.cleanup),new Promise$3((c,d)=>{const h=eos$2(a,e,g=>{o&&h(),g?d(g):c()})})}endOfStream.exports=eos$2;endOfStream.exports.finished=finished$1;var endOfStreamExports=endOfStream.exports;const process$3=browserExports$2,{aggregateTwoErrors:aggregateTwoErrors$1,codes:{ERR_MULTIPLE_CALLBACK},AbortError:AbortError$3}=errors,{Symbol:Symbol$3}=primordials,{kIsDestroyed,isDestroyed,isFinished,isServerRequest}=utils$2,kDestroy=Symbol$3("kDestroy"),kConstruct=Symbol$3("kConstruct");function checkError(a,e,s){a&&(a.stack,e&&!e.errored&&(e.errored=a),s&&!s.errored&&(s.errored=a))}function destroy(a,e){const s=this._readableState,o=this._writableState,c=o||s;return o!=null&&o.destroyed||s!=null&&s.destroyed?(typeof e=="function"&&e(),this):(checkError(a,o,s),o&&(o.destroyed=!0),s&&(s.destroyed=!0),c.constructed?_destroy(this,a,e):this.once(kDestroy,function(d){_destroy(this,aggregateTwoErrors$1(d,a),e)}),this)}function _destroy(a,e,s){let o=!1;function c(d){if(o)return;o=!0;const h=a._readableState,g=a._writableState;checkError(d,g,h),g&&(g.closed=!0),h&&(h.closed=!0),typeof s=="function"&&s(d),d?process$3.nextTick(emitErrorCloseNT,a,d):process$3.nextTick(emitCloseNT,a)}try{a._destroy(e||null,c)}catch(d){c(d)}}function emitErrorCloseNT(a,e){emitErrorNT(a,e),emitCloseNT(a)}function emitCloseNT(a){const e=a._readableState,s=a._writableState;s&&(s.closeEmitted=!0),e&&(e.closeEmitted=!0),(s!=null&&s.emitClose||e!=null&&e.emitClose)&&a.emit("close")}function emitErrorNT(a,e){const s=a._readableState,o=a._writableState;o!=null&&o.errorEmitted||s!=null&&s.errorEmitted||(o&&(o.errorEmitted=!0),s&&(s.errorEmitted=!0),a.emit("error",e))}function undestroy(){const a=this._readableState,e=this._writableState;a&&(a.constructed=!0,a.closed=!1,a.closeEmitted=!1,a.destroyed=!1,a.errored=null,a.errorEmitted=!1,a.reading=!1,a.ended=a.readable===!1,a.endEmitted=a.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function errorOrDestroy(a,e,s){const o=a._readableState,c=a._writableState;if(c!=null&&c.destroyed||o!=null&&o.destroyed)return this;o!=null&&o.autoDestroy||c!=null&&c.autoDestroy?a.destroy(e):e&&(e.stack,c&&!c.errored&&(c.errored=e),o&&!o.errored&&(o.errored=e),s?process$3.nextTick(emitErrorNT,a,e):emitErrorNT(a,e))}function construct(a,e){if(typeof a._construct!="function")return;const s=a._readableState,o=a._writableState;s&&(s.constructed=!1),o&&(o.constructed=!1),a.once(kConstruct,e),!(a.listenerCount(kConstruct)>1)&&process$3.nextTick(constructNT,a)}function constructNT(a){let e=!1;function s(o){if(e){errorOrDestroy(a,o??new ERR_MULTIPLE_CALLBACK);return}e=!0;const c=a._readableState,d=a._writableState,h=d||c;c&&(c.constructed=!0),d&&(d.constructed=!0),h.destroyed?a.emit(kDestroy,o):o?errorOrDestroy(a,o,!0):process$3.nextTick(emitConstructNT,a)}try{a._construct(o=>{process$3.nextTick(s,o)})}catch(o){process$3.nextTick(s,o)}}function emitConstructNT(a){a.emit(kConstruct)}function isRequest$1(a){return(a==null?void 0:a.setHeader)&&typeof a.abort=="function"}function emitCloseLegacy(a){a.emit("close")}function emitErrorCloseLegacy(a,e){a.emit("error",e),process$3.nextTick(emitCloseLegacy,a)}function destroyer$2(a,e){!a||isDestroyed(a)||(!e&&!isFinished(a)&&(e=new AbortError$3),isServerRequest(a)?(a.socket=null,a.destroy(e)):isRequest$1(a)?a.abort():isRequest$1(a.req)?a.req.abort():typeof a.destroy=="function"?a.destroy(e):typeof a.close=="function"?a.close():e?process$3.nextTick(emitErrorCloseLegacy,a,e):process$3.nextTick(emitCloseLegacy,a),a.destroyed||(a[kIsDestroyed]=!0))}var destroy_1={construct,destroyer:destroyer$2,destroy,undestroy,errorOrDestroy};const{ArrayIsArray:ArrayIsArray$1,ObjectSetPrototypeOf:ObjectSetPrototypeOf$2}=primordials,{EventEmitter:EE}=eventsExports;function Stream(a){EE.call(this,a)}ObjectSetPrototypeOf$2(Stream.prototype,EE.prototype);ObjectSetPrototypeOf$2(Stream,EE);Stream.prototype.pipe=function(a,e){const s=this;function o($){a.writable&&a.write($)===!1&&s.pause&&s.pause()}s.on("data",o);function c(){s.readable&&s.resume&&s.resume()}a.on("drain",c),!a._isStdio&&(!e||e.end!==!1)&&(s.on("end",h),s.on("close",g));let d=!1;function h(){d||(d=!0,a.end())}function g(){d||(d=!0,typeof a.destroy=="function"&&a.destroy())}function _($){b(),EE.listenerCount(this,"error")===0&&this.emit("error",$)}prependListener(s,"error",_),prependListener(a,"error",_);function b(){s.removeListener("data",o),a.removeListener("drain",c),s.removeListener("end",h),s.removeListener("close",g),s.removeListener("error",_),a.removeListener("error",_),s.removeListener("end",b),s.removeListener("close",b),a.removeListener("close",b)}return s.on("end",b),s.on("close",b),a.on("close",b),a.emit("pipe",s),a};function prependListener(a,e,s){if(typeof a.prependListener=="function")return a.prependListener(e,s);!a._events||!a._events[e]?a.on(e,s):ArrayIsArray$1(a._events[e])?a._events[e].unshift(s):a._events[e]=[s,a._events[e]]}var legacy={Stream,prependListener},addAbortSignal={exports:{}};(function(a){const{SymbolDispose:e}=primordials,{AbortError:s,codes:o}=errors,{isNodeStream:c,isWebStream:d,kControllerErrorFunction:h}=utils$2,g=endOfStreamExports,{ERR_INVALID_ARG_TYPE:_}=o;let b;const $=(j,_e)=>{if(typeof j!="object"||!("aborted"in j))throw new _(_e,"AbortSignal",j)};a.exports.addAbortSignal=function(_e,tt){if($(_e,"signal"),!c(tt)&&!d(tt))throw new _("stream",["ReadableStream","WritableStream","Stream"],tt);return a.exports.addAbortSignalNoValidate(_e,tt)},a.exports.addAbortSignalNoValidate=function(j,_e){if(typeof j!="object"||!("aborted"in j))return _e;const tt=c(_e)?()=>{_e.destroy(new s(void 0,{cause:j.reason}))}:()=>{_e[h](new s(void 0,{cause:j.reason}))};if(j.aborted)tt();else{b=b||utilExports.addAbortListener;const rt=b(j,tt);g(_e,rt[e])}return _e}})(addAbortSignal);var addAbortSignalExports=addAbortSignal.exports;const{StringPrototypeSlice,SymbolIterator:SymbolIterator$1,TypedArrayPrototypeSet,Uint8Array:Uint8Array$1}=primordials,{Buffer:Buffer$3}=buffer,{inspect}=utilExports;var buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const s={data:e,next:null};this.length>0?this.tail.next=s:this.head=s,this.tail=s,++this.length}unshift(e){const s={data:e,next:this.head};this.length===0&&(this.tail=s),this.head=s,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let s=this.head,o=""+s.data;for(;(s=s.next)!==null;)o+=e+s.data;return o}concat(e){if(this.length===0)return Buffer$3.alloc(0);const s=Buffer$3.allocUnsafe(e>>>0);let o=this.head,c=0;for(;o;)TypedArrayPrototypeSet(s,o.data,c),c+=o.data.length,o=o.next;return s}consume(e,s){const o=this.head.data;if(e<o.length){const c=o.slice(0,e);return this.head.data=o.slice(e),c}return e===o.length?this.shift():s?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[SymbolIterator$1](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let s="",o=this.head,c=0;do{const d=o.data;if(e>d.length)s+=d,e-=d.length;else{e===d.length?(s+=d,++c,o.next?this.head=o.next:this.head=this.tail=null):(s+=StringPrototypeSlice(d,0,e),this.head=o,o.data=StringPrototypeSlice(d,e));break}++c}while((o=o.next)!==null);return this.length-=c,s}_getBuffer(e){const s=Buffer$3.allocUnsafe(e),o=e;let c=this.head,d=0;do{const h=c.data;if(e>h.length)TypedArrayPrototypeSet(s,h,o-e),e-=h.length;else{e===h.length?(TypedArrayPrototypeSet(s,h,o-e),++d,c.next?this.head=c.next:this.head=this.tail=null):(TypedArrayPrototypeSet(s,new Uint8Array$1(h.buffer,h.byteOffset,e),o-e),this.head=c,c.data=h.slice(e));break}++d}while((c=c.next)!==null);return this.length-=d,s}[Symbol.for("nodejs.util.inspect.custom")](e,s){return inspect(this,{...s,depth:0,customInspect:!1})}};const{MathFloor:MathFloor$1,NumberIsInteger}=primordials,{validateInteger:validateInteger$1}=validators$2,{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$2}=errors.codes;let defaultHighWaterMarkBytes=16*1024,defaultHighWaterMarkObjectMode=16;function highWaterMarkFrom(a,e,s){return a.highWaterMark!=null?a.highWaterMark:e?a[s]:null}function getDefaultHighWaterMark(a){return a?defaultHighWaterMarkObjectMode:defaultHighWaterMarkBytes}function setDefaultHighWaterMark(a,e){validateInteger$1(e,"value",0),a?defaultHighWaterMarkObjectMode=e:defaultHighWaterMarkBytes=e}function getHighWaterMark$1(a,e,s,o){const c=highWaterMarkFrom(e,o,s);if(c!=null){if(!NumberIsInteger(c)||c<0){const d=o?`options.${s}`:"options.highWaterMark";throw new ERR_INVALID_ARG_VALUE$2(d,c)}return MathFloor$1(c)}return getDefaultHighWaterMark(a.objectMode)}var state={getHighWaterMark:getHighWaterMark$1,getDefaultHighWaterMark,setDefaultHighWaterMark},string_decoder={},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(a,e){var s=buffer,o=s.Buffer;function c(h,g){for(var _ in h)g[_]=h[_]}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?a.exports=s:(c(s,e),e.Buffer=d);function d(h,g,_){return o(h,g,_)}d.prototype=Object.create(o.prototype),c(o,d),d.from=function(h,g,_){if(typeof h=="number")throw new TypeError("Argument must not be a number");return o(h,g,_)},d.alloc=function(h,g,_){if(typeof h!="number")throw new TypeError("Argument must be a number");var b=o(h);return g!==void 0?typeof _=="string"?b.fill(g,_):b.fill(g):b.fill(0),b},d.allocUnsafe=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return o(h)},d.allocUnsafeSlow=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return s.SlowBuffer(h)}})(safeBuffer,safeBuffer.exports);var safeBufferExports=safeBuffer.exports,Buffer$2=safeBufferExports.Buffer,isEncoding=Buffer$2.isEncoding||function(a){switch(a=""+a,a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function _normalizeEncoding(a){if(!a)return"utf8";for(var e;;)switch(a){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return a;default:if(e)return;a=(""+a).toLowerCase(),e=!0}}function normalizeEncoding(a){var e=_normalizeEncoding(a);if(typeof e!="string"&&(Buffer$2.isEncoding===isEncoding||!isEncoding(a)))throw new Error("Unknown encoding: "+a);return e||a}string_decoder.StringDecoder=StringDecoder$1;function StringDecoder$1(a){this.encoding=normalizeEncoding(a);var e;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:this.write=simpleWrite,this.end=simpleEnd;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer$2.allocUnsafe(e)}StringDecoder$1.prototype.write=function(a){if(a.length===0)return"";var e,s;if(this.lastNeed){if(e=this.fillLast(a),e===void 0)return"";s=this.lastNeed,this.lastNeed=0}else s=0;return s<a.length?e?e+this.text(a,s):this.text(a,s):e||""};StringDecoder$1.prototype.end=utf8End;StringDecoder$1.prototype.text=utf8Text;StringDecoder$1.prototype.fillLast=function(a){if(this.lastNeed<=a.length)return a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,a.length),this.lastNeed-=a.length};function utf8CheckByte(a){return a<=127?0:a>>5===6?2:a>>4===14?3:a>>3===30?4:a>>6===2?-1:-2}function utf8CheckIncomplete(a,e,s){var o=e.length-1;if(o<s)return 0;var c=utf8CheckByte(e[o]);return c>=0?(c>0&&(a.lastNeed=c-1),c):--o<s||c===-2?0:(c=utf8CheckByte(e[o]),c>=0?(c>0&&(a.lastNeed=c-2),c):--o<s||c===-2?0:(c=utf8CheckByte(e[o]),c>=0?(c>0&&(c===2?c=0:a.lastNeed=c-3),c):0))}function utf8CheckExtraBytes(a,e,s){if((e[0]&192)!==128)return a.lastNeed=0,"";if(a.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return a.lastNeed=1,"";if(a.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return a.lastNeed=2,""}}function utf8FillLast(a){var e=this.lastTotal-this.lastNeed,s=utf8CheckExtraBytes(this,a);if(s!==void 0)return s;if(this.lastNeed<=a.length)return a.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);a.copy(this.lastChar,e,0,a.length),this.lastNeed-=a.length}function utf8Text(a,e){var s=utf8CheckIncomplete(this,a,e);if(!this.lastNeed)return a.toString("utf8",e);this.lastTotal=s;var o=a.length-(s-this.lastNeed);return a.copy(this.lastChar,0,o),a.toString("utf8",e,o)}function utf8End(a){var e=a&&a.length?this.write(a):"";return this.lastNeed?e+"":e}function utf16Text(a,e){if((a.length-e)%2===0){var s=a.toString("utf16le",e);if(s){var o=s.charCodeAt(s.length-1);if(o>=55296&&o<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1],s.slice(0,-1)}return s}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=a[a.length-1],a.toString("utf16le",e,a.length-1)}function utf16End(a){var e=a&&a.length?this.write(a):"";if(this.lastNeed){var s=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,s)}return e}function base64Text(a,e){var s=(a.length-e)%3;return s===0?a.toString("base64",e):(this.lastNeed=3-s,this.lastTotal=3,s===1?this.lastChar[0]=a[a.length-1]:(this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1]),a.toString("base64",e,a.length-s))}function base64End(a){var e=a&&a.length?this.write(a):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(a){return a.toString(this.encoding)}function simpleEnd(a){return a&&a.length?this.write(a):""}const process$2=browserExports$2,{PromisePrototypeThen:PromisePrototypeThen$1,SymbolAsyncIterator:SymbolAsyncIterator$1,SymbolIterator}=primordials,{Buffer:Buffer$1}=buffer,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$2,ERR_STREAM_NULL_VALUES}=errors.codes;function from(a,e,s){let o;if(typeof e=="string"||e instanceof Buffer$1)return new a({objectMode:!0,...s,read(){this.push(e),this.push(null)}});let c;if(e&&e[SymbolAsyncIterator$1])c=!0,o=e[SymbolAsyncIterator$1]();else if(e&&e[SymbolIterator])c=!1,o=e[SymbolIterator]();else throw new ERR_INVALID_ARG_TYPE$2("iterable",["Iterable"],e);const d=new a({objectMode:!0,highWaterMark:1,...s});let h=!1;d._read=function(){h||(h=!0,_())},d._destroy=function(b,$){PromisePrototypeThen$1(g(b),()=>process$2.nextTick($,b),j=>process$2.nextTick($,j||b))};async function g(b){const $=b!=null,j=typeof o.throw=="function";if($&&j){const{value:_e,done:tt}=await o.throw(b);if(await _e,tt)return}if(typeof o.return=="function"){const{value:_e}=await o.return();await _e}}async function _(){for(;;){try{const{value:b,done:$}=c?await o.next():o.next();if($)d.push(null);else{const j=b&&typeof b.then=="function"?await b:b;if(j===null)throw h=!1,new ERR_STREAM_NULL_VALUES;if(d.push(j))continue;h=!1}}catch(b){d.destroy(b)}break}}return d}var from_1=from,readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const a=browserExports$2,{ArrayPrototypeIndexOf:e,NumberIsInteger:s,NumberIsNaN:o,NumberParseInt:c,ObjectDefineProperties:d,ObjectKeys:h,ObjectSetPrototypeOf:g,Promise:_,SafeSet:b,SymbolAsyncDispose:$,SymbolAsyncIterator:j,Symbol:_e}=primordials;readable=xr,xr.ReadableState=Ur;const{EventEmitter:tt}=eventsExports,{Stream:rt,prependListener:nt}=legacy,{Buffer:st}=buffer,{addAbortSignal:at}=addAbortSignalExports,ot=endOfStreamExports;let ut=utilExports.debuglog("stream",_t=>{ut=_t});const mt=buffer_list,yt=destroy_1,{getHighWaterMark:Et,getDefaultHighWaterMark:dt}=state,{aggregateTwoErrors:gt,codes:{ERR_INVALID_ARG_TYPE:St,ERR_METHOD_NOT_IMPLEMENTED:xt,ERR_OUT_OF_RANGE:Ct,ERR_STREAM_PUSH_AFTER_EOF:Ht,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Dt},AbortError:rr}=errors,{validateObject:er}=validators$2,qt=_e("kPaused"),{StringDecoder:tr}=string_decoder,Ft=from_1;g(xr.prototype,rt.prototype),g(xr,rt);const Yt=()=>{},{errorOrDestroy:Qt}=yt,zt=1,Xt=2,sr=4,Er=8,Sr=16,_r=32,Fr=64,$r=128,yr=256,qr=512,Yr=1024,Pr=2048,Bt=4096,Vt=8192,ir=16384,ar=32768,pr=65536,kr=1<<17,Or=1<<18;function Ar(_t){return{enumerable:!1,get(){return(this.state&_t)!==0},set(wt){wt?this.state|=_t:this.state&=~_t}}}d(Ur.prototype,{objectMode:Ar(zt),ended:Ar(Xt),endEmitted:Ar(sr),reading:Ar(Er),constructed:Ar(Sr),sync:Ar(_r),needReadable:Ar(Fr),emittedReadable:Ar($r),readableListening:Ar(yr),resumeScheduled:Ar(qr),errorEmitted:Ar(Yr),emitClose:Ar(Pr),autoDestroy:Ar(Bt),destroyed:Ar(Vt),closed:Ar(ir),closeEmitted:Ar(ar),multiAwaitDrain:Ar(pr),readingMore:Ar(kr),dataEmitted:Ar(Or)});function Ur(_t,wt,lr){typeof lr!="boolean"&&(lr=wt instanceof requireDuplex()),this.state=Pr|Bt|Sr|_r,_t&&_t.objectMode&&(this.state|=zt),lr&&_t&&_t.readableObjectMode&&(this.state|=zt),this.highWaterMark=_t?Et(this,_t,"readableHighWaterMark",lr):dt(!1),this.buffer=new mt,this.length=0,this.pipes=[],this.flowing=null,this[qt]=null,_t&&_t.emitClose===!1&&(this.state&=~Pr),_t&&_t.autoDestroy===!1&&(this.state&=~Bt),this.errored=null,this.defaultEncoding=_t&&_t.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,_t&&_t.encoding&&(this.decoder=new tr(_t.encoding),this.encoding=_t.encoding)}function xr(_t){if(!(this instanceof xr))return new xr(_t);const wt=this instanceof requireDuplex();this._readableState=new Ur(_t,this,wt),_t&&(typeof _t.read=="function"&&(this._read=_t.read),typeof _t.destroy=="function"&&(this._destroy=_t.destroy),typeof _t.construct=="function"&&(this._construct=_t.construct),_t.signal&&!wt&&at(_t.signal,this)),rt.call(this,_t),yt.construct(this,()=>{this._readableState.needReadable&&Pt(this,this._readableState)})}xr.prototype.destroy=yt.destroy,xr.prototype._undestroy=yt.undestroy,xr.prototype._destroy=function(_t,wt){wt(_t)},xr.prototype[tt.captureRejectionSymbol]=function(_t){this.destroy(_t)},xr.prototype[$]=function(){let _t;return this.destroyed||(_t=this.readableEnded?null:new rr,this.destroy(_t)),new _((wt,lr)=>ot(this,cr=>cr&&cr!==_t?lr(cr):wt(null)))},xr.prototype.push=function(_t,wt){return Hr(this,_t,wt,!1)},xr.prototype.unshift=function(_t,wt){return Hr(this,_t,wt,!0)};function Hr(_t,wt,lr,cr){ut("readableAddChunk",wt);const br=_t._readableState;let Cr;if(br.state&zt||(typeof wt=="string"?(lr=lr||br.defaultEncoding,br.encoding!==lr&&(cr&&br.encoding?wt=st.from(wt,lr).toString(br.encoding):(wt=st.from(wt,lr),lr=""))):wt instanceof st?lr="":rt._isUint8Array(wt)?(wt=rt._uint8ArrayToBuffer(wt),lr=""):wt!=null&&(Cr=new St("chunk",["string","Buffer","Uint8Array"],wt))),Cr)Qt(_t,Cr);else if(wt===null)br.state&=~Er,ct(_t,br);else if(br.state&zt||wt&&wt.length>0)if(cr)if(br.state&sr)Qt(_t,new Dt);else{if(br.destroyed||br.errored)return!1;sn(_t,br,wt,!0)}else if(br.ended)Qt(_t,new Ht);else{if(br.destroyed||br.errored)return!1;br.state&=~Er,br.decoder&&!lr?(wt=br.decoder.write(wt),br.objectMode||wt.length!==0?sn(_t,br,wt,!1):Pt(_t,br)):sn(_t,br,wt,!1)}else cr||(br.state&=~Er,Pt(_t,br));return!br.ended&&(br.length<br.highWaterMark||br.length===0)}function sn(_t,wt,lr,cr){wt.flowing&&wt.length===0&&!wt.sync&&_t.listenerCount("data")>0?(wt.state&pr?wt.awaitDrainWriters.clear():wt.awaitDrainWriters=null,wt.dataEmitted=!0,_t.emit("data",lr)):(wt.length+=wt.objectMode?1:lr.length,cr?wt.buffer.unshift(lr):wt.buffer.push(lr),wt.state&Fr&&ft(_t)),Pt(_t,wt)}xr.prototype.isPaused=function(){const _t=this._readableState;return _t[qt]===!0||_t.flowing===!1},xr.prototype.setEncoding=function(_t){const wt=new tr(_t);this._readableState.decoder=wt,this._readableState.encoding=this._readableState.decoder.encoding;const lr=this._readableState.buffer;let cr="";for(const br of lr)cr+=wt.write(br);return lr.clear(),cr!==""&&lr.push(cr),this._readableState.length=cr.length,this};const Xr=1073741824;function Zr(_t){if(_t>Xr)throw new Ct("size","<= 1GiB",_t);return _t--,_t|=_t>>>1,_t|=_t>>>2,_t|=_t>>>4,_t|=_t>>>8,_t|=_t>>>16,_t++,_t}function Tt(_t,wt){return _t<=0||wt.length===0&&wt.ended?0:wt.state&zt?1:o(_t)?wt.flowing&&wt.length?wt.buffer.first().length:wt.length:_t<=wt.length?_t:wt.ended?wt.length:0}xr.prototype.read=function(_t){ut("read",_t),_t===void 0?_t=NaN:s(_t)||(_t=c(_t,10));const wt=this._readableState,lr=_t;if(_t>wt.highWaterMark&&(wt.highWaterMark=Zr(_t)),_t!==0&&(wt.state&=~$r),_t===0&&wt.needReadable&&((wt.highWaterMark!==0?wt.length>=wt.highWaterMark:wt.length>0)||wt.ended))return ut("read: emitReadable",wt.length,wt.ended),wt.length===0&&wt.ended?Ln(this):ft(this),null;if(_t=Tt(_t,wt),_t===0&&wt.ended)return wt.length===0&&Ln(this),null;let cr=(wt.state&Fr)!==0;if(ut("need readable",cr),(wt.length===0||wt.length-_t<wt.highWaterMark)&&(cr=!0,ut("length less than watermark",cr)),wt.ended||wt.reading||wt.destroyed||wt.errored||!wt.constructed)cr=!1,ut("reading, ended or constructing",cr);else if(cr){ut("do read"),wt.state|=Er|_r,wt.length===0&&(wt.state|=Fr);try{this._read(wt.highWaterMark)}catch(Cr){Qt(this,Cr)}wt.state&=~_r,wt.reading||(_t=Tt(lr,wt))}let br;return _t>0?br=Dn(_t,wt):br=null,br===null?(wt.needReadable=wt.length<=wt.highWaterMark,_t=0):(wt.length-=_t,wt.multiAwaitDrain?wt.awaitDrainWriters.clear():wt.awaitDrainWriters=null),wt.length===0&&(wt.ended||(wt.needReadable=!0),lr!==_t&&wt.ended&&Ln(this)),br!==null&&!wt.errorEmitted&&!wt.closeEmitted&&(wt.dataEmitted=!0,this.emit("data",br)),br};function ct(_t,wt){if(ut("onEofChunk"),!wt.ended){if(wt.decoder){const lr=wt.decoder.end();lr&&lr.length&&(wt.buffer.push(lr),wt.length+=wt.objectMode?1:lr.length)}wt.ended=!0,wt.sync?ft(_t):(wt.needReadable=!1,wt.emittedReadable=!0,At(_t))}}function ft(_t){const wt=_t._readableState;ut("emitReadable",wt.needReadable,wt.emittedReadable),wt.needReadable=!1,wt.emittedReadable||(ut("emitReadable",wt.flowing),wt.emittedReadable=!0,a.nextTick(At,_t))}function At(_t){const wt=_t._readableState;ut("emitReadable_",wt.destroyed,wt.length,wt.ended),!wt.destroyed&&!wt.errored&&(wt.length||wt.ended)&&(_t.emit("readable"),wt.emittedReadable=!1),wt.needReadable=!wt.flowing&&!wt.ended&&wt.length<=wt.highWaterMark,Lr(_t)}function Pt(_t,wt){!wt.readingMore&&wt.constructed&&(wt.readingMore=!0,a.nextTick(Kt,_t,wt))}function Kt(_t,wt){for(;!wt.reading&&!wt.ended&&(wt.length<wt.highWaterMark||wt.flowing&&wt.length===0);){const lr=wt.length;if(ut("maybeReadMore read 0"),_t.read(0),lr===wt.length)break}wt.readingMore=!1}xr.prototype._read=function(_t){throw new xt("_read()")},xr.prototype.pipe=function(_t,wt){const lr=this,cr=this._readableState;cr.pipes.length===1&&(cr.multiAwaitDrain||(cr.multiAwaitDrain=!0,cr.awaitDrainWriters=new b(cr.awaitDrainWriters?[cr.awaitDrainWriters]:[]))),cr.pipes.push(_t),ut("pipe count=%d opts=%j",cr.pipes.length,wt);const Cr=(!wt||wt.end!==!1)&&_t!==a.stdout&&_t!==a.stderr?Zn:An;cr.endEmitted?a.nextTick(Cr):lr.once("end",Cr),_t.on("unpipe",Vr);function Vr(Jr,cn){ut("onunpipe"),Jr===lr&&cn&&cn.hasUnpiped===!1&&(cn.hasUnpiped=!0,Mn())}function Zn(){ut("onend"),_t.end()}let ln,_n=!1;function Mn(){ut("cleanup"),_t.removeListener("close",un),_t.removeListener("finish",vn),ln&&_t.removeListener("drain",ln),_t.removeListener("error",hn),_t.removeListener("unpipe",Vr),lr.removeListener("end",Zn),lr.removeListener("end",An),lr.removeListener("data",fn),_n=!0,ln&&cr.awaitDrainWriters&&(!_t._writableState||_t._writableState.needDrain)&&ln()}function Jn(){_n||(cr.pipes.length===1&&cr.pipes[0]===_t?(ut("false write response, pause",0),cr.awaitDrainWriters=_t,cr.multiAwaitDrain=!1):cr.pipes.length>1&&cr.pipes.includes(_t)&&(ut("false write response, pause",cr.awaitDrainWriters.size),cr.awaitDrainWriters.add(_t)),lr.pause()),ln||(ln=Jt(lr,_t),_t.on("drain",ln))}lr.on("data",fn);function fn(Jr){ut("ondata");const cn=_t.write(Jr);ut("dest.write",cn),cn===!1&&Jn()}function hn(Jr){if(ut("onerror",Jr),An(),_t.removeListener("error",hn),_t.listenerCount("error")===0){const cn=_t._writableState||_t._readableState;cn&&!cn.errorEmitted?Qt(_t,Jr):_t.emit("error",Jr)}}nt(_t,"error",hn);function un(){_t.removeListener("finish",vn),An()}_t.once("close",un);function vn(){ut("onfinish"),_t.removeListener("close",un),An()}_t.once("finish",vn);function An(){ut("unpipe"),lr.unpipe(_t)}return _t.emit("pipe",lr),_t.writableNeedDrain===!0?Jn():cr.flowing||(ut("pipe resume"),lr.resume()),_t};function Jt(_t,wt){return function(){const cr=_t._readableState;cr.awaitDrainWriters===wt?(ut("pipeOnDrain",1),cr.awaitDrainWriters=null):cr.multiAwaitDrain&&(ut("pipeOnDrain",cr.awaitDrainWriters.size),cr.awaitDrainWriters.delete(wt)),(!cr.awaitDrainWriters||cr.awaitDrainWriters.size===0)&&_t.listenerCount("data")&&_t.resume()}}xr.prototype.unpipe=function(_t){const wt=this._readableState,lr={hasUnpiped:!1};if(wt.pipes.length===0)return this;if(!_t){const br=wt.pipes;wt.pipes=[],this.pause();for(let Cr=0;Cr<br.length;Cr++)br[Cr].emit("unpipe",this,{hasUnpiped:!1});return this}const cr=e(wt.pipes,_t);return cr===-1?this:(wt.pipes.splice(cr,1),wt.pipes.length===0&&this.pause(),_t.emit("unpipe",this,lr),this)},xr.prototype.on=function(_t,wt){const lr=rt.prototype.on.call(this,_t,wt),cr=this._readableState;return _t==="data"?(cr.readableListening=this.listenerCount("readable")>0,cr.flowing!==!1&&this.resume()):_t==="readable"&&!cr.endEmitted&&!cr.readableListening&&(cr.readableListening=cr.needReadable=!0,cr.flowing=!1,cr.emittedReadable=!1,ut("on readable",cr.length,cr.reading),cr.length?ft(this):cr.reading||a.nextTick(Br,this)),lr},xr.prototype.addListener=xr.prototype.on,xr.prototype.removeListener=function(_t,wt){const lr=rt.prototype.removeListener.call(this,_t,wt);return _t==="readable"&&a.nextTick(wr,this),lr},xr.prototype.off=xr.prototype.removeListener,xr.prototype.removeAllListeners=function(_t){const wt=rt.prototype.removeAllListeners.apply(this,arguments);return(_t==="readable"||_t===void 0)&&a.nextTick(wr,this),wt};function wr(_t){const wt=_t._readableState;wt.readableListening=_t.listenerCount("readable")>0,wt.resumeScheduled&&wt[qt]===!1?wt.flowing=!0:_t.listenerCount("data")>0?_t.resume():wt.readableListening||(wt.flowing=null)}function Br(_t){ut("readable nexttick read 0"),_t.read(0)}xr.prototype.resume=function(){const _t=this._readableState;return _t.flowing||(ut("resume"),_t.flowing=!_t.readableListening,dr(this,_t)),_t[qt]=!1,this};function dr(_t,wt){wt.resumeScheduled||(wt.resumeScheduled=!0,a.nextTick(Gr,_t,wt))}function Gr(_t,wt){ut("resume",wt.reading),wt.reading||_t.read(0),wt.resumeScheduled=!1,_t.emit("resume"),Lr(_t),wt.flowing&&!wt.reading&&_t.read(0)}xr.prototype.pause=function(){return ut("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(ut("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[qt]=!0,this};function Lr(_t){const wt=_t._readableState;for(ut("flow",wt.flowing);wt.flowing&&_t.read()!==null;);}xr.prototype.wrap=function(_t){let wt=!1;_t.on("data",cr=>{!this.push(cr)&&_t.pause&&(wt=!0,_t.pause())}),_t.on("end",()=>{this.push(null)}),_t.on("error",cr=>{Qt(this,cr)}),_t.on("close",()=>{this.destroy()}),_t.on("destroy",()=>{this.destroy()}),this._read=()=>{wt&&_t.resume&&(wt=!1,_t.resume())};const lr=h(_t);for(let cr=1;cr<lr.length;cr++){const br=lr[cr];this[br]===void 0&&typeof _t[br]=="function"&&(this[br]=_t[br].bind(_t))}return this},xr.prototype[j]=function(){return Sn(this)},xr.prototype.iterator=function(_t){return _t!==void 0&&er(_t,"options"),Sn(this,_t)};function Sn(_t,wt){typeof _t.read!="function"&&(_t=xr.wrap(_t,{objectMode:!0}));const lr=vr(_t,wt);return lr.stream=_t,lr}async function*vr(_t,wt){let lr=Yt;function cr(Vr){this===_t?(lr(),lr=Yt):lr=Vr}_t.on("readable",cr);let br;const Cr=ot(_t,{writable:!1},Vr=>{br=Vr?gt(br,Vr):null,lr(),lr=Yt});try{for(;;){const Vr=_t.destroyed?null:_t.read();if(Vr!==null)yield Vr;else{if(br)throw br;if(br===null)return;await new _(cr)}}}catch(Vr){throw br=gt(br,Vr),br}finally{(br||(wt==null?void 0:wt.destroyOnReturn)!==!1)&&(br===void 0||_t._readableState.autoDestroy)?yt.destroyer(_t,null):(_t.off("readable",cr),Cr())}}d(xr.prototype,{readable:{__proto__:null,get(){const _t=this._readableState;return!!_t&&_t.readable!==!1&&!_t.destroyed&&!_t.errorEmitted&&!_t.endEmitted},set(_t){this._readableState&&(this._readableState.readable=!!_t)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(_t){this._readableState&&(this._readableState.flowing=_t)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(_t){this._readableState&&(this._readableState.destroyed=_t)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),d(Ur.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[qt]!==!1},set(_t){this[qt]=!!_t}}}),xr._fromList=Dn;function Dn(_t,wt){if(wt.length===0)return null;let lr;return wt.objectMode?lr=wt.buffer.shift():!_t||_t>=wt.length?(wt.decoder?lr=wt.buffer.join(""):wt.buffer.length===1?lr=wt.buffer.first():lr=wt.buffer.concat(wt.length),wt.buffer.clear()):lr=wt.buffer.consume(_t,wt.decoder),lr}function Ln(_t){const wt=_t._readableState;ut("endReadable",wt.endEmitted),wt.endEmitted||(wt.ended=!0,a.nextTick(Un,wt,_t))}function Un(_t,wt){if(ut("endReadableNT",_t.endEmitted,_t.length),!_t.errored&&!_t.closeEmitted&&!_t.endEmitted&&_t.length===0){if(_t.endEmitted=!0,wt.emit("end"),wt.writable&&wt.allowHalfOpen===!1)a.nextTick(Xn,wt);else if(_t.autoDestroy){const lr=wt._writableState;(!lr||lr.autoDestroy&&(lr.finished||lr.writable===!1))&&wt.destroy()}}}function Xn(_t){_t.writable&&!_t.writableEnded&&!_t.destroyed&&_t.end()}xr.from=function(_t,wt){return Ft(xr,_t,wt)};let bn;function Qn(){return bn===void 0&&(bn={}),bn}return xr.fromWeb=function(_t,wt){return Qn().newStreamReadableFromReadableStream(_t,wt)},xr.toWeb=function(_t,wt){return Qn().newReadableStreamFromStreamReadable(_t,wt)},xr.wrap=function(_t,wt){var lr,cr;return new xr({objectMode:(lr=(cr=_t.readableObjectMode)!==null&&cr!==void 0?cr:_t.objectMode)!==null&&lr!==void 0?lr:!0,...wt,destroy(br,Cr){yt.destroyer(_t,br),Cr(br)}}).wrap(_t)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const a=browserExports$2,{ArrayPrototypeSlice:e,Error:s,FunctionPrototypeSymbolHasInstance:o,ObjectDefineProperty:c,ObjectDefineProperties:d,ObjectSetPrototypeOf:h,StringPrototypeToLowerCase:g,Symbol:_,SymbolHasInstance:b}=primordials;writable=er,er.WritableState=Dt;const{EventEmitter:$}=eventsExports,j=legacy.Stream,{Buffer:_e}=buffer,tt=destroy_1,{addAbortSignal:rt}=addAbortSignalExports,{getHighWaterMark:nt,getDefaultHighWaterMark:st}=state,{ERR_INVALID_ARG_TYPE:at,ERR_METHOD_NOT_IMPLEMENTED:ot,ERR_MULTIPLE_CALLBACK:ut,ERR_STREAM_CANNOT_PIPE:mt,ERR_STREAM_DESTROYED:yt,ERR_STREAM_ALREADY_FINISHED:Et,ERR_STREAM_NULL_VALUES:dt,ERR_STREAM_WRITE_AFTER_END:gt,ERR_UNKNOWN_ENCODING:St}=errors.codes,{errorOrDestroy:xt}=tt;h(er.prototype,j.prototype),h(er,j);function Ct(){}const Ht=_("kOnFinished");function Dt(Bt,Vt,ir){typeof ir!="boolean"&&(ir=Vt instanceof requireDuplex()),this.objectMode=!!(Bt&&Bt.objectMode),ir&&(this.objectMode=this.objectMode||!!(Bt&&Bt.writableObjectMode)),this.highWaterMark=Bt?nt(this,Bt,"writableHighWaterMark",ir):st(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const ar=!!(Bt&&Bt.decodeStrings===!1);this.decodeStrings=!ar,this.defaultEncoding=Bt&&Bt.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=Qt.bind(void 0,Vt),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,rr(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!Bt||Bt.emitClose!==!1,this.autoDestroy=!Bt||Bt.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Ht]=[]}function rr(Bt){Bt.buffered=[],Bt.bufferedIndex=0,Bt.allBuffers=!0,Bt.allNoop=!0}Dt.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},c(Dt.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function er(Bt){const Vt=this instanceof requireDuplex();if(!Vt&&!o(er,this))return new er(Bt);this._writableState=new Dt(Bt,this,Vt),Bt&&(typeof Bt.write=="function"&&(this._write=Bt.write),typeof Bt.writev=="function"&&(this._writev=Bt.writev),typeof Bt.destroy=="function"&&(this._destroy=Bt.destroy),typeof Bt.final=="function"&&(this._final=Bt.final),typeof Bt.construct=="function"&&(this._construct=Bt.construct),Bt.signal&&rt(Bt.signal,this)),j.call(this,Bt),tt.construct(this,()=>{const ir=this._writableState;ir.writing||Er(this,ir),$r(this,ir)})}c(er,b,{__proto__:null,value:function(Bt){return o(this,Bt)?!0:this!==er?!1:Bt&&Bt._writableState instanceof Dt}}),er.prototype.pipe=function(){xt(this,new mt)};function qt(Bt,Vt,ir,ar){const pr=Bt._writableState;if(typeof ir=="function")ar=ir,ir=pr.defaultEncoding;else{if(!ir)ir=pr.defaultEncoding;else if(ir!=="buffer"&&!_e.isEncoding(ir))throw new St(ir);typeof ar!="function"&&(ar=Ct)}if(Vt===null)throw new dt;if(!pr.objectMode)if(typeof Vt=="string")pr.decodeStrings!==!1&&(Vt=_e.from(Vt,ir),ir="buffer");else if(Vt instanceof _e)ir="buffer";else if(j._isUint8Array(Vt))Vt=j._uint8ArrayToBuffer(Vt),ir="buffer";else throw new at("chunk",["string","Buffer","Uint8Array"],Vt);let kr;return pr.ending?kr=new gt:pr.destroyed&&(kr=new yt("write")),kr?(a.nextTick(ar,kr),xt(Bt,kr,!0),kr):(pr.pendingcb++,tr(Bt,pr,Vt,ir,ar))}er.prototype.write=function(Bt,Vt,ir){return qt(this,Bt,Vt,ir)===!0},er.prototype.cork=function(){this._writableState.corked++},er.prototype.uncork=function(){const Bt=this._writableState;Bt.corked&&(Bt.corked--,Bt.writing||Er(this,Bt))},er.prototype.setDefaultEncoding=function(Vt){if(typeof Vt=="string"&&(Vt=g(Vt)),!_e.isEncoding(Vt))throw new St(Vt);return this._writableState.defaultEncoding=Vt,this};function tr(Bt,Vt,ir,ar,pr){const kr=Vt.objectMode?1:ir.length;Vt.length+=kr;const Or=Vt.length<Vt.highWaterMark;return Or||(Vt.needDrain=!0),Vt.writing||Vt.corked||Vt.errored||!Vt.constructed?(Vt.buffered.push({chunk:ir,encoding:ar,callback:pr}),Vt.allBuffers&&ar!=="buffer"&&(Vt.allBuffers=!1),Vt.allNoop&&pr!==Ct&&(Vt.allNoop=!1)):(Vt.writelen=kr,Vt.writecb=pr,Vt.writing=!0,Vt.sync=!0,Bt._write(ir,ar,Vt.onwrite),Vt.sync=!1),Or&&!Vt.errored&&!Vt.destroyed}function Ft(Bt,Vt,ir,ar,pr,kr,Or){Vt.writelen=ar,Vt.writecb=Or,Vt.writing=!0,Vt.sync=!0,Vt.destroyed?Vt.onwrite(new yt("write")):ir?Bt._writev(pr,Vt.onwrite):Bt._write(pr,kr,Vt.onwrite),Vt.sync=!1}function Yt(Bt,Vt,ir,ar){--Vt.pendingcb,ar(ir),sr(Vt),xt(Bt,ir)}function Qt(Bt,Vt){const ir=Bt._writableState,ar=ir.sync,pr=ir.writecb;if(typeof pr!="function"){xt(Bt,new ut);return}ir.writing=!1,ir.writecb=null,ir.length-=ir.writelen,ir.writelen=0,Vt?(Vt.stack,ir.errored||(ir.errored=Vt),Bt._readableState&&!Bt._readableState.errored&&(Bt._readableState.errored=Vt),ar?a.nextTick(Yt,Bt,ir,Vt,pr):Yt(Bt,ir,Vt,pr)):(ir.buffered.length>ir.bufferedIndex&&Er(Bt,ir),ar?ir.afterWriteTickInfo!==null&&ir.afterWriteTickInfo.cb===pr?ir.afterWriteTickInfo.count++:(ir.afterWriteTickInfo={count:1,cb:pr,stream:Bt,state:ir},a.nextTick(zt,ir.afterWriteTickInfo)):Xt(Bt,ir,1,pr))}function zt({stream:Bt,state:Vt,count:ir,cb:ar}){return Vt.afterWriteTickInfo=null,Xt(Bt,Vt,ir,ar)}function Xt(Bt,Vt,ir,ar){for(!Vt.ending&&!Bt.destroyed&&Vt.length===0&&Vt.needDrain&&(Vt.needDrain=!1,Bt.emit("drain"));ir-- >0;)Vt.pendingcb--,ar();Vt.destroyed&&sr(Vt),$r(Bt,Vt)}function sr(Bt){if(Bt.writing)return;for(let pr=Bt.bufferedIndex;pr<Bt.buffered.length;++pr){var Vt;const{chunk:kr,callback:Or}=Bt.buffered[pr],Ar=Bt.objectMode?1:kr.length;Bt.length-=Ar,Or((Vt=Bt.errored)!==null&&Vt!==void 0?Vt:new yt("write"))}const ir=Bt[Ht].splice(0);for(let pr=0;pr<ir.length;pr++){var ar;ir[pr]((ar=Bt.errored)!==null&&ar!==void 0?ar:new yt("end"))}rr(Bt)}function Er(Bt,Vt){if(Vt.corked||Vt.bufferProcessing||Vt.destroyed||!Vt.constructed)return;const{buffered:ir,bufferedIndex:ar,objectMode:pr}=Vt,kr=ir.length-ar;if(!kr)return;let Or=ar;if(Vt.bufferProcessing=!0,kr>1&&Bt._writev){Vt.pendingcb-=kr-1;const Ar=Vt.allNoop?Ct:xr=>{for(let Hr=Or;Hr<ir.length;++Hr)ir[Hr].callback(xr)},Ur=Vt.allNoop&&Or===0?ir:e(ir,Or);Ur.allBuffers=Vt.allBuffers,Ft(Bt,Vt,!0,Vt.length,Ur,"",Ar),rr(Vt)}else{do{const{chunk:Ar,encoding:Ur,callback:xr}=ir[Or];ir[Or++]=null;const Hr=pr?1:Ar.length;Ft(Bt,Vt,!1,Hr,Ar,Ur,xr)}while(Or<ir.length&&!Vt.writing);Or===ir.length?rr(Vt):Or>256?(ir.splice(0,Or),Vt.bufferedIndex=0):Vt.bufferedIndex=Or}Vt.bufferProcessing=!1}er.prototype._write=function(Bt,Vt,ir){if(this._writev)this._writev([{chunk:Bt,encoding:Vt}],ir);else throw new ot("_write()")},er.prototype._writev=null,er.prototype.end=function(Bt,Vt,ir){const ar=this._writableState;typeof Bt=="function"?(ir=Bt,Bt=null,Vt=null):typeof Vt=="function"&&(ir=Vt,Vt=null);let pr;if(Bt!=null){const kr=qt(this,Bt,Vt);kr instanceof s&&(pr=kr)}return ar.corked&&(ar.corked=1,this.uncork()),pr||(!ar.errored&&!ar.ending?(ar.ending=!0,$r(this,ar,!0),ar.ended=!0):ar.finished?pr=new Et("end"):ar.destroyed&&(pr=new yt("end"))),typeof ir=="function"&&(pr||ar.finished?a.nextTick(ir,pr):ar[Ht].push(ir)),this};function Sr(Bt){return Bt.ending&&!Bt.destroyed&&Bt.constructed&&Bt.length===0&&!Bt.errored&&Bt.buffered.length===0&&!Bt.finished&&!Bt.writing&&!Bt.errorEmitted&&!Bt.closeEmitted}function _r(Bt,Vt){let ir=!1;function ar(pr){if(ir){xt(Bt,pr??ut());return}if(ir=!0,Vt.pendingcb--,pr){const kr=Vt[Ht].splice(0);for(let Or=0;Or<kr.length;Or++)kr[Or](pr);xt(Bt,pr,Vt.sync)}else Sr(Vt)&&(Vt.prefinished=!0,Bt.emit("prefinish"),Vt.pendingcb++,a.nextTick(yr,Bt,Vt))}Vt.sync=!0,Vt.pendingcb++;try{Bt._final(ar)}catch(pr){ar(pr)}Vt.sync=!1}function Fr(Bt,Vt){!Vt.prefinished&&!Vt.finalCalled&&(typeof Bt._final=="function"&&!Vt.destroyed?(Vt.finalCalled=!0,_r(Bt,Vt)):(Vt.prefinished=!0,Bt.emit("prefinish")))}function $r(Bt,Vt,ir){Sr(Vt)&&(Fr(Bt,Vt),Vt.pendingcb===0&&(ir?(Vt.pendingcb++,a.nextTick((ar,pr)=>{Sr(pr)?yr(ar,pr):pr.pendingcb--},Bt,Vt)):Sr(Vt)&&(Vt.pendingcb++,yr(Bt,Vt))))}function yr(Bt,Vt){Vt.pendingcb--,Vt.finished=!0;const ir=Vt[Ht].splice(0);for(let ar=0;ar<ir.length;ar++)ir[ar]();if(Bt.emit("finish"),Vt.autoDestroy){const ar=Bt._readableState;(!ar||ar.autoDestroy&&(ar.endEmitted||ar.readable===!1))&&Bt.destroy()}}d(er.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(Bt){this._writableState&&(this._writableState.destroyed=Bt)}},writable:{__proto__:null,get(){const Bt=this._writableState;return!!Bt&&Bt.writable!==!1&&!Bt.destroyed&&!Bt.errored&&!Bt.ending&&!Bt.ended},set(Bt){this._writableState&&(this._writableState.writable=!!Bt)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const Bt=this._writableState;return Bt?!Bt.destroyed&&!Bt.ending&&Bt.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const qr=tt.destroy;er.prototype.destroy=function(Bt,Vt){const ir=this._writableState;return!ir.destroyed&&(ir.bufferedIndex<ir.buffered.length||ir[Ht].length)&&a.nextTick(sr,ir),qr.call(this,Bt,Vt),this},er.prototype._undestroy=tt.undestroy,er.prototype._destroy=function(Bt,Vt){Vt(Bt)},er.prototype[$.captureRejectionSymbol]=function(Bt){this.destroy(Bt)};let Yr;function Pr(){return Yr===void 0&&(Yr={}),Yr}return er.fromWeb=function(Bt,Vt){return Pr().newStreamWritableFromWritableStream(Bt,Vt)},er.toWeb=function(Bt){return Pr().newWritableStreamFromStreamWritable(Bt)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const a=browserExports$2,e=buffer,{isReadable:s,isWritable:o,isIterable:c,isNodeStream:d,isReadableNodeStream:h,isWritableNodeStream:g,isDuplexNodeStream:_,isReadableStream:b,isWritableStream:$}=utils$2,j=endOfStreamExports,{AbortError:_e,codes:{ERR_INVALID_ARG_TYPE:tt,ERR_INVALID_RETURN_VALUE:rt}}=errors,{destroyer:nt}=destroy_1,st=requireDuplex(),at=requireReadable(),ot=requireWritable(),{createDeferredPromise:ut}=utilExports,mt=from_1,yt=globalThis.Blob||e.Blob,Et=typeof yt<"u"?function(Dt){return Dt instanceof yt}:function(Dt){return!1},dt=globalThis.AbortController||requireBrowser().AbortController,{FunctionPrototypeCall:gt}=primordials;class St extends st{constructor(Dt){super(Dt),(Dt==null?void 0:Dt.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(Dt==null?void 0:Dt.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function Ht(Dt,rr){if(_(Dt))return Dt;if(h(Dt))return Ct({readable:Dt});if(g(Dt))return Ct({writable:Dt});if(d(Dt))return Ct({writable:!1,readable:!1});if(b(Dt))return Ct({readable:at.fromWeb(Dt)});if($(Dt))return Ct({writable:ot.fromWeb(Dt)});if(typeof Dt=="function"){const{value:qt,write:tr,final:Ft,destroy:Yt}=xt(Dt);if(c(qt))return mt(St,qt,{objectMode:!0,write:tr,final:Ft,destroy:Yt});const Qt=qt==null?void 0:qt.then;if(typeof Qt=="function"){let zt;const Xt=gt(Qt,qt,sr=>{if(sr!=null)throw new rt("nully","body",sr)},sr=>{nt(zt,sr)});return zt=new St({objectMode:!0,readable:!1,write:tr,final(sr){Ft(async()=>{try{await Xt,a.nextTick(sr,null)}catch(Er){a.nextTick(sr,Er)}})},destroy:Yt})}throw new rt("Iterable, AsyncIterable or AsyncFunction",rr,qt)}if(Et(Dt))return Ht(Dt.arrayBuffer());if(c(Dt))return mt(St,Dt,{objectMode:!0,writable:!1});if(b(Dt==null?void 0:Dt.readable)&&$(Dt==null?void 0:Dt.writable))return St.fromWeb(Dt);if(typeof(Dt==null?void 0:Dt.writable)=="object"||typeof(Dt==null?void 0:Dt.readable)=="object"){const qt=Dt!=null&&Dt.readable?h(Dt==null?void 0:Dt.readable)?Dt==null?void 0:Dt.readable:Ht(Dt.readable):void 0,tr=Dt!=null&&Dt.writable?g(Dt==null?void 0:Dt.writable)?Dt==null?void 0:Dt.writable:Ht(Dt.writable):void 0;return Ct({readable:qt,writable:tr})}const er=Dt==null?void 0:Dt.then;if(typeof er=="function"){let qt;return gt(er,Dt,tr=>{tr!=null&&qt.push(tr),qt.push(null)},tr=>{nt(qt,tr)}),qt=new St({objectMode:!0,writable:!1,read(){}})}throw new tt(rr,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],Dt)};function xt(Ht){let{promise:Dt,resolve:rr}=ut();const er=new dt,qt=er.signal;return{value:Ht(async function*(){for(;;){const Ft=Dt;Dt=null;const{chunk:Yt,done:Qt,cb:zt}=await Ft;if(a.nextTick(zt),Qt)return;if(qt.aborted)throw new _e(void 0,{cause:qt.reason});({promise:Dt,resolve:rr}=ut()),yield Yt}}(),{signal:qt}),write(Ft,Yt,Qt){const zt=rr;rr=null,zt({chunk:Ft,done:!1,cb:Qt})},final(Ft){const Yt=rr;rr=null,Yt({done:!0,cb:Ft})},destroy(Ft,Yt){er.abort(),Yt(Ft)}}}function Ct(Ht){const Dt=Ht.readable&&typeof Ht.readable.read!="function"?at.wrap(Ht.readable):Ht.readable,rr=Ht.writable;let er=!!s(Dt),qt=!!o(rr),tr,Ft,Yt,Qt,zt;function Xt(sr){const Er=Qt;Qt=null,Er?Er(sr):sr&&zt.destroy(sr)}return zt=new St({readableObjectMode:!!(Dt!=null&&Dt.readableObjectMode),writableObjectMode:!!(rr!=null&&rr.writableObjectMode),readable:er,writable:qt}),qt&&(j(rr,sr=>{qt=!1,sr&&nt(Dt,sr),Xt(sr)}),zt._write=function(sr,Er,Sr){rr.write(sr,Er)?Sr():tr=Sr},zt._final=function(sr){rr.end(),Ft=sr},rr.on("drain",function(){if(tr){const sr=tr;tr=null,sr()}}),rr.on("finish",function(){if(Ft){const sr=Ft;Ft=null,sr()}})),er&&(j(Dt,sr=>{er=!1,sr&&nt(Dt,sr),Xt(sr)}),Dt.on("readable",function(){if(Yt){const sr=Yt;Yt=null,sr()}}),Dt.on("end",function(){zt.push(null)}),zt._read=function(){for(;;){const sr=Dt.read();if(sr===null){Yt=zt._read;return}if(!zt.push(sr))return}}),zt._destroy=function(sr,Er){!sr&&Qt!==null&&(sr=new _e),Yt=null,tr=null,Ft=null,Qt===null?Er(sr):(Qt=Er,nt(rr,sr),nt(Dt,sr))},zt}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:a,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:s,ObjectSetPrototypeOf:o}=primordials;duplex=h;const c=requireReadable(),d=requireWritable();o(h.prototype,c.prototype),o(h,c);{const $=s(d.prototype);for(let j=0;j<$.length;j++){const _e=$[j];h.prototype[_e]||(h.prototype[_e]=d.prototype[_e])}}function h($){if(!(this instanceof h))return new h($);c.call(this,$),d.call(this,$),$?(this.allowHalfOpen=$.allowHalfOpen!==!1,$.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),$.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}a(h.prototype,{writable:{__proto__:null,...e(d.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(d.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(d.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(d.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(d.prototype,"writableLength")},writableFinished:{__proto__:null,...e(d.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(d.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(d.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(d.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set($){this._readableState&&this._writableState&&(this._readableState.destroyed=$,this._writableState.destroyed=$)}}});let g;function _(){return g===void 0&&(g={}),g}h.fromWeb=function($,j){return _().newStreamDuplexFromReadableWritablePair($,j)},h.toWeb=function($){return _().newReadableWritablePairFromDuplex($)};let b;return h.from=function($){return b||(b=requireDuplexify()),b($,"body")},duplex}const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$1,Symbol:Symbol$2}=primordials;var transform=Transform$1;const{ERR_METHOD_NOT_IMPLEMENTED}=errors.codes,Duplex$2=requireDuplex(),{getHighWaterMark}=state;ObjectSetPrototypeOf$1(Transform$1.prototype,Duplex$2.prototype);ObjectSetPrototypeOf$1(Transform$1,Duplex$2);const kCallback=Symbol$2("kCallback");function Transform$1(a){if(!(this instanceof Transform$1))return new Transform$1(a);const e=a?getHighWaterMark(this,a,"readableHighWaterMark",!0):null;e===0&&(a={...a,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:a.writableHighWaterMark||0}),Duplex$2.call(this,a),this._readableState.sync=!1,this[kCallback]=null,a&&(typeof a.transform=="function"&&(this._transform=a.transform),typeof a.flush=="function"&&(this._flush=a.flush)),this.on("prefinish",prefinish)}function final(a){typeof this._flush=="function"&&!this.destroyed?this._flush((e,s)=>{if(e){a?a(e):this.destroy(e);return}s!=null&&this.push(s),this.push(null),a&&a()}):(this.push(null),a&&a())}function prefinish(){this._final!==final&&final.call(this)}Transform$1.prototype._final=final;Transform$1.prototype._transform=function(a,e,s){throw new ERR_METHOD_NOT_IMPLEMENTED("_transform()")};Transform$1.prototype._write=function(a,e,s){const o=this._readableState,c=this._writableState,d=o.length;this._transform(a,e,(h,g)=>{if(h){s(h);return}g!=null&&this.push(g),c.ended||d===o.length||o.length<o.highWaterMark?s():this[kCallback]=s})};Transform$1.prototype._read=function(){if(this[kCallback]){const a=this[kCallback];this[kCallback]=null,a()}};const{ObjectSetPrototypeOf}=primordials;var passthrough=PassThrough$1;const Transform=transform;ObjectSetPrototypeOf(PassThrough$1.prototype,Transform.prototype);ObjectSetPrototypeOf(PassThrough$1,Transform);function PassThrough$1(a){if(!(this instanceof PassThrough$1))return new PassThrough$1(a);Transform.call(this,a)}PassThrough$1.prototype._transform=function(a,e,s){s(null,a)};const process$1=browserExports$2,{ArrayIsArray,Promise:Promise$2,SymbolAsyncIterator,SymbolDispose}=primordials,eos$1=endOfStreamExports,{once}=utilExports,destroyImpl=destroy_1,Duplex$1=requireDuplex(),{aggregateTwoErrors,codes:{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$1,ERR_INVALID_RETURN_VALUE,ERR_MISSING_ARGS:ERR_MISSING_ARGS$2,ERR_STREAM_DESTROYED,ERR_STREAM_PREMATURE_CLOSE},AbortError:AbortError$2}=errors,{validateFunction,validateAbortSignal:validateAbortSignal$1}=validators$2,{isIterable:isIterable$1,isReadable:isReadable$1,isReadableNodeStream,isNodeStream:isNodeStream$2,isTransformStream:isTransformStream$1,isWebStream:isWebStream$1,isReadableStream:isReadableStream$2,isReadableFinished}=utils$2,AbortController$2=globalThis.AbortController||requireBrowser().AbortController;let PassThrough,Readable,addAbortListener;function destroyer$1(a,e,s){let o=!1;a.on("close",()=>{o=!0});const c=eos$1(a,{readable:e,writable:s},d=>{o=!d});return{destroy:d=>{o||(o=!0,destroyImpl.destroyer(a,d||new ERR_STREAM_DESTROYED("pipe")))},cleanup:c}}function popCallback(a){return validateFunction(a[a.length-1],"streams[stream.length - 1]"),a.pop()}function makeAsyncIterable(a){if(isIterable$1(a))return a;if(isReadableNodeStream(a))return fromReadable(a);throw new ERR_INVALID_ARG_TYPE$1("val",["Readable","Iterable","AsyncIterable"],a)}async function*fromReadable(a){Readable||(Readable=requireReadable()),yield*Readable.prototype[SymbolAsyncIterator].call(a)}async function pumpToNode(a,e,s,{end:o}){let c,d=null;const h=b=>{if(b&&(c=b),d){const $=d;d=null,$()}},g=()=>new Promise$2((b,$)=>{c?$(c):d=()=>{c?$(c):b()}});e.on("drain",h);const _=eos$1(e,{readable:!1},h);try{e.writableNeedDrain&&await g();for await(const b of a)e.write(b)||await g();o&&(e.end(),await g()),s()}catch(b){s(c!==b?aggregateTwoErrors(c,b):b)}finally{_(),e.off("drain",h)}}async function pumpToWeb(a,e,s,{end:o}){isTransformStream$1(e)&&(e=e.writable);const c=e.getWriter();try{for await(const d of a)await c.ready,c.write(d).catch(()=>{});await c.ready,o&&await c.close(),s()}catch(d){try{await c.abort(d),s(d)}catch(h){s(h)}}}function pipeline$1(...a){return pipelineImpl(a,once(popCallback(a)))}function pipelineImpl(a,e,s){if(a.length===1&&ArrayIsArray(a[0])&&(a=a[0]),a.length<2)throw new ERR_MISSING_ARGS$2("streams");const o=new AbortController$2,c=o.signal,d=s==null?void 0:s.signal,h=[];validateAbortSignal$1(d,"options.signal");function g(){rt(new AbortError$2)}addAbortListener=addAbortListener||utilExports.addAbortListener;let _;d&&(_=addAbortListener(d,g));let b,$;const j=[];let _e=0;function tt(ut){rt(ut,--_e===0)}function rt(ut,mt){var yt;if(ut&&(!b||b.code==="ERR_STREAM_PREMATURE_CLOSE")&&(b=ut),!(!b&&!mt)){for(;j.length;)j.shift()(b);(yt=_)===null||yt===void 0||yt[SymbolDispose](),o.abort(),mt&&(b||h.forEach(Et=>Et()),process$1.nextTick(e,b,$))}}let nt;for(let ut=0;ut<a.length;ut++){const mt=a[ut],yt=ut<a.length-1,Et=ut>0,dt=yt||(s==null?void 0:s.end)!==!1,gt=ut===a.length-1;if(isNodeStream$2(mt)){let St=function(xt){xt&&xt.name!=="AbortError"&&xt.code!=="ERR_STREAM_PREMATURE_CLOSE"&&tt(xt)};var ot=St;if(dt){const{destroy:xt,cleanup:Ct}=destroyer$1(mt,yt,Et);j.push(xt),isReadable$1(mt)&&gt&&h.push(Ct)}mt.on("error",St),isReadable$1(mt)&&gt&&h.push(()=>{mt.removeListener("error",St)})}if(ut===0)if(typeof mt=="function"){if(nt=mt({signal:c}),!isIterable$1(nt))throw new ERR_INVALID_RETURN_VALUE("Iterable, AsyncIterable or Stream","source",nt)}else isIterable$1(mt)||isReadableNodeStream(mt)||isTransformStream$1(mt)?nt=mt:nt=Duplex$1.from(mt);else if(typeof mt=="function"){if(isTransformStream$1(nt)){var st;nt=makeAsyncIterable((st=nt)===null||st===void 0?void 0:st.readable)}else nt=makeAsyncIterable(nt);if(nt=mt(nt,{signal:c}),yt){if(!isIterable$1(nt,!0))throw new ERR_INVALID_RETURN_VALUE("AsyncIterable",`transform[${ut-1}]`,nt)}else{var at;PassThrough||(PassThrough=passthrough);const St=new PassThrough({objectMode:!0}),xt=(at=nt)===null||at===void 0?void 0:at.then;if(typeof xt=="function")_e++,xt.call(nt,Dt=>{$=Dt,Dt!=null&&St.write(Dt),dt&&St.end(),process$1.nextTick(tt)},Dt=>{St.destroy(Dt),process$1.nextTick(tt,Dt)});else if(isIterable$1(nt,!0))_e++,pumpToNode(nt,St,tt,{end:dt});else if(isReadableStream$2(nt)||isTransformStream$1(nt)){const Dt=nt.readable||nt;_e++,pumpToNode(Dt,St,tt,{end:dt})}else throw new ERR_INVALID_RETURN_VALUE("AsyncIterable or Promise","destination",nt);nt=St;const{destroy:Ct,cleanup:Ht}=destroyer$1(nt,!1,!0);j.push(Ct),gt&&h.push(Ht)}}else if(isNodeStream$2(mt)){if(isReadableNodeStream(nt)){_e+=2;const St=pipe(nt,mt,tt,{end:dt});isReadable$1(mt)&&gt&&h.push(St)}else if(isTransformStream$1(nt)||isReadableStream$2(nt)){const St=nt.readable||nt;_e++,pumpToNode(St,mt,tt,{end:dt})}else if(isIterable$1(nt))_e++,pumpToNode(nt,mt,tt,{end:dt});else throw new ERR_INVALID_ARG_TYPE$1("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],nt);nt=mt}else if(isWebStream$1(mt)){if(isReadableNodeStream(nt))_e++,pumpToWeb(makeAsyncIterable(nt),mt,tt,{end:dt});else if(isReadableStream$2(nt)||isIterable$1(nt))_e++,pumpToWeb(nt,mt,tt,{end:dt});else if(isTransformStream$1(nt))_e++,pumpToWeb(nt.readable,mt,tt,{end:dt});else throw new ERR_INVALID_ARG_TYPE$1("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],nt);nt=mt}else nt=Duplex$1.from(mt)}return(c!=null&&c.aborted||d!=null&&d.aborted)&&process$1.nextTick(g),nt}function pipe(a,e,s,{end:o}){let c=!1;if(e.on("close",()=>{c||s(new ERR_STREAM_PREMATURE_CLOSE)}),a.pipe(e,{end:!1}),o){let h=function(){c=!0,e.end()};var d=h;isReadableFinished(a)?process$1.nextTick(h):a.once("end",h)}else s();return eos$1(a,{readable:!0,writable:!1},h=>{const g=a._readableState;h&&h.code==="ERR_STREAM_PREMATURE_CLOSE"&&g&&g.ended&&!g.errored&&!g.errorEmitted?a.once("end",s).once("error",s):s(h)}),eos$1(e,{readable:!1,writable:!0},s)}var pipeline_1={pipelineImpl,pipeline:pipeline$1};const{pipeline}=pipeline_1,Duplex=requireDuplex(),{destroyer}=destroy_1,{isNodeStream:isNodeStream$1,isReadable,isWritable:isWritable$1,isWebStream,isTransformStream,isWritableStream,isReadableStream:isReadableStream$1}=utils$2,{AbortError:AbortError$1,codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$1,ERR_MISSING_ARGS:ERR_MISSING_ARGS$1}}=errors,eos=endOfStreamExports;var compose$1=function a(...e){if(e.length===0)throw new ERR_MISSING_ARGS$1("streams");if(e.length===1)return Duplex.from(e[0]);const s=[...e];if(typeof e[0]=="function"&&(e[0]=Duplex.from(e[0])),typeof e[e.length-1]=="function"){const tt=e.length-1;e[tt]=Duplex.from(e[tt])}for(let tt=0;tt<e.length;++tt)if(!(!isNodeStream$1(e[tt])&&!isWebStream(e[tt]))){if(tt<e.length-1&&!(isReadable(e[tt])||isReadableStream$1(e[tt])||isTransformStream(e[tt])))throw new ERR_INVALID_ARG_VALUE$1(`streams[${tt}]`,s[tt],"must be readable");if(tt>0&&!(isWritable$1(e[tt])||isWritableStream(e[tt])||isTransformStream(e[tt])))throw new ERR_INVALID_ARG_VALUE$1(`streams[${tt}]`,s[tt],"must be writable")}let o,c,d,h,g;function _(tt){const rt=h;h=null,rt?rt(tt):tt?g.destroy(tt):!_e&&!j&&g.destroy()}const b=e[0],$=pipeline(e,_),j=!!(isWritable$1(b)||isWritableStream(b)||isTransformStream(b)),_e=!!(isReadable($)||isReadableStream$1($)||isTransformStream($));if(g=new Duplex({writableObjectMode:!!(b!=null&&b.writableObjectMode),readableObjectMode:!!($!=null&&$.readableObjectMode),writable:j,readable:_e}),j){if(isNodeStream$1(b))g._write=function(rt,nt,st){b.write(rt,nt)?st():o=st},g._final=function(rt){b.end(),c=rt},b.on("drain",function(){if(o){const rt=o;o=null,rt()}});else if(isWebStream(b)){const nt=(isTransformStream(b)?b.writable:b).getWriter();g._write=async function(st,at,ot){try{await nt.ready,nt.write(st).catch(()=>{}),ot()}catch(ut){ot(ut)}},g._final=async function(st){try{await nt.ready,nt.close().catch(()=>{}),c=st}catch(at){st(at)}}}const tt=isTransformStream($)?$.readable:$;eos(tt,()=>{if(c){const rt=c;c=null,rt()}})}if(_e){if(isNodeStream$1($))$.on("readable",function(){if(d){const tt=d;d=null,tt()}}),$.on("end",function(){g.push(null)}),g._read=function(){for(;;){const tt=$.read();if(tt===null){d=g._read;return}if(!g.push(tt))return}};else if(isWebStream($)){const rt=(isTransformStream($)?$.readable:$).getReader();g._read=async function(){for(;;)try{const{value:nt,done:st}=await rt.read();if(!g.push(nt))return;if(st){g.push(null);return}}catch{return}}}}return g._destroy=function(tt,rt){!tt&&h!==null&&(tt=new AbortError$1),d=null,o=null,c=null,h===null?rt(tt):(h=rt,isNodeStream$1($)&&destroyer($,tt))},g};const AbortController$1=globalThis.AbortController||requireBrowser().AbortController,{codes:{ERR_INVALID_ARG_VALUE,ERR_INVALID_ARG_TYPE,ERR_MISSING_ARGS,ERR_OUT_OF_RANGE},AbortError}=errors,{validateAbortSignal,validateInteger,validateObject}=validators$2,kWeakHandler=primordials.Symbol("kWeak"),kResistStopPropagation=primordials.Symbol("kResistStopPropagation"),{finished}=endOfStreamExports,staticCompose=compose$1,{addAbortSignalNoValidate}=addAbortSignalExports,{isWritable,isNodeStream}=utils$2,{deprecate}=utilExports,{ArrayPrototypePush,Boolean:Boolean$1,MathFloor,Number:Number$1,NumberIsNaN,Promise:Promise$1,PromiseReject,PromiseResolve,PromisePrototypeThen,Symbol:Symbol$1}=primordials,kEmpty=Symbol$1("kEmpty"),kEof=Symbol$1("kEof");function compose(a,e){if(e!=null&&validateObject(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),isNodeStream(a)&&!isWritable(a))throw new ERR_INVALID_ARG_VALUE("stream",a,"must be writable");const s=staticCompose(this,a);return e!=null&&e.signal&&addAbortSignalNoValidate(e.signal,s),s}function map(a,e){if(typeof a!="function")throw new ERR_INVALID_ARG_TYPE("fn",["Function","AsyncFunction"],a);e!=null&&validateObject(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal");let s=1;(e==null?void 0:e.concurrency)!=null&&(s=MathFloor(e.concurrency));let o=s-1;return(e==null?void 0:e.highWaterMark)!=null&&(o=MathFloor(e.highWaterMark)),validateInteger(s,"options.concurrency",1),validateInteger(o,"options.highWaterMark",0),o+=s,(async function*(){const d=utilExports.AbortSignalAny([e==null?void 0:e.signal].filter(Boolean$1)),h=this,g=[],_={signal:d};let b,$,j=!1,_e=0;function tt(){j=!0,rt()}function rt(){_e-=1,nt()}function nt(){$&&!j&&_e<s&&g.length<o&&($(),$=null)}async function st(){try{for await(let at of h){if(j)return;if(d.aborted)throw new AbortError;try{if(at=a(at,_),at===kEmpty)continue;at=PromiseResolve(at)}catch(ot){at=PromiseReject(ot)}_e+=1,PromisePrototypeThen(at,rt,tt),g.push(at),b&&(b(),b=null),!j&&(g.length>=o||_e>=s)&&await new Promise$1(ot=>{$=ot})}g.push(kEof)}catch(at){const ot=PromiseReject(at);PromisePrototypeThen(ot,rt,tt),g.push(ot)}finally{j=!0,b&&(b(),b=null)}}st();try{for(;;){for(;g.length>0;){const at=await g[0];if(at===kEof)return;if(d.aborted)throw new AbortError;at!==kEmpty&&(yield at),g.shift(),nt()}await new Promise$1(at=>{b=at})}}finally{j=!0,$&&($(),$=null)}}).call(this)}function asIndexedPairs(a=void 0){return a!=null&&validateObject(a,"options"),(a==null?void 0:a.signal)!=null&&validateAbortSignal(a.signal,"options.signal"),(async function*(){let s=0;for await(const c of this){var o;if(a!=null&&(o=a.signal)!==null&&o!==void 0&&o.aborted)throw new AbortError({cause:a.signal.reason});yield[s++,c]}}).call(this)}async function some(a,e=void 0){for await(const s of filter.call(this,a,e))return!0;return!1}async function every(a,e=void 0){if(typeof a!="function")throw new ERR_INVALID_ARG_TYPE("fn",["Function","AsyncFunction"],a);return!await some.call(this,async(...s)=>!await a(...s),e)}async function find(a,e){for await(const s of filter.call(this,a,e))return s}async function forEach$1(a,e){if(typeof a!="function")throw new ERR_INVALID_ARG_TYPE("fn",["Function","AsyncFunction"],a);async function s(o,c){return await a(o,c),kEmpty}for await(const o of map.call(this,s,e));}function filter(a,e){if(typeof a!="function")throw new ERR_INVALID_ARG_TYPE("fn",["Function","AsyncFunction"],a);async function s(o,c){return await a(o,c)?o:kEmpty}return map.call(this,s,e)}class ReduceAwareErrMissingArgs extends ERR_MISSING_ARGS{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function reduce(a,e,s){var o;if(typeof a!="function")throw new ERR_INVALID_ARG_TYPE("reducer",["Function","AsyncFunction"],a);s!=null&&validateObject(s,"options"),(s==null?void 0:s.signal)!=null&&validateAbortSignal(s.signal,"options.signal");let c=arguments.length>1;if(s!=null&&(o=s.signal)!==null&&o!==void 0&&o.aborted){const b=new AbortError(void 0,{cause:s.signal.reason});throw this.once("error",()=>{}),await finished(this.destroy(b)),b}const d=new AbortController$1,h=d.signal;if(s!=null&&s.signal){const b={once:!0,[kWeakHandler]:this,[kResistStopPropagation]:!0};s.signal.addEventListener("abort",()=>d.abort(),b)}let g=!1;try{for await(const b of this){var _;if(g=!0,s!=null&&(_=s.signal)!==null&&_!==void 0&&_.aborted)throw new AbortError;c?e=await a(e,b,{signal:h}):(e=b,c=!0)}if(!g&&!c)throw new ReduceAwareErrMissingArgs}finally{d.abort()}return e}async function toArray$1(a){a!=null&&validateObject(a,"options"),(a==null?void 0:a.signal)!=null&&validateAbortSignal(a.signal,"options.signal");const e=[];for await(const o of this){var s;if(a!=null&&(s=a.signal)!==null&&s!==void 0&&s.aborted)throw new AbortError(void 0,{cause:a.signal.reason});ArrayPrototypePush(e,o)}return e}function flatMap(a,e){const s=map.call(this,a,e);return(async function*(){for await(const c of s)yield*c}).call(this)}function toIntegerOrInfinity(a){if(a=Number$1(a),NumberIsNaN(a))return 0;if(a<0)throw new ERR_OUT_OF_RANGE("number",">= 0",a);return a}function drop(a,e=void 0){return e!=null&&validateObject(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),a=toIntegerOrInfinity(a),(async function*(){var o;if(e!=null&&(o=e.signal)!==null&&o!==void 0&&o.aborted)throw new AbortError;for await(const d of this){var c;if(e!=null&&(c=e.signal)!==null&&c!==void 0&&c.aborted)throw new AbortError;a--<=0&&(yield d)}}).call(this)}function take(a,e=void 0){return e!=null&&validateObject(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),a=toIntegerOrInfinity(a),(async function*(){var o;if(e!=null&&(o=e.signal)!==null&&o!==void 0&&o.aborted)throw new AbortError;for await(const d of this){var c;if(e!=null&&(c=e.signal)!==null&&c!==void 0&&c.aborted)throw new AbortError;if(a-- >0&&(yield d),a<=0)return}}).call(this)}operators.streamReturningOperators={asIndexedPairs:deprecate(asIndexedPairs,"readable.asIndexedPairs will be removed in a future version."),drop,filter,flatMap,map,take,compose};operators.promiseReturningOperators={every,forEach:forEach$1,reduce,toArray:toArray$1,some,find};var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:a,Promise:e}=primordials,{isIterable:s,isNodeStream:o,isWebStream:c}=utils$2,{pipelineImpl:d}=pipeline_1,{finished:h}=endOfStreamExports;requireStream();function g(..._){return new e((b,$)=>{let j,_e;const tt=_[_.length-1];if(tt&&typeof tt=="object"&&!o(tt)&&!s(tt)&&!c(tt)){const rt=a(_);j=rt.signal,_e=rt.end}d(_,(rt,nt)=>{rt?$(rt):b(nt)},{signal:j,end:_e})})}return promises={finished:h,pipeline:g},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:a}=buffer,{ObjectDefineProperty:e,ObjectKeys:s,ReflectApply:o}=primordials,{promisify:{custom:c}}=utilExports,{streamReturningOperators:d,promiseReturningOperators:h}=operators,{codes:{ERR_ILLEGAL_CONSTRUCTOR:g}}=errors,_=compose$1,{setDefaultHighWaterMark:b,getDefaultHighWaterMark:$}=state,{pipeline:j}=pipeline_1,{destroyer:_e}=destroy_1,tt=endOfStreamExports,rt=requirePromises(),nt=utils$2,st=stream.exports=legacy.Stream;st.isDestroyed=nt.isDestroyed,st.isDisturbed=nt.isDisturbed,st.isErrored=nt.isErrored,st.isReadable=nt.isReadable,st.isWritable=nt.isWritable,st.Readable=requireReadable();for(const ut of s(d)){let yt=function(...Et){if(new.target)throw g();return st.Readable.from(o(mt,this,Et))};var ot=yt;const mt=d[ut];e(yt,"name",{__proto__:null,value:mt.name}),e(yt,"length",{__proto__:null,value:mt.length}),e(st.Readable.prototype,ut,{__proto__:null,value:yt,enumerable:!1,configurable:!0,writable:!0})}for(const ut of s(h)){let yt=function(...dt){if(new.target)throw g();return o(mt,this,dt)};var ot=yt;const mt=h[ut];e(yt,"name",{__proto__:null,value:mt.name}),e(yt,"length",{__proto__:null,value:mt.length}),e(st.Readable.prototype,ut,{__proto__:null,value:yt,enumerable:!1,configurable:!0,writable:!0})}st.Writable=requireWritable(),st.Duplex=requireDuplex(),st.Transform=transform,st.PassThrough=passthrough,st.pipeline=j;const{addAbortSignal:at}=addAbortSignalExports;return st.addAbortSignal=at,st.finished=tt,st.destroy=_e,st.compose=_,st.setDefaultHighWaterMark=b,st.getDefaultHighWaterMark=$,e(st,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return rt}}),e(j,c,{__proto__:null,enumerable:!0,get(){return rt.pipeline}}),e(tt,c,{__proto__:null,enumerable:!0,get(){return rt.finished}}),st.Stream=st,st._isUint8Array=function(mt){return mt instanceof Uint8Array},st._uint8ArrayToBuffer=function(mt){return a.from(mt.buffer,mt.byteOffset,mt.byteLength)},stream.exports}(function(a){const e=requireStream(),s=requirePromises(),o=e.Readable.destroy;a.exports=e.Readable,a.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,a.exports._isUint8Array=e._isUint8Array,a.exports.isDisturbed=e.isDisturbed,a.exports.isErrored=e.isErrored,a.exports.isReadable=e.isReadable,a.exports.Readable=e.Readable,a.exports.Writable=e.Writable,a.exports.Duplex=e.Duplex,a.exports.Transform=e.Transform,a.exports.PassThrough=e.PassThrough,a.exports.addAbortSignal=e.addAbortSignal,a.exports.finished=e.finished,a.exports.destroy=e.destroy,a.exports.destroy=o,a.exports.pipeline=e.pipeline,a.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return s}}),a.exports.Stream=e.Stream,a.exports.default=a.exports})(browser$1);var browserExports=browser$1.exports;Object.defineProperty(lib,"__esModule",{value:!0});lib.ReadableWebToNodeStream=void 0;const readable_stream_1=browserExports;class ReadableWebToNodeStream extends readable_stream_1.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}_read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read().then(e=>{delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}).catch(e=>{this.destroy(e)})}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}lib.ReadableWebToNodeStream=ReadableWebToNodeStream;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.fetchFromUrl=a.parseBlob=a.parseReadableStream=a.parseNodeStream=a.selectCover=a.ratingToStars=a.orderTags=a.parseFromTokenizer=a.parseBuffer=void 0;const e=browserExports$1,s=core$2,o=lib,c=e("music-metadata-browser:main");var d=core$2;Object.defineProperty(a,"parseBuffer",{enumerable:!0,get:function(){return d.parseBuffer}}),Object.defineProperty(a,"parseFromTokenizer",{enumerable:!0,get:function(){return d.parseFromTokenizer}}),Object.defineProperty(a,"orderTags",{enumerable:!0,get:function(){return d.orderTags}}),Object.defineProperty(a,"ratingToStars",{enumerable:!0,get:function(){return d.ratingToStars}}),Object.defineProperty(a,"selectCover",{enumerable:!0,get:function(){return d.selectCover}}),a.parseNodeStream=s.parseStream;async function h($,j,_e){const tt=new o.ReadableWebToNodeStream($),rt=await(0,a.parseNodeStream)(tt,typeof j=="string"?{mimeType:j}:j,_e);return await tt.close(),rt}a.parseReadableStream=h;async function g($,j){$.type,$.size,$ instanceof File&&$.name;const _e=$.stream?$.stream():_($);return h(_e,{mimeType:$.type,size:$.size},j)}a.parseBlob=g;function _($){const j=new FileReader;return new ReadableStream({start(_e){j.onloadend=tt=>{let rt=tt.target.result;rt instanceof ArrayBuffer&&(rt=new Uint8Array(rt)),_e.enqueue(rt),_e.close()},j.onerror=tt=>{_e.close()},j.onabort=tt=>{_e.close()},j.readAsArrayBuffer($)}})}async function b($,j){const _e=await fetch($),tt={size:parseInt(_e.headers.get("Content-Length"),10),mimeType:_e.headers.get("Content-Type")};if(_e.ok)if(_e.body){const rt=await h(_e.body,tt,j);return c("Closing HTTP-readable-stream..."),_e.body.locked||await _e.body.cancel(),c("HTTP-readable-stream closed."),rt}else return g(await _e.blob(),j);else throw new Error(`HTTP error status=${_e.status}: ${_e.statusText}`)}a.fetchFromUrl=b})(lib$3);const importMusicFromFolder=async()=>{try{const a=await window.showDirectoryPicker(),e=[];for await(const s of getFilesRecursively(a))if(s.kind==="file"&&isAudioFile(s.name)){const o=await s.getFile();try{const c=await lib$3.parseBlob(o),{common:d,format:h}=c;let g=null;if(d.picture&&d.picture.length>0){const _=d.picture[0],b=new Blob([_.data],{type:_.format});g=URL.createObjectURL(b)}e.push({title:d.title||o.name,artist:d.artist||"Unknown Artist",album:d.album||"Unknown Album",duration:h.duration||0,fileHandle:s})}catch(c){console.warn("Failed to parse metadata for",s.name,c),e.push({title:s.name,artist:"Unknown",album:"Unknown",duration:0,fileHandle:s})}}return e}catch(a){if(a.name==="AbortError")return[];throw console.error("Error importing music:",a),a}};async function*getFilesRecursively(a){if(a.kind==="file")yield a;else if(a.kind==="directory")for await(const e of a.values())yield*getFilesRecursively(e)}const AUDIO_EXTENSIONS=[".mp3",".flac",".wav",".m4a",".aac",".ogg"];function isAudioFile(a){const e=a.toLowerCase();return AUDIO_EXTENSIONS.some(s=>e.endsWith(s))}const SongList=()=>{const{songs:a,loadSongs:e,addSongsToLibrary:s,isLoading:o}=useLibraryStore(),{playSong:c,currentSong:d,isPlaying:h,toggleLike:g}=usePlayerStore();reactExports.useEffect(()=>{e()},[e]);const _=async()=>{try{const $=await importMusicFromFolder();$.length>0&&await s($)}catch($){console.error("Import failed",$)}},b=$=>{if(!$)return"--:--";const j=Math.floor($/60),_e=Math.floor($%60);return`${j}:${_e.toString().padStart(2,"0")}`};return jsxRuntimeExports.jsxs("div",{className:"flex-1 h-full overflow-hidden flex flex-col bg-black",children:[jsxRuntimeExports.jsxs("div",{className:"p-8 pb-4 flex justify-between items-end",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-1",children:"Songs"}),jsxRuntimeExports.jsxs("p",{className:"text-white/60 text-sm",children:[a.length," songs"]})]}),jsxRuntimeExports.jsxs("button",{onClick:_,className:"flex items-center gap-2 bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm",children:[jsxRuntimeExports.jsx(FolderPlus,{size:18}),"Add Folder"]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 pt-0",children:jsxRuntimeExports.jsxs("div",{className:"w-full text-left border-collapse",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-black z-10 grid grid-cols-[auto_1fr_1fr_1fr_auto_auto] gap-4 py-3 border-b border-white/10 text-xs font-medium text-white/40 uppercase tracking-wider",children:[jsxRuntimeExports.jsx("div",{className:"w-8 text-center",children:"#"}),jsxRuntimeExports.jsx("div",{children:"Title"}),jsxRuntimeExports.jsx("div",{children:"Artist"}),jsxRuntimeExports.jsx("div",{children:"Album"}),jsxRuntimeExports.jsx("div",{className:"w-8"}),jsxRuntimeExports.jsx("div",{className:"w-16 text-right",children:jsxRuntimeExports.jsx(Clock,{size:14,className:"ml-auto"})})]}),jsxRuntimeExports.jsx("div",{className:"mt-2 space-y-1",children:o?jsxRuntimeExports.jsx("div",{className:"text-center py-10 text-white/40",children:"Loading library..."}):a.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-20 text-white/40",children:[jsxRuntimeExports.jsx("p",{className:"text-lg mb-2",children:"No music found"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:'Click "Add Folder" to import your local music.'})]}):a.map(($,j)=>{const _e=(d==null?void 0:d.id)===$.id;return jsxRuntimeExports.jsxs("div",{onDoubleClick:()=>c($,a),className:`grid grid-cols-[auto_1fr_1fr_1fr_auto_auto] gap-4 py-2.5 px-2 rounded-lg items-center text-sm group hover:bg-white/10 transition-colors cursor-default ${_e?"bg-white/10 text-pink-500":"text-white/80"}`,children:[jsxRuntimeExports.jsxs("div",{className:"w-8 text-center relative flex justify-center",children:[jsxRuntimeExports.jsx("span",{className:`group-hover:hidden ${_e?"hidden":"block"}`,children:j+1}),jsxRuntimeExports.jsx("button",{onClick:()=>c($,a),className:`hidden group-hover:block ${_e&&h?"hidden":""}`,children:jsxRuntimeExports.jsx(Play,{size:14,fill:"currentColor"})}),_e&&h&&jsxRuntimeExports.jsxs("div",{className:"w-3 h-3 flex gap-0.5 items-end justify-center",children:[jsxRuntimeExports.jsx("div",{className:"w-0.5 bg-pink-500 animate-[bounce_1s_infinite]"}),jsxRuntimeExports.jsx("div",{className:"w-0.5 bg-pink-500 animate-[bounce_1.2s_infinite]"}),jsxRuntimeExports.jsx("div",{className:"w-0.5 bg-pink-500 animate-[bounce_0.8s_infinite]"})]})]}),jsxRuntimeExports.jsx("div",{className:"font-medium truncate text-white",children:$.title}),jsxRuntimeExports.jsx("div",{className:"truncate text-white/60",children:$.artist}),jsxRuntimeExports.jsx("div",{className:"truncate text-white/60",children:$.album}),jsxRuntimeExports.jsx("div",{className:"w-8 flex justify-center",children:jsxRuntimeExports.jsx("button",{onClick:tt=>{tt.stopPropagation(),g($)},className:`transition-all ${$.liked?"opacity-100 text-pink-500":"opacity-0 group-hover:opacity-100 text-white/40 hover:text-white"}`,children:jsxRuntimeExports.jsx(Heart,{size:16,fill:$.liked?"currentColor":"none"})})}),jsxRuntimeExports.jsx("div",{className:"w-16 text-right text-white/40 font-variant-numeric tabular-nums",children:b($.duration)})]},$.id)})})]})})]})};function bind(a,e){return function(){return a.apply(e,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(a=>e=>{const s=toString.call(e);return a[s]||(a[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=a=>(a=a.toLowerCase(),e=>kindOf(e)===a),typeOfTest=a=>e=>typeof e===a,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(a){return a!==null&&!isUndefined(a)&&a.constructor!==null&&!isUndefined(a.constructor)&&isFunction$1(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView$1(a){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(a):e=a&&a.buffer&&isArrayBuffer(a.buffer),e}const isString=typeOfTest("string"),isFunction$1=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=a=>a!==null&&typeof a=="object",isBoolean=a=>a===!0||a===!1,isPlainObject=a=>{if(kindOf(a)!=="object")return!1;const e=getPrototypeOf(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(toStringTag in a)&&!(iterator in a)},isEmptyObject=a=>{if(!isObject(a)||isBuffer(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=a=>isObject(a)&&isFunction$1(a.pipe),isFormData=a=>{let e;return a&&(typeof FormData=="function"&&a instanceof FormData||isFunction$1(a.append)&&((e=kindOf(a))==="formdata"||e==="object"&&isFunction$1(a.toString)&&a.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(a,e,{allOwnKeys:s=!1}={}){if(a===null||typeof a>"u")return;let o,c;if(typeof a!="object"&&(a=[a]),isArray(a))for(o=0,c=a.length;o<c;o++)e.call(null,a[o],o,a);else{if(isBuffer(a))return;const d=s?Object.getOwnPropertyNames(a):Object.keys(a),h=d.length;let g;for(o=0;o<h;o++)g=d[o],e.call(null,a[g],g,a)}}function findKey(a,e){if(isBuffer(a))return null;e=e.toLowerCase();const s=Object.keys(a);let o=s.length,c;for(;o-- >0;)if(c=s[o],e===c.toLowerCase())return c;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=a=>!isUndefined(a)&&a!==_global;function merge(){const{caseless:a,skipUndefined:e}=isContextDefined(this)&&this||{},s={},o=(c,d)=>{const h=a&&findKey(s,d)||d;isPlainObject(s[h])&&isPlainObject(c)?s[h]=merge(s[h],c):isPlainObject(c)?s[h]=merge({},c):isArray(c)?s[h]=c.slice():(!e||!isUndefined(c))&&(s[h]=c)};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&forEach(arguments[c],o);return s}const extend=(a,e,s,{allOwnKeys:o}={})=>(forEach(e,(c,d)=>{s&&isFunction$1(c)?a[d]=bind(c,s):a[d]=c},{allOwnKeys:o}),a),stripBOM=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),inherits=(a,e,s,o)=>{a.prototype=Object.create(e.prototype,o),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:e.prototype}),s&&Object.assign(a.prototype,s)},toFlatObject=(a,e,s,o)=>{let c,d,h;const g={};if(e=e||{},a==null)return e;do{for(c=Object.getOwnPropertyNames(a),d=c.length;d-- >0;)h=c[d],(!o||o(h,a,e))&&!g[h]&&(e[h]=a[h],g[h]=!0);a=s!==!1&&getPrototypeOf(a)}while(a&&(!s||s(a,e))&&a!==Object.prototype);return e},endsWith=(a,e,s)=>{a=String(a),(s===void 0||s>a.length)&&(s=a.length),s-=e.length;const o=a.indexOf(e,s);return o!==-1&&o===s},toArray=a=>{if(!a)return null;if(isArray(a))return a;let e=a.length;if(!isNumber(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=a[e];return s},isTypedArray=(a=>e=>a&&e instanceof a)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(a,e)=>{const o=(a&&a[iterator]).call(a);let c;for(;(c=o.next())&&!c.done;){const d=c.value;e.call(a,d[0],d[1])}},matchAll=(a,e)=>{let s;const o=[];for(;(s=a.exec(e))!==null;)o.push(s);return o},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,o,c){return o.toUpperCase()+c}),hasOwnProperty=(({hasOwnProperty:a})=>(e,s)=>a.call(e,s))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(a,e)=>{const s=Object.getOwnPropertyDescriptors(a),o={};forEach(s,(c,d)=>{let h;(h=e(c,d,a))!==!1&&(o[d]=h||c)}),Object.defineProperties(a,o)},freezeMethods=a=>{reduceDescriptors(a,(e,s)=>{if(isFunction$1(a)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=a[s];if(isFunction$1(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},toObjectSet=(a,e)=>{const s={},o=c=>{c.forEach(d=>{s[d]=!0})};return isArray(a)?o(a):o(String(a).split(e)),s},noop$1=()=>{},toFiniteNumber=(a,e)=>a!=null&&Number.isFinite(a=+a)?a:e;function isSpecCompliantForm(a){return!!(a&&isFunction$1(a.append)&&a[toStringTag]==="FormData"&&a[iterator])}const toJSONObject=a=>{const e=new Array(10),s=(o,c)=>{if(isObject(o)){if(e.indexOf(o)>=0)return;if(isBuffer(o))return o;if(!("toJSON"in o)){e[c]=o;const d=isArray(o)?[]:{};return forEach(o,(h,g)=>{const _=s(h,c+1);!isUndefined(_)&&(d[g]=_)}),e[c]=void 0,d}}return o};return s(a,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=a=>a&&(isObject(a)||isFunction$1(a))&&isFunction$1(a.then)&&isFunction$1(a.catch),_setImmediate=((a,e)=>a?setImmediate:e?((s,o)=>(_global.addEventListener("message",({source:c,data:d})=>{c===_global&&d===s&&o.length&&o.shift()()},!1),c=>{o.push(c),_global.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",isFunction$1(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=a=>a!=null&&isFunction$1(a[iterator]),utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView:isArrayBufferView$1,isString,isNumber,isBoolean,isObject,isPlainObject,isEmptyObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction:isFunction$1,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop:noop$1,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};function AxiosError$1(a,e,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}utils$1.inherits(AxiosError$1,Error,{toJSON:function a(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{descriptors[a]={value:a}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(a,e,s,o,c,d)=>{const h=Object.create(prototype$1);utils$1.toFlatObject(a,h,function($){return $!==Error.prototype},b=>b!=="isAxiosError");const g=a&&a.message?a.message:"Error",_=e==null&&a?a.code:e;return AxiosError$1.call(h,g,_,s,o,c),a&&h.cause==null&&Object.defineProperty(h,"cause",{value:a,configurable:!0}),h.name=a&&a.name||"Error",d&&Object.assign(h,d),h};const httpAdapter=null;function isVisitable(a){return utils$1.isPlainObject(a)||utils$1.isArray(a)}function removeBrackets(a){return utils$1.endsWith(a,"[]")?a.slice(0,-2):a}function renderKey(a,e,s){return a?a.concat(e).map(function(c,d){return c=removeBrackets(c),!s&&d?"["+c+"]":c}).join(s?".":""):e}function isFlatArray(a){return utils$1.isArray(a)&&!a.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function a(e){return/^is[A-Z]/.test(e)});function toFormData$1(a,e,s){if(!utils$1.isObject(a))throw new TypeError("target must be an object");e=e||new FormData,s=utils$1.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(nt,st){return!utils$1.isUndefined(st[nt])});const o=s.metaTokens,c=s.visitor||$,d=s.dots,h=s.indexes,_=(s.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(e);if(!utils$1.isFunction(c))throw new TypeError("visitor must be a function");function b(rt){if(rt===null)return"";if(utils$1.isDate(rt))return rt.toISOString();if(utils$1.isBoolean(rt))return rt.toString();if(!_&&utils$1.isBlob(rt))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(rt)||utils$1.isTypedArray(rt)?_&&typeof Blob=="function"?new Blob([rt]):Buffer.from(rt):rt}function $(rt,nt,st){let at=rt;if(rt&&!st&&typeof rt=="object"){if(utils$1.endsWith(nt,"{}"))nt=o?nt:nt.slice(0,-2),rt=JSON.stringify(rt);else if(utils$1.isArray(rt)&&isFlatArray(rt)||(utils$1.isFileList(rt)||utils$1.endsWith(nt,"[]"))&&(at=utils$1.toArray(rt)))return nt=removeBrackets(nt),at.forEach(function(ut,mt){!(utils$1.isUndefined(ut)||ut===null)&&e.append(h===!0?renderKey([nt],mt,d):h===null?nt:nt+"[]",b(ut))}),!1}return isVisitable(rt)?!0:(e.append(renderKey(st,nt,d),b(rt)),!1)}const j=[],_e=Object.assign(predicates,{defaultVisitor:$,convertValue:b,isVisitable});function tt(rt,nt){if(!utils$1.isUndefined(rt)){if(j.indexOf(rt)!==-1)throw Error("Circular reference detected in "+nt.join("."));j.push(rt),utils$1.forEach(rt,function(at,ot){(!(utils$1.isUndefined(at)||at===null)&&c.call(e,at,utils$1.isString(ot)?ot.trim():ot,nt,_e))===!0&&tt(at,nt?nt.concat(ot):[ot])}),j.pop()}}if(!utils$1.isObject(a))throw new TypeError("data must be an object");return tt(a),e}function encode$1(a){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(o){return e[o]})}function AxiosURLSearchParams(a,e){this._pairs=[],a&&toFormData$1(a,this,e)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function a(e,s){this._pairs.push([e,s])};prototype.toString=function a(e){const s=e?function(o){return e.call(this,o,encode$1)}:encode$1;return this._pairs.map(function(c){return s(c[0])+"="+s(c[1])},"").join("&")};function encode(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function buildURL(a,e,s){if(!e)return a;const o=s&&s.encode||encode;utils$1.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(c?d=c(e,s):d=utils$1.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,s).toString(o),d){const h=a.indexOf("#");h!==-1&&(a=a.slice(0,h)),a+=(a.indexOf("?")===-1?"?":"&")+d}return a}class InterceptorManager{constructor(){this.handlers=[]}use(e,s,o){return this.handlers.push({fulfilled:e,rejected:s,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,function(o){o!==null&&e(o)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(a,e){return toFormData$1(a,new platform.classes.URLSearchParams,{visitor:function(s,o,c,d){return platform.isNode&&utils$1.isBuffer(s)?(this.append(o,s.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)},...e})}function parsePropPath(a){return utils$1.matchAll(/\w+|\[(\w*)]/g,a).map(e=>e[0]==="[]"?"":e[1]||e[0])}function arrayToObject(a){const e={},s=Object.keys(a);let o;const c=s.length;let d;for(o=0;o<c;o++)d=s[o],e[d]=a[d];return e}function formDataToJSON(a){function e(s,o,c,d){let h=s[d++];if(h==="__proto__")return!0;const g=Number.isFinite(+h),_=d>=s.length;return h=!h&&utils$1.isArray(c)?c.length:h,_?(utils$1.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!g):((!c[h]||!utils$1.isObject(c[h]))&&(c[h]=[]),e(s,o,c[h],d)&&utils$1.isArray(c[h])&&(c[h]=arrayToObject(c[h])),!g)}if(utils$1.isFormData(a)&&utils$1.isFunction(a.entries)){const s={};return utils$1.forEachEntry(a,(o,c)=>{e(parsePropPath(o),c,s,0)}),s}return null}function stringifySafely(a,e,s){if(utils$1.isString(a))try{return(e||JSON.parse)(a),utils$1.trim(a)}catch(o){if(o.name!=="SyntaxError")throw o}return(s||JSON.stringify)(a)}const defaults$1={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function a(e,s){const o=s.getContentType()||"",c=o.indexOf("application/json")>-1,d=utils$1.isObject(e);if(d&&utils$1.isHTMLForm(e)&&(e=new FormData(e)),utils$1.isFormData(e))return c?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e)||utils$1.isReadableStream(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let g;if(d){if(o.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((g=utils$1.isFileList(e))||o.indexOf("multipart/form-data")>-1){const _=this.env&&this.env.FormData;return toFormData$1(g?{"files[]":e}:e,_&&new _,this.formSerializer)}}return d||c?(s.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function a(e){const s=this.transitional||defaults$1.transitional,o=s&&s.forcedJSONParsing,c=this.responseType==="json";if(utils$1.isResponse(e)||utils$1.isReadableStream(e))return e;if(e&&utils$1.isString(e)&&(o&&!this.responseType||c)){const h=!(s&&s.silentJSONParsing)&&c;try{return JSON.parse(e,this.parseReviver)}catch(g){if(h)throw g.name==="SyntaxError"?AxiosError$1.from(g,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):g}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function a(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],a=>{defaults$1.headers[a]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=a=>{const e={};let s,o,c;return a&&a.split(`
`).forEach(function(h){c=h.indexOf(":"),s=h.substring(0,c).trim().toLowerCase(),o=h.substring(c+1).trim(),!(!s||e[s]&&ignoreDuplicateOf[s])&&(s==="set-cookie"?e[s]?e[s].push(o):e[s]=[o]:e[s]=e[s]?e[s]+", "+o:o)}),e},$internals=Symbol("internals");function normalizeHeader(a){return a&&String(a).trim().toLowerCase()}function normalizeValue(a){return a===!1||a==null?a:utils$1.isArray(a)?a.map(normalizeValue):String(a)}function parseTokens(a){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=s.exec(a);)e[o[1]]=o[2];return e}const isValidHeaderName=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function matchHeaderValue(a,e,s,o,c){if(utils$1.isFunction(o))return o.call(this,e,s);if(c&&(e=s),!!utils$1.isString(e)){if(utils$1.isString(o))return e.indexOf(o)!==-1;if(utils$1.isRegExp(o))return o.test(e)}}function formatHeader(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,o)=>s.toUpperCase()+o)}function buildAccessors(a,e){const s=utils$1.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(a,o+s,{value:function(c,d,h){return this[o].call(this,e,c,d,h)},configurable:!0})})}let AxiosHeaders$1=class{constructor(e){e&&this.set(e)}set(e,s,o){const c=this;function d(g,_,b){const $=normalizeHeader(_);if(!$)throw new Error("header name must be a non-empty string");const j=utils$1.findKey(c,$);(!j||c[j]===void 0||b===!0||b===void 0&&c[j]!==!1)&&(c[j||_]=normalizeValue(g))}const h=(g,_)=>utils$1.forEach(g,(b,$)=>d(b,$,_));if(utils$1.isPlainObject(e)||e instanceof this.constructor)h(e,s);else if(utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e))h(parseHeaders(e),s);else if(utils$1.isObject(e)&&utils$1.isIterable(e)){let g={},_,b;for(const $ of e){if(!utils$1.isArray($))throw TypeError("Object iterator must return a key-value pair");g[b=$[0]]=(_=g[b])?utils$1.isArray(_)?[..._,$[1]]:[_,$[1]]:$[1]}h(g,s)}else e!=null&&d(s,e,o);return this}get(e,s){if(e=normalizeHeader(e),e){const o=utils$1.findKey(this,e);if(o){const c=this[o];if(!s)return c;if(s===!0)return parseTokens(c);if(utils$1.isFunction(s))return s.call(this,c,o);if(utils$1.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=normalizeHeader(e),e){const o=utils$1.findKey(this,e);return!!(o&&this[o]!==void 0&&(!s||matchHeaderValue(this,this[o],o,s)))}return!1}delete(e,s){const o=this;let c=!1;function d(h){if(h=normalizeHeader(h),h){const g=utils$1.findKey(o,h);g&&(!s||matchHeaderValue(o,o[g],g,s))&&(delete o[g],c=!0)}}return utils$1.isArray(e)?e.forEach(d):d(e),c}clear(e){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const d=s[o];(!e||matchHeaderValue(this,this[d],d,e,!0))&&(delete this[d],c=!0)}return c}normalize(e){const s=this,o={};return utils$1.forEach(this,(c,d)=>{const h=utils$1.findKey(o,d);if(h){s[h]=normalizeValue(c),delete s[d];return}const g=e?formatHeader(d):String(d).trim();g!==d&&delete s[d],s[g]=normalizeValue(c),o[g]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return utils$1.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=e&&utils$1.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const o=new this(e);return s.forEach(c=>o.set(c)),o}static accessor(e){const o=(this[$internals]=this[$internals]={accessors:{}}).accessors,c=this.prototype;function d(h){const g=normalizeHeader(h);o[g]||(buildAccessors(c,h),o[g]=!0)}return utils$1.isArray(e)?e.forEach(d):d(e),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders$1.prototype,({value:a},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>a,set(o){this[s]=o}}});utils$1.freezeMethods(AxiosHeaders$1);function transformData(a,e){const s=this||defaults$1,o=e||s,c=AxiosHeaders$1.from(o.headers);let d=o.data;return utils$1.forEach(a,function(g){d=g.call(s,d,c.normalize(),e?e.status:void 0)}),c.normalize(),d}function isCancel$1(a){return!!(a&&a.__CANCEL__)}function CanceledError$1(a,e,s){AxiosError$1.call(this,a??"canceled",AxiosError$1.ERR_CANCELED,e,s),this.name="CanceledError"}utils$1.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(a,e,s){const o=s.config.validateStatus;!s.status||!o||o(s.status)?a(s):e(new AxiosError$1("Request failed with status code "+s.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function parseProtocol(a){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return e&&e[1]||""}function speedometer(a,e){a=a||10;const s=new Array(a),o=new Array(a);let c=0,d=0,h;return e=e!==void 0?e:1e3,function(_){const b=Date.now(),$=o[d];h||(h=b),s[c]=_,o[c]=b;let j=d,_e=0;for(;j!==c;)_e+=s[j++],j=j%a;if(c=(c+1)%a,c===d&&(d=(d+1)%a),b-h<e)return;const tt=$&&b-$;return tt?Math.round(_e*1e3/tt):void 0}}function throttle(a,e){let s=0,o=1e3/e,c,d;const h=(b,$=Date.now())=>{s=$,c=null,d&&(clearTimeout(d),d=null),a(...b)};return[(...b)=>{const $=Date.now(),j=$-s;j>=o?h(b,$):(c=b,d||(d=setTimeout(()=>{d=null,h(c)},o-j)))},()=>c&&h(c)]}const progressEventReducer=(a,e,s=3)=>{let o=0;const c=speedometer(50,250);return throttle(d=>{const h=d.loaded,g=d.lengthComputable?d.total:void 0,_=h-o,b=c(_),$=h<=g;o=h;const j={loaded:h,total:g,progress:g?h/g:void 0,bytes:_,rate:b||void 0,estimated:b&&g&&$?(g-h)/b:void 0,event:d,lengthComputable:g!=null,[e?"download":"upload"]:!0};a(j)},s)},progressEventDecorator=(a,e)=>{const s=a!=null;return[o=>e[0]({lengthComputable:s,total:a,loaded:o}),e[1]]},asyncDecorator=a=>(...e)=>utils$1.asap(()=>a(...e)),isURLSameOrigin=platform.hasStandardBrowserEnv?((a,e)=>s=>(s=new URL(s,platform.origin),a.protocol===s.protocol&&a.host===s.host&&(e||a.port===s.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(a,e,s,o,c,d,h){if(typeof document>"u")return;const g=[`${a}=${encodeURIComponent(e)}`];utils$1.isNumber(s)&&g.push(`expires=${new Date(s).toUTCString()}`),utils$1.isString(o)&&g.push(`path=${o}`),utils$1.isString(c)&&g.push(`domain=${c}`),d===!0&&g.push("secure"),utils$1.isString(h)&&g.push(`SameSite=${h}`),document.cookie=g.join("; ")},read(a){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function combineURLs(a,e){return e?a.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):a}function buildFullPath(a,e,s){let o=!isAbsoluteURL(e);return a&&(o||s==!1)?combineURLs(a,e):e}const headersToObject=a=>a instanceof AxiosHeaders$1?{...a}:a;function mergeConfig$2(a,e){e=e||{};const s={};function o(b,$,j,_e){return utils$1.isPlainObject(b)&&utils$1.isPlainObject($)?utils$1.merge.call({caseless:_e},b,$):utils$1.isPlainObject($)?utils$1.merge({},$):utils$1.isArray($)?$.slice():$}function c(b,$,j,_e){if(utils$1.isUndefined($)){if(!utils$1.isUndefined(b))return o(void 0,b,j,_e)}else return o(b,$,j,_e)}function d(b,$){if(!utils$1.isUndefined($))return o(void 0,$)}function h(b,$){if(utils$1.isUndefined($)){if(!utils$1.isUndefined(b))return o(void 0,b)}else return o(void 0,$)}function g(b,$,j){if(j in e)return o(b,$);if(j in a)return o(void 0,b)}const _={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:g,headers:(b,$,j)=>c(headersToObject(b),headersToObject($),j,!0)};return utils$1.forEach(Object.keys({...a,...e}),function($){const j=_[$]||c,_e=j(a[$],e[$],$);utils$1.isUndefined(_e)&&j!==g||(s[$]=_e)}),s}const resolveConfig=a=>{const e=mergeConfig$2({},a);let{data:s,withXSRFToken:o,xsrfHeaderName:c,xsrfCookieName:d,headers:h,auth:g}=e;if(e.headers=h=AxiosHeaders$1.from(h),e.url=buildURL(buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls),a.params,a.paramsSerializer),g&&h.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),utils$1.isFormData(s)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(utils$1.isFunction(s.getHeaders)){const _=s.getHeaders(),b=["content-type","content-length"];Object.entries(_).forEach(([$,j])=>{b.includes($.toLowerCase())&&h.set($,j)})}}if(platform.hasStandardBrowserEnv&&(o&&utils$1.isFunction(o)&&(o=o(e)),o||o!==!1&&isURLSameOrigin(e.url))){const _=c&&d&&cookies.read(d);_&&h.set(c,_)}return e},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(a){return new Promise(function(s,o){const c=resolveConfig(a);let d=c.data;const h=AxiosHeaders$1.from(c.headers).normalize();let{responseType:g,onUploadProgress:_,onDownloadProgress:b}=c,$,j,_e,tt,rt;function nt(){tt&&tt(),rt&&rt(),c.cancelToken&&c.cancelToken.unsubscribe($),c.signal&&c.signal.removeEventListener("abort",$)}let st=new XMLHttpRequest;st.open(c.method.toUpperCase(),c.url,!0),st.timeout=c.timeout;function at(){if(!st)return;const ut=AxiosHeaders$1.from("getAllResponseHeaders"in st&&st.getAllResponseHeaders()),yt={data:!g||g==="text"||g==="json"?st.responseText:st.response,status:st.status,statusText:st.statusText,headers:ut,config:a,request:st};settle(function(dt){s(dt),nt()},function(dt){o(dt),nt()},yt),st=null}"onloadend"in st?st.onloadend=at:st.onreadystatechange=function(){!st||st.readyState!==4||st.status===0&&!(st.responseURL&&st.responseURL.indexOf("file:")===0)||setTimeout(at)},st.onabort=function(){st&&(o(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,a,st)),st=null)},st.onerror=function(mt){const yt=mt&&mt.message?mt.message:"Network Error",Et=new AxiosError$1(yt,AxiosError$1.ERR_NETWORK,a,st);Et.event=mt||null,o(Et),st=null},st.ontimeout=function(){let mt=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const yt=c.transitional||transitionalDefaults;c.timeoutErrorMessage&&(mt=c.timeoutErrorMessage),o(new AxiosError$1(mt,yt.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,a,st)),st=null},d===void 0&&h.setContentType(null),"setRequestHeader"in st&&utils$1.forEach(h.toJSON(),function(mt,yt){st.setRequestHeader(yt,mt)}),utils$1.isUndefined(c.withCredentials)||(st.withCredentials=!!c.withCredentials),g&&g!=="json"&&(st.responseType=c.responseType),b&&([_e,rt]=progressEventReducer(b,!0),st.addEventListener("progress",_e)),_&&st.upload&&([j,tt]=progressEventReducer(_),st.upload.addEventListener("progress",j),st.upload.addEventListener("loadend",tt)),(c.cancelToken||c.signal)&&($=ut=>{st&&(o(!ut||ut.type?new CanceledError$1(null,a,st):ut),st.abort(),st=null)},c.cancelToken&&c.cancelToken.subscribe($),c.signal&&(c.signal.aborted?$():c.signal.addEventListener("abort",$)));const ot=parseProtocol(c.url);if(ot&&platform.protocols.indexOf(ot)===-1){o(new AxiosError$1("Unsupported protocol "+ot+":",AxiosError$1.ERR_BAD_REQUEST,a));return}st.send(d||null)})},composeSignals=(a,e)=>{const{length:s}=a=a?a.filter(Boolean):[];if(e||s){let o=new AbortController,c;const d=function(b){if(!c){c=!0,g();const $=b instanceof Error?b:this.reason;o.abort($ instanceof AxiosError$1?$:new CanceledError$1($ instanceof Error?$.message:$))}};let h=e&&setTimeout(()=>{h=null,d(new AxiosError$1(`timeout ${e} of ms exceeded`,AxiosError$1.ETIMEDOUT))},e);const g=()=>{a&&(h&&clearTimeout(h),h=null,a.forEach(b=>{b.unsubscribe?b.unsubscribe(d):b.removeEventListener("abort",d)}),a=null)};a.forEach(b=>b.addEventListener("abort",d));const{signal:_}=o;return _.unsubscribe=()=>utils$1.asap(g),_}},streamChunk=function*(a,e){let s=a.byteLength;if(s<e){yield a;return}let o=0,c;for(;o<s;)c=o+e,yield a.slice(o,c),o=c},readBytes=async function*(a,e){for await(const s of readStream(a))yield*streamChunk(s,e)},readStream=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const e=a.getReader();try{for(;;){const{done:s,value:o}=await e.read();if(s)break;yield o}}finally{await e.cancel()}},trackStream=(a,e,s,o)=>{const c=readBytes(a,e);let d=0,h,g=_=>{h||(h=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:b,value:$}=await c.next();if(b){g(),_.close();return}let j=$.byteLength;if(s){let _e=d+=j;s(_e)}_.enqueue(new Uint8Array($))}catch(b){throw g(b),b}},cancel(_){return g(_),c.return()}},{highWaterMark:2})},DEFAULT_CHUNK_SIZE=64*1024,{isFunction}=utils$1,globalFetchAPI=(({Request:a,Response:e})=>({Request:a,Response:e}))(utils$1.global),{ReadableStream:ReadableStream$1,TextEncoder}=utils$1.global,test=(a,...e)=>{try{return!!a(...e)}catch{return!1}},factory=a=>{a=utils$1.merge.call({skipUndefined:!0},globalFetchAPI,a);const{fetch:e,Request:s,Response:o}=a,c=e?isFunction(e):typeof fetch=="function",d=isFunction(s),h=isFunction(o);if(!c)return!1;const g=c&&isFunction(ReadableStream$1),_=c&&(typeof TextEncoder=="function"?(rt=>nt=>rt.encode(nt))(new TextEncoder):async rt=>new Uint8Array(await new s(rt).arrayBuffer())),b=d&&g&&test(()=>{let rt=!1;const nt=new s(platform.origin,{body:new ReadableStream$1,method:"POST",get duplex(){return rt=!0,"half"}}).headers.has("Content-Type");return rt&&!nt}),$=h&&g&&test(()=>utils$1.isReadableStream(new o("").body)),j={stream:$&&(rt=>rt.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(rt=>{!j[rt]&&(j[rt]=(nt,st)=>{let at=nt&&nt[rt];if(at)return at.call(nt);throw new AxiosError$1(`Response type '${rt}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,st)})});const _e=async rt=>{if(rt==null)return 0;if(utils$1.isBlob(rt))return rt.size;if(utils$1.isSpecCompliantForm(rt))return(await new s(platform.origin,{method:"POST",body:rt}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(rt)||utils$1.isArrayBuffer(rt))return rt.byteLength;if(utils$1.isURLSearchParams(rt)&&(rt=rt+""),utils$1.isString(rt))return(await _(rt)).byteLength},tt=async(rt,nt)=>{const st=utils$1.toFiniteNumber(rt.getContentLength());return st??_e(nt)};return async rt=>{let{url:nt,method:st,data:at,signal:ot,cancelToken:ut,timeout:mt,onDownloadProgress:yt,onUploadProgress:Et,responseType:dt,headers:gt,withCredentials:St="same-origin",fetchOptions:xt}=resolveConfig(rt),Ct=e||fetch;dt=dt?(dt+"").toLowerCase():"text";let Ht=composeSignals([ot,ut&&ut.toAbortSignal()],mt),Dt=null;const rr=Ht&&Ht.unsubscribe&&(()=>{Ht.unsubscribe()});let er;try{if(Et&&b&&st!=="get"&&st!=="head"&&(er=await tt(gt,at))!==0){let zt=new s(nt,{method:"POST",body:at,duplex:"half"}),Xt;if(utils$1.isFormData(at)&&(Xt=zt.headers.get("content-type"))&&gt.setContentType(Xt),zt.body){const[sr,Er]=progressEventDecorator(er,progressEventReducer(asyncDecorator(Et)));at=trackStream(zt.body,DEFAULT_CHUNK_SIZE,sr,Er)}}utils$1.isString(St)||(St=St?"include":"omit");const qt=d&&"credentials"in s.prototype,tr={...xt,signal:Ht,method:st.toUpperCase(),headers:gt.normalize().toJSON(),body:at,duplex:"half",credentials:qt?St:void 0};Dt=d&&new s(nt,tr);let Ft=await(d?Ct(Dt,xt):Ct(nt,tr));const Yt=$&&(dt==="stream"||dt==="response");if($&&(yt||Yt&&rr)){const zt={};["status","statusText","headers"].forEach(Sr=>{zt[Sr]=Ft[Sr]});const Xt=utils$1.toFiniteNumber(Ft.headers.get("content-length")),[sr,Er]=yt&&progressEventDecorator(Xt,progressEventReducer(asyncDecorator(yt),!0))||[];Ft=new o(trackStream(Ft.body,DEFAULT_CHUNK_SIZE,sr,()=>{Er&&Er(),rr&&rr()}),zt)}dt=dt||"text";let Qt=await j[utils$1.findKey(j,dt)||"text"](Ft,rt);return!Yt&&rr&&rr(),await new Promise((zt,Xt)=>{settle(zt,Xt,{data:Qt,headers:AxiosHeaders$1.from(Ft.headers),status:Ft.status,statusText:Ft.statusText,config:rt,request:Dt})})}catch(qt){throw rr&&rr(),qt&&qt.name==="TypeError"&&/Load failed|fetch/i.test(qt.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,rt,Dt),{cause:qt.cause||qt}):AxiosError$1.from(qt,qt&&qt.code,rt,Dt)}}},seedCache=new Map,getFetch=a=>{let e=a&&a.env||{};const{fetch:s,Request:o,Response:c}=e,d=[o,c,s];let h=d.length,g=h,_,b,$=seedCache;for(;g--;)_=d[g],b=$.get(_),b===void 0&&$.set(_,b=g?new Map:factory(e)),$=b;return b};getFetch();const knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:{get:getFetch}};utils$1.forEach(knownAdapters,(a,e)=>{if(a){try{Object.defineProperty(a,"name",{value:e})}catch{}Object.defineProperty(a,"adapterName",{value:e})}});const renderReason=a=>`- ${a}`,isResolvedHandle=a=>utils$1.isFunction(a)||a===null||a===!1;function getAdapter$1(a,e){a=utils$1.isArray(a)?a:[a];const{length:s}=a;let o,c;const d={};for(let h=0;h<s;h++){o=a[h];let g;if(c=o,!isResolvedHandle(o)&&(c=knownAdapters[(g=String(o)).toLowerCase()],c===void 0))throw new AxiosError$1(`Unknown adapter '${g}'`);if(c&&(utils$1.isFunction(c)||(c=c.get(e))))break;d[g||"#"+h]=c}if(!c){const h=Object.entries(d).map(([_,b])=>`adapter ${_} `+(b===!1?"is not supported by the environment":"is not available in the build"));let g=s?h.length>1?`since :
`+h.map(renderReason).join(`
`):" "+renderReason(h[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+g,"ERR_NOT_SUPPORT")}return c}const adapters={getAdapter:getAdapter$1,adapters:knownAdapters};function throwIfCancellationRequested(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new CanceledError$1(null,a)}function dispatchRequest(a){return throwIfCancellationRequested(a),a.headers=AxiosHeaders$1.from(a.headers),a.data=transformData.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(a.adapter||defaults$1.adapter,a)(a).then(function(o){return throwIfCancellationRequested(a),o.data=transformData.call(a,a.transformResponse,o),o.headers=AxiosHeaders$1.from(o.headers),o},function(o){return isCancel$1(o)||(throwIfCancellationRequested(a),o&&o.response&&(o.response.data=transformData.call(a,a.transformResponse,o.response),o.response.headers=AxiosHeaders$1.from(o.response.headers))),Promise.reject(o)})}const VERSION$1="1.13.2",validators$1={};["object","boolean","number","function","string","symbol"].forEach((a,e)=>{validators$1[a]=function(o){return typeof o===a||"a"+(e<1?"n ":" ")+a}});const deprecatedWarnings={};validators$1.transitional=function a(e,s,o){function c(d,h){return"[Axios v"+VERSION$1+"] Transitional option '"+d+"'"+h+(o?". "+o:"")}return(d,h,g)=>{if(e===!1)throw new AxiosError$1(c(h," has been removed"+(s?" in "+s:"")),AxiosError$1.ERR_DEPRECATED);return s&&!deprecatedWarnings[h]&&(deprecatedWarnings[h]=!0,console.warn(c(h," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(d,h,g):!0}};validators$1.spelling=function a(e){return(s,o)=>(console.warn(`${o} is likely a misspelling of ${e}`),!0)};function assertOptions(a,e,s){if(typeof a!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const o=Object.keys(a);let c=o.length;for(;c-- >0;){const d=o[c],h=e[d];if(h){const g=a[d],_=g===void 0||h(g,d,a);if(_!==!0)throw new AxiosError$1("option "+d+" must be "+_,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new AxiosError$1("Unknown option "+d,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(e){this.defaults=e||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(e,s){try{return await this._request(e,s)}catch(o){if(o instanceof Error){let c={};Error.captureStackTrace?Error.captureStackTrace(c):c=new Error;const d=c.stack?c.stack.replace(/^.+\n/,""):"";try{o.stack?d&&!String(o.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+d):o.stack=d}catch{}}throw o}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=mergeConfig$2(this.defaults,s);const{transitional:o,paramsSerializer:c,headers:d}=s;o!==void 0&&validator.assertOptions(o,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),c!=null&&(utils$1.isFunction(c)?s.paramsSerializer={serialize:c}:validator.assertOptions(c,{encode:validators.function,serialize:validators.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),validator.assertOptions(s,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let h=d&&utils$1.merge(d.common,d[s.method]);d&&utils$1.forEach(["delete","get","head","post","put","patch","common"],rt=>{delete d[rt]}),s.headers=AxiosHeaders$1.concat(h,d);const g=[];let _=!0;this.interceptors.request.forEach(function(nt){typeof nt.runWhen=="function"&&nt.runWhen(s)===!1||(_=_&&nt.synchronous,g.unshift(nt.fulfilled,nt.rejected))});const b=[];this.interceptors.response.forEach(function(nt){b.push(nt.fulfilled,nt.rejected)});let $,j=0,_e;if(!_){const rt=[dispatchRequest.bind(this),void 0];for(rt.unshift(...g),rt.push(...b),_e=rt.length,$=Promise.resolve(s);j<_e;)$=$.then(rt[j++],rt[j++]);return $}_e=g.length;let tt=s;for(;j<_e;){const rt=g[j++],nt=g[j++];try{tt=rt(tt)}catch(st){nt.call(this,st);break}}try{$=dispatchRequest.call(this,tt)}catch(rt){return Promise.reject(rt)}for(j=0,_e=b.length;j<_e;)$=$.then(b[j++],b[j++]);return $}getUri(e){e=mergeConfig$2(this.defaults,e);const s=buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls);return buildURL(s,e.params,e.paramsSerializer)}};utils$1.forEach(["delete","get","head","options"],function a(e){Axios$1.prototype[e]=function(s,o){return this.request(mergeConfig$2(o||{},{method:e,url:s,data:(o||{}).data}))}});utils$1.forEach(["post","put","patch"],function a(e){function s(o){return function(d,h,g){return this.request(mergeConfig$2(g||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:d,data:h}))}}Axios$1.prototype[e]=s(),Axios$1.prototype[e+"Form"]=s(!0)});let CancelToken$1=class go{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(d){s=d});const o=this;this.promise.then(c=>{if(!o._listeners)return;let d=o._listeners.length;for(;d-- >0;)o._listeners[d](c);o._listeners=null}),this.promise.then=c=>{let d;const h=new Promise(g=>{o.subscribe(g),d=g}).then(c);return h.cancel=function(){o.unsubscribe(d)},h},e(function(d,h,g){o.reason||(o.reason=new CanceledError$1(d,h,g),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=o=>{e.abort(o)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new go(function(c){e=c}),cancel:e}}};function spread$1(a){return function(s){return a.apply(null,s)}}function isAxiosError$1(a){return utils$1.isObject(a)&&a.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(HttpStatusCode$1).forEach(([a,e])=>{HttpStatusCode$1[e]=a});function createInstance(a){const e=new Axios$1(a),s=bind(Axios$1.prototype.request,e);return utils$1.extend(s,Axios$1.prototype,e,{allOwnKeys:!0}),utils$1.extend(s,e,null,{allOwnKeys:!0}),s.create=function(c){return createInstance(mergeConfig$2(a,c))},s}const axios=createInstance(defaults$1);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function a(e){return Promise.all(e)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$2;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=a=>formDataToJSON(utils$1.isHTMLForm(a)?new FormData(a):a);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig:mergeConfig$1}=axios,PROXY_PREFIX$1="/netease",searchMusic$1=async(a,e=1,s=10)=>{var o;try{const c=s*3,d=(e-1)*c,g=((o=(await axios.get(`${PROXY_PREFIX$1}/api/search/get/web`,{params:{s:a,type:1,limit:c,offset:d}})).data.result)==null?void 0:o.songs)||[];if(g.length===0)return[];const _=g.map(_e=>_e.id),b=await axios.get(`${PROXY_PREFIX$1}/api/song/enhance/player/url`,{params:{ids:JSON.stringify(_),br:32e4}}),$={};return(b.data.data||[]).forEach(_e=>{_e.url&&($[_e.id]=_e.url)}),g.filter(_e=>$[_e.id]).map(_e=>{var tt,rt;return{id:_e.id,name:_e.name,artist:_e.artists?_e.artists.map(nt=>nt.name).join(", "):"Unknown",album:((tt=_e.album)==null?void 0:tt.name)||"Unknown Album",picUrl:((rt=_e.album)==null?void 0:rt.picUrl)||null,playUrl:$[_e.id],duration:_e.duration?_e.duration/1e3:0,source:"wy"}}).slice(0,s)}catch(c){return console.error("Netease search failed:",c),[]}},getPlayUrl=async(a,e="wy")=>{var s,o;try{return((o=(s=(await axios.get(`${PROXY_PREFIX$1}/api/song/enhance/player/url`,{params:{ids:`[${a}]`,br:32e4}})).data.data)==null?void 0:s[0])==null?void 0:o.url)||null}catch(c){return console.error("Get play URL failed:",c),null}},SearchPage=()=>{const[a,e]=reactExports.useState(""),[s,o]=reactExports.useState([]),[c,d]=reactExports.useState(!1),[h,g]=reactExports.useState(!1),{playSong:_}=usePlayerStore(),{songs:b}=useLibraryStore(),$=usePlayerStore(nt=>nt.toggleLike),j=async()=>{if(a.trim()){g(!0),o([]);try{const nt=await searchMusic$1(a);o(nt)}catch(nt){console.error("Search error",nt)}finally{g(!1)}}},_e=async nt=>{d(!0);try{let st=nt.playUrl;if(st||(st=await getPlayUrl(nt.id,nt.source)),st){const at={id:nt.id,title:nt.name,artist:nt.artist,album:nt.album||"Unknown Album",duration:nt.duration||0,coverUrl:nt.picUrl,remoteCoverUrl:nt.picUrl,url:st,liked:b.some(ot=>ot.id===nt.id&&ot.liked)};_(at)}else alert("Failed to get playback URL")}catch(st){console.error(st),alert("Error playing song")}finally{d(!1)}},tt=nt=>{nt.playUrl?window.open(nt.playUrl,"_blank"):alert("Failed to get download URL")},rt=nt=>b.some(st=>st.id===nt&&st.liked);return jsxRuntimeExports.jsxs("div",{className:"flex-1 h-full overflow-hidden flex flex-col bg-black p-8",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Search"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 mb-8",children:[jsxRuntimeExports.jsxs("div",{className:"relative flex-1 max-w-xl",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/40",size:20}),jsxRuntimeExports.jsx("input",{type:"text",value:a,onChange:nt=>e(nt.target.value),onKeyDown:nt=>nt.key==="Enter"&&j(),placeholder:"Search for songs, artists...",className:"w-full bg-white/10 rounded-xl pl-12 pr-4 py-3 text-lg text-white placeholder-white/40 focus:outline-none focus:bg-white/20 transition-colors"})]}),jsxRuntimeExports.jsx("button",{onClick:j,disabled:h,className:"bg-pink-500 hover:bg-pink-600 text-white px-8 py-3 rounded-xl font-medium transition-colors disabled:opacity-50",children:h?jsxRuntimeExports.jsx(Loader2,{className:"animate-spin"}):"Search"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[s.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:s.map(nt=>{const st=rt(nt.id);return jsxRuntimeExports.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl hover:bg-white/10 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[nt.picUrl?jsxRuntimeExports.jsx("img",{src:nt.picUrl,alt:nt.album,className:"w-12 h-12 rounded-md object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-md bg-white/10 flex items-center justify-center text-xs text-white/40",children:"No Cover"}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-white truncate",children:nt.name}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-white/60 truncate",children:[nt.artist,"  ",nt.album]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity",children:[jsxRuntimeExports.jsx("button",{onClick:at=>{at.stopPropagation();const ot={id:nt.id,title:nt.name,artist:nt.artist,album:nt.album||"Unknown Album",duration:nt.duration||0,coverUrl:nt.picUrl,remoteCoverUrl:nt.picUrl,url:nt.playUrl,liked:st};$(ot)},className:`transition-all ${st?"opacity-100 text-pink-500":"text-white/40 hover:text-white"}`,children:jsxRuntimeExports.jsx(Heart,{size:16,fill:st?"currentColor":"none"})}),jsxRuntimeExports.jsx("button",{onClick:()=>_e(nt),className:"p-2 bg-white text-black rounded-full hover:scale-105 transition",title:"Play",children:jsxRuntimeExports.jsx(Play,{size:16,fill:"currentColor",className:"ml-0.5"})}),jsxRuntimeExports.jsx("button",{onClick:()=>tt(nt),className:"p-2 bg-white/10 text-white rounded-full hover:bg-white/20 transition",title:"Download",children:jsxRuntimeExports.jsx(Download,{size:16})})]})]},nt.id)})}),s.length===0&&!h&&a&&jsxRuntimeExports.jsx("div",{className:"text-center text-white/40 mt-20",children:'Try searching for a song name like ""'})]}),c&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"bg-[#1c1c1e] p-6 rounded-xl flex flex-col items-center gap-4",children:[jsxRuntimeExports.jsx(Loader2,{className:"animate-spin text-pink-500",size:32}),jsxRuntimeExports.jsx("p",{children:"Fetching song URL..."})]})})]})},AlbumsView=()=>{const{songs:a}=useLibraryStore(),{playSong:e,currentSong:s,isPlaying:o,toggleLike:c}=usePlayerStore(),[d,h]=reactExports.useState(null),g=reactExports.useMemo(()=>{const b={},$=[];a.forEach(_e=>{_e.liked&&$.push(_e);const tt=_e.album||"Unknown Album";b[tt]||(b[tt]={name:tt,artist:_e.artist||"Unknown Artist",songs:[],cover:_e.remoteCoverUrl||(_e.coverBlob?URL.createObjectURL(new Blob([_e.coverBlob])):null)}),b[tt].songs.push(_e)});const j=Object.values(b).sort((_e,tt)=>_e.name.localeCompare(tt.name));return $.length>0&&j.unshift({name:"Favorites",artist:"Various Artists",songs:$,isFavorites:!0,cover:null}),j},[a]),_=b=>{if(!b)return"--:--";const $=Math.floor(b/60),j=Math.floor(b%60);return`${$}:${j.toString().padStart(2,"0")}`};return d?jsxRuntimeExports.jsxs("div",{className:"flex-1 h-full overflow-hidden flex flex-col bg-black",children:[jsxRuntimeExports.jsxs("div",{className:"p-8 pb-4",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>h(null),className:"flex items-center gap-1 text-pink-500 hover:underline mb-4 text-sm font-medium",children:[jsxRuntimeExports.jsx(ChevronLeft,{size:16}),"Back to Albums"]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-6 items-end",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-40 shadow-2xl rounded-lg overflow-hidden bg-white/10 flex items-center justify-center relative group",children:d.isFavorites?jsxRuntimeExports.jsx("div",{className:"w-full h-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center",children:jsxRuntimeExports.jsx(Heart,{size:64,fill:"white",className:"text-white"})}):d.cover?jsxRuntimeExports.jsx("img",{src:d.cover,alt:d.name,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-4xl text-white/20 font-bold",children:d.name[0]})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl font-bold mb-2",children:d.name}),jsxRuntimeExports.jsx("p",{className:"text-xl text-pink-500 font-medium",children:d.artist}),jsxRuntimeExports.jsxs("p",{className:"text-white/60 text-sm mt-1",children:[d.songs.length," songs"]})]})]}),jsxRuntimeExports.jsx("div",{className:"mt-6 flex gap-3",children:jsxRuntimeExports.jsxs("button",{onClick:()=>e(d.songs[0],d.songs),className:"flex items-center gap-2 bg-pink-500 hover:bg-pink-600 text-white px-8 py-3 rounded-lg font-bold transition-colors",children:[jsxRuntimeExports.jsx(Play,{fill:"currentColor",size:20}),"Play"]})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 pt-0",children:jsxRuntimeExports.jsxs("div",{className:"w-full text-left border-collapse",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-black z-10 grid grid-cols-[auto_1fr_1fr_auto_auto] gap-4 py-3 border-b border-white/10 text-xs font-medium text-white/40 uppercase tracking-wider",children:[jsxRuntimeExports.jsx("div",{className:"w-8 text-center",children:"#"}),jsxRuntimeExports.jsx("div",{children:"Title"}),jsxRuntimeExports.jsx("div",{children:"Artist"}),jsxRuntimeExports.jsx("div",{className:"w-8"}),jsxRuntimeExports.jsx("div",{className:"w-16 text-right",children:jsxRuntimeExports.jsx(Clock,{size:14,className:"ml-auto"})})]}),jsxRuntimeExports.jsx("div",{className:"mt-2 space-y-1",children:d.songs.map((b,$)=>{const j=(s==null?void 0:s.id)===b.id;return jsxRuntimeExports.jsxs("div",{onDoubleClick:()=>e(b,d.songs),className:`grid grid-cols-[auto_1fr_1fr_auto_auto] gap-4 py-2.5 px-2 rounded-lg items-center text-sm group hover:bg-white/10 transition-colors cursor-default ${j?"bg-white/10 text-pink-500":"text-white/80"}`,children:[jsxRuntimeExports.jsxs("div",{className:"w-8 text-center relative flex justify-center",children:[jsxRuntimeExports.jsx("span",{className:`group-hover:hidden ${j?"hidden":"block"}`,children:$+1}),jsxRuntimeExports.jsx("button",{onClick:()=>e(b,d.songs),className:`hidden group-hover:block ${j&&o?"hidden":""}`,children:jsxRuntimeExports.jsx(Play,{size:14,fill:"currentColor"})}),j&&o&&jsxRuntimeExports.jsxs("div",{className:"w-3 h-3 flex gap-0.5 items-end justify-center",children:[jsxRuntimeExports.jsx("div",{className:"w-0.5 bg-pink-500 animate-[bounce_1s_infinite]"}),jsxRuntimeExports.jsx("div",{className:"w-0.5 bg-pink-500 animate-[bounce_1.2s_infinite]"}),jsxRuntimeExports.jsx("div",{className:"w-0.5 bg-pink-500 animate-[bounce_0.8s_infinite]"})]})]}),jsxRuntimeExports.jsx("div",{className:"font-medium truncate text-white",children:b.title}),jsxRuntimeExports.jsx("div",{className:"truncate text-white/60",children:b.artist}),jsxRuntimeExports.jsx("div",{className:"w-8 flex justify-center",children:jsxRuntimeExports.jsx("button",{onClick:_e=>{_e.stopPropagation(),c(b)},className:`transition-all ${b.liked?"opacity-100 text-pink-500":"opacity-0 group-hover:opacity-100 text-white/40 hover:text-white"}`,children:jsxRuntimeExports.jsx(Heart,{size:16,fill:b.liked?"currentColor":"none"})})}),jsxRuntimeExports.jsx("div",{className:"w-16 text-right text-white/40 font-variant-numeric tabular-nums",children:_(b.duration)})]},b.id)})})]})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 h-full overflow-hidden flex flex-col bg-black",children:jsxRuntimeExports.jsxs("div",{className:"p-8",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Albums"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:g.map(b=>jsxRuntimeExports.jsxs(motion.div,{whileHover:{y:-5},onClick:()=>h(b),className:"group cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"aspect-square w-full rounded-lg overflow-hidden bg-white/5 mb-3 shadow-lg relative",children:[b.isFavorites?jsxRuntimeExports.jsx("div",{className:"w-full h-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center",children:jsxRuntimeExports.jsx(Heart,{size:48,fill:"white",className:"text-white drop-shadow-md"})}):b.cover?jsxRuntimeExports.jsx("img",{src:b.cover,alt:b.name,className:"w-full h-full object-cover transition duration-500 group-hover:scale-110"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-800 text-white/20 font-bold text-4xl",children:b.name[0]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-12 h-12 bg-pink-500 rounded-full flex items-center justify-center shadow-xl transform scale-50 group-hover:scale-100 transition duration-300",children:jsxRuntimeExports.jsx(Play,{fill:"white",className:"ml-1 text-white",size:24})})})]}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-white truncate",children:b.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-white/60 truncate",children:b.artist})]},b.name))})]})})},RadioView=()=>{const[a,e]=reactExports.useState([]),[s,o]=reactExports.useState("Beijing"),[c,d]=reactExports.useState([]),[h,g]=reactExports.useState(!1),[_,b]=reactExports.useState(null),{playSong:$,currentSong:j,isPlaying:_e}=usePlayerStore();reactExports.useEffect(()=>{(async()=>{try{const at=(await(await fetch("https://de1.api.radio-browser.info/json/states/China")).json()).filter(ot=>ot.name.trim()!=="").sort((ot,ut)=>ot.name.localeCompare(ut.name));e(at)}catch(nt){console.error("Failed to fetch provinces",nt)}})()},[]),reactExports.useEffect(()=>{(async()=>{if(s){g(!0),b(null);try{const st=await(await fetch(`https://de1.api.radio-browser.info/json/stations/search?limit=100&countrycode=CN&state=${encodeURIComponent(s)}&order=clickcount&reverse=true`)).json();d(st)}catch(nt){console.error("Failed to fetch stations",nt),b("Failed to load stations. Please try again.")}finally{g(!1)}}})()},[s]);const tt=rt=>{$({id:rt.stationuuid,title:rt.name,artist:rt.state||"China Radio",album:"Live Radio",cover:rt.favicon||"https://lucide.dev/icons/radio",url:rt.url_resolved,duration:0,isRadio:!0})};return jsxRuntimeExports.jsxs("div",{className:"flex h-full",children:[jsxRuntimeExports.jsx("div",{className:"w-48 border-r border-white/10 overflow-y-auto custom-scrollbar bg-black/20",children:jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xs font-semibold text-white/40 uppercase tracking-wider mb-4",children:"Regions"}),jsxRuntimeExports.jsx("div",{className:"space-y-1",children:a.map(rt=>jsxRuntimeExports.jsxs("button",{onClick:()=>o(rt.name),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${s===rt.name?"bg-pink-500/20 text-pink-500 font-medium":"text-white/60 hover:text-white hover:bg-white/5"}`,children:[rt.name,jsxRuntimeExports.jsx("span",{className:"float-right text-xs opacity-50",children:rt.stationcount})]},rt.name))})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8",children:[jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsxs("h1",{className:"text-3xl font-bold mb-2",children:[s," Radio"]}),jsxRuntimeExports.jsxs("p",{className:"text-white/60",children:["Live stations from ",s,", China"]})]}),h?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx(Loader2,{className:"animate-spin text-pink-500",size:32})}):_?jsxRuntimeExports.jsx("div",{className:"text-red-400 text-center p-8",children:_}):jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:c.map(rt=>{const nt=(j==null?void 0:j.id)===rt.stationuuid;return jsxRuntimeExports.jsxs("div",{className:"group relative bg-white/5 hover:bg-white/10 rounded-xl p-4 transition-all duration-300 hover:-translate-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"aspect-square mb-4 bg-black/40 rounded-lg flex items-center justify-center relative overflow-hidden",children:[rt.favicon?jsxRuntimeExports.jsx("img",{src:rt.favicon,alt:rt.name,className:"w-full h-full object-cover",onError:st=>{st.target.onerror=null,st.target.src="",st.target.style.display="none",st.target.nextSibling.style.display="flex"}}):null,jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white/20",style:{display:rt.favicon?"none":"flex"},children:jsxRuntimeExports.jsx(Radio,{size:48})}),jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-black/40 flex items-center justify-center transition-opacity duration-300 ${nt&&_e?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:jsxRuntimeExports.jsx("button",{onClick:()=>tt(rt),className:"w-12 h-12 rounded-full bg-pink-500 text-white flex items-center justify-center shadow-lg transform transition-transform hover:scale-105 active:scale-95",children:nt&&_e?jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsx("div",{className:"w-1 h-3 bg-white animate-bounce",style:{animationDelay:"0s"}}),jsxRuntimeExports.jsx("div",{className:"w-1 h-3 bg-white animate-bounce",style:{animationDelay:"0.1s"}}),jsxRuntimeExports.jsx("div",{className:"w-1 h-3 bg-white animate-bounce",style:{animationDelay:"0.2s"}})]}):jsxRuntimeExports.jsx(Play,{size:24,fill:"currentColor",className:"ml-1"})})})]}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-white truncate mb-1",title:rt.name,children:rt.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-white/40 truncate",children:rt.tags||"Unknown Genre"}),rt.bitrate>0&&jsxRuntimeExports.jsxs("span",{className:"inline-block mt-2 text-[10px] px-1.5 py-0.5 rounded bg-white/10 text-white/60",children:[rt.bitrate,"kbps"]})]},rt.stationuuid)})})]})]})},PROXY_PREFIX="/netease",searchMusic=async a=>{var e,s;try{const o=await fetch(`${PROXY_PREFIX}/api/search/get/web?s=${encodeURIComponent(a)}&type=1&offset=0&total=true&limit=1`);if(!o.ok)throw new Error("Search failed");return((s=(e=(await o.json()).result)==null?void 0:e.songs)==null?void 0:s[0])||null}catch(o){return console.error("Search error:",o),null}},getSongDetail=async a=>{var e;try{const s=await fetch(`${PROXY_PREFIX}/api/song/detail/?id=${a}&ids=[${a}]`);if(!s.ok)throw new Error("Detail fetch failed");return((e=(await s.json()).songs)==null?void 0:e[0])||null}catch(s){return console.error("Detail error:",s),null}},getLyrics=async a=>{var e,s;try{const o=await fetch(`${PROXY_PREFIX}/api/song/lyric?os=pc&id=${a}&lv=-1&kv=-1&tv=-1`);if(!o.ok)throw new Error("Lyrics fetch failed");const c=await o.json();return{original:((e=c.lrc)==null?void 0:e.lyric)||"",translation:((s=c.tlyric)==null?void 0:s.lyric)||""}}catch(o){return console.error("Lyrics error:",o),null}},parseLyrics=a=>{if(!a)return[];const e=a.split(`
`),s=[],o=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/;for(const c of e){const d=o.exec(c);if(d){const h=parseInt(d[1]),g=parseInt(d[2]),_=parseInt(d[3].padEnd(3,"0")),b=h*60+g+_/1e3,$=c.replace(o,"").trim();$&&s.push({time:b,text:$})}}return s},matchAndGetMetadata=async(a,e)=>{var s;try{const o=`${a} ${e}`,c=await searchMusic(o);if(c){const[d,h]=await Promise.all([getSongDetail(c.id),getLyrics(c.id)]),g={};if((s=d==null?void 0:d.album)!=null&&s.picUrl&&(g.remoteCoverUrl=d.album.picUrl),h!=null&&h.original&&(g.lyrics=h.original),Object.keys(g).length>0)return g}return null}catch(o){throw console.error("Match error:",o),o}},PlayerBar=()=>{const{currentSong:a,isPlaying:e,setIsPlaying:s,nextSong:o,prevSong:c,toggleFullScreen:d,volume:h,setVolume:g,currentTime:_,duration:b,setDuration:$,setCurrentTime:j,updateCurrentSongMetadata:_e}=usePlayerStore();if(reactExports.useEffect(()=>{(async()=>{if(a!=null&&a.id){const st=!!a.lyrics,at=!!a.remoteCoverUrl;if(!st||!at)try{const ot=await matchAndGetMetadata(a.title,a.artist);ot&&_e(ot)}catch{}}})()},[a==null?void 0:a.id]),!a)return null;const tt=a.remoteCoverUrl||(a.coverBlob?URL.createObjectURL(new Blob([a.coverBlob])):null),rt=nt=>{const st=parseFloat(nt.target.value);j(st)};return jsxRuntimeExports.jsxs("div",{className:"h-20 bg-[#1c1c1e]/95 backdrop-blur-xl border-t border-white/10 flex items-center px-4 justify-between z-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 w-[30%] min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"w-12 h-12 rounded-md bg-white/10 overflow-hidden flex-shrink-0 relative group cursor-pointer",onClick:d,children:[tt?jsxRuntimeExports.jsx("img",{src:tt,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:jsxRuntimeExports.jsx("span",{className:"text-xs text-white/40",children:"Music"})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40 hidden group-hover:flex items-center justify-center",children:jsxRuntimeExports.jsx(Maximize2,{size:16})})]}),jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"font-medium truncate text-sm hover:underline cursor-pointer",onClick:d,children:a.title}),jsxRuntimeExports.jsx("div",{className:"text-xs text-white/60 truncate hover:underline cursor-pointer",children:a.artist})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-1 w-[40%]",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-6",children:[jsxRuntimeExports.jsx("button",{onClick:c,className:"text-white/60 hover:text-white transition",children:jsxRuntimeExports.jsx(SkipBack,{size:20,fill:"currentColor"})}),jsxRuntimeExports.jsx("button",{onClick:()=>s(!e),className:"w-8 h-8 flex items-center justify-center bg-white text-black rounded-full hover:scale-105 transition",children:e?jsxRuntimeExports.jsx(Pause,{size:16,fill:"currentColor"}):jsxRuntimeExports.jsx(Play,{size:16,fill:"currentColor",className:"ml-0.5"})}),jsxRuntimeExports.jsx("button",{onClick:o,className:"text-white/60 hover:text-white transition",children:jsxRuntimeExports.jsx(SkipForward,{size:20,fill:"currentColor"})})]}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md flex items-center gap-2 text-[10px] text-white/40 font-medium tabular-nums",children:[jsxRuntimeExports.jsx("span",{children:formatTime(_)}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:b||100,value:_,onChange:rt,className:"flex-1 h-1 bg-white/10 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2 [&::-webkit-slider-thumb]:h-2 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white hover:[&::-webkit-slider-thumb]:bg-white"}),jsxRuntimeExports.jsx("span",{children:formatTime(b)})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-4 w-[30%]",children:[jsxRuntimeExports.jsx("button",{className:"text-white/60 hover:text-white",children:jsxRuntimeExports.jsx(ListMusic,{size:18})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 w-24",children:[jsxRuntimeExports.jsx(Volume2,{size:16,className:"text-white/60"}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:1,step:.01,value:h,onChange:nt=>g(parseFloat(nt.target.value)),className:"w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2 [&::-webkit-slider-thumb]:h-2 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white"})]})]})]})},formatTime=a=>{if(!a)return"0:00";const e=Math.floor(a/60),s=Math.floor(a%60);return`${e}:${s.toString().padStart(2,"0")}`};function FullScreenPlayer(){const{currentSong:a,isPlaying:e,setIsPlaying:s,nextSong:o,prevSong:c,toggleFullScreen:d,volume:h,setVolume:g,currentTime:_,duration:b,setCurrentTime:$,updateCurrentSongMetadata:j,toggleLike:_e}=usePlayerStore(),[tt,rt]=reactExports.useState(!1),[nt,st]=reactExports.useState([]),[at,ot]=reactExports.useState(!1),[ut,mt]=reactExports.useState(-1),yt=reactExports.useRef(null);reactExports.useEffect(()=>{a!=null&&a.lyrics?st(parseLyrics(a.lyrics)):st([])},[a]),reactExports.useEffect(()=>{if(!nt.length)return;const St=nt.findIndex((xt,Ct)=>{const Ht=nt[Ct+1];return _>=xt.time&&(!Ht||_<Ht.time)});mt(St)},[_,nt]),reactExports.useEffect(()=>{if(at&&ut!==-1&&yt.current){const St=yt.current.children[ut];St&&St.scrollIntoView({behavior:"smooth",block:"center"})}},[ut,at]);const Et=async(St=!1)=>{if(a){rt(!0);try{const xt=await matchAndGetMetadata(a.title,a.artist);xt?(j(xt),!St&&xt.lyrics&&ot(!0)):St||alert("No match found")}catch(xt){console.error(xt),St||alert("Failed to match info")}finally{rt(!1)}}};if(!a)return null;const dt=St=>{const xt=Math.floor(St/60),Ct=Math.floor(St%60);return`${xt}:${Ct.toString().padStart(2,"0")}`},gt=a.remoteCoverUrl||(a.coverBlob?URL.createObjectURL(new Blob([a.coverBlob])):"https://upload.wikimedia.org/wikipedia/commons/c/ca/CD-ROM.png");return jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden bg-black text-white font-sans",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-0 transition-colors duration-1000 ease-in-out opacity-60 bg-gray-900"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-0 backdrop-blur-[100px] bg-black/30"}),gt&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-[-1] opacity-50 blur-3xl scale-125 transition-all duration-1000",style:{backgroundImage:`url(${gt})`,backgroundPosition:"center",backgroundSize:"cover"}}),jsxRuntimeExports.jsxs("div",{className:"relative z-10 flex flex-col h-full max-w-5xl mx-auto p-8 pt-12",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-8 relative",children:[jsxRuntimeExports.jsx("button",{onClick:d,className:"w-8 h-8 flex items-center justify-center bg-white/10 rounded-full hover:bg-white/20 transition",children:jsxRuntimeExports.jsx(ChevronDown,{size:20})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 bg-black/20 rounded-lg p-1",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ot(!1),className:`px-4 py-1 rounded-md text-xs font-medium transition ${at?"text-white/40 hover:text-white":"bg-white/20 text-white"}`,children:"Cover"}),jsxRuntimeExports.jsx("button",{onClick:()=>ot(!0),className:`px-4 py-1 rounded-md text-xs font-medium transition ${at?"bg-white/20 text-white":"text-white/40 hover:text-white"}`,children:"Lyrics"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>Et(!1),disabled:tt,className:"w-8 h-8 flex items-center justify-center bg-white/10 rounded-full hover:bg-white/20 transition disabled:opacity-50",title:"Auto Match Info",children:jsxRuntimeExports.jsx(Wand2,{size:16,className:tt?"animate-spin":""})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col md:flex-row items-center justify-center gap-12 md:gap-24 pb-20",children:[at?jsxRuntimeExports.jsx("div",{ref:yt,className:"w-full h-[50vh] md:h-[60vh] overflow-y-auto custom-scrollbar text-center space-y-6 mask-linear-gradient",children:nt.length>0?nt.map((St,xt)=>jsxRuntimeExports.jsx(motion.p,{initial:{opacity:0,y:10},animate:{opacity:ut===xt?1:.5,scale:ut===xt?1.05:1,filter:ut===xt?"blur(0px)":"blur(0.5px)",color:ut===xt?"#ffffff":"rgba(255, 255, 255, 0.6)"},className:"text-lg md:text-2xl font-bold transition-all duration-500 cursor-pointer hover:opacity-80",onClick:()=>{const Ct=document.querySelector("audio");Ct&&(Ct.currentTime=St.time),$(St.time)},children:St.text},xt)):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/40",children:[jsxRuntimeExports.jsx("p",{children:"No lyrics available"}),jsxRuntimeExports.jsx("button",{onClick:Et,className:"mt-4 text-pink-500 hover:underline",children:"Try Auto-Match"})]})}):jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.4,ease:"easeOut"},className:"relative group aspect-square w-full max-w-[350px] md:max-w-[400px] shadow-2xl rounded-xl overflow-hidden bg-white/5",children:[jsxRuntimeExports.jsx("img",{src:gt,alt:a.album,className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 shadow-[inset_0_0_20px_rgba(0,0,0,0.2)] rounded-xl pointer-events-none"})]},a.id),jsxRuntimeExports.jsxs("div",{className:"flex flex-col w-full max-w-md gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx(motion.h1,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},className:"text-2xl md:text-3xl font-bold truncate",children:a.title},a.title),jsxRuntimeExports.jsxs(motion.p,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"text-lg md:text-xl text-white/60 truncate",children:[a.artist,"  ",a.album]},a.artist)]}),jsxRuntimeExports.jsxs("div",{className:"group space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"relative h-1.5 bg-white/20 rounded-full cursor-pointer overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/80 rounded-full group-hover:bg-white transition-colors",style:{width:`${_/(b||1)*100}%`}}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:b||100,value:_,onChange:St=>$(parseFloat(St.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-xs text-white/40 font-medium",children:[jsxRuntimeExports.jsx("span",{children:dt(_)}),jsxRuntimeExports.jsxs("span",{children:["-",dt((b||0)-_)]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-10",children:[jsxRuntimeExports.jsx("button",{onClick:c,className:"text-white/70 hover:text-white transition transform active:scale-95",children:jsxRuntimeExports.jsx(SkipBack,{size:32,fill:"currentColor"})}),jsxRuntimeExports.jsx("button",{onClick:()=>s(!e),className:"text-white hover:scale-105 transition transform active:scale-95",children:e?jsxRuntimeExports.jsx(Pause,{size:48,fill:"currentColor"}):jsxRuntimeExports.jsx(Play,{size:48,fill:"currentColor"})}),jsxRuntimeExports.jsx("button",{onClick:o,className:"text-white/70 hover:text-white transition transform active:scale-95",children:jsxRuntimeExports.jsx(SkipForward,{size:32,fill:"currentColor"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-6",children:[jsxRuntimeExports.jsx("button",{className:"text-white/50 hover:text-white transition",children:jsxRuntimeExports.jsx(MessageSquareQuote,{size:20})}),jsxRuntimeExports.jsx("button",{onClick:()=>_e(a),className:`transition transform active:scale-95 ${a.liked?"text-pink-500":"text-white/50 hover:text-white"}`,children:jsxRuntimeExports.jsx(Heart,{size:20,fill:a.liked?"currentColor":"none"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 w-32 group",children:[jsxRuntimeExports.jsx(Volume2,{size:18,className:"text-white/50"}),jsxRuntimeExports.jsxs("div",{className:"relative flex-1 h-1 bg-white/20 rounded-full overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/80 rounded-full",style:{width:`${h*100}%`}}),jsxRuntimeExports.jsx("input",{type:"range",min:0,max:1,step:.01,value:h,onChange:St=>g(parseFloat(St.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})]})]})]})]})]})]})}const isFiniteNumber=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},isSafeInteger=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let ErrorTypes=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),ErrorDetails=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a}({}),Events=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a}({});var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class EWMA{constructor(e,s=0,o=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=s,this.totalWeight_=o}sample(e,s){const o=Math.pow(this.alpha_,e);this.estimate_=s*(1-o)+o*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class EwmaBandWidthEstimator{constructor(e,s,o,c=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(e),this.fast_=new EWMA(s),this.defaultTTFB_=c,this.ttfb_=new EWMA(e)}update(e,s){const{slow_:o,fast_:c,ttfb_:d}=this;o.halfLife!==e&&(this.slow_=new EWMA(e,o.getEstimate(),o.getTotalWeight())),c.halfLife!==s&&(this.fast_=new EWMA(s,c.getEstimate(),c.getTotalWeight())),d.halfLife!==e&&(this.ttfb_=new EWMA(e,d.getEstimate(),d.getTotalWeight()))}sample(e,s){e=Math.max(e,this.minDelayMs_);const o=8*s,c=e/1e3,d=o/c;this.fast_.sample(c,d),this.slow_.sample(c,d)}sampleTTFB(e){const s=e/1e3,o=Math.sqrt(2)*Math.exp(-Math.pow(s,2)/2);this.ttfb_.sample(o,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function _defineProperty(a,e,s){return(e=_toPropertyKey(e))in a?Object.defineProperty(a,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[e]=s,a}function _extends(){return _extends=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var o in s)({}).hasOwnProperty.call(s,o)&&(a[o]=s[o])}return a},_extends.apply(null,arguments)}function ownKeys(a,e){var s=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);e&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),s.push.apply(s,o)}return s}function _objectSpread2(a){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?ownKeys(Object(s),!0).forEach(function(o){_defineProperty(a,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(s,o))})}return a}function _toPrimitive(a,e){if(typeof a!="object"||!a)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var o=s.call(a,e);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function _toPropertyKey(a){var e=_toPrimitive(a,"string");return typeof e=="symbol"?e:e+""}class Logger{constructor(e,s){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const o=`[${e}]:`;this.trace=noop,this.debug=s.debug.bind(null,o),this.log=s.log.bind(null,o),this.warn=s.warn.bind(null,o),this.info=s.info.bind(null,o),this.error=s.error.bind(null,o)}}const noop=function a(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};function createLogger(){return _extends({},fakeLogger)}function consolePrintFn(a,e){const s=self.console[a];return s?s.bind(self.console,`${e?"["+e+"] ":""}[${a}] >`):noop}function getLoggerFn(a,e,s){return e[a]?e[a].bind(e):consolePrintFn(a,s)}const exportedLogger=createLogger();function enableLogs(a,e,s){const o=createLogger();if(typeof console=="object"&&a===!0||typeof a=="object"){const c=["debug","log","info","warn","error"];c.forEach(d=>{o[d]=getLoggerFn(d,a,s)});try{o.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return createLogger()}c.forEach(d=>{exportedLogger[d]=getLoggerFn(d,a)})}else _extends(exportedLogger,o);return o}const logger=exportedLogger;function getMediaSource(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function isManagedMediaSource(a){return typeof self<"u"&&a===self.ManagedMediaSource}function isCompatibleTrackChange(a,e){const s=Object.keys(a),o=Object.keys(e),c=s.length,d=o.length;return!c||!d||c===d&&!s.some(h=>o.indexOf(h)===-1)}function utf8ArrayToStr(a,e=!1){if(typeof TextDecoder<"u"){const b=new TextDecoder("utf-8").decode(a);if(e){const $=b.indexOf("\0");return $!==-1?b.substring(0,$):b}return b.replace(/\0/g,"")}const s=a.length;let o,c,d,h="",g=0;for(;g<s;){if(o=a[g++],o===0&&e)return h;if(o===0||o===3)continue;switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h+=String.fromCharCode(o);break;case 12:case 13:c=a[g++],h+=String.fromCharCode((o&31)<<6|c&63);break;case 14:c=a[g++],d=a[g++],h+=String.fromCharCode((o&15)<<12|(c&63)<<6|(d&63)<<0);break}}return h}function arrayToHex(a){let e="";for(let s=0;s<a.length;s++){let o=a[s].toString(16);o.length<2&&(o="0"+o),e+=o}return e}function hexToArrayBuffer(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function getDefaultExportFromCjs(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var urlToolkit={exports:{}},hasRequiredUrlToolkit;function requireUrlToolkit(){return hasRequiredUrlToolkit||(hasRequiredUrlToolkit=1,function(a,e){(function(s){var o=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,c=/^(?=([^\/?#]*))\1([^]*)$/,d=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,g={buildAbsoluteURL:function(_,b,$){if($=$||{},_=_.trim(),b=b.trim(),!b){if(!$.alwaysNormalize)return _;var j=g.parseURL(_);if(!j)throw new Error("Error trying to parse base URL.");return j.path=g.normalizePath(j.path),g.buildURLFromParts(j)}var _e=g.parseURL(b);if(!_e)throw new Error("Error trying to parse relative URL.");if(_e.scheme)return $.alwaysNormalize?(_e.path=g.normalizePath(_e.path),g.buildURLFromParts(_e)):b;var tt=g.parseURL(_);if(!tt)throw new Error("Error trying to parse base URL.");if(!tt.netLoc&&tt.path&&tt.path[0]!=="/"){var rt=c.exec(tt.path);tt.netLoc=rt[1],tt.path=rt[2]}tt.netLoc&&!tt.path&&(tt.path="/");var nt={scheme:tt.scheme,netLoc:_e.netLoc,path:null,params:_e.params,query:_e.query,fragment:_e.fragment};if(!_e.netLoc&&(nt.netLoc=tt.netLoc,_e.path[0]!=="/"))if(!_e.path)nt.path=tt.path,_e.params||(nt.params=tt.params,_e.query||(nt.query=tt.query));else{var st=tt.path,at=st.substring(0,st.lastIndexOf("/")+1)+_e.path;nt.path=g.normalizePath(at)}return nt.path===null&&(nt.path=$.alwaysNormalize?g.normalizePath(_e.path):_e.path),g.buildURLFromParts(nt)},parseURL:function(_){var b=o.exec(_);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(_){for(_=_.split("").reverse().join("").replace(d,"");_.length!==(_=_.replace(h,"")).length;);return _.split("").reverse().join("")},buildURLFromParts:function(_){return _.scheme+_.netLoc+_.path+_.params+_.query+_.fragment}};a.exports=g})()}(urlToolkit)),urlToolkit.exports}var urlToolkitExports=requireUrlToolkit();class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,makeEnumerable(this,"stats")}setByteRange(e,s){const o=e.split("@",2);let c;o.length===1?c=(s==null?void 0:s.byteRangeEndOffset)||0:c=parseInt(o[1]),this._byteRange=[c,parseInt(o[0])+c]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new LoadStats),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ElementaryStreamTypes.AUDIO]=null,e[ElementaryStreamTypes.VIDEO]=null,e[ElementaryStreamTypes.AUDIOVIDEO]=null}}function isMediaFragment(a){return a.sn!=="initSegment"}class Fragment extends BaseSegment{constructor(e,s){super(s),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],s=this.byteRange[1];if(isFiniteNumber(e)&&isFiniteNumber(s))return s-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:s}=this;if(!s||s.NONE)return null;if(s.identity)this._decryptdata||(this._decryptdata=s.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const o=Object.keys(s);if(o.length===1){const c=this._decryptdata=s[o[0]]||null;c&&(this._decryptdata=c.getDecryptData(this.sn,s))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var s;const o=Object.keys(this.levelkeys),c=o.length;if(c>1||c===1&&(s=this.levelkeys[o[0]])!=null&&s.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!isFiniteNumber(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return isMediaFragment(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const s=this.levelkeys;if(s){var o;const c=s[e];c&&!((o=this._decryptdata)!=null&&o.keyId)&&(this._decryptdata=c.getDecryptData(this.sn,s))}}abortRequests(){var e,s;(e=this.loader)==null||e.abort(),(s=this.keyLoader)==null||s.abort()}setElementaryStreamInfo(e,s,o,c,d,h=!1){const{elementaryStreams:g}=this,_=g[e];if(!_){g[e]={startPTS:s,endPTS:o,startDTS:c,endDTS:d,partial:h};return}_.startPTS=Math.min(_.startPTS,s),_.endPTS=Math.max(_.endPTS,o),_.startDTS=Math.min(_.startDTS,c),_.endDTS=Math.max(_.endDTS,d)}}class Part extends BaseSegment{constructor(e,s,o,c,d){super(o),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=s,this.index=c;const h=e.enumeratedString("BYTERANGE");h&&this.setByteRange(h,d),d&&(this.fragOffset=d.fragOffset+d.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function getOwnPropertyDescriptorFromPrototypeChain(a,e){const s=Object.getPrototypeOf(a);if(s){const o=Object.getOwnPropertyDescriptor(s,e);return o||getOwnPropertyDescriptorFromPrototypeChain(s,e)}}function makeEnumerable(a,e){const s=getOwnPropertyDescriptorFromPrototypeChain(a,e);s&&(s.enumerable=!0,Object.defineProperty(a,e,s))}const UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(a){return String.fromCharCode.apply(null,a)}function readUint16(a,e){const s=a[e]<<8|a[e+1];return s<0?65536+s:s}function readUint32(a,e){const s=readSint32(a,e);return s<0?4294967296+s:s}function readUint64(a,e){let s=readUint32(a,e);return s*=Math.pow(2,32),s+=readUint32(a,e+4),s}function readSint32(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function hasMoofData(a){const e=a.byteLength;for(let s=0;s<e;){const o=readUint32(a,s);if(o>8&&a[s+4]===109&&a[s+5]===111&&a[s+6]===111&&a[s+7]===102)return!0;s=o>1?s+o:e}return!1}function findBox(a,e){const s=[];if(!e.length)return s;const o=a.byteLength;for(let c=0;c<o;){const d=readUint32(a,c),h=bin2str(a.subarray(c+4,c+8)),g=d>1?c+d:o;if(h===e[0])if(e.length===1)s.push(a.subarray(c+8,g));else{const _=findBox(a.subarray(c+8,g),e.slice(1));_.length&&push.apply(s,_)}c=g}return s}function parseSegmentIndex(a){const e=[],s=a[0];let o=8;const c=readUint32(a,o);o+=4;let d=0,h=0;s===0?(d=readUint32(a,o),h=readUint32(a,o+4),o+=8):(d=readUint64(a,o),h=readUint64(a,o+8),o+=16),o+=2;let g=a.length+h;const _=readUint16(a,o);o+=2;for(let b=0;b<_;b++){let $=o;const j=readUint32(a,$);$+=4;const _e=j&2147483647;if((j&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const rt=readUint32(a,$);$+=4,e.push({referenceSize:_e,subsegmentDuration:rt,info:{duration:rt/c,start:g,end:g+_e-1}}),g+=_e,$+=4,o=$}return{earliestPresentationTime:d,timescale:c,version:s,referencesCount:_,references:e}}function parseInitSegment(a){const e=[],s=findBox(a,["moov","trak"]);for(let c=0;c<s.length;c++){const d=s[c],h=findBox(d,["tkhd"])[0];if(h){let g=h[0];const _=readUint32(h,g===0?12:20),b=findBox(d,["mdia","mdhd"])[0];if(b){g=b[0];const $=readUint32(b,g===0?12:20),j=findBox(d,["mdia","hdlr"])[0];if(j){const _e=bin2str(j.subarray(8,12)),tt={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[_e],rt=findBox(d,["mdia","minf","stbl","stsd"])[0],nt=parseStsd(rt);tt?(e[_]={timescale:$,type:tt,stsd:nt},e[tt]=_objectSpread2({timescale:$,id:_},nt)):e[_]={timescale:$,type:_e,stsd:nt}}}}}return findBox(a,["moov","mvex","trex"]).forEach(c=>{const d=readUint32(c,4),h=e[d];h&&(h.default={duration:readUint32(c,12),flags:readUint32(c,20)})}),e}function parseStsd(a){const e=a.subarray(8),s=e.subarray(86),o=bin2str(e.subarray(4,8));let c=o,d;const h=o==="enca"||o==="encv";if(h){const b=findBox(e,[o])[0].subarray(o==="enca"?28:78);findBox(b,["sinf"]).forEach(j=>{const _e=findBox(j,["schm"])[0];if(_e){const tt=bin2str(_e.subarray(4,8));if(tt==="cbcs"||tt==="cenc"){const rt=findBox(j,["frma"])[0];rt&&(c=bin2str(rt))}}})}const g=c;switch(c){case"avc1":case"avc2":case"avc3":case"avc4":{const _=findBox(s,["avcC"])[0];_&&_.length>3&&(c+="."+toHex(_[1])+toHex(_[2])+toHex(_[3]),d=parseSupplementalDoViCodec(g==="avc1"?"dva1":"dvav",s));break}case"mp4a":{const _=findBox(e,[o])[0],b=findBox(_.subarray(28),["esds"])[0];if(b&&b.length>7){let $=4;if(b[$++]!==3)break;$=skipBERInteger(b,$),$+=2;const j=b[$++];if(j&128&&($+=2),j&64&&($+=b[$++]),b[$++]!==4)break;$=skipBERInteger(b,$);const _e=b[$++];if(_e===64)c+="."+toHex(_e);else break;if($+=12,b[$++]!==5)break;$=skipBERInteger(b,$);const tt=b[$++];let rt=(tt&248)>>3;rt===31&&(rt+=1+((tt&7)<<3)+((b[$]&224)>>5)),c+="."+rt}break}case"hvc1":case"hev1":{const _=findBox(s,["hvcC"])[0];if(_&&_.length>12){const b=_[1],$=["","A","B","C"][b>>6],j=b&31,_e=readUint32(_,2),tt=(b&32)>>5?"H":"L",rt=_[12],nt=_.subarray(6,12);c+="."+$+j,c+="."+reverse32BitInt(_e).toString(16).toUpperCase(),c+="."+tt+rt;let st="";for(let at=nt.length;at--;){const ot=nt[at];(ot||st)&&(st="."+ot.toString(16).toUpperCase()+st)}c+=st}d=parseSupplementalDoViCodec(g=="hev1"?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{c=parseSupplementalDoViCodec(c,s)||c;break}case"vp09":{const _=findBox(s,["vpcC"])[0];if(_&&_.length>6){const b=_[4],$=_[5],j=_[6]>>4&15;c+="."+addLeadingZero(b)+"."+addLeadingZero($)+"."+addLeadingZero(j)}break}case"av01":{const _=findBox(s,["av1C"])[0];if(_&&_.length>2){const b=_[1]>>>5,$=_[1]&31,j=_[2]>>>7?"H":"M",_e=(_[2]&64)>>6,tt=(_[2]&32)>>5,rt=b===2&&_e?tt?12:10:_e?10:8,nt=(_[2]&16)>>4,st=(_[2]&8)>>3,at=(_[2]&4)>>2,ot=_[2]&3;c+="."+b+"."+addLeadingZero($)+j+"."+addLeadingZero(rt)+"."+nt+"."+st+at+ot+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+0,d=parseSupplementalDoViCodec("dav1",s)}break}}return{codec:c,encrypted:h,supplemental:d}}function parseSupplementalDoViCodec(a,e){const s=findBox(e,["dvvC"]),o=s.length?s[0]:findBox(e,["dvcC"])[0];if(o){const c=o[2]>>1&127,d=o[2]<<5&32|o[3]>>3&31;return a+"."+addLeadingZero(c)+"."+addLeadingZero(d)}}function reverse32BitInt(a){let e=0;for(let s=0;s<32;s++)e|=(a>>s&1)<<31-s;return e>>>0}function skipBERInteger(a,e){const s=e+5;for(;a[e++]&128&&e<s;);return e}function toHex(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(a){return(a<10?"0":"")+a}function patchEncyptionData(a,e){if(!a||!e)return;const s=e.keyId;s&&e.isCommonEncryption&&applyToTencBoxes(a,(o,c)=>{const d=o.subarray(8,24);d.some(h=>h!==0)||(logger.log(`[eme] Patching keyId in 'enc${c?"a":"v"}>sinf>>tenc' box: ${arrayToHex(d)} -> ${arrayToHex(s)}`),o.set(s,8))})}function parseKeyIdsFromTenc(a){const e=[];return applyToTencBoxes(a,s=>e.push(s.subarray(8,24))),e}function applyToTencBoxes(a,e){findBox(a,["moov","trak"]).forEach(o=>{const c=findBox(o,["mdia","minf","stbl","stsd"])[0];if(!c)return;const d=c.subarray(8);let h=findBox(d,["enca"]);const g=h.length>0;g||(h=findBox(d,["encv"])),h.forEach(_=>{const b=g?_.subarray(28):_.subarray(78);findBox(b,["sinf"]).forEach(j=>{const _e=parseSinf(j);_e&&e(_e,g)})})})}function parseSinf(a){const e=findBox(a,["schm"])[0];if(e){const s=bin2str(e.subarray(4,8));if(s==="cbcs"||s==="cenc"){const o=findBox(a,["schi","tenc"])[0];if(o)return o}}}function getSampleData(a,e,s){const o={},c=findBox(a,["moof","traf"]);for(let d=0;d<c.length;d++){const h=c[d],g=findBox(h,["tfhd"])[0],_=readUint32(g,4),b=e[_];if(!b)continue;o[_]||(o[_]={start:NaN,duration:0,sampleCount:0,timescale:b.timescale,type:b.type});const $=o[_],j=findBox(h,["tfdt"])[0];if(j){const ut=j[0];let mt=readUint32(j,4);ut===1&&(mt===UINT32_MAX$1?s.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(mt*=UINT32_MAX$1+1,mt+=readUint32(j,8))),isFiniteNumber(mt)&&(!isFiniteNumber($.start)||mt<$.start)&&($.start=mt)}const _e=b.default,tt=readUint32(g,0)|(_e==null?void 0:_e.flags);let rt=(_e==null?void 0:_e.duration)||0;tt&8&&(tt&2?rt=readUint32(g,12):rt=readUint32(g,8));const nt=findBox(h,["trun"]);let st=$.start||0,at=0,ot=rt;for(let ut=0;ut<nt.length;ut++){const mt=nt[ut],yt=readUint32(mt,4),Et=$.sampleCount;$.sampleCount+=yt;const dt=mt[3]&1,gt=mt[3]&4,St=mt[2]&1,xt=mt[2]&2,Ct=mt[2]&4,Ht=mt[2]&8;let Dt=8,rr=yt;for(dt&&(Dt+=4),gt&&yt&&(!(mt[Dt+1]&1)&&$.keyFrameIndex===void 0&&($.keyFrameIndex=Et),Dt+=4,St?(ot=readUint32(mt,Dt),Dt+=4):ot=rt,xt&&(Dt+=4),Ht&&(Dt+=4),st+=ot,at+=ot,rr--);rr--;)St?(ot=readUint32(mt,Dt),Dt+=4):ot=rt,xt&&(Dt+=4),Ct&&(mt[Dt+1]&1||$.keyFrameIndex===void 0&&($.keyFrameIndex=$.sampleCount-(rr+1),$.keyFrameStart=st),Dt+=4),Ht&&(Dt+=4),st+=ot,at+=ot;!at&&rt&&(at+=rt*yt)}$.duration+=at}if(!Object.keys(o).some(d=>o[d].duration)){let d=1/0,h=0;const g=findBox(a,["sidx"]);for(let _=0;_<g.length;_++){const b=parseSegmentIndex(g[_]);if(b!=null&&b.references){d=Math.min(d,b.earliestPresentationTime/b.timescale);const $=b.references.reduce((j,_e)=>j+_e.info.duration||0,0);h=Math.max(h,$+b.earliestPresentationTime/b.timescale)}}h&&isFiniteNumber(h)&&Object.keys(o).forEach(_=>{o[_].duration||(o[_].duration=h*o[_].timescale-o[_].start)})}return o}function segmentValidRange(a){const e={valid:null,remainder:null},s=findBox(a,["moof"]);if(s.length<2)return e.remainder=a,e;const o=s[s.length-1];return e.valid=a.slice(0,o.byteOffset-8),e.remainder=a.slice(o.byteOffset-8),e}function appendUint8Array(a,e){const s=new Uint8Array(a.length+e.length);return s.set(a),s.set(e,a.length),s}function parseSamples(a,e){const s=[],o=e.samples,c=e.timescale,d=e.id;let h=!1;return findBox(o,["moof"]).map(_=>{const b=_.byteOffset-8;findBox(_,["traf"]).map(j=>{const _e=findBox(j,["tfdt"]).map(tt=>{const rt=tt[0];let nt=readUint32(tt,4);return rt===1&&(nt*=Math.pow(2,32),nt+=readUint32(tt,8)),nt/c})[0];return _e!==void 0&&(a=_e),findBox(j,["tfhd"]).map(tt=>{const rt=readUint32(tt,4),nt=readUint32(tt,0)&16777215,st=(nt&1)!==0,at=(nt&2)!==0,ot=(nt&8)!==0;let ut=0;const mt=(nt&16)!==0;let yt=0;const Et=(nt&32)!==0;let dt=8;rt===d&&(st&&(dt+=8),at&&(dt+=4),ot&&(ut=readUint32(tt,dt),dt+=4),mt&&(yt=readUint32(tt,dt),dt+=4),Et&&(dt+=4),e.type==="video"&&(h=isHEVC(e.codec)),findBox(j,["trun"]).map(gt=>{const St=gt[0],xt=readUint32(gt,0)&16777215,Ct=(xt&1)!==0;let Ht=0;const Dt=(xt&4)!==0,rr=(xt&256)!==0;let er=0;const qt=(xt&512)!==0;let tr=0;const Ft=(xt&1024)!==0,Yt=(xt&2048)!==0;let Qt=0;const zt=readUint32(gt,4);let Xt=8;Ct&&(Ht=readUint32(gt,Xt),Xt+=4),Dt&&(Xt+=4);let sr=Ht+b;for(let Er=0;Er<zt;Er++){if(rr?(er=readUint32(gt,Xt),Xt+=4):er=ut,qt?(tr=readUint32(gt,Xt),Xt+=4):tr=yt,Ft&&(Xt+=4),Yt&&(St===0?Qt=readUint32(gt,Xt):Qt=readSint32(gt,Xt),Xt+=4),e.type===ElementaryStreamTypes.VIDEO){let Sr=0;for(;Sr<tr;){const _r=readUint32(o,sr);if(sr+=4,isSEIMessage(h,o[sr])){const Fr=o.subarray(sr,sr+_r);parseSEIMessageFromNALu(Fr,h?2:1,a+Qt/c,s)}sr+=_r,Sr+=_r+4}}a+=er/c}}))})})}),s}function isHEVC(a){if(!a)return!1;const e=a.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function isSEIMessage(a,e){if(a){const s=e>>1&63;return s===39||s===40}else return(e&31)===6}function parseSEIMessageFromNALu(a,e,s,o){const c=discardEPB(a);let d=0;d+=e;let h=0,g=0,_=0;for(;d<c.length;){h=0;do{if(d>=c.length)break;_=c[d++],h+=_}while(_===255);g=0;do{if(d>=c.length)break;_=c[d++],g+=_}while(_===255);const b=c.length-d;let $=d;if(g<b)d+=g;else if(g>b){logger.error(`Malformed SEI payload. ${g} is too small, only ${b} bytes left to parse.`);break}if(h===4){if(c[$++]===181){const _e=readUint16(c,$);if($+=2,_e===49){const tt=readUint32(c,$);if($+=4,tt===1195456820){const rt=c[$++];if(rt===3){const nt=c[$++],st=31&nt,at=64&nt,ot=at?2+st*3:0,ut=new Uint8Array(ot);if(at){ut[0]=nt;for(let mt=1;mt<ot;mt++)ut[mt]=c[$++]}o.push({type:rt,payloadType:h,pts:s,bytes:ut})}}}}}else if(h===5&&g>16){const j=[];for(let rt=0;rt<16;rt++){const nt=c[$++].toString(16);j.push(nt.length==1?"0"+nt:nt),(rt===3||rt===5||rt===7||rt===9)&&j.push("-")}const _e=g-16,tt=new Uint8Array(_e);for(let rt=0;rt<_e;rt++)tt[rt]=c[$++];o.push({payloadType:h,pts:s,uuid:j.join(""),userData:utf8ArrayToStr(tt),userDataBytes:tt})}}}function discardEPB(a){const e=a.byteLength,s=[];let o=1;for(;o<e-2;)a[o]===0&&a[o+1]===0&&a[o+2]===3?(s.push(o+2),o+=2):o++;if(s.length===0)return a;const c=e-s.length,d=new Uint8Array(c);let h=0;for(o=0;o<c;h++,o++)h===s[0]&&(h++,s.shift()),d[o]=a[h];return d}function parseEmsg(a){const e=a[0];let s="",o="",c=0,d=0,h=0,g=0,_=0,b=0;if(e===0){for(;bin2str(a.subarray(b,b+1))!=="\0";)s+=bin2str(a.subarray(b,b+1)),b+=1;for(s+=bin2str(a.subarray(b,b+1)),b+=1;bin2str(a.subarray(b,b+1))!=="\0";)o+=bin2str(a.subarray(b,b+1)),b+=1;o+=bin2str(a.subarray(b,b+1)),b+=1,c=readUint32(a,12),d=readUint32(a,16),g=readUint32(a,20),_=readUint32(a,24),b=28}else if(e===1){b+=4,c=readUint32(a,b),b+=4;const j=readUint32(a,b);b+=4;const _e=readUint32(a,b);for(b+=4,h=2**32*j+_e,isSafeInteger(h)||(h=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),g=readUint32(a,b),b+=4,_=readUint32(a,b),b+=4;bin2str(a.subarray(b,b+1))!=="\0";)s+=bin2str(a.subarray(b,b+1)),b+=1;for(s+=bin2str(a.subarray(b,b+1)),b+=1;bin2str(a.subarray(b,b+1))!=="\0";)o+=bin2str(a.subarray(b,b+1)),b+=1;o+=bin2str(a.subarray(b,b+1)),b+=1}const $=a.subarray(b,a.byteLength);return{schemeIdUri:s,value:o,timeScale:c,presentationTime:h,presentationTimeDelta:d,eventDuration:g,id:_,payload:$}}function mp4Box(a,...e){const s=e.length;let o=8,c=s;for(;c--;)o+=e[c].byteLength;const d=new Uint8Array(o);for(d[0]=o>>24&255,d[1]=o>>16&255,d[2]=o>>8&255,d[3]=o&255,d.set(a,4),c=0,o=8;c<s;c++)d.set(e[c],o),o+=e[c].byteLength;return d}function mp4pssh(a,e,s){if(a.byteLength!==16)throw new RangeError("Invalid system id");let o,c;o=0,c=new Uint8Array;let d;o>0?(d=new Uint8Array(4),e.length>0&&new DataView(d.buffer).setUint32(0,e.length,!1)):d=new Uint8Array;const h=new Uint8Array(4);return s.byteLength>0&&new DataView(h.buffer).setUint32(0,s.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([o,0,0,0]),a,d,c,h,s)}function parseMultiPssh(a){const e=[];if(a instanceof ArrayBuffer){const s=a.byteLength;let o=0;for(;o+32<s;){const c=new DataView(a,o),d=parsePssh(c);e.push(d),o+=d.size}}return e}function parsePssh(a){const e=a.getUint32(0),s=a.byteOffset,o=a.byteLength;if(o<e)return{offset:s,size:o};if(a.getUint32(4)!==1886614376)return{offset:s,size:e};const d=a.getUint32(8)>>>24;if(d!==0&&d!==1)return{offset:s,size:e};const h=a.buffer,g=arrayToHex(new Uint8Array(h,s+12,16));let _=null,b=null,$=0;if(d===0)$=28;else{const _e=a.getUint32(28);if(!_e||o<32+_e*16)return{offset:s,size:e};_=[];for(let tt=0;tt<_e;tt++)_.push(new Uint8Array(h,s+32+tt*16,16));$=32+_e*16}if(!$)return{offset:s,size:e};const j=a.getUint32($);return e-32<j?{offset:s,size:e}:(b=new Uint8Array(h,s+$+4,j),{version:d,systemId:g,kids:_,data:b,offset:s,size:e})}const userAgentHevcSupportIsInaccurate=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(a,e){const s=sampleEntryCodesISO[e];return!!s&&!!s[a.slice(0,4)]}function areCodecsMediaSourceSupported(a,e,s=!0){return!a.split(",").some(o=>!isCodecMediaSourceSupported(o,e,s))}function isCodecMediaSourceSupported(a,e,s=!0){var o;const c=getMediaSource(s);return(o=c==null?void 0:c.isTypeSupported(mimeTypeForCodec(a,e)))!=null?o:!1}function mimeTypeForCodec(a,e){return`${e}/mp4;codecs=${a}`}function videoCodecPreferenceValue(a){if(a){const e=a.substring(0,4);return sampleEntryCodesISO.video[e]}return 2}function codecsSetSelectionPreferenceValue(a){const e=userAgentHevcSupportIsInaccurate();return a.split(",").reduce((s,o)=>{const d=e&&isHEVC(o)?9:sampleEntryCodesISO.video[o];return d?(d*2+s)/(s?3:2):(sampleEntryCodesISO.audio[o]+s)/(s?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(a,e=!0){if(CODEC_COMPATIBLE_NAMES[a])return CODEC_COMPATIBLE_NAMES[a];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a];for(let c=0;c<s.length;c++){var o;if(isCodecMediaSourceSupported(s[c],"audio",e))return CODEC_COMPATIBLE_NAMES[a]=s[c],s[c];if(s[c]==="mp3"&&(o=getMediaSource(e))!=null&&o.isTypeSupported("audio/mpeg"))return""}return a}const AUDIO_CODEC_REGEXP=/flac|opus|mp4a\.40\.34/i;function getCodecCompatibleName(a,e=!0){return a.replace(AUDIO_CODEC_REGEXP,s=>getCodecCompatibleNameLower(s.toLowerCase(),e))}function replaceVideoCodec(a,e){const s=[];if(a){const o=a.split(",");for(let c=0;c<o.length;c++)isCodecType(o[c],"video")||s.push(o[c])}return e&&s.push(e),s.join(",")}function pickMostCompleteCodecName(a,e){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1)&&(isCodecSupportedAsType(a,"audio")||isCodecSupportedAsType(a,"video")))return a;if(e){const s=e.split(",");if(s.length>1){if(a){for(let o=s.length;o--;)if(s[o].substring(0,4)===a.substring(0,4))return s[o]}return s[0]}}return e||a}function isCodecSupportedAsType(a,e){return isCodecType(a,e)&&isCodecMediaSourceSupported(a,e)}function convertAVC1ToAVCOTI(a){const e=a.split(",");for(let s=0;s<e.length;s++){const o=e[s].split(".");o.length>2&&o[0]==="avc1"&&(e[s]=`avc1.${parseInt(o[1]).toString(16)}${("000"+parseInt(o[2]).toString(16)).slice(-4)}`)}return e.join(",")}function fillInMissingAV01Params(a){if(a.startsWith("av01.")){const e=a.split("."),s=["0","111","01","01","01","0"];for(let o=e.length;o>4&&o<10;o++)e[o]=s[o-4];return e.join(".")}return a}function getM2TSSupportedAudioTypes(a){const e=getMediaSource(a)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function getCodecsForMimeType(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const supportedResult={supported:!0,powerEfficient:!0,smooth:!0},unsupportedResult={supported:!1,smooth:!1,powerEfficient:!1},SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[supportedResult]};function getUnsupportedResult(a,e){return{supported:!1,configurations:e,decodingInfoResults:[unsupportedResult],error:a}}function requiresMediaCapabilitiesDecodingInfo(a,e,s,o,c,d){const h=a.videoCodec,g=a.audioCodec?a.audioGroups:null,_=d==null?void 0:d.audioCodec,b=d==null?void 0:d.channels,$=b?parseInt(b):_?1/0:2;let j=null;if(g!=null&&g.length)try{g.length===1&&g[0]?j=e.groups[g[0]].channels:j=g.reduce((_e,tt)=>{if(tt){const rt=e.groups[tt];if(!rt)throw new Error(`Audio track group ${tt} not found`);Object.keys(rt.channels).forEach(nt=>{_e[nt]=(_e[nt]||0)+rt.channels[nt]})}return _e},{2:0})}catch{return!0}return h!==void 0&&(h.split(",").some(_e=>isHEVC(_e))||a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(o,30)||a.videoRange!=="SDR"&&a.videoRange!==s||a.bitrate>Math.max(c,8e6))||!!j&&isFiniteNumber($)&&Object.keys(j).some(_e=>parseInt(_e)>$)}function getMediaDecodingInfoPromise(a,e,s,o={}){const c=a.videoCodec;if(!c&&!a.audioCodec||!s)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const d=[],h=makeVideoConfigurations(a),g=h.length,_=makeAudioConfigurations(a,e,g>0),b=_.length;for(let $=g||1*b||1;$--;){const j={type:"media-source"};if(g&&(j.video=h[$%g]),b){j.audio=_[$%b];const _e=j.audio.bitrate;j.video&&_e&&(j.video.bitrate-=_e)}d.push(j)}if(c){const $=navigator.userAgent;if(c.split(",").some(j=>isHEVC(j))&&userAgentHevcSupportIsInaccurate())return Promise.resolve(getUnsupportedResult(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${$})`),d))}return Promise.all(d.map($=>{const j=getMediaDecodingInfoKey($);return o[j]||(o[j]=s.decodingInfo($))})).then($=>({supported:!$.some(j=>!j.supported),configurations:d,decodingInfoResults:$})).catch($=>({supported:!1,configurations:d,decodingInfoResults:[],error:$}))}function makeVideoConfigurations(a){var e;const s=(e=a.videoCodec)==null?void 0:e.split(","),o=getVariantDecodingBitrate(a),c=a.width||640,d=a.height||480,h=a.frameRate||30,g=a.videoRange.toLowerCase();return s?s.map(_=>{const b={contentType:mimeTypeForCodec(fillInMissingAV01Params(_),"video"),width:c,height:d,bitrate:o,framerate:h};return g!=="sdr"&&(b.transferFunction=g),b}):[]}function makeAudioConfigurations(a,e,s){var o;const c=(o=a.audioCodec)==null?void 0:o.split(","),d=getVariantDecodingBitrate(a);return c&&a.audioGroups?a.audioGroups.reduce((h,g)=>{var _;const b=g?(_=e.groups[g])==null?void 0:_.tracks:null;return b?b.reduce(($,j)=>{if(j.groupId===g){const _e=parseFloat(j.channels||"");c.forEach(tt=>{const rt={contentType:mimeTypeForCodec(tt,"audio"),bitrate:s?estimatedAudioBitrate(tt,d):d};_e&&(rt.channels=""+_e),$.push(rt)})}return $},h):h},[]):[]}function estimatedAudioBitrate(a,e){if(e<=1)return 1;let s=128e3;return a==="ec-3"?s=768e3:a==="ac-3"&&(s=64e4),Math.min(e/2,s)}function getVariantDecodingBitrate(a){return Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)/1e3)*1e3||1}function getMediaDecodingInfoKey(a){let e="";const{audio:s,video:o}=a;if(o){const c=getCodecsForMimeType(o.contentType);e+=`${c}_r${o.height}x${o.width}f${Math.ceil(o.framerate)}${o.transferFunction||"sd"}_${Math.ceil(o.bitrate/1e5)}`}if(s){const c=getCodecsForMimeType(s.contentType);e+=`${o?"_":""}${c}_c${s.channels}`}return e}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(a){return HdcpLevels.indexOf(a)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(a){return!!a&&VideoRangeValues.indexOf(a)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(a){const{canSkipUntil:e,canSkipDateRanges:s,age:o}=a,c=o<e/2;return e&&c?s?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(e,s,o){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=s,this.skip=o}addDirectives(e){const s=new self.URL(e);return this.msn!==void 0&&s.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&s.searchParams.set("_HLS_part",this.part.toString()),this.skip&&s.searchParams.set("_HLS_skip",this.skip),s.href}}class Level{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(o=>!!o).map(o=>o.substring(0,4)).join(","),"supplemental"in e){var s;this.supplemental=e.supplemental;const o=(s=e.supplemental)==null?void 0:s.videoCodec;o&&o!==e.videoCodec&&(this.codecSet+=`,${o.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return hasGroup(this._audioGroups,e)}hasSubtitleGroup(e){return hasGroup(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,s){if(s){if(e==="audio"){let o=this._audioGroups;o||(o=this._audioGroups=[]),o.indexOf(s)===-1&&o.push(s)}else if(e==="text"){let o=this._subtitleGroups;o||(o=this._subtitleGroups=[]),o.indexOf(s)===-1&&o.push(s)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function hasGroup(a,e){return!e||!a?!1:a.indexOf(e)!==-1}function isHdrSupported(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(a.media!==e.media)return a.matches===!0}return!1}function getVideoSelectionOptions(a,e){let s=!1,o=[];if(a&&(s=a!=="SDR",o=[a]),e){o=e.allowedVideoRanges||VideoRangeValues.slice(0);const c=o.join("")!=="SDR"&&!e.videoCodec;s=e.preferHDR!==void 0?e.preferHDR:c&&isHdrSupported(),s||(o=["SDR"])}return{preferHDR:s,allowedVideoRanges:o}}const omitCircularRefsReplacer=a=>{const e=new WeakSet;return(s,o)=>{if(a&&(o=a(s,o)),typeof o=="object"&&o!==null){if(e.has(o))return;e.add(o)}return o}},stringify=(a,e)=>JSON.stringify(a,omitCircularRefsReplacer(e));function getStartCodecTier(a,e,s,o,c){const d=Object.keys(a),h=o==null?void 0:o.channels,g=o==null?void 0:o.audioCodec,_=c==null?void 0:c.videoCodec,b=h&&parseInt(h)===2;let $=!1,j=!1,_e=1/0,tt=1/0,rt=1/0,nt=1/0,st=0,at=[];const{preferHDR:ot,allowedVideoRanges:ut}=getVideoSelectionOptions(e,c);for(let gt=d.length;gt--;){const St=a[d[gt]];$||($=St.channels[2]>0),_e=Math.min(_e,St.minHeight),tt=Math.min(tt,St.minFramerate),rt=Math.min(rt,St.minBitrate),ut.filter(Ct=>St.videoRanges[Ct]>0).length>0&&(j=!0)}_e=isFiniteNumber(_e)?_e:0,tt=isFiniteNumber(tt)?tt:0;const mt=Math.max(1080,_e),yt=Math.max(30,tt);rt=isFiniteNumber(rt)?rt:s,s=Math.max(rt,s),j||(e=void 0);const Et=d.length>1;return{codecSet:d.reduce((gt,St)=>{const xt=a[St];if(St===gt)return gt;if(at=j?ut.filter(Ct=>xt.videoRanges[Ct]>0):[],Et){if(xt.minBitrate>s)return logStartCodecCandidateIgnored(St,`min bitrate of ${xt.minBitrate} > current estimate of ${s}`),gt;if(!xt.hasDefaultAudio)return logStartCodecCandidateIgnored(St,"no renditions with default or auto-select sound found"),gt;if(g&&St.indexOf(g.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(St,`audio codec preference "${g}" not found`),gt;if(h&&!b){if(!xt.channels[h])return logStartCodecCandidateIgnored(St,`no renditions with ${h} channel sound found (channels options: ${Object.keys(xt.channels)})`),gt}else if((!g||b)&&$&&xt.channels[2]===0)return logStartCodecCandidateIgnored(St,"no renditions with stereo sound found"),gt;if(xt.minHeight>mt)return logStartCodecCandidateIgnored(St,`min resolution of ${xt.minHeight} > maximum of ${mt}`),gt;if(xt.minFramerate>yt)return logStartCodecCandidateIgnored(St,`min framerate of ${xt.minFramerate} > maximum of ${yt}`),gt;if(!at.some(Ct=>xt.videoRanges[Ct]>0))return logStartCodecCandidateIgnored(St,`no variants with VIDEO-RANGE of ${stringify(at)} found`),gt;if(_&&St.indexOf(_.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(St,`video codec preference "${_}" not found`),gt;if(xt.maxScore<st)return logStartCodecCandidateIgnored(St,`max score of ${xt.maxScore} < selected max of ${st}`),gt}return gt&&(codecsSetSelectionPreferenceValue(St)>=codecsSetSelectionPreferenceValue(gt)||xt.fragmentError>a[gt].fragmentError)?gt:(nt=xt.minIndex,st=xt.maxScore,St)},void 0),videoRanges:at,preferHDR:ot,minFramerate:tt,minBitrate:rt,minIndex:nt}}function logStartCodecCandidateIgnored(a,e){logger.log(`[abr] start candidates with "${a}" ignored because ${e}`)}function getAudioTracksByGroup(a){return a.reduce((e,s)=>{let o=e.groups[s.groupId];o||(o=e.groups[s.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),o.tracks.push(s);const c=s.channels||"2";return o.channels[c]=(o.channels[c]||0)+1,o.hasDefault=o.hasDefault||s.default,o.hasAutoSelect=o.hasAutoSelect||s.autoselect,o.hasDefault&&(e.hasDefaultAudio=!0),o.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(a,e,s,o){return a.slice(s,o+1).reduce((c,d,h)=>{if(!d.codecSet)return c;const g=d.audioGroups;let _=c[d.codecSet];_||(c[d.codecSet]=_={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:h,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!g,fragmentError:0}),_.minBitrate=Math.min(_.minBitrate,d.bitrate);const b=Math.min(d.height,d.width);return _.minHeight=Math.min(_.minHeight,b),_.minFramerate=Math.min(_.minFramerate,d.frameRate),_.minIndex=Math.min(_.minIndex,h),_.maxScore=Math.max(_.maxScore,d.score),_.fragmentError+=d.fragmentError,_.videoRanges[d.videoRange]=(_.videoRanges[d.videoRange]||0)+1,g&&g.forEach($=>{if(!$)return;const j=e.groups[$];j&&(_.hasDefaultAudio=_.hasDefaultAudio||e.hasDefaultAudio?j.hasDefault:j.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(j.channels).forEach(_e=>{_.channels[_e]=(_.channels[_e]||0)+j.channels[_e]}))}),c},{})}function getBasicSelectionOption(a){if(!a)return a;const{lang:e,assocLang:s,characteristics:o,channels:c,audioCodec:d}=a;return{lang:e,assocLang:s,characteristics:o,channels:c,audioCodec:d}}function findMatchingOption(a,e,s){if("attrs"in a){const o=e.indexOf(a);if(o!==-1)return o}for(let o=0;o<e.length;o++){const c=e[o];if(matchesOption(a,c,s))return o}return-1}function matchesOption(a,e,s){const{groupId:o,name:c,lang:d,assocLang:h,default:g}=a,_=a.forced;return(o===void 0||e.groupId===o)&&(c===void 0||e.name===c)&&(d===void 0||languagesMatch(d,e.lang))&&(d===void 0||e.assocLang===h)&&(g===void 0||e.default===g)&&(_===void 0||e.forced===_)&&(!("characteristics"in a)||characteristicsMatch(a.characteristics||"",e.characteristics))&&(s===void 0||s(a,e))}function languagesMatch(a,e="--"){return a.length===e.length?a===e:a.startsWith(e)||e.startsWith(a)}function characteristicsMatch(a,e=""){const s=a.split(","),o=e.split(",");return s.length===o.length&&!s.some(c=>o.indexOf(c)===-1)}function audioMatchPredicate(a,e){const{audioCodec:s,channels:o}=a;return(s===void 0||(e.audioCodec||"").substring(0,4)===s.substring(0,4))&&(o===void 0||o===(e.channels||"2"))}function findClosestLevelWithAudioGroup(a,e,s,o,c){const d=e[o],g=e.reduce((_e,tt,rt)=>{const nt=tt.uri;return(_e[nt]||(_e[nt]=[])).push(rt),_e},{})[d.uri];g.length>1&&(o=Math.max.apply(Math,g));const _=d.videoRange,b=d.frameRate,$=d.codecSet.substring(0,4),j=searchDownAndUpList(e,o,_e=>{if(_e.videoRange!==_||_e.frameRate!==b||_e.codecSet.substring(0,4)!==$)return!1;const tt=_e.audioGroups,rt=s.filter(nt=>!tt||tt.indexOf(nt.groupId)!==-1);return findMatchingOption(a,rt,c)>-1});return j>-1?j:searchDownAndUpList(e,o,_e=>{const tt=_e.audioGroups,rt=s.filter(nt=>!tt||tt.indexOf(nt.groupId)!==-1);return findMatchingOption(a,rt,c)>-1})}function searchDownAndUpList(a,e,s){for(let o=e;o>-1;o--)if(s(a[o]))return o;for(let o=e+1;o<a.length;o++)if(s(a[o]))return o;return-1}function useAlternateAudio(a,e){var s;return!!a&&a!==((s=e.loadLevelObj)==null?void 0:s.uri)}class AbrController extends Logger{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=s=>{var o;const{fragCurrent:c,partCurrent:d,hls:h}=this,{autoLevelEnabled:g,media:_}=h;if(!c||!_)return;const b=performance.now(),$=d?d.stats:c.stats,j=d?d.duration:c.duration,_e=b-$.loading.start,tt=h.minAutoLevel,rt=c.level,nt=this._nextAutoLevel;if($.aborted||$.loaded&&$.loaded===$.total||rt<=tt){this.clearTimer(),this._nextAutoLevel=-1;return}if(!g)return;const st=nt>-1&&nt!==rt,at=!!s||st;if(!at&&(_.paused||!_.playbackRate||!_.readyState))return;const ot=h.mainForwardBufferInfo;if(!at&&ot===null)return;const ut=this.bwEstimator.getEstimateTTFB(),mt=Math.abs(_.playbackRate);if(_e<=Math.max(ut,1e3*(j/(mt*2))))return;const yt=ot?ot.len/mt:0,Et=$.loading.first?$.loading.first-$.loading.start:-1,dt=$.loaded&&Et>-1,gt=this.getBwEstimate(),St=h.levels,xt=St[rt],Ct=Math.max($.loaded,Math.round(j*(c.bitrate||xt.averageBitrate)/8));let Ht=dt?_e-Et:_e;Ht<1&&dt&&(Ht=Math.min(_e,$.loaded*8/gt));const Dt=dt?$.loaded*1e3/Ht:0,rr=ut/1e3,er=Dt?(Ct-$.loaded)/Dt:Ct*8/gt+rr;if(er<=yt)return;const qt=Dt?Dt*8:gt,tr=((o=(s==null?void 0:s.details)||this.hls.latestLevelDetails)==null?void 0:o.live)===!0,Ft=this.hls.config.abrBandWidthUpFactor;let Yt=Number.POSITIVE_INFINITY,Qt;for(Qt=rt-1;Qt>tt;Qt--){const Er=St[Qt].maxBitrate,Sr=!St[Qt].details||tr;if(Yt=this.getTimeToLoadFrag(rr,qt,j*Er,Sr),Yt<Math.min(yt,j+rr))break}if(Yt>=er||Yt>j*10)return;dt?this.bwEstimator.sample(_e-Math.min(ut,Et),$.loaded):this.bwEstimator.sampleTTFB(_e);const zt=St[Qt].maxBitrate;this.getBwEstimate()*Ft>zt&&this.resetEstimator(zt);const Xt=this.findBestLevel(zt,tt,Qt,0,yt,1,1);Xt>-1&&(Qt=Xt),this.warn(`Fragment ${c.sn}${d?" part "+d.index:""} of level ${rt} is loading too slowly;
      Fragment duration: ${c.duration.toFixed(3)}
      Time to underbuffer: ${yt.toFixed(3)} s
      Estimated load time for current fragment: ${er.toFixed(3)} s
      Estimated load time for down switch fragment: ${Yt.toFixed(3)} s
      TTFB estimate: ${Et|0} ms
      Current BW estimate: ${isFiniteNumber(gt)?gt|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Qt} @ ${zt|0} bps`),h.nextLoadLevel=h.nextAutoLevel=Qt,this.clearTimer();const sr=()=>{if(this.clearTimer(),this.fragCurrent===c&&this.hls.loadLevel===Qt&&Qt>0){const Er=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Qt>0?"and switching down":""}
      Fragment duration: ${c.duration.toFixed(3)} s
      Time to underbuffer: ${Er.toFixed(3)} s`),c.abortRequests(),this.fragCurrent=this.partCurrent=null,Qt>tt){let Sr=this.findBestLevel(this.hls.levels[tt].bitrate,tt,Qt,0,Er,1,1);Sr===-1&&(Sr=tt),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Sr,this.resetEstimator(this.hls.levels[Sr].bitrate)}}};st||er>Yt*2?sr():this.timer=self.setInterval(sr,Yt*1e3),h.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,part:d,stats:$})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new EwmaBandWidthEstimator(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.FRAG_LOADING,this.onFragLoading,this),e.on(Events.FRAG_LOADED,this.onFragLoaded,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.FRAG_LOADING,this.onFragLoading,this),e.off(Events.FRAG_LOADED,this.onFragLoaded,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,s){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,s){const o=s.frag;if(!this.ignoreFragment(o)){if(!o.bitrateTest){var c;this.fragCurrent=o,this.partCurrent=(c=s.part)!=null?c:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,s){this.clearTimer()}onError(e,s){if(!s.fatal)switch(s.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const o=s.frag,{fragCurrent:c,partCurrent:d}=this;if(o&&c&&o.sn===c.sn&&o.level===c.level){const h=performance.now(),g=d?d.stats:o.stats,_=h-g.loading.start,b=g.loading.first?g.loading.first-g.loading.start:-1;if(g.loaded&&b>-1){const j=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(_-Math.min(j,b),g.loaded)}else this.bwEstimator.sampleTTFB(_)}break}}}getTimeToLoadFrag(e,s,o,c){const d=e+o/s,h=c?e+this.lastLevelLoadSec:0;return d+h}onLevelLoaded(e,s){const o=this.hls.config,{loading:c}=s.stats,d=c.end-c.first;isFiniteNumber(d)&&(this.lastLevelLoadSec=d/1e3),s.details.live?this.bwEstimator.update(o.abrEwmaSlowLive,o.abrEwmaFastLive):this.bwEstimator.update(o.abrEwmaSlowVoD,o.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(s.levelInfo)}onFragLoaded(e,{frag:s,part:o}){const c=o?o.stats:s.stats;if(s.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(c.loading.first-c.loading.start),!this.ignoreFragment(s)){if(this.clearTimer(),s.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const d=o?o.duration:s.duration,h=this.hls.levels[s.level],g=(h.loaded?h.loaded.bytes:0)+c.loaded,_=(h.loaded?h.loaded.duration:0)+d;h.loaded={bytes:g,duration:_},h.realBitrate=Math.round(8*g/_)}if(s.bitrateTest){const d={stats:c,frag:s,part:o,id:s.type};this.onFragBuffered(Events.FRAG_BUFFERED,d),s.bitrateTest=!1}else this.lastLoadedFragLevel=s.level}}onFragBuffered(e,s){const{frag:o,part:c}=s,d=c!=null&&c.stats.loaded?c.stats:o.stats;if(d.aborted||this.ignoreFragment(o))return;const h=d.parsing.end-d.loading.start-Math.min(d.loading.first-d.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(h,d.loaded),d.bwEstimate=this.getBwEstimate(),o.bitrateTest?this.bitrateTestDelay=h/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==PlaylistLevelType.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:s}=this.hls,o=this.getBwEstimate(),c=this.hls.config.maxStarvationDelay,d=this.findBestLevel(o,s,e,0,c,1,1);if(d>-1)return d;const h=this.hls.firstLevel,g=Math.min(Math.max(h,s),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${h} clamped to ${g}`),g}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,o=this.bwEstimator.canEstimate(),c=this.lastLoadedFragLevel>-1;if(e!==-1&&(!o||!c||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const d=o&&c?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const h=this.hls.levels;if(h.length>Math.max(e,d)&&h[e].loadError<=h[d].loadError)return e}return this._nextAutoLevel=d,this.nextAutoLevelKey=this.getAutoLevelKey(),d}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:s,hls:o}=this;if(o.levels.length<=1)return o.loadLevel;const{maxAutoLevel:c,config:d,minAutoLevel:h}=o,g=s?s.duration:e?e.duration:0,_=this.getBwEstimate(),b=this.getStarvationDelay();let $=d.abrBandWidthFactor,j=d.abrBandWidthUpFactor;if(b){const st=this.findBestLevel(_,h,c,b,0,$,j);if(st>=0)return this.rebufferNotice=-1,st}let _e=g?Math.min(g,d.maxStarvationDelay):d.maxStarvationDelay;if(!b){const st=this.bitrateTestDelay;st&&(_e=(g?Math.min(g,d.maxLoadingDelay):d.maxLoadingDelay)-st,this.info(`bitrate test took ${Math.round(1e3*st)}ms, set first fragment max fetchDuration to ${Math.round(1e3*_e)} ms`),$=j=1)}const tt=this.findBestLevel(_,h,c,b,_e,$,j);if(this.rebufferNotice!==tt&&(this.rebufferNotice=tt,this.info(`${b?"rebuffering expected":"buffer is empty"}, optimal quality level ${tt}`)),tt>-1)return tt;const rt=o.levels[h],nt=o.loadLevelObj;return nt&&(rt==null?void 0:rt.bitrate)<nt.bitrate?h:o.loadLevel}getStarvationDelay(){const e=this.hls,s=e.media;if(!s)return 1/0;const o=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,c=e.mainForwardBufferInfo;return(c?c.len:0)/o}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,s,o,c,d,h,g){var _;const b=c+d,$=this.lastLoadedFragLevel,j=$===-1?this.hls.firstLevel:$,{fragCurrent:_e,partCurrent:tt}=this,{levels:rt,allAudioTracks:nt,loadLevel:st,config:at}=this.hls;if(rt.length===1)return 0;const ot=rt[j],ut=!!((_=this.hls.latestLevelDetails)!=null&&_.live),mt=st===-1||$===-1;let yt,Et="SDR",dt=(ot==null?void 0:ot.frameRate)||0;const{audioPreference:gt,videoPreference:St}=at,xt=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(nt));let Ct=-1;if(mt){if(this.firstSelection!==-1)return this.firstSelection;const qt=this.codecTiers||(this.codecTiers=getCodecTiers(rt,xt,s,o)),tr=getStartCodecTier(qt,Et,e,gt,St),{codecSet:Ft,videoRanges:Yt,minFramerate:Qt,minBitrate:zt,minIndex:Xt,preferHDR:sr}=tr;Ct=Xt,yt=Ft,Et=sr?Yt[Yt.length-1]:Yt[0],dt=Qt,e=Math.max(e,zt),this.log(`picked start tier ${stringify(tr)}`)}else yt=ot==null?void 0:ot.codecSet,Et=ot==null?void 0:ot.videoRange;const Ht=tt?tt.duration:_e?_e.duration:0,Dt=this.bwEstimator.getEstimateTTFB()/1e3,rr=[];for(let qt=o;qt>=s;qt--){var er;const tr=rt[qt],Ft=qt>j;if(!tr)continue;if(at.useMediaCapabilities&&!tr.supportedResult&&!tr.supportedPromise){const Sr=navigator.mediaCapabilities;typeof(Sr==null?void 0:Sr.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(tr,xt,Et,dt,e,gt)?(tr.supportedPromise=getMediaDecodingInfoPromise(tr,xt,Sr,this.supportedCache),tr.supportedPromise.then(_r=>{if(!this.hls)return;tr.supportedResult=_r;const Fr=this.hls.levels,$r=Fr.indexOf(tr);_r.error?this.warn(`MediaCapabilities decodingInfo error: "${_r.error}" for level ${$r} ${stringify(_r)}`):_r.supported?_r.decodingInfoResults.some(yr=>yr.smooth===!1||yr.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${$r} not smooth or powerEfficient: ${stringify(_r)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${$r} ${stringify(_r)}`),$r>-1&&Fr.length>1&&(this.log(`Removing unsupported level ${$r}`),this.hls.removeLevel($r),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(_r=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${_r}`)})):tr.supportedResult=SUPPORTED_INFO_DEFAULT}if((yt&&tr.codecSet!==yt||Et&&tr.videoRange!==Et||Ft&&dt>tr.frameRate||!Ft&&dt>0&&dt<tr.frameRate||(er=tr.supportedResult)!=null&&(er=er.decodingInfoResults)!=null&&er.some(Sr=>Sr.smooth===!1))&&(!mt||qt!==Ct)){rr.push(qt);continue}const Yt=tr.details,Qt=(tt?Yt==null?void 0:Yt.partTarget:Yt==null?void 0:Yt.averagetargetduration)||Ht;let zt;Ft?zt=g*e:zt=h*e;const Xt=Ht&&c>=Ht*2&&d===0?tr.averageBitrate:tr.maxBitrate,sr=this.getTimeToLoadFrag(Dt,zt,Xt*Qt,Yt===void 0);if(zt>=Xt&&(qt===$||tr.loadError===0&&tr.fragmentError===0)&&(sr<=Dt||!isFiniteNumber(sr)||ut&&!this.bitrateTestDelay||sr<b)){const Sr=this.forcedAutoLevel;return qt!==st&&(Sr===-1||Sr!==st)&&(rr.length&&this.trace(`Skipped level(s) ${rr.join(",")} of ${o} max with CODECS and VIDEO-RANGE:"${rt[rr[0]].codecs}" ${rt[rr[0]].videoRange}; not compatible with "${yt}" ${Et}`),this.info(`switch candidate:${j}->${qt} adjustedbw(${Math.round(zt)})-bitrate=${Math.round(zt-Xt)} ttfb:${Dt.toFixed(1)} avgDuration:${Qt.toFixed(1)} maxFetchDuration:${b.toFixed(1)} fetchDuration:${sr.toFixed(1)} firstSelection:${mt} codecSet:${tr.codecSet} videoRange:${tr.videoRange} hls.loadLevel:${st}`)),mt&&(this.firstSelection=qt),qt}}return-1}set nextAutoLevel(e){const s=this.deriveNextAutoLevel(e);this._nextAutoLevel!==s&&(this.nextAutoLevelKey="",this._nextAutoLevel=s)}deriveNextAutoLevel(e){const{maxAutoLevel:s,minAutoLevel:o}=this.hls;return Math.min(Math.max(e,o),s)}}const BinarySearch={search:function(a,e){let s=0,o=a.length-1,c=null,d=null;for(;s<=o;){c=(s+o)/2|0,d=a[c];const h=e(d);if(h>0)s=c+1;else if(h<0)o=c-1;else return d}return null}};function findFragmentByPDT(a,e,s){if(e===null||!Array.isArray(a)||!a.length||!isFiniteNumber(e))return null;const o=a[0].programDateTime;if(e<(o||0))return null;const c=a[a.length-1].endProgramDateTime;if(e>=(c||0))return null;for(let d=0;d<a.length;++d){const h=a[d];if(pdtWithinToleranceTest(e,s,h))return h}return null}function findFragmentByPTS(a,e,s=0,o=0,c=.005){let d=null;if(a){d=e[1+a.sn-e[0].sn]||null;const g=a.endDTS-s;g>0&&g<15e-7&&(s+=15e-7),d&&a.level!==d.level&&d.end<=a.end&&(d=e[2+a.sn-e[0].sn]||null)}else s===0&&e[0].start===0&&(d=e[0]);if(d&&((!a||a.level===d.level)&&fragmentWithinToleranceTest(s,o,d)===0||fragmentWithinFastStartSwitch(d,a,Math.min(c,o))))return d;const h=BinarySearch.search(e,fragmentWithinToleranceTest.bind(null,s,o));return h&&(h!==a||!d)?h:d}function fragmentWithinFastStartSwitch(a,e,s){if(e&&e.start===0&&e.level<a.level&&(e.endPTS||0)>0){const o=e.tagList.reduce((c,d)=>(d[0]==="INF"&&(c+=parseFloat(d[1])),c),s);return a.start<=o}return!1}function fragmentWithinToleranceTest(a=0,e=0,s){if(s.start<=a&&s.start+s.duration>a)return 0;const o=Math.min(e,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-o<=a?1:s.start-o>a&&s.start?-1:0}function pdtWithinToleranceTest(a,e,s){const o=Math.min(e,s.duration+(s.deltaPTS?s.deltaPTS:0))*1e3;return(s.endProgramDateTime||0)-o>a}function findNearestWithCC(a,e,s){if(a&&a.startCC<=e&&a.endCC>=e){let o=a.fragments;const{fragmentHint:c}=a;c&&(o=o.concat(c));let d;return BinarySearch.search(o,h=>h.cc<e?1:h.cc>e?-1:(d=h,h.end<=s?1:h.start>s?-1:0)),d||null}return null}function isTimeoutError(a){switch(a.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function isKeyError(a){return a.details.startsWith("key")}function isUnusableKeyError(a){return isKeyError(a)&&!!a.frag&&!a.frag.decryptdata}function getRetryConfig(a,e){const s=isTimeoutError(e);return a.default[`${s?"timeout":"error"}Retry`]}function getRetryDelay(a,e){const s=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(s*a.retryDelayMs,a.maxRetryDelayMs)}function getLoaderConfigWithoutReties(a){return _objectSpread2(_objectSpread2({},a),{errorRetry:null,timeoutRetry:null})}function shouldRetry(a,e,s,o){if(!a)return!1;const c=o==null?void 0:o.code,d=e<a.maxNumRetry&&(retryForHttpStatus(c)||!!s);return a.shouldRetry?a.shouldRetry(a,e,s,o,d):d}function retryForHttpStatus(a){return offlineHttpStatus(a)||!!a&&(a<400||a>499)}function offlineHttpStatus(a){return a===0&&navigator.onLine===!1}var NetworkErrorAction={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class ErrorController extends Logger{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Events.ERROR,this.onError,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Events.ERROR,this.onError,this),e.off(Events.ERROR,this.onErrorOut,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===PlaylistLevelType.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const s=this.hls,o=s.currentLevel;return(e=s.loadLevelObj)!=null&&e.details||o===-1?s.loadLevel:o}variantHasKey(e,s){if(e){var o;if((o=e.details)!=null&&o.hasKey(s))return!0;const c=e.audioGroups;if(c)return this.hls.allAudioTracks.filter(h=>c.indexOf(h.groupId)>=0).some(h=>{var g;return(g=h.details)==null?void 0:g.hasKey(s)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,s){var o;if(s.fatal)return;const c=this.hls,d=s.context;switch(s.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:s.errorAction=this.getFragRetryOrSwitchAction(s);return;case ErrorDetails.FRAG_PARSING_ERROR:if((o=s.frag)!=null&&o.gap){s.errorAction=createDoNothingErrorAction();return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{s.errorAction=this.getFragRetryOrSwitchAction(s),s.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var h;const _=s.parent===PlaylistLevelType.MAIN?s.level:c.loadLevel;s.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((h=s.context)!=null&&(h=h.levelDetails)!=null&&h.live)?s.errorAction=this.getPlaylistRetryOrSwitchAction(s,_):(s.levelRetry=!1,s.errorAction=this.getLevelSwitchAction(s,_))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(d==null?void 0:d.level)=="number"&&(s.errorAction=this.getPlaylistRetryOrSwitchAction(s,d.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(d){const _=c.loadLevelObj;if(_&&(d.type===PlaylistContextType.AUDIO_TRACK&&_.hasAudioGroup(d.groupId)||d.type===PlaylistContextType.SUBTITLE_TRACK&&_.hasSubtitleGroup(d.groupId))){s.errorAction=this.getPlaylistRetryOrSwitchAction(s,c.loadLevel),s.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,s.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:s.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP};return;case ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED:case ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case ErrorDetails.KEY_SYSTEM_NO_SESSION:s.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingKey};return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:if(!s.errorAction){var g;s.errorAction=this.getLevelSwitchAction(s,(g=s.level)!=null?g:c.loadLevel)}return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:s.errorAction=createDoNothingErrorAction();return}s.type===ErrorTypes.KEY_SYSTEM_ERROR&&(s.levelRetry=!1,s.errorAction=createDoNothingErrorAction())}getPlaylistRetryOrSwitchAction(e,s){const o=this.hls,c=getRetryConfig(o.config.playlistLoadPolicy,e),d=this.playlistError++;if(shouldRetry(c,d,isTimeoutError(e),e.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:c,retryCount:d};const g=this.getLevelSwitchAction(e,s);return c&&(g.retryConfig=c,g.retryCount=d),g}getFragRetryOrSwitchAction(e){const s=this.hls,o=this.getVariantLevelIndex(e.frag),c=s.levels[o],{fragLoadPolicy:d,keyLoadPolicy:h}=s.config,g=getRetryConfig(isKeyError(e)?h:d,e),_=s.levels.reduce(($,j)=>$+j.fragmentError,0);if(c&&(e.details!==ErrorDetails.FRAG_GAP&&c.fragmentError++,!isUnusableKeyError(e)&&shouldRetry(g,_,isTimeoutError(e),e.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:g,retryCount:_};const b=this.getLevelSwitchAction(e,o);return g&&(b.retryConfig=g,b.retryCount=_),b}getLevelSwitchAction(e,s){const o=this.hls;s==null&&(s=o.loadLevel);const c=this.hls.levels[s];if(c){var d,h;const b=e.details;c.loadError++,b===ErrorDetails.BUFFER_APPEND_ERROR&&c.fragmentError++;let $=-1;const{levels:j,loadLevel:_e,minAutoLevel:tt,maxAutoLevel:rt}=o;!o.autoLevelEnabled&&!o.config.preserveManualLevelOnError&&(o.loadLevel=-1);const nt=(d=e.frag)==null?void 0:d.type,at=(nt===PlaylistLevelType.AUDIO&&b===ErrorDetails.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(b===ErrorDetails.BUFFER_ADD_CODEC_ERROR||b===ErrorDetails.BUFFER_APPEND_ERROR))&&j.some(({audioCodec:Et})=>c.audioCodec!==Et),ut=e.sourceBufferName==="video"&&(b===ErrorDetails.BUFFER_ADD_CODEC_ERROR||b===ErrorDetails.BUFFER_APPEND_ERROR)&&j.some(({codecSet:Et,audioCodec:dt})=>c.codecSet!==Et&&c.audioCodec===dt),{type:mt,groupId:yt}=(h=e.context)!=null?h:{};for(let Et=j.length;Et--;){const dt=(Et+_e)%j.length;if(dt!==_e&&dt>=tt&&dt<=rt&&j[dt].loadError===0){var g,_;const gt=j[dt];if(b===ErrorDetails.FRAG_GAP&&nt===PlaylistLevelType.MAIN&&e.frag){const St=j[dt].details;if(St){const xt=findFragmentByPTS(e.frag,St.fragments,e.frag.start);if(xt!=null&&xt.gap)continue}}else{if(mt===PlaylistContextType.AUDIO_TRACK&&gt.hasAudioGroup(yt)||mt===PlaylistContextType.SUBTITLE_TRACK&&gt.hasSubtitleGroup(yt))continue;if(nt===PlaylistLevelType.AUDIO&&(g=c.audioGroups)!=null&&g.some(St=>gt.hasAudioGroup(St))||nt===PlaylistLevelType.SUBTITLE&&(_=c.subtitleGroups)!=null&&_.some(St=>gt.hasSubtitleGroup(St))||at&&c.audioCodec===gt.audioCodec||ut&&c.codecSet===gt.codecSet||!at&&c.codecSet!==gt.codecSet)continue}$=dt;break}}if($>-1&&o.loadLevel!==$)return e.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:$}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(e,s){var o;switch((o=s.errorAction)==null?void 0:o.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(s),!s.errorAction.resolved&&s.details!==ErrorDetails.FRAG_GAP?s.fatal=!0:/MediaSource readyState: ended/.test(s.error.message)&&(this.warn(`MediaSource ended after "${s.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(s.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const s=this.hls,o=e.errorAction;if(!o)return;const{flags:c}=o,d=o.nextAutoLevel;switch(c){case ErrorActionFlags.None:this.switchLevel(e,d);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:{const _=this.getVariantLevelIndex(e.frag),b=s.levels[_],$=b==null?void 0:b.attrs["HDCP-LEVEL"];if(o.hdcpLevel=$,$==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if($){s.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf($)-1],o.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${s.maxHdcpLevel}" or lower`);break}}case ErrorActionFlags.MoveAllAlternatesMatchingKey:{const _=e.decryptdata;if(_){const b=this.hls.levels,$=b.length;for(let _e=$;_e--;)if(this.variantHasKey(b[_e],_)){var h,g;this.log(`Banned key found in level ${_e} (${b[_e].bitrate}bps) or audio group "${(h=b[_e].audioGroups)==null?void 0:h.join(",")}" (${(g=e.frag)==null?void 0:g.type} fragment) ${arrayToHex(_.keyId||[])}`),b[_e].fragmentError++,b[_e].loadError++,this.log(`Removing level ${_e} with key error (${e.error})`),this.hls.removeLevel(_e)}const j=e.frag;if(this.hls.levels.length<$)o.resolved=!0;else if(j&&j.type!==PlaylistLevelType.MAIN){const _e=j.decryptdata;_e&&!_.matches(_e)&&(o.resolved=!0)}}break}}o.resolved||this.switchLevel(e,d)}switchLevel(e,s){if(s!==void 0&&e.errorAction&&(this.warn(`switching to level ${s} after ${e.details}`),this.hls.nextAutoLevel=s,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===ErrorDetails.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const o=getCodecsForMimeType(e.mimeType),c=this.hls.levels;for(let d=c.length;d--;)c[d][`${e.sourceBufferName}Codec`]===o&&(this.log(`Removing level ${d} for ${e.details} ("${o}" not supported)`),this.hls.removeLevel(d))}}}function createDoNothingErrorAction(a){const e={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return a&&(e.resolved=!0),e}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Events.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Events.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,s){const o=this.activePartLists[s];if(o)for(let c=o.length;c--;){const d=o[c];if(!d)break;if(d.start<=e&&e<=d.end&&d.loaded)return d}return this.getBufferedFrag(e,s)}getBufferedFrag(e,s){return this.getFragAtPos(e,s,!0)}getFragAtPos(e,s,o){const{fragments:c}=this,d=Object.keys(c);for(let h=d.length;h--;){const g=c[d[h]];if((g==null?void 0:g.body.type)===s&&(!o||g.buffered)){const _=g.body;if(_.start<=e&&e<=_.end)return _}}return null}detectEvictedFragments(e,s,o,c,d){this.timeRanges&&(this.timeRanges[e]=s);const h=(c==null?void 0:c.fragment.sn)||-1;Object.keys(this.fragments).forEach(g=>{const _=this.fragments[g];if(!_||h>=_.body.sn)return;if(!_.buffered&&(!_.loaded||d)){_.body.type===o&&this.removeFragment(_.body);return}const b=_.range[e];if(b){if(b.time.length===0){this.removeFragment(_.body);return}b.time.some($=>{const j=!this.isTimeBuffered($.startPTS,$.endPTS,s);return j&&this.removeFragment(_.body),j})}})}detectPartialFragments(e){const s=this.timeRanges;if(!s||e.frag.sn==="initSegment")return;const o=e.frag,c=getFragmentKey(o),d=this.fragments[c];if(!d||d.buffered&&o.gap)return;const h=!o.relurl;Object.keys(s).forEach(g=>{const _=o.elementaryStreams[g];if(!_)return;const b=s[g],$=h||_.partial===!0;d.range[g]=this.getBufferedTimes(o,e.part,$,b)}),d.loaded=null,Object.keys(d.range).length?(this.bufferedEnd(d,o),isPartial(d)||this.removeParts(o.sn-1,o.type)):this.removeFragment(d.body)}bufferedEnd(e,s){e.buffered=!0,(e.body.endList=s.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,s){const o=this.activePartLists[s];o&&(this.activePartLists[s]=filterParts(o,c=>c.fragment.sn>=e))}fragBuffered(e,s){const o=getFragmentKey(e);let c=this.fragments[o];!c&&s&&(c=this.fragments[o]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),c&&(c.loaded=null,this.bufferedEnd(c,e))}getBufferedTimes(e,s,o,c){const d={time:[],partial:o},h=e.start,g=e.end,_=e.minEndPTS||g,b=e.maxStartPTS||h;for(let $=0;$<c.length;$++){const j=c.start($)-this.bufferPadding,_e=c.end($)+this.bufferPadding;if(b>=j&&_<=_e){d.time.push({startPTS:Math.max(h,c.start($)),endPTS:Math.min(g,c.end($))});break}else if(h<_e&&g>j){const tt=Math.max(h,c.start($)),rt=Math.min(g,c.end($));rt>tt&&(d.partial=!0,d.time.push({startPTS:tt,endPTS:rt}))}else if(g<=j)break}return d}getPartialFragment(e){let s=null,o,c,d,h=0;const{bufferPadding:g,fragments:_}=this;return Object.keys(_).forEach(b=>{const $=_[b];$&&isPartial($)&&(c=$.body.start-g,d=$.body.end+g,e>=c&&e<=d&&(o=Math.min(e-c,d-e),h<=o&&(s=$.body,h=o)))}),s}isEndListAppended(e){const s=this.endListFragments[e];return s!==void 0&&(s.buffered||isPartial(s))}getState(e){const s=getFragmentKey(e),o=this.fragments[s];return o?o.buffered?isPartial(o)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(e,s,o){let c,d;for(let h=0;h<o.length;h++){if(c=o.start(h)-this.bufferPadding,d=o.end(h)+this.bufferPadding,e>=c&&s<=d)return!0;if(s<=c)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,s){if(s.frag.sn==="initSegment"||s.frag.bitrateTest)return;const o=s.frag,c=s.part?null:s,d=getFragmentKey(o);this.fragments[d]={body:o,appendedPTS:null,loaded:c,buffered:!1,range:Object.create(null)}}onBufferAppended(e,s){const{frag:o,part:c,timeRanges:d,type:h}=s;if(o.sn==="initSegment")return;const g=o.type;if(c){let b=this.activePartLists[g];b||(this.activePartLists[g]=b=[]),b.push(c)}this.timeRanges=d;const _=d[h];this.detectEvictedFragments(h,_,g,c)}onFragBuffered(e,s){this.detectPartialFragments(s)}hasFragment(e){const s=getFragmentKey(e);return!!this.fragments[s]}hasFragments(e){const{fragments:s}=this,o=Object.keys(s);if(!e)return o.length>0;for(let c=o.length;c--;){const d=s[o[c]];if((d==null?void 0:d.body.type)===e)return!0}return!1}hasParts(e){var s;return!!((s=this.activePartLists[e])!=null&&s.length)}removeFragmentsInRange(e,s,o,c,d){c&&!this.hasGaps||Object.keys(this.fragments).forEach(h=>{const g=this.fragments[h];if(!g)return;const _=g.body;_.type!==o||c&&!_.gap||_.start<s&&_.end>e&&(g.buffered||d)&&this.removeFragment(_)})}removeFragment(e){const s=getFragmentKey(e);e.clearElementaryStreamInfo();const o=this.activePartLists[e.type];if(o){const c=e.sn;this.activePartLists[e.type]=filterParts(o,d=>d.fragment.sn!==c)}delete this.fragments[s],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;s&&s.forEach(o=>o.clearElementaryStreamInfo())}}function isPartial(a){var e,s,o;return a.buffered&&!!(a.body.gap||(e=a.range.video)!=null&&e.partial||(s=a.range.audio)!=null&&s.partial||(o=a.range.audiovideo)!=null&&o.partial)}function getFragmentKey(a){return`${a.type}_${a.level}_${a.sn}`}function filterParts(a,e){return a.filter(s=>{const o=e(s);return o||s.clearElementaryStreamInfo(),o})}var DecrypterAesMode={cbc:0,ctr:1};class AESCrypto{constructor(e,s,o){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=s,this.aesMode=o}decrypt(e,s){switch(this.aesMode){case DecrypterAesMode.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},s,e);case DecrypterAesMode.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},s,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function removePadding(a){const e=a.byteLength,s=e&&new DataView(a.buffer).getUint8(e-1);return s?a.slice(0,e-s):a}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const s=new DataView(e),o=new Uint32Array(4);for(let c=0;c<4;c++)o[c]=s.getUint32(c*4);return o}initTable(){const e=this.sBox,s=this.invSBox,o=this.subMix,c=o[0],d=o[1],h=o[2],g=o[3],_=this.invSubMix,b=_[0],$=_[1],j=_[2],_e=_[3],tt=new Uint32Array(256);let rt=0,nt=0,st=0;for(st=0;st<256;st++)st<128?tt[st]=st<<1:tt[st]=st<<1^283;for(st=0;st<256;st++){let at=nt^nt<<1^nt<<2^nt<<3^nt<<4;at=at>>>8^at&255^99,e[rt]=at,s[at]=rt;const ot=tt[rt],ut=tt[ot],mt=tt[ut];let yt=tt[at]*257^at*16843008;c[rt]=yt<<24|yt>>>8,d[rt]=yt<<16|yt>>>16,h[rt]=yt<<8|yt>>>24,g[rt]=yt,yt=mt*16843009^ut*65537^ot*257^rt*16843008,b[at]=yt<<24|yt>>>8,$[at]=yt<<16|yt>>>16,j[at]=yt<<8|yt>>>24,_e[at]=yt,rt?(rt=ot^tt[tt[tt[mt^ot]]],nt^=tt[tt[nt]]):rt=nt=1}}expandKey(e){const s=this.uint8ArrayToUint32Array_(e);let o=!0,c=0;for(;c<s.length&&o;)o=s[c]===this.key[c],c++;if(o)return;this.key=s;const d=this.keySize=s.length;if(d!==4&&d!==6&&d!==8)throw new Error("Invalid aes key size="+d);const h=this.ksRows=(d+6+1)*4;let g,_;const b=this.keySchedule=new Uint32Array(h),$=this.invKeySchedule=new Uint32Array(h),j=this.sBox,_e=this.rcon,tt=this.invSubMix,rt=tt[0],nt=tt[1],st=tt[2],at=tt[3];let ot,ut;for(g=0;g<h;g++){if(g<d){ot=b[g]=s[g];continue}ut=ot,g%d===0?(ut=ut<<8|ut>>>24,ut=j[ut>>>24]<<24|j[ut>>>16&255]<<16|j[ut>>>8&255]<<8|j[ut&255],ut^=_e[g/d|0]<<24):d>6&&g%d===4&&(ut=j[ut>>>24]<<24|j[ut>>>16&255]<<16|j[ut>>>8&255]<<8|j[ut&255]),b[g]=ot=(b[g-d]^ut)>>>0}for(_=0;_<h;_++)g=h-_,_&3?ut=b[g]:ut=b[g-4],_<4||g<=4?$[_]=ut:$[_]=rt[j[ut>>>24]]^nt[j[ut>>>16&255]]^st[j[ut>>>8&255]]^at[j[ut&255]],$[_]=$[_]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,s,o){const c=this.keySize+6,d=this.invKeySchedule,h=this.invSBox,g=this.invSubMix,_=g[0],b=g[1],$=g[2],j=g[3],_e=this.uint8ArrayToUint32Array_(o);let tt=_e[0],rt=_e[1],nt=_e[2],st=_e[3];const at=new Int32Array(e),ot=new Int32Array(at.length);let ut,mt,yt,Et,dt,gt,St,xt,Ct,Ht,Dt,rr,er,qt;const tr=this.networkToHostOrderSwap;for(;s<at.length;){for(Ct=tr(at[s]),Ht=tr(at[s+1]),Dt=tr(at[s+2]),rr=tr(at[s+3]),dt=Ct^d[0],gt=rr^d[1],St=Dt^d[2],xt=Ht^d[3],er=4,qt=1;qt<c;qt++)ut=_[dt>>>24]^b[gt>>16&255]^$[St>>8&255]^j[xt&255]^d[er],mt=_[gt>>>24]^b[St>>16&255]^$[xt>>8&255]^j[dt&255]^d[er+1],yt=_[St>>>24]^b[xt>>16&255]^$[dt>>8&255]^j[gt&255]^d[er+2],Et=_[xt>>>24]^b[dt>>16&255]^$[gt>>8&255]^j[St&255]^d[er+3],dt=ut,gt=mt,St=yt,xt=Et,er=er+4;ut=h[dt>>>24]<<24^h[gt>>16&255]<<16^h[St>>8&255]<<8^h[xt&255]^d[er],mt=h[gt>>>24]<<24^h[St>>16&255]<<16^h[xt>>8&255]<<8^h[dt&255]^d[er+1],yt=h[St>>>24]<<24^h[xt>>16&255]<<16^h[dt>>8&255]<<8^h[gt&255]^d[er+2],Et=h[xt>>>24]<<24^h[dt>>16&255]<<16^h[gt>>8&255]<<8^h[St&255]^d[er+3],ot[s]=tr(ut^tt),ot[s+1]=tr(Et^rt),ot[s+2]=tr(yt^nt),ot[s+3]=tr(mt^st),tt=Ct,rt=Ht,nt=Dt,st=rr,s=s+4}return ot.buffer}}class FastAESKey{constructor(e,s,o){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=s,this.aesMode=o}expandKey(){const e=getSubtleAlgoName(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function getSubtleAlgoName(a){switch(a){case DecrypterAesMode.cbc:return"AES-CBC";case DecrypterAesMode.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${a}`)}}const CHUNK_SIZE=16;class Decrypter{constructor(e,{removePKCS7Padding:s=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=s,s)try{const o=self.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:s}=this;if(!e||s)return this.reset(),null;const o=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?removePadding(o):o}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,s,o,c){return this.useSoftware?new Promise((d,h)=>{const g=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(g,s,o,c);const _=this.flush();_?d(_.buffer):h(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),s,o,c)}softwareDecrypt(e,s,o,c){const{currentIV:d,currentResult:h,remainderData:g}=this;if(c!==DecrypterAesMode.cbc||s.byteLength!==16)return logger.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),g&&(e=appendUint8Array(g,e),this.remainderData=null);const _=this.getValidChunk(e);if(!_.length)return null;d&&(o=d);let b=this.softwareDecrypter;b||(b=this.softwareDecrypter=new AESDecryptor),b.expandKey(s);const $=h;return this.currentResult=b.decrypt(_.buffer,0,o),this.currentIV=_.slice(-16).buffer,$||null}webCryptoDecrypt(e,s,o,c){if(this.key!==s||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,s,o,c));this.key=s,this.fastAesKey=new FastAESKey(this.subtle,s,c)}return this.fastAesKey.expandKey().then(d=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(this.subtle,new Uint8Array(o),c).decrypt(e.buffer,d)):Promise.reject(new Error("web crypto not initialized"))).catch(d=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${d.name}: ${d.message}`),this.onWebCryptoError(e,s,o,c)))}onWebCryptoError(e,s,o,c){const d=this.enableSoftwareAES;if(d){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,s,o,c);const h=this.flush();if(h)return h.buffer}throw new Error("WebCrypto"+(d?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let s=e;const o=e.length-e.length%CHUNK_SIZE;return o!==e.length&&(s=e.slice(0,o),this.remainderData=e.slice(o)),s}logOnce(e){this.logEnabled&&(logger.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,s){const o=e.url;if(!o)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${o?"part list":"url"}`),networkDetails:null}));this.abort();const c=this.config,d=c.fLoader,h=c.loader;return new Promise((g,_)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(rt=>rt[0]==="GAP")){_(createGapLoadError(e));return}else e.gap=!1;const b=this.loader=d?new d(c):new h(c),$=createLoaderContext(e);e.loader=b;const j=getLoaderConfigWithoutReties(c.fragLoadPolicy.default),_e={loadPolicy:j,timeout:j.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};e.stats=b.stats;const tt={onSuccess:(rt,nt,st,at)=>{this.resetLoader(e,b);let ot=rt.data;st.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(ot.slice(0,16)),ot=ot.slice(16)),g({frag:e,part:null,payload:ot,networkDetails:at})},onError:(rt,nt,st,at)=>{this.resetLoader(e,b),_(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:_objectSpread2({url:o,data:void 0},rt),error:new Error(`HTTP Error ${rt.code} ${rt.text}`),networkDetails:st,stats:at}))},onAbort:(rt,nt,st)=>{this.resetLoader(e,b),_(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:st,stats:rt}))},onTimeout:(rt,nt,st)=>{this.resetLoader(e,b),_(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${_e.timeout}ms`),networkDetails:st,stats:rt}))}};s&&(tt.onProgress=(rt,nt,st,at)=>s({frag:e,part:null,payload:st,networkDetails:at})),b.load($,_e,tt)})}loadPart(e,s,o){this.abort();const c=this.config,d=c.fLoader,h=c.loader;return new Promise((g,_)=>{if(this.loader&&this.loader.destroy(),e.gap||s.gap){_(createGapLoadError(e,s));return}const b=this.loader=d?new d(c):new h(c),$=createLoaderContext(e,s);e.loader=b;const j=getLoaderConfigWithoutReties(c.fragLoadPolicy.default),_e={loadPolicy:j,timeout:j.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};s.stats=b.stats,b.load($,_e,{onSuccess:(tt,rt,nt,st)=>{this.resetLoader(e,b),this.updateStatsFromPart(e,s);const at={frag:e,part:s,payload:tt.data,networkDetails:st};o(at),g(at)},onError:(tt,rt,nt,st)=>{this.resetLoader(e,b),_(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:s,response:_objectSpread2({url:$.url,data:void 0},tt),error:new Error(`HTTP Error ${tt.code} ${tt.text}`),networkDetails:nt,stats:st}))},onAbort:(tt,rt,nt)=>{e.stats.aborted=s.stats.aborted,this.resetLoader(e,b),_(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:s,error:new Error("Aborted"),networkDetails:nt,stats:tt}))},onTimeout:(tt,rt,nt)=>{this.resetLoader(e,b),_(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:s,error:new Error(`Timeout after ${_e.timeout}ms`),networkDetails:nt,stats:tt}))}})})}updateStatsFromPart(e,s){const o=e.stats,c=s.stats,d=c.total;if(o.loaded+=c.loaded,d){const _=Math.round(e.duration/s.duration),b=Math.min(Math.round(o.loaded/d),_),j=(_-b)*Math.round(o.loaded/b);o.total=o.loaded+j}else o.total=Math.max(o.loaded,o.total);const h=o.loading,g=c.loading;h.start?h.first+=g.first-g.start:(h.start=g.start,h.first=g.first),h.end=g.end}resetLoader(e,s){e.loader=null,this.loader===s&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),s.destroy()}}function createLoaderContext(a,e=null){const s=e||a,o={frag:a,part:e,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},c=s.byteRangeStartOffset,d=s.byteRangeEndOffset;if(isFiniteNumber(c)&&isFiniteNumber(d)){var h;let g=c,_=d;if(a.sn==="initSegment"&&isMethodFullSegmentAesCbc((h=a.decryptdata)==null?void 0:h.method)){const b=d-c;b%16&&(_=d+(16-b%16)),c!==0&&(o.resetIV=!0,g=c-16)}o.rangeStart=g,o.rangeEnd=_}return o}function createGapLoadError(a,e){const s=new Error(`GAP ${a.gap?"tag":"attribute"} found`),o={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:a,error:s,networkDetails:null};return e&&(o.part=e),(e||a).stats.aborted=!0,new LoadError(o)}function isMethodFullSegmentAesCbc(a){return a==="AES-128"||a==="AES-256"}class LoadError extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class TaskLoop extends Logger{constructor(e,s){super(e,s),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ChunkMetadata{constructor(e,s,o,c=0,d=-1,h=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=e,this.sn=s,this.id=o,this.size=c,this.part=d,this.partial=h}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(e,s){if(e){const o=BufferHelper.getBuffered(e);for(let c=o.length;c--;)if(s>=o.start(c)&&s<=o.end(c))return!0}return!1}static bufferedRanges(e){if(e){const s=BufferHelper.getBuffered(e);return BufferHelper.timeRangesToArray(s)}return[]}static timeRangesToArray(e){const s=[];for(let o=0;o<e.length;o++)s.push({start:e.start(o),end:e.end(o)});return s}static bufferInfo(e,s,o){if(e){const c=BufferHelper.bufferedRanges(e);if(c.length)return BufferHelper.bufferedInfo(c,s,o)}return{len:0,start:s,end:s,bufferedIndex:-1}}static bufferedInfo(e,s,o){s=Math.max(0,s),e.length>1&&e.sort(($,j)=>$.start-j.start||j.end-$.end);let c=-1,d=[];if(o)for(let $=0;$<e.length;$++){s>=e[$].start&&s<=e[$].end&&(c=$);const j=d.length;if(j){const _e=d[j-1].end;e[$].start-_e<o?e[$].end>_e&&(d[j-1].end=e[$].end):d.push(e[$])}else d.push(e[$])}else d=e;let h=0,g,_=s,b=s;for(let $=0;$<d.length;$++){const j=d[$].start,_e=d[$].end;if(c===-1&&s>=j&&s<=_e&&(c=$),s+o>=j&&s<_e)_=j,b=_e,h=b-s;else if(s+o<j){g=j;break}}return{len:h,start:_||0,end:b||0,nextStart:g,buffered:e,bufferedIndex:c}}static getBuffered(e){try{return e.buffered||noopBuffered}catch(s){return logger.log("failed to get media.buffered",s),noopBuffered}}}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(a){return VARIABLE_REPLACEMENT_REGEX.test(a)}function substituteVariables(a,e){if(a.variableList!==null||a.hasVariableRefs){const s=a.variableList;return e.replace(VARIABLE_REPLACEMENT_REGEX,o=>{const c=o.substring(2,o.length-1),d=s==null?void 0:s[c];return d===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${c}"`)),o):d})}return e}function addVariableDefinition(a,e,s){let o=a.variableList;o||(a.variableList=o={});let c,d;if("QUERYPARAM"in e){c=e.QUERYPARAM;try{const h=new self.URL(s).searchParams;if(h.has(c))d=h.get(c);else throw new Error(`"${c}" does not match any query parameter in URI: "${s}"`)}catch(h){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${h.message}`))}}else c=e.NAME,d=e.VALUE;c in o?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${c}"`)):o[c]=d||""}function importVariableDefinition(a,e,s){const o=e.IMPORT;if(s&&o in s){let c=a.variableList;c||(a.variableList=c={}),c[o]=s[o]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${o}"`))}const DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(e,s){typeof e=="string"&&(e=AttrList.parseAttrList(e,s)),_extends(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const s=parseInt(this[e],10);return s>Number.MAX_SAFE_INTEGER?1/0:s}hexadecimalInteger(e){if(this[e]){let s=(this[e]||"0x").slice(2);s=(s.length&1?"0":"")+s;const o=new Uint8Array(s.length/2);for(let c=0;c<s.length/2;c++)o[c]=parseInt(s.slice(c*2,c*2+2),16);return o}return null}hexadecimalIntegerAsNumber(e){const s=parseInt(this[e],16);return s>Number.MAX_SAFE_INTEGER?1/0:s}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,s){const o=this[e];return o?parseFloat(o):s}enumeratedString(e){return this[e]}enumeratedStringList(e,s){const o=this[e];return(o?o.split(/[ ,]+/):[]).reduce((c,d)=>(c[d.toLowerCase()]=!0,c),s)}bool(e){return this[e]==="YES"}decimalResolution(e){const s=DECIMAL_RESOLUTION_REGEX.exec(this[e]);if(s!==null)return{width:parseInt(s[1],10),height:parseInt(s[2],10)}}static parseAttrList(e,s){let o;const c={},d='"';for(ATTR_LIST_REGEX.lastIndex=0;(o=ATTR_LIST_REGEX.exec(e))!==null;){const h=o[1].trim();let g=o[2];const _=g.indexOf(d)===0&&g.lastIndexOf(d)===g.length-1;let b=!1;if(_)g=g.slice(1,-1);else switch(h){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":b=!0}if(s&&(_||b))g=substituteVariables(s,g);else if(!b&&!_)switch(h){case"CLOSED-CAPTIONS":if(g==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":logger.warn(`${e}: attribute ${h} is missing quotes`)}c[h]=g}return c}}const CLASS_INTERSTITIAL="com.apple.hls.interstitial";function isDateRangeCueAttribute(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function isSCTE35Attribute(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}class DateRange{constructor(e,s,o=0){var c;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(s==null?void 0:s.tagAnchor)||null,this.tagOrder=(c=s==null?void 0:s.tagOrder)!=null?c:o,s){const d=s.attr;for(const h in d)if(Object.prototype.hasOwnProperty.call(e,h)&&e[h]!==d[h]){logger.warn(`DATERANGE tag attribute: "${h}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=h;break}e=_extends(new AttrList({}),d,e)}if(this.attr=e,s?(this._startDate=s._startDate,this._cue=s._cue,this._endDate=s._endDate,this._dateAtEnd=s._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const d=(s==null?void 0:s.endDate)||new Date(this.attr["END-DATE"]);isFiniteNumber(d.getTime())&&(this._endDate=d)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(logger.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const s=this.duration;return s!==null?this._dateAtEnd=new Date(this._startDate.getTime()+s*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===CLASS_INTERSTITIAL}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const s=this.lastPartSn-e.lastPartSn,o=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!o||!!s||!this.live,this.advanced=this.endSN>e.endSN||s>0||s===0&&o>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(s=>{let o=s.decryptdata;return o||(s.setKeyFormat(e.keyFormat),o=s.decryptdata),!!o&&e.matches(o)})}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const s=this.lastPartIndex;if(s!==-1){for(let o=e.length;o--;)if(e[o].index>s)return e[o].index;return s}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function arrayValuesMatch(a,e){return a.length===e.length?!a.some((s,o)=>s!==e[o]):!1}function optionalArrayValuesMatch(a,e){return!a&&!e?!0:!a||!e?!1:arrayValuesMatch(a,e)}function isFullSegmentEncryption(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function getAesModeFromFullSegmentMethod(a){switch(a){case"AES-128":case"AES-256":return DecrypterAesMode.cbc;case"AES-256-CTR":return DecrypterAesMode.ctr;default:throw new Error(`invalid full segment method ${a}`)}}function base64Decode(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function strToUtf8array(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}function getKeyIdBytes(a){const e=strToUtf8array(a).subarray(0,16),s=new Uint8Array(16);return s.set(e,16-e.length),s}function changeEndianness(a){const e=function(o,c,d){const h=o[c];o[c]=o[d],o[d]=h};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function convertDataUriToArrayBytes(a){const e=a.split(":");let s=null;if(e[0]==="data"&&e.length===2){const o=e[1].split(";"),c=o[o.length-1].split(",");if(c.length===2){const d=c[0]==="base64",h=c[1];d?(o.splice(-1,1),s=base64Decode(h)):s=getKeyIdBytes(h)}}return s}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(a){switch(a){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}function keySystemDomainToKeySystemFormat(a){switch(a){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(a){const{drmSystems:e,widevineLicenseUrl:s}=a,o=e?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(c=>!!e[c]):[];return!o[KeySystems.WIDEVINE]&&s&&o.push(KeySystems.WIDEVINE),o}const requestMediaKeySystemAccess=function(a){return optionalSelf!=null&&(a=optionalSelf.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(a,e,s,o){let c;switch(a){case KeySystems.FAIRPLAY:c=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:c=["cenc"];break;case KeySystems.CLEARKEY:c=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return createMediaKeySystemConfigurations(c,e,s,o)}function createMediaKeySystemConfigurations(a,e,s,o){return[{initDataTypes:a,persistentState:o.persistentState||"optional",distinctiveIdentifier:o.distinctiveIdentifier||"optional",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:e.map(d=>({contentType:`audio/mp4; codecs=${d}`,robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null})),videoCapabilities:s.map(d=>({contentType:`video/mp4; codecs=${d}`,robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}))}]}function isPersistentSessionType(a){var e;return!!a&&(a.sessionType==="persistent-license"||!!((e=a.sessionTypes)!=null&&e.some(s=>s==="persistent-license")))}function parsePlayReadyWRM(a){const e=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),s=String.fromCharCode.apply(null,Array.from(e)),o=s.substring(s.indexOf("<"),s.length),h=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(h){const g=h.childNodes[0]?h.childNodes[0].nodeValue:h.getAttribute("VALUE");if(g){const _=base64Decode(g).subarray(0,16);return changeEndianness(_),_}}return null}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}static setKeyIdForUri(e,s){keyUriToKeyIdMap[e]=s}static addKeyIdForUri(e){const s=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER,o=new Uint8Array(16);return new DataView(o.buffer,12,4).setUint32(0,s),keyUriToKeyIdMap[e]=o,o}constructor(e,s,o,c=[1],d=null,h){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=s,this.keyFormat=o,this.keyFormatVersions=c,this.iv=d,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!isFullSegmentEncryption(e),h!=null&&h.startsWith("0x")&&(this.keyId=new Uint8Array(hexToArrayBuffer(h)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&arrayValuesMatch(e.keyFormatVersions,this.keyFormatVersions)&&optionalArrayValuesMatch(e.iv,this.iv)&&optionalArrayValuesMatch(e.keyId,this.keyId)}isSupported(){if(this.method){if(isFullSegmentEncryption(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,s){if(!this.encrypted||!this.uri)return null;if(isFullSegmentEncryption(this.method)){let d=this.iv;return d||(typeof e!="number"&&(logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),d=createInitializationVector(e)),new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,d)}if(this.keyId){const d=keyUriToKeyIdMap[this.uri];if(d&&!arrayValuesMatch(this.keyId,d)&&LevelKey.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const o=convertDataUriToArrayBytes(this.uri);if(o)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:if(this.pssh=o,!this.keyId){const d=parseMultiPssh(o.buffer);if(d.length){var c;const h=d[0];this.keyId=(c=h.kids)!=null&&c.length?h.kids[0]:null}}this.keyId||(this.keyId=getKeyIdFromPlayReadyKey(s));break;case KeySystemFormats.PLAYREADY:{const d=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(d,null,o),this.keyId=parsePlayReadyWRM(o);break}default:{let d=o.subarray(0,16);if(d.length!==16){const h=new Uint8Array(16);h.set(d,16-d.length),d=h}this.keyId=d;break}}if(!this.keyId||this.keyId.byteLength!==16){let d;d=getKeyIdFromWidevineKey(s),d||(d=getKeyIdFromPlayReadyKey(s),d||(d=keyUriToKeyIdMap[this.uri])),d&&(this.keyId=d,LevelKey.setKeyIdForUri(this.uri,d))}return this}}function getKeyIdFromWidevineKey(a){const e=a==null?void 0:a[KeySystemFormats.WIDEVINE];return e?e.keyId:null}function getKeyIdFromPlayReadyKey(a){const e=a==null?void 0:a[KeySystemFormats.PLAYREADY];if(e){const s=convertDataUriToArrayBytes(e.uri);if(s)return parsePlayReadyWRM(s)}return null}function createInitializationVector(a){const e=new Uint8Array(16);for(let s=12;s<16;s++)e[s]=a>>8*(15-s)&255;return e}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(e,s){for(let o=0;o<e.length;o++){const c=e[o];if(c.id===s)return c}}static resolve(e,s){return urlToolkitExports.buildAbsoluteURL(s,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return IS_MEDIA_PLAYLIST.test(e)}static parseMasterPlaylist(e,s){const o=hasVariableReferences(e),c={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:o},d=[];if(MASTER_PLAYLIST_REGEX.lastIndex=0,!e.startsWith("#EXTM3U"))return c.playlistParsingError=new Error("no EXTM3U delimiter"),c;let h;for(;(h=MASTER_PLAYLIST_REGEX.exec(e))!=null;)if(h[1]){var g;const b=new AttrList(h[1],c),$=substituteVariables(c,h[2]),j={attrs:b,bitrate:b.decimalInteger("BANDWIDTH")||b.decimalInteger("AVERAGE-BANDWIDTH"),name:b.NAME,url:M3U8Parser.resolve($,s)},_e=b.decimalResolution("RESOLUTION");_e&&(j.width=_e.width,j.height=_e.height),setCodecs(b.CODECS,j);const tt=b["SUPPLEMENTAL-CODECS"];tt&&(j.supplemental={},setCodecs(tt,j.supplemental)),(g=j.unknownCodecs)!=null&&g.length||d.push(j),c.levels.push(j)}else if(h[3]){const b=h[3],$=h[4];switch(b){case"SESSION-DATA":{const j=new AttrList($,c),_e=j["DATA-ID"];_e&&(c.sessionData===null&&(c.sessionData={}),c.sessionData[_e]=j);break}case"SESSION-KEY":{const j=parseKey($,s,c);j.encrypted&&j.isSupported()?(c.sessionKeys===null&&(c.sessionKeys=[]),c.sessionKeys.push(j)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${$}"`);break}case"DEFINE":{{const j=new AttrList($,c);addVariableDefinition(c,j,s)}break}case"CONTENT-STEERING":{const j=new AttrList($,c);c.contentSteering={uri:M3U8Parser.resolve(j["SERVER-URI"],s),pathwayId:j["PATHWAY-ID"]||"."};break}case"START":{c.startTimeOffset=parseStartTimeOffset($);break}}}const _=d.length>0&&d.length<c.levels.length;return c.levels=_?d:c.levels,c.levels.length===0&&(c.playlistParsingError=new Error("no levels found in manifest")),c}static parseMasterPlaylistMedia(e,s,o){let c;const d={},h=o.levels,g={AUDIO:h.map(b=>({id:b.attrs.AUDIO,audioCodec:b.audioCodec})),SUBTITLES:h.map(b=>({id:b.attrs.SUBTITLES,textCodec:b.textCodec})),"CLOSED-CAPTIONS":[]};let _=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(c=MASTER_PLAYLIST_MEDIA_REGEX.exec(e))!==null;){const b=new AttrList(c[1],o),$=b.TYPE;if($){const j=g[$],_e=d[$]||[];d[$]=_e;const tt=b.LANGUAGE,rt=b["ASSOC-LANGUAGE"],nt=b.CHANNELS,st=b.CHARACTERISTICS,at=b["INSTREAM-ID"],ot={attrs:b,bitrate:0,id:_++,groupId:b["GROUP-ID"]||"",name:b.NAME||tt||"",type:$,default:b.bool("DEFAULT"),autoselect:b.bool("AUTOSELECT"),forced:b.bool("FORCED"),lang:tt,url:b.URI?M3U8Parser.resolve(b.URI,s):""};if(rt&&(ot.assocLang=rt),nt&&(ot.channels=nt),st&&(ot.characteristics=st),at&&(ot.instreamId=at),j!=null&&j.length){const ut=M3U8Parser.findGroup(j,ot.groupId)||j[0];assignCodec(ot,ut,"audioCodec"),assignCodec(ot,ut,"textCodec")}_e.push(ot)}}return d}static parseLevelPlaylist(e,s,o,c,d,h){var g;const _={url:s},b=new LevelDetails(s),$=b.fragments,j=[];let _e=null,tt=0,rt=0,nt=0,st=0,at=0,ot=null,ut=new Fragment(c,_),mt,yt,Et,dt=-1,gt=!1,St=null,xt;if(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,b.m3u8=e,b.hasVariableRefs=hasVariableReferences(e),((g=LEVEL_PLAYLIST_REGEX_FAST.exec(e))==null?void 0:g[0])!=="#EXTM3U")return b.playlistParsingError=new Error("Missing format identifier #EXTM3U"),b;for(;(mt=LEVEL_PLAYLIST_REGEX_FAST.exec(e))!==null;){gt&&(gt=!1,ut=new Fragment(c,_),ut.playlistOffset=nt,ut.setStart(nt),ut.sn=tt,ut.cc=st,at&&(ut.bitrate=at),ut.level=o,_e&&(ut.initSegment=_e,_e.rawProgramDateTime&&(ut.rawProgramDateTime=_e.rawProgramDateTime,_e.rawProgramDateTime=null),St&&(ut.setByteRange(St),St=null)));const rr=mt[1];if(rr){ut.duration=parseFloat(rr);const er=(" "+mt[2]).slice(1);ut.title=er||null,ut.tagList.push(er?["INF",rr,er]:["INF",rr])}else if(mt[3]){if(isFiniteNumber(ut.duration)){ut.playlistOffset=nt,ut.setStart(nt),Et&&setFragLevelKeys(ut,Et,b),ut.sn=tt,ut.level=o,ut.cc=st,$.push(ut);const er=(" "+mt[3]).slice(1);ut.relurl=substituteVariables(b,er),assignProgramDateTime(ut,ot,j),ot=ut,nt+=ut.duration,tt++,rt=0,gt=!0}}else{if(mt=mt[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!mt){logger.warn("No matches on slow regex match for level playlist!");continue}for(yt=1;yt<mt.length&&mt[yt]===void 0;yt++);const er=(" "+mt[yt]).slice(1),qt=(" "+mt[yt+1]).slice(1),tr=mt[yt+2]?(" "+mt[yt+2]).slice(1):null;switch(er){case"BYTERANGE":ot?ut.setByteRange(qt,ot):ut.setByteRange(qt);break;case"PROGRAM-DATE-TIME":ut.rawProgramDateTime=qt,ut.tagList.push(["PROGRAM-DATE-TIME",qt]),dt===-1&&(dt=$.length);break;case"PLAYLIST-TYPE":b.type&&assignMultipleMediaPlaylistTagOccuranceError(b,er,mt),b.type=qt.toUpperCase();break;case"MEDIA-SEQUENCE":b.startSN!==0?assignMultipleMediaPlaylistTagOccuranceError(b,er,mt):$.length>0&&assignMustAppearBeforeSegmentsError(b,er,mt),tt=b.startSN=parseInt(qt);break;case"SKIP":{b.skippedSegments&&assignMultipleMediaPlaylistTagOccuranceError(b,er,mt);const Ft=new AttrList(qt,b),Yt=Ft.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(Yt)){b.skippedSegments+=Yt;for(let zt=Yt;zt--;)$.push(null);tt+=Yt}const Qt=Ft.enumeratedString("RECENTLY-REMOVED-DATERANGES");Qt&&(b.recentlyRemovedDateranges=(b.recentlyRemovedDateranges||[]).concat(Qt.split("	")));break}case"TARGETDURATION":b.targetduration!==0&&assignMultipleMediaPlaylistTagOccuranceError(b,er,mt),b.targetduration=Math.max(parseInt(qt),1);break;case"VERSION":b.version!==null&&assignMultipleMediaPlaylistTagOccuranceError(b,er,mt),b.version=parseInt(qt);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":b.live||assignMultipleMediaPlaylistTagOccuranceError(b,er,mt),b.live=!1;break;case"#":(qt||tr)&&ut.tagList.push(tr?[qt,tr]:[qt]);break;case"DISCONTINUITY":st++,ut.tagList.push(["DIS"]);break;case"GAP":ut.gap=!0,ut.tagList.push([er]);break;case"BITRATE":ut.tagList.push([er,qt]),at=parseInt(qt)*1e3,isFiniteNumber(at)?ut.bitrate=at:at=0;break;case"DATERANGE":{const Ft=new AttrList(qt,b),Yt=new DateRange(Ft,b.dateRanges[Ft.ID],b.dateRangeTagCount);b.dateRangeTagCount++,Yt.isValid||b.skippedSegments?b.dateRanges[Yt.id]=Yt:logger.warn(`Ignoring invalid DATERANGE tag: "${qt}"`),ut.tagList.push(["EXT-X-DATERANGE",qt]);break}case"DEFINE":{{const Ft=new AttrList(qt,b);"IMPORT"in Ft?importVariableDefinition(b,Ft,h):addVariableDefinition(b,Ft,s)}break}case"DISCONTINUITY-SEQUENCE":b.startCC!==0?assignMultipleMediaPlaylistTagOccuranceError(b,er,mt):$.length>0&&assignMustAppearBeforeSegmentsError(b,er,mt),b.startCC=st=parseInt(qt);break;case"KEY":{const Ft=parseKey(qt,s,b);if(Ft.isSupported()){if(Ft.method==="NONE"){Et=void 0;break}Et||(Et={});const Yt=Et[Ft.keyFormat];Yt!=null&&Yt.matches(Ft)||(Yt&&(Et=_extends({},Et)),Et[Ft.keyFormat]=Ft)}else logger.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${qt}"`);break}case"START":b.startTimeOffset=parseStartTimeOffset(qt);break;case"MAP":{const Ft=new AttrList(qt,b);if(ut.duration){const Yt=new Fragment(c,_);setInitSegment(Yt,Ft,o,Et),_e=Yt,ut.initSegment=_e,_e.rawProgramDateTime&&!ut.rawProgramDateTime&&(ut.rawProgramDateTime=_e.rawProgramDateTime)}else{const Yt=ut.byteRangeEndOffset;if(Yt){const Qt=ut.byteRangeStartOffset;St=`${Yt-Qt}@${Qt}`}else St=null;setInitSegment(ut,Ft,o,Et),_e=ut,gt=!0}_e.cc=st;break}case"SERVER-CONTROL":{xt&&assignMultipleMediaPlaylistTagOccuranceError(b,er,mt),xt=new AttrList(qt),b.canBlockReload=xt.bool("CAN-BLOCK-RELOAD"),b.canSkipUntil=xt.optionalFloat("CAN-SKIP-UNTIL",0),b.canSkipDateRanges=b.canSkipUntil>0&&xt.bool("CAN-SKIP-DATERANGES"),b.partHoldBack=xt.optionalFloat("PART-HOLD-BACK",0),b.holdBack=xt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{b.partTarget&&assignMultipleMediaPlaylistTagOccuranceError(b,er,mt);const Ft=new AttrList(qt);b.partTarget=Ft.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Ft=b.partList;Ft||(Ft=b.partList=[]);const Yt=rt>0?Ft[Ft.length-1]:void 0,Qt=rt++,zt=new AttrList(qt,b),Xt=new Part(zt,ut,_,Qt,Yt);Ft.push(Xt),ut.duration+=Xt.duration;break}case"PRELOAD-HINT":{const Ft=new AttrList(qt,b);b.preloadHint=Ft;break}case"RENDITION-REPORT":{const Ft=new AttrList(qt,b);b.renditionReports=b.renditionReports||[],b.renditionReports.push(Ft);break}default:logger.warn(`line parsed but not handled: ${mt}`);break}}}ot&&!ot.relurl?($.pop(),nt-=ot.duration,b.partList&&(b.fragmentHint=ot)):b.partList&&(assignProgramDateTime(ut,ot,j),ut.cc=st,b.fragmentHint=ut,Et&&setFragLevelKeys(ut,Et,b)),b.targetduration||(b.playlistParsingError=new Error("Missing Target Duration"));const Ct=$.length,Ht=$[0],Dt=$[Ct-1];if(nt+=b.skippedSegments*b.targetduration,nt>0&&Ct&&Dt){b.averagetargetduration=nt/Ct;const rr=Dt.sn;b.endSN=rr!=="initSegment"?rr:0,b.live||(Dt.endList=!0),dt>0&&(backfillProgramDateTimes($,dt),Ht&&j.unshift(Ht))}return b.fragmentHint&&(nt+=b.fragmentHint.duration),b.totalduration=nt,j.length&&b.dateRangeTagCount&&Ht&&mapDateRanges(j,b),b.endCC=st,b}}function mapDateRanges(a,e){let s=a.length;if(!s)if(e.hasProgramDateTime){const g=e.fragments[e.fragments.length-1];a.push(g),s++}else return;const o=a[s-1],c=e.live?1/0:e.totalduration,d=Object.keys(e.dateRanges);for(let g=d.length;g--;){const _=e.dateRanges[d[g]],b=_.startDate.getTime();_.tagAnchor=o.ref;for(let $=s;$--;){var h;if(((h=a[$])==null?void 0:h.sn)<e.startSN)break;const j=findFragmentWithStartDate(e,b,a,$,c);if(j!==-1){_.tagAnchor=e.fragments[j].ref;break}}}}function findFragmentWithStartDate(a,e,s,o,c){const d=s[o];if(d){const g=d.programDateTime;if(e>=g||o===0){var h;const _=(((h=s[o+1])==null?void 0:h.start)||c)-d.start;if(e<=g+_*1e3){const b=s[o].sn-a.startSN;if(b<0)return-1;const $=a.fragments;if($.length>s.length){const _e=(s[o+1]||$[$.length-1]).sn-a.startSN;for(let tt=_e;tt>b;tt--){const rt=$[tt].programDateTime;if(e>=rt&&e<rt+$[tt].duration*1e3)return tt}}return b}}}return-1}function parseKey(a,e,s){var o,c;const d=new AttrList(a,s),h=(o=d.METHOD)!=null?o:"",g=d.URI,_=d.hexadecimalInteger("IV"),b=d.KEYFORMATVERSIONS,$=(c=d.KEYFORMAT)!=null?c:"identity";g&&d.IV&&!_&&logger.error(`Invalid IV: ${d.IV}`);const j=g?M3U8Parser.resolve(g,e):"",_e=(b||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(h,j,$,_e,_,d.KEYID)}function parseStartTimeOffset(a){const s=new AttrList(a).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(s)?s:null}function setCodecs(a,e){let s=(a||"").split(/[ ,]+/).filter(o=>o);["video","audio","text"].forEach(o=>{const c=s.filter(d=>isCodecType(d,o));c.length&&(e[`${o}Codec`]=c.map(d=>d.split("/")[0]).join(","),s=s.filter(d=>c.indexOf(d)===-1))}),e.unknownCodecs=s}function assignCodec(a,e,s){const o=e[s];o&&(a[s]=o)}function backfillProgramDateTimes(a,e){let s=a[e];for(let o=e;o--;){const c=a[o];if(!c)return;c.programDateTime=s.programDateTime-c.duration*1e3,s=c}}function assignProgramDateTime(a,e,s){a.rawProgramDateTime?s.push(a):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime)}function setInitSegment(a,e,s,o){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=s,a.sn="initSegment",o&&(a.levelkeys=o),a.initSegment=null}function setFragLevelKeys(a,e,s){a.levelkeys=e;const{encryptedFragments:o}=s;(!o.length||o[o.length-1].levelkeys!==e)&&Object.keys(e).some(c=>e[c].isCommonEncryption)&&o.push(a)}function assignMultipleMediaPlaylistTagOccuranceError(a,e,s){a.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${s[0]})`)}function assignMustAppearBeforeSegmentsError(a,e,s){a.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${s[0]})`)}function updateFromToPTS(a,e){const s=e.startPTS;if(isFiniteNumber(s)){let o=0,c;e.sn>a.sn?(o=s-a.start,c=a):(o=a.start-s,c=e),c.duration!==o&&c.setDuration(o)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.setStart(a.start+(a.minEndPTS-a.start)):e.setStart(a.start+a.duration):e.setStart(Math.max(a.start-e.duration,0))}function updateFragPTSDTS(a,e,s,o,c,d,h){o-s<=0&&(h.warn("Fragment should have a positive duration",e),o=s+e.duration,d=c+e.duration);let _=s,b=o;const $=e.startPTS,j=e.endPTS;if(isFiniteNumber($)){const at=Math.abs($-s);a&&at>a.totalduration?h.warn(`media timestamps and playlist times differ by ${at}s for level ${e.level} ${a.url}`):isFiniteNumber(e.deltaPTS)?e.deltaPTS=Math.max(at,e.deltaPTS):e.deltaPTS=at,_=Math.max(s,$),s=Math.min(s,$),c=e.startDTS!==void 0?Math.min(c,e.startDTS):c,b=Math.min(o,j),o=Math.max(o,j),d=e.endDTS!==void 0?Math.max(d,e.endDTS):d}const _e=s-e.start;e.start!==0&&e.setStart(s),e.setDuration(o-e.start),e.startPTS=s,e.maxStartPTS=_,e.startDTS=c,e.endPTS=o,e.minEndPTS=b,e.endDTS=d;const tt=e.sn;if(!a||tt<a.startSN||tt>a.endSN)return 0;let rt;const nt=tt-a.startSN,st=a.fragments;for(st[nt]=e,rt=nt;rt>0;rt--)updateFromToPTS(st[rt],st[rt-1]);for(rt=nt;rt<st.length-1;rt++)updateFromToPTS(st[rt],st[rt+1]);return a.fragmentHint&&updateFromToPTS(st[st.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,_e}function mergeDetails(a,e,s){if(a===e)return;let o=null;const c=a.fragments;for(let $=c.length-1;$>=0;$--){const j=c[$].initSegment;if(j){o=j;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let d;mapFragmentIntersection(a,e,($,j,_e,tt)=>{if((!e.startCC||e.skippedSegments)&&j.cc!==$.cc){const rt=$.cc-j.cc;for(let nt=_e;nt<tt.length;nt++)tt[nt].cc+=rt;e.endCC=tt[tt.length-1].cc}isFiniteNumber($.startPTS)&&isFiniteNumber($.endPTS)&&(j.setStart(j.startPTS=$.startPTS),j.startDTS=$.startDTS,j.maxStartPTS=$.maxStartPTS,j.endPTS=$.endPTS,j.endDTS=$.endDTS,j.minEndPTS=$.minEndPTS,j.setDuration($.endPTS-$.startPTS),j.duration&&(d=j),e.PTSKnown=e.alignedSliding=!0),$.hasStreams&&(j.elementaryStreams=$.elementaryStreams),j.loader=$.loader,$.hasStats&&(j.stats=$.stats),$.initSegment&&(j.initSegment=$.initSegment,o=$.initSegment)});const h=e.fragments,g=e.fragmentHint?h.concat(e.fragmentHint):h;if(o&&g.forEach($=>{var j;$&&(!$.initSegment||$.initSegment.relurl===((j=o)==null?void 0:j.relurl))&&($.initSegment=o)}),e.skippedSegments){if(e.deltaUpdateFailed=h.some($=>!$),e.deltaUpdateFailed){s.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let $=e.skippedSegments;$--;)h.shift();e.startSN=h[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=mergeDateRanges(a.dateRanges,e,s));const $=a.fragments.filter(j=>j.rawProgramDateTime);if(a.hasProgramDateTime&&!e.hasProgramDateTime)for(let j=1;j<g.length;j++)g[j].programDateTime===null&&assignProgramDateTime(g[j],g[j-1],$);mapDateRanges($,e)}e.endCC=h[h.length-1].cc}if(!e.startCC){var _;const $=getFragmentWithSN(a,e.startSN-1);e.startCC=(_=$==null?void 0:$.cc)!=null?_:h[0].cc}mapPartIntersection(a.partList,e.partList,($,j)=>{j.elementaryStreams=$.elementaryStreams,j.stats=$.stats}),d?updateFragPTSDTS(e,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS,s):adjustSliding(a,e),h.length&&(e.totalduration=e.edge-h[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const b=e.advancedDateTime;if(e.advanced&&b){const $=e.edge;e.driftStart||(e.driftStartTime=b,e.driftStart=$),e.driftEndTime=b,e.driftEnd=$}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=a.requestScheduled)}function mergeDateRanges(a,e,s){const{dateRanges:o,recentlyRemovedDateranges:c}=e,d=_extends({},a);c&&c.forEach(_=>{delete d[_]});const g=Object.keys(d).length;return g?(Object.keys(o).forEach(_=>{const b=d[_],$=new DateRange(o[_].attr,b);$.isValid?(d[_]=$,b||($.tagOrder+=g)):s.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${stringify(o[_].attr)}"`)}),d):o}function mapPartIntersection(a,e,s){if(a&&e){let o=0;for(let c=0,d=a.length;c<=d;c++){const h=a[c],g=e[c+o];h&&g&&h.index===g.index&&h.fragment.sn===g.fragment.sn?s(h,g):o--}}}function mapFragmentIntersection(a,e,s){const o=e.skippedSegments,c=Math.max(a.startSN,e.startSN)-e.startSN,d=(a.fragmentHint?1:0)+(o?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,h=e.startSN-a.startSN,g=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,_=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let b=c;b<=d;b++){const $=_[h+b];let j=g[b];if(o&&!j&&$&&(j=e.fragments[b]=$),$&&j){s($,j,b,g);const _e=$.relurl,tt=j.relurl;if(_e&&notEqualAfterStrippingQueries(_e,tt)){e.playlistParsingError=getSequenceError(`media sequence mismatch ${j.sn}:`,a,e,$,j);return}else if($.cc!==j.cc){e.playlistParsingError=getSequenceError(`discontinuity sequence mismatch (${$.cc}!=${j.cc})`,a,e,$,j);return}}}}function getSequenceError(a,e,s,o,c){return new Error(`${a} ${c.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${s.startSN}
${s.m3u8}`)}function adjustSliding(a,e,s=!0){const o=e.startSN+e.skippedSegments-a.startSN,c=a.fragments,d=o>=0;let h=0;if(d&&o<c.length)h=c[o].start;else if(d&&e.startSN===a.endSN+1)h=a.fragmentEnd;else if(d&&s)h=a.fragmentStart+o*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)h=a.fragmentStart;else return;addSliding(e,h)}function addSliding(a,e){if(e){const s=a.fragments;for(let o=a.skippedSegments;o<s.length;o++)s[o].addStart(e);a.fragmentHint&&a.fragmentHint.addStart(e)}}function computeReloadInterval(a,e=1/0){let s=1e3*a.targetduration;if(a.updated){const o=a.fragments;if(o.length&&s*4>e){const d=o[o.length-1].duration*1e3;d<s&&(s=d)}}else s/=2;return Math.round(s)}function getFragmentWithSN(a,e,s){if(!a)return null;let o=a.fragments[e-a.startSN];return o||(o=a.fragmentHint,o&&o.sn===e)?o:e<a.startSN&&s&&s.sn===e?s:null}function getPartWith(a,e,s){return a?findPart(a.partList,e,s):null}function findPart(a,e,s){if(a)for(let o=a.length;o--;){const c=a[o];if(c.index===s&&c.fragment.sn===e)return c}return null}function reassignFragmentLevelIndexes(a){a.forEach((e,s)=>{var o;(o=e.details)==null||o.fragments.forEach(c=>{c.level=s,c.initSegment&&(c.initSegment.level=s)})})}function notEqualAfterStrippingQueries(a,e){return a!==e&&e?stripQuery(a)!==stripQuery(e):!1}function stripQuery(a){return a.replace(/\?[^?]*$/,"")}function findFirstFragWithCC(a,e){for(let o=0,c=a.length;o<c;o++){var s;if(((s=a[o])==null?void 0:s.cc)===e)return a[o]}return null}function shouldAlignOnDiscontinuities(a,e){return!!(a&&e.startCC<a.endCC&&e.endCC>a.startCC)}function adjustFragmentStart(a,e){const s=a.start+e;a.startPTS=s,a.setStart(s),a.endPTS=s+a.duration}function adjustSlidingStart(a,e){const s=e.fragments;for(let o=0,c=s.length;o<c;o++)adjustFragmentStart(s[o],a);e.fragmentHint&&adjustFragmentStart(e.fragmentHint,a),e.alignedSliding=!0}function alignStream(a,e){a&&(alignDiscontinuities(e,a),e.alignedSliding||alignMediaPlaylistByPDT(e,a),!e.alignedSliding&&!e.skippedSegments&&adjustSliding(a,e,!1))}function alignDiscontinuities(a,e){if(!shouldAlignOnDiscontinuities(e,a))return;const s=Math.min(e.endCC,a.endCC),o=findFirstFragWithCC(e.fragments,s),c=findFirstFragWithCC(a.fragments,s);if(!o||!c)return;logger.log(`Aligning playlist at start of dicontinuity sequence ${s}`);const d=o.start-c.start;adjustSlidingStart(d,a)}function alignMediaPlaylistByPDT(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const s=a.fragments,o=e.fragments;if(!s.length||!o.length)return;let c,d;const h=Math.min(e.endCC,a.endCC);e.startCC<h&&a.startCC<h&&(c=findFirstFragWithCC(o,h),d=findFirstFragWithCC(s,h)),(!c||!d)&&(c=o[Math.floor(o.length/2)],d=findFirstFragWithCC(s,c.cc)||s[Math.floor(s.length/2)]);const g=c.programDateTime,_=d.programDateTime;if(!g||!_)return;const b=(_-g)/1e3-(d.start-c.start);adjustSlidingStart(b,a)}function addEventListener$1(a,e,s){removeEventListener(a,e,s),a.addEventListener(e,s)}function removeEventListener(a,e,s){a.removeEventListener(e,s)}const TimeRanges={toString:function(a){let e="";const s=a.length;for(let o=0;o<s;o++)e+=`[${a.start(o).toFixed(3)}-${a.end(o).toFixed(3)}]`;return e}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(e,s,o,c,d){super(c,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:h,fragCurrent:g,media:_,mediaBuffer:b,state:$}=this,j=_?_.currentTime:0,_e=BufferHelper.bufferInfo(b||_,j,h.maxBufferHole),tt=!_e.len;if(this.log(`Media seeking to ${isFiniteNumber(j)?j.toFixed(3):j}, state: ${$}, ${tt?"out of":"in"} buffer`),this.state===State.ENDED)this.resetLoadingState();else if(g){const rt=h.maxFragLookUpTolerance,nt=g.start-rt,st=g.start+g.duration+rt;if(tt||st<_e.start||nt>_e.end){const at=j>st;(j<nt||at)&&(at&&g.loader&&(this.log(`Cancelling fragment load for seek (sn: ${g.sn})`),g.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(_){this.fragmentTracker.removeFragmentsInRange(j,1/0,this.playlistType,!0);const rt=this.lastCurrentTime;if(j>rt&&(this.lastCurrentTime=j),!this.loadingParts){const nt=Math.max(_e.end,j),st=this.shouldLoadParts(this.getLevelDetails(),nt);st&&(this.log(`LL-Part loading ON after seeking to ${j.toFixed(2)} with buffer @${nt.toFixed(2)}`),this.loadingParts=st)}}this.hls.hasEnoughToStart||(this.log(`Setting ${tt?"startPosition":"nextLoadPosition"} to ${j} for seek without enough to start`),this.nextLoadPosition=j,tt&&(this.startPosition=j)),tt&&this.state===State.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=d,this.hls=e,this.fragmentLoader=new FragmentLoader(e.config),this.keyLoader=o,this.fragmentTracker=s,this.config=e.config,this.decrypter=new Decrypter(e.config)}registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===State.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:s}=this;return s===-1&&e?e:s}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,s){if(s.live||!this.media)return!1;const o=e.end||0,c=this.config.timelineOffset||0;if(o<=c)return!1;const d=e.buffered;this.config.maxBufferHole&&d&&d.length>1&&(e=BufferHelper.bufferedInfo(d,e.start,0));const h=e.nextStart;if(h&&h>c&&h<s.edge||this.media.currentTime<e.start)return!1;const _=s.partList;if(_!=null&&_.length){const $=_[_.length-1];return BufferHelper.isBuffered(this.media,$.start+$.duration/2)}const b=s.fragments[s.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(b)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var s;return((s=this.getLevelDetails())==null?void 0:s.appliedTimelineOffset)||e}return 0}onMediaAttached(e,s){const o=this.media=this.mediaBuffer=s.media;addEventListener$1(o,"seeking",this.onMediaSeeking),addEventListener$1(o,"ended",this.onMediaEnded);const c=this.config;this.levels&&c.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(c.startPosition)}onMediaDetaching(e,s){const o=!!s.transferMedia,c=this.media;if(c!==null){if(c.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),removeEventListener(c,"seeking",this.onMediaSeeking),removeEventListener(c,"ended",this.onMediaEnded),this.keyLoader&&!o&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,o){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,s){}onManifestLoaded(e,s){this.startTimeOffset=s.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,s,o){this.startFragRequested=!0,this._loadFragForPlayback(e,s,o)}_loadFragForPlayback(e,s,o){const c=d=>{const h=d.frag;if(this.fragContextChanged(h)){this.warn(`${h.type} sn: ${h.sn}${d.part?" part: "+d.part.index:""} of ${this.fragInfo(h,!1,d.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(h);return}h.stats.chunkCount++,this._handleFragmentLoadProgress(d)};this._doFragLoad(e,s,o,c).then(d=>{if(!d)return;const h=this.state,g=d.frag;if(this.fragContextChanged(g)){(h===State.FRAG_LOADING||!this.fragCurrent&&h===State.PARSING)&&(this.fragmentTracker.removeFragment(g),this.state=State.IDLE);return}"payload"in d&&(this.log(`Loaded ${g.type} sn: ${g.sn} of ${this.playlistLabel()} ${g.level}`),this.hls.trigger(Events.FRAG_LOADED,d)),this._handleFragmentLoadComplete(d)}).catch(d=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(`Frag error: ${(d==null?void 0:d.message)||d}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var s;const{fragmentTracker:o}=this;if(o.getState(e)===FragmentState.APPENDING){const d=e.type,h=this.getFwdBufferInfo(this.mediaBuffer,d),g=Math.max(e.duration,h?h.len:this.config.maxBufferLength),_=this.backtrackFragment;((_?e.sn-_.sn:0)===1||this.reduceMaxBufferLength(g,e.duration))&&o.removeFragment(e)}else((s=this.mediaBuffer)==null?void 0:s.buffered.length)===0?o.removeAllFragments():o.hasParts(e.type)&&(o.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),o.getState(e)===FragmentState.PARTIAL&&o.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const s=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:s,part:null,stats:s.stats,id:s.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const s=e.details;return(s==null?void 0:s.live)&&s.type!=="EVENT"&&(this.levelLastLoaded!==e||s.expired)}flushMainBuffer(e,s,o=null){if(!(e-s))return;const c={startOffset:e,endOffset:s,type:o};this.hls.trigger(Events.BUFFER_FLUSHING,c)}_loadInitSegment(e,s){this._doFragLoad(e,s).then(o=>{const c=o==null?void 0:o.frag;if(!c||this.fragContextChanged(c)||!this.levels)throw new Error("init load aborted");return o}).then(o=>{const{hls:c}=this,{frag:d,payload:h}=o,g=d.decryptdata;if(h&&h.byteLength>0&&g!=null&&g.key&&g.iv&&isFullSegmentEncryption(g.method)){const _=self.performance.now();return this.decrypter.decrypt(new Uint8Array(h),g.key.buffer,g.iv.buffer,getAesModeFromFullSegmentMethod(g.method)).catch(b=>{throw c.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:b,reason:b.message,frag:d}),b}).then(b=>{const $=self.performance.now();return c.trigger(Events.FRAG_DECRYPTED,{frag:d,payload:b,stats:{tstart:_,tdecrypt:$}}),o.payload=b,this.completeInitSegmentLoad(o)})}return this.completeInitSegmentLoad(o)}).catch(o=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(o),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:s}=this;if(!s)throw new Error("init load aborted, missing levels");const o=e.frag.stats;this.state!==State.STOPPED&&(this.state=State.IDLE),e.frag.data=new Uint8Array(e.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,s){var o,c;const d=e.tracks;if(d&&!s.encrypted&&((o=d.audio)!=null&&o.encrypted||(c=d.video)!=null&&c.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const h=this.media,g=new Error(`Encrypted track with no key in ${this.fragInfo(s)} (media ${h?"attached mediaKeys: "+h.mediaKeys:"detached"})`);return this.warn(g.message),!h||h.mediaKeys?!1:(this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!1,error:g,frag:s}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:s}=this;return!e||!s||e.sn!==s.sn||e.level!==s.level}fragBufferedComplete(e,s){const o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${s?" part: "+s.index:""} of ${this.fragInfo(e,!1,s)} > buffer:${o?TimeRanges.toString(BufferHelper.getBuffered(o)):"(detached)"})`),isMediaFragment(e)){var c;if(e.type!==PlaylistLevelType.SUBTITLE){const h=e.elementaryStreams;if(!Object.keys(h).some(g=>!!h[g])){this.state=State.IDLE;return}}const d=(c=this.levels)==null?void 0:c[e.level];d!=null&&d.fragmentError&&(this.log(`Resetting level fragment error count of ${d.fragmentError} on frag buffered`),d.fragmentError=0)}this.state=State.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:s}=this;if(!s)return;const{frag:o,part:c,partsLoaded:d}=e,h=!d||d.length===0||d.some(_=>!_),g=new ChunkMetadata(o.level,o.sn,o.stats.chunkCount+1,0,c?c.index:-1,!h);s.flush(g)}_handleFragmentLoadProgress(e){}_doFragLoad(e,s,o=null,c){var d;this.fragCurrent=e;const h=s.details;if(!this.levels||!h)throw new Error(`frag load aborted, missing level${h?"":" detail"}s`);let g=null;if(e.encrypted&&!((d=e.decryptdata)!=null&&d.key)){if(this.log(`Loading key for ${e.sn} of [${h.startSN}-${h.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=State.KEY_LOADING,this.fragCurrent=e,g=this.keyLoader.load(e).then(_e=>{if(!this.fragContextChanged(_e.frag))return this.hls.trigger(Events.KEY_LOADED,_e),this.state===State.KEY_LOADING&&(this.state=State.IDLE),_e}),this.hls.trigger(Events.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(g=this.keyLoader.loadClear(e,h.encryptedFragments,this.startFragRequested),g&&this.log("[eme] blocking frag load until media-keys acquired"));const _=this.fragPrevious;if(isMediaFragment(e)&&(!_||e.sn!==_.sn)){const _e=this.shouldLoadParts(s.details,e.end);_e!==this.loadingParts&&(this.log(`LL-Part loading ${_e?"ON":"OFF"} loading sn ${_==null?void 0:_.sn}->${e.sn}`),this.loadingParts=_e)}if(o=Math.max(e.start,o||0),this.loadingParts&&isMediaFragment(e)){const _e=h.partList;if(_e&&c){o>h.fragmentEnd&&h.fragmentHint&&(e=h.fragmentHint);const tt=this.getNextPart(_e,e,o);if(tt>-1){const rt=_e[tt];e=this.fragCurrent=rt.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${rt.index} (${tt}/${_e.length-1}) of ${this.fragInfo(e,!1,rt)}) cc: ${e.cc} [${h.startSN}-${h.endSN}], target: ${parseFloat(o.toFixed(3))}`),this.nextLoadPosition=rt.start+rt.duration,this.state=State.FRAG_LOADING;let nt;return g?nt=g.then(st=>!st||this.fragContextChanged(st.frag)?null:this.doFragPartsLoad(e,rt,s,c)).catch(st=>this.handleFragLoadError(st)):nt=this.doFragPartsLoad(e,rt,s,c).catch(st=>this.handleFragLoadError(st)),this.hls.trigger(Events.FRAG_LOADING,{frag:e,part:rt,targetBufferTime:o}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):nt}else if(!e.url||this.loadedEndOfParts(_e,o))return Promise.resolve(null)}}if(isMediaFragment(e)&&this.loadingParts){var b;this.log(`LL-Part loading OFF after next part miss @${o.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(b=h.partList)==null?void 0:b.filter(_e=>_e.loaded).map(_e=>`[${_e.start}-${_e.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+h.startSN+"-"+h.endSN+"]"}, target: ${parseFloat(o.toFixed(3))}`),isFiniteNumber(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=State.FRAG_LOADING;const $=this.config.progressive&&e.type!==PlaylistLevelType.SUBTITLE;let j;return $&&g?j=g.then(_e=>!_e||this.fragContextChanged(_e.frag)?null:this.fragmentLoader.load(e,c)).catch(_e=>this.handleFragLoadError(_e)):j=Promise.all([this.fragmentLoader.load(e,$?c:void 0),g]).then(([_e])=>(!$&&c&&c(_e),_e)).catch(_e=>this.handleFragLoadError(_e)),this.hls.trigger(Events.FRAG_LOADING,{frag:e,targetBufferTime:o}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):j}doFragPartsLoad(e,s,o,c){return new Promise((d,h)=>{var g;const _=[],b=(g=o.details)==null?void 0:g.partList,$=j=>{this.fragmentLoader.loadPart(e,j,c).then(_e=>{_[j.index]=_e;const tt=_e.part;this.hls.trigger(Events.FRAG_LOADED,_e);const rt=getPartWith(o.details,e.sn,j.index+1)||findPart(b,e.sn,j.index+1);if(rt)$(rt);else return d({frag:e,part:tt,partsLoaded:_})}).catch(h)};$(s)})}handleFragLoadError(e){if("data"in e){const s=e.data;s.frag&&s.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(s.frag,s.part):s.frag&&s.type===ErrorTypes.KEY_SYSTEM_ERROR?(s.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(s.frag)):this.hls.trigger(Events.ERROR,s)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const s=this.getCurrentContext(e);if(!s||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:o,part:c,level:d}=s,h=self.performance.now();o.stats.parsing.end=h,c&&(c.stats.parsing.end=h);const g=this.getLevelDetails(),b=g&&o.sn>g.endSN||this.shouldLoadParts(g,o.end);b!==this.loadingParts&&(this.log(`LL-Part loading ${b?"ON":"OFF"} after parsing segment ending @${o.end.toFixed(2)}`),this.loadingParts=b),this.updateLevelTiming(o,c,d,e.partial)}shouldLoadParts(e,s){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var o;const d=e.partList[0];if(d.fragment.type===PlaylistLevelType.SUBTITLE)return!1;const h=d.end+(((o=e.fragmentHint)==null?void 0:o.duration)||0);if(s>=h){var c;if((this.hls.hasEnoughToStart?((c=this.media)==null?void 0:c.currentTime)||this.lastCurrentTime:this.getLoadPosition())>d.start-d.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:s,fragCurrent:o}=this,{level:c,sn:d,part:h}=e;if(!(s!=null&&s[c]))return this.warn(`Levels object was unset while buffering fragment ${d} of ${this.playlistLabel()} ${c}. The current chunk will not be buffered.`),null;const g=s[c],_=g.details,b=h>-1?getPartWith(_,d,h):null,$=b?b.fragment:getFragmentWithSN(_,d,o);return $?(o&&o!==$&&($.stats=o.stats),{frag:$,part:b,level:g}):null}bufferFragmentData(e,s,o,c,d){if(this.state!==State.PARSING)return;const{data1:h,data2:g}=e;let _=h;if(g&&(_=appendUint8Array(h,g)),!_.length)return;const b=this.initPTS[s.cc],$=b?-b.baseTime/b.timescale:void 0,j={type:e.type,frag:s,part:o,chunkMeta:c,offset:$,parent:s.type,data:_};if(this.hls.trigger(Events.BUFFER_APPENDING,j),e.dropped&&e.independent&&!o){if(d)return;this.flushBufferGap(s)}}flushBufferGap(e){const s=this.media;if(!s)return;if(!BufferHelper.isBuffered(s,s.currentTime)){this.flushMainBuffer(0,e.start);return}const o=s.currentTime,c=BufferHelper.bufferInfo(s,o,0),d=e.duration,h=Math.min(this.config.maxFragLookUpTolerance*2,d*.25),g=Math.max(Math.min(e.start-h,c.end-h),o+h);e.start-g>h&&this.flushMainBuffer(g,e.start)}getFwdBufferInfo(e,s){var o;const c=this.getLoadPosition();if(!isFiniteNumber(c))return null;const h=this.lastCurrentTime>c||(o=this.media)!=null&&o.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,c,s,h)}getFwdBufferInfoAtPos(e,s,o,c){const d=BufferHelper.bufferInfo(e,s,c);if(d.len===0&&d.nextStart!==void 0){const h=this.fragmentTracker.getBufferedFrag(s,o);if(h&&(d.nextStart<=h.end||h.gap)){const g=Math.max(Math.min(d.nextStart,h.end)-s,c);return BufferHelper.bufferInfo(e,s,g)}}return d}getMaxBufferLength(e){const{config:s}=this;let o;return e?o=Math.max(8*s.maxBufferSize/e,s.maxBufferLength):o=s.maxBufferLength,Math.min(o,s.maxMaxBufferLength)}reduceMaxBufferLength(e,s){const o=this.config,c=Math.max(Math.min(e-s,o.maxBufferLength),s),d=Math.max(e-s*3,o.maxMaxBufferLength/2,c);return d>=c?(o.maxMaxBufferLength=d,this.warn(`Reduce max buffer length to ${d}s`),!0):!1}getAppendedFrag(e,s=PlaylistLevelType.MAIN){const o=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,s):null;return o&&"fragment"in o?o.fragment:o}getNextFragment(e,s){const o=s.fragments,c=o.length;if(!c)return null;const{config:d}=this,h=o[0].start,g=d.lowLatencyMode&&!!s.partList;let _=null;if(s.live){const j=d.initialLiveManifestSize;if(c<j)return this.warn(`Not enough fragments to start playback (have: ${c}, need: ${j})`),null;if(!s.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<h){var b;g&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),_=this.getInitialLiveFragment(s);const _e=this.hls.startPosition,tt=this.hls.liveSyncPosition,rt=_?(_e!==-1&&_e>=h?_e:tt)||_.start:e;this.log(`Setting startPosition to ${rt} to match start frag at live edge. mainStart: ${_e} liveSyncPosition: ${tt} frag.start: ${(b=_)==null?void 0:b.start}`),this.startPosition=this.nextLoadPosition=rt}}else e<=h&&(_=o[0]);if(!_){const j=this.loadingParts?s.partEnd:s.fragmentEnd;_=this.getFragmentAtPosition(e,j,s)}let $=this.filterReplacedPrimary(_,s);if(!$&&_){const j=_.sn-s.startSN;$=this.filterReplacedPrimary(o[j+1]||null,s)}return this.mapToInitFragWhenRequired($)}isLoopLoading(e,s){const o=this.fragmentTracker.getState(e);return(o===FragmentState.OK||o===FragmentState.PARTIAL&&!!e.gap)&&this.nextLoadPosition>s}getNextFragmentLoopLoading(e,s,o,c,d){let h=null;if(e.gap&&(h=this.getNextFragment(this.nextLoadPosition,s),h&&!h.gap&&o.nextStart)){const g=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,o.nextStart,c,0);if(g!==null&&o.len+g.len>=d){const _=h.sn;return this.loopSn!==_&&(this.log(`buffer full after gaps in "${c}" playlist starting at sn: ${_}`),this.loopSn=_),null}}return this.loopSn=void 0,h}get primaryPrefetch(){if(interstitialsEnabled(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,s){if(!e)return e;if(interstitialsEnabled(this.config)&&e.type!==PlaylistLevelType.SUBTITLE){const o=this.hls.interstitialsManager,c=o==null?void 0:o.bufferingItem;if(c){const h=c.event;if(h){if(h.appendInPlace||Math.abs(e.start-c.start)>1||c.start===0)return null}else if(e.end<=c.start&&(s==null?void 0:s.live)===!1||e.start>c.end&&c.nextEvent&&(c.nextEvent.appendInPlace||e.start-c.end>1))return null}const d=o==null?void 0:o.playerQueue;if(d)for(let h=d.length;h--;){const g=d[h].interstitial;if(g.appendInPlace&&e.start>=g.startTime&&e.end<=g.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,s,o){let c=-1,d=!1,h=!0;for(let g=0,_=e.length;g<_;g++){const b=e[g];if(h=h&&!b.independent,c>-1&&o<b.start)break;const $=b.loaded;$?c=-1:(d||(b.independent||h)&&b.fragment===s)&&(b.fragment!==s&&this.warn(`Need buffer at ${o} but next unloaded part starts at ${b.start}`),c=g),d=$}return c}loadedEndOfParts(e,s){let o;for(let c=e.length;c--;){if(o=e[c],!o.loaded)return!1;if(s>o.start)return!0}return!1}getInitialLiveFragment(e){const s=e.fragments,o=this.fragPrevious;let c=null;if(o){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${o.programDateTime}`),c=findFragmentByPDT(s,o.endProgramDateTime,this.config.maxFragLookUpTolerance)),!c){const d=o.sn+1;if(d>=e.startSN&&d<=e.endSN){const h=s[d-e.startSN];o.cc===h.cc&&(c=h,this.log(`Live playlist, switching playlist, load frag with next SN: ${c.sn}`))}c||(c=findNearestWithCC(e,o.cc,o.end),c&&this.log(`Live playlist, switching playlist, load frag with same CC: ${c.sn}`))}}else{const d=this.hls.liveSyncPosition;d!==null&&(c=this.getFragmentAtPosition(d,this.bitrateTest?e.fragmentEnd:e.edge,e))}return c}getFragmentAtPosition(e,s,o){const{config:c}=this;let{fragPrevious:d}=this,{fragments:h,endSN:g}=o;const{fragmentHint:_}=o,{maxFragLookUpTolerance:b}=c,$=o.partList,j=!!(this.loadingParts&&$!=null&&$.length&&_);j&&!this.bitrateTest&&$[$.length-1].fragment.sn===_.sn&&(h=h.concat(_),g=_.sn);let _e;if(e<s){var tt;const nt=e<this.lastCurrentTime||e>s-b||(tt=this.media)!=null&&tt.paused||!this.startFragRequested?0:b;_e=findFragmentByPTS(d,h,e,nt)}else _e=h[h.length-1];if(_e){const rt=_e.sn-o.startSN,nt=this.fragmentTracker.getState(_e);if((nt===FragmentState.OK||nt===FragmentState.PARTIAL&&_e.gap)&&(d=_e),d&&_e.sn===d.sn&&(!j||$[0].fragment.sn>_e.sn||!o.live)&&_e.level===d.level){const at=h[rt+1];_e.sn<g&&this.fragmentTracker.getState(at)!==FragmentState.OK?_e=at:_e=null}}return _e}alignPlaylists(e,s,o){const c=e.fragments.length;if(!c)return this.warn("No fragments in live playlist"),0;const d=e.fragmentStart,h=!s,g=e.alignedSliding&&isFiniteNumber(d);if(h||!g&&!d){alignStream(o,e);const _=e.fragmentStart;return this.log(`Live playlist sliding: ${_.toFixed(2)} start-sn: ${s?s.startSN:"na"}->${e.startSN} fragments: ${c}`),_}return d}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,s){let o=this.startPosition;o<s&&(o=-1);const c=this.timelineOffset;if(o===-1){const d=this.startTimeOffset!==null,h=d?this.startTimeOffset:e.startTimeOffset;h!==null&&isFiniteNumber(h)?(o=s+h,h<0&&(o+=e.edge),o=Math.min(Math.max(s,o),s+e.totalduration),this.log(`Setting startPosition to ${o} for start time offset ${h} found in ${d?"multivariant":"media"} playlist`),this.startPosition=o):e.live?(o=this.hls.liveSyncPosition||s,this.log(`Setting startPosition to -1 to start at live edge ${o}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=o=0),this.lastCurrentTime=o+c}this.nextLoadPosition=o+c}getLoadPosition(){var e;const{media:s}=this;let o=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&s?o=s.currentTime:this.nextLoadPosition>=0&&(o=this.nextLoadPosition),o}handleFragLoadAborted(e,s){this.transmuxer&&e.type===this.playlistType&&isMediaFragment(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${s?" part "+s.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(e,s){var o;if(s.chunkMeta&&!s.frag){const at=this.getCurrentContext(s.chunkMeta);at&&(s.frag=at.frag)}const c=s.frag;if(!c||c.type!==e||!this.levels)return;if(this.fragContextChanged(c)){var d;this.warn(`Frag load error must match current frag to retry ${c.url} > ${(d=this.fragCurrent)==null?void 0:d.url}`);return}const h=s.details===ErrorDetails.FRAG_GAP;h&&this.fragmentTracker.fragBuffered(c,!0);const g=s.errorAction;if(!g){this.state=State.ERROR;return}const{action:_,flags:b,retryCount:$=0,retryConfig:j}=g,_e=!!j,tt=_e&&_===NetworkErrorAction.RetryRequest,rt=_e&&!g.resolved&&b===ErrorActionFlags.MoveAllAlternatesMatchingHost,nt=(o=this.hls.latestLevelDetails)==null?void 0:o.live;if(!tt&&rt&&isMediaFragment(c)&&!c.endList&&nt&&!isUnusableKeyError(s))this.resetFragmentErrors(e),this.treatAsGap(c),g.resolved=!0;else if((tt||rt)&&$<j.maxNumRetry){var st;const at=offlineHttpStatus((st=s.response)==null?void 0:st.code),ot=getRetryDelay(j,$);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+ot,this.state=State.FRAG_LOADING_WAITING_RETRY,g.resolved=!0,at){this.log("Waiting for connection (offline)"),this.retryDate=1/0,s.reason="offline";return}this.warn(`Fragment ${c.sn} of ${e} ${c.level} errored with ${s.details}, retrying loading ${$+1}/${j.maxNumRetry} in ${ot}ms`)}else if(j)if(this.resetFragmentErrors(e),$<j.maxNumRetry)!h&&_!==NetworkErrorAction.RemoveAlternatePermanently&&(g.resolved=!0);else{this.warn(`${s.details} reached or exceeded max retry (${$})`);return}else _===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),s=this.retryDate,o=s===1/0;(!s||e>=s||o&&!offlineHttpStatus(0))&&(o&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=State.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===State.PARSING||this.state===State.PARSED){const s=e.frag,o=e.parent,c=this.getFwdBufferInfo(this.mediaBuffer,o),d=c&&c.len>.5;d&&this.reduceMaxBufferLength(c.len,(s==null?void 0:s.duration)||10);const h=!d;return h&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${o} buffer`),s&&(this.fragmentTracker.removeFragment(s),this.nextLoadPosition=s.start),this.resetLoadingState(),h}return!1}resetFragmentErrors(e){e===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(e,s,o){if(!e)return;const c=BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(s,c,o),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==State.STOPPED&&(this.state=State.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,s=e?e.details:null;s!=null&&s.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(s,s.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,s,o,c){const d=o.details;if(!d){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((_,b)=>{const $=e.elementaryStreams[b];if($){const j=$.endPTS-$.startPTS;if(j<=0)return this.warn(`Could not parse fragment ${e.sn} ${b} duration reliably (${j})`),_||!1;const _e=c?0:updateFragPTSDTS(d,e,$.startPTS,$.endPTS,$.startDTS,$.endDTS,this);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:d,level:o,drift:_e,type:b,frag:e,start:$.startPTS,end:$.endPTS}),!0}return _},!1)){var g;const _=((g=this.transmuxer)==null?void 0:g.error)===null;if((o.fragmentError===0||_&&(o.fragmentError<2||e.endList))&&this.treatAsGap(e,o),_){const b=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(b.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:b,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${o.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=State.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${s?" part: "+s.index:""} of ${this.fragInfo(e,!1,s)})`),this.hls.trigger(Events.FRAG_PARSED,{frag:e,part:s})}playlistLabel(){return this.playlistType===PlaylistLevelType.MAIN?"level":"track"}fragInfo(e,s=!0,o){var c,d;return`${this.playlistLabel()} ${e.level} (${o?"part":"frag"}:[${((c=s&&!o?e.startPTS:(o||e).start)!=null?c:NaN).toFixed(3)}-${((d=s&&!o?e.endPTS:(o||e).end)!=null?d:NaN).toFixed(3)}]${o&&e.type==="main"?"INDEPENDENT="+(o.independent?"YES":"NO"):""}`}treatAsGap(e,s){s&&s.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const s=this._state;s!==e&&(this._state=e,this.log(`${s}->${e}`))}get state(){return this._state}}function interstitialsEnabled(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:s}=this;let o;if(e.length)e.length===1?o=e[0]:o=concatUint8Arrays(e,s);else return new Uint8Array(0);return this.reset(),o}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(a,e){const s=new Uint8Array(e);let o=0;for(let c=0;c<a.length;c++){const d=a[c];s.set(d,o),o+=d.length}return s}var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,function(a){var e=Object.prototype.hasOwnProperty,s="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(s=!1));function c(_,b,$){this.fn=_,this.context=b,this.once=$||!1}function d(_,b,$,j,_e){if(typeof $!="function")throw new TypeError("The listener must be a function");var tt=new c($,j||_,_e),rt=s?s+b:b;return _._events[rt]?_._events[rt].fn?_._events[rt]=[_._events[rt],tt]:_._events[rt].push(tt):(_._events[rt]=tt,_._eventsCount++),_}function h(_,b){--_._eventsCount===0?_._events=new o:delete _._events[b]}function g(){this._events=new o,this._eventsCount=0}g.prototype.eventNames=function(){var b=[],$,j;if(this._eventsCount===0)return b;for(j in $=this._events)e.call($,j)&&b.push(s?j.slice(1):j);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols($)):b},g.prototype.listeners=function(b){var $=s?s+b:b,j=this._events[$];if(!j)return[];if(j.fn)return[j.fn];for(var _e=0,tt=j.length,rt=new Array(tt);_e<tt;_e++)rt[_e]=j[_e].fn;return rt},g.prototype.listenerCount=function(b){var $=s?s+b:b,j=this._events[$];return j?j.fn?1:j.length:0},g.prototype.emit=function(b,$,j,_e,tt,rt){var nt=s?s+b:b;if(!this._events[nt])return!1;var st=this._events[nt],at=arguments.length,ot,ut;if(st.fn){switch(st.once&&this.removeListener(b,st.fn,void 0,!0),at){case 1:return st.fn.call(st.context),!0;case 2:return st.fn.call(st.context,$),!0;case 3:return st.fn.call(st.context,$,j),!0;case 4:return st.fn.call(st.context,$,j,_e),!0;case 5:return st.fn.call(st.context,$,j,_e,tt),!0;case 6:return st.fn.call(st.context,$,j,_e,tt,rt),!0}for(ut=1,ot=new Array(at-1);ut<at;ut++)ot[ut-1]=arguments[ut];st.fn.apply(st.context,ot)}else{var mt=st.length,yt;for(ut=0;ut<mt;ut++)switch(st[ut].once&&this.removeListener(b,st[ut].fn,void 0,!0),at){case 1:st[ut].fn.call(st[ut].context);break;case 2:st[ut].fn.call(st[ut].context,$);break;case 3:st[ut].fn.call(st[ut].context,$,j);break;case 4:st[ut].fn.call(st[ut].context,$,j,_e);break;default:if(!ot)for(yt=1,ot=new Array(at-1);yt<at;yt++)ot[yt-1]=arguments[yt];st[ut].fn.apply(st[ut].context,ot)}}return!0},g.prototype.on=function(b,$,j){return d(this,b,$,j,!1)},g.prototype.once=function(b,$,j){return d(this,b,$,j,!0)},g.prototype.removeListener=function(b,$,j,_e){var tt=s?s+b:b;if(!this._events[tt])return this;if(!$)return h(this,tt),this;var rt=this._events[tt];if(rt.fn)rt.fn===$&&(!_e||rt.once)&&(!j||rt.context===j)&&h(this,tt);else{for(var nt=0,st=[],at=rt.length;nt<at;nt++)(rt[nt].fn!==$||_e&&!rt[nt].once||j&&rt[nt].context!==j)&&st.push(rt[nt]);st.length?this._events[tt]=st.length===1?st[0]:st:h(this,tt)}return this},g.prototype.removeAllListeners=function(b){var $;return b?($=s?s+b:b,this._events[$]&&h(this,$)):(this._events=new o,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=s,g.EventEmitter=g,a.exports=g}(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3(),EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);const version="1.6.15",workerStore={};function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const a=workerStore[version];if(a)return a.clientCount++,a;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(e),c={worker:new self.Worker(s),objectURL:s,clientCount:1};return workerStore[version]=c,c}function loadWorker(a){const e=workerStore[a];if(e)return e.clientCount++,e;const s=new self.URL(a,self.location.href).href,c={worker:new self.Worker(s),scriptURL:s,clientCount:1};return workerStore[a]=c,c}function removeWorkerFromStore(a){const e=workerStore[a||version];if(e&&e.clientCount--===1){const{worker:o,objectURL:c}=e;delete workerStore[a||version],c&&self.URL.revokeObjectURL(c),o.terminate()}}function isId3Footer(a,e){return e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function isId3Header(a,e){return e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function readId3Size(a,e){let s=0;return s=(a[e]&127)<<21,s|=(a[e+1]&127)<<14,s|=(a[e+2]&127)<<7,s|=a[e+3]&127,s}function getId3Data(a,e){const s=e;let o=0;for(;isId3Header(a,e);){o+=10;const c=readId3Size(a,e+6);o+=c,isId3Footer(a,e+10)&&(o+=10),e+=o}if(o>0)return a.subarray(s,s+o)}function getAudioConfig(a,e,s,o){const c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],d=e[s+2],h=d>>2&15;if(h>12){const tt=new Error(`invalid ADTS sampling index:${h}`);a.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:tt,reason:tt.message});return}const g=(d>>6&3)+1,_=e[s+3]>>6&3|(d&1)<<2,b="mp4a.40."+g,$=c[h];let j=h;(g===5||g===29)&&(j-=3);const _e=[g<<3|(j&14)>>1,(j&1)<<7|_<<3];return logger.log(`manifest codec:${o}, parsed codec:${b}, channels:${_}, rate:${$} (ADTS object type:${g} sampling index:${h})`),{config:_e,samplerate:$,channelCount:_,codec:b,parsedCodec:b,manifestCodec:o}}function isHeaderPattern$1(a,e){return a[e]===255&&(a[e+1]&246)===240}function getHeaderLength(a,e){return a[e+1]&1?7:9}function getFullFrameLength(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function canGetFrameLength(a,e){return e+5<a.length}function isHeader$1(a,e){return e+1<a.length&&isHeaderPattern$1(a,e)}function canParse$1(a,e){return canGetFrameLength(a,e)&&isHeaderPattern$1(a,e)&&getFullFrameLength(a,e)<=a.length-e}function probe$1(a,e){if(isHeader$1(a,e)){const s=getHeaderLength(a,e);if(e+s>=a.length)return!1;const o=getFullFrameLength(a,e);if(o<=s)return!1;const c=e+o;return c===a.length||isHeader$1(a,c)}return!1}function initTrackConfig(a,e,s,o,c){if(!a.samplerate){const d=getAudioConfig(e,s,o,c);if(!d)return;_extends(a,d)}}function getFrameDuration(a){return 1024*9e4/a}function parseFrameHeader(a,e){const s=getHeaderLength(a,e);if(e+s<=a.length){const o=getFullFrameLength(a,e)-s;if(o>0)return{headerLength:s,frameLength:o}}}function appendFrame$2(a,e,s,o,c){const d=getFrameDuration(a.samplerate),h=o+c*d,g=parseFrameHeader(e,s);let _;if(g){const{frameLength:j,headerLength:_e}=g,tt=_e+j,rt=Math.max(0,s+tt-e.length);rt?(_=new Uint8Array(tt-_e),_.set(e.subarray(s+_e,e.length),0)):_=e.subarray(s+_e,s+tt);const nt={unit:_,pts:h};return rt||a.samples.push(nt),{sample:nt,length:tt,missing:rt}}const b=e.length-s;return _=new Uint8Array(b),_.set(e.subarray(s,e.length),0),{sample:{unit:_,pts:h},length:b,missing:-1}}function canParseId3(a,e){return isId3Header(a,e)&&readId3Size(a,e+6)+10<=a.length-e}function toArrayBuffer(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function toUint8(a,e=0,s=1/0){return view(a,e,s,Uint8Array)}function view(a,e,s,o){const c=unsafeGetArrayBuffer(a);let d=1;"BYTES_PER_ELEMENT"in o&&(d=o.BYTES_PER_ELEMENT);const h=isArrayBufferView(a)?a.byteOffset:0,g=(h+a.byteLength)/d,_=(h+e)/d,b=Math.floor(Math.max(0,Math.min(_,g))),$=Math.floor(Math.min(b+Math.max(s,0),g));return new o(c,b,$-b)}function unsafeGetArrayBuffer(a){return a instanceof ArrayBuffer?a:a.buffer}function isArrayBufferView(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function decodeId3ImageFrame(a){const e={key:a.type,description:"",data:"",mimeType:null,pictureType:null},s=3;if(a.size<2)return;if(a.data[0]!==s){console.log("Ignore frame with unrecognized character encoding");return}const o=a.data.subarray(1).indexOf(0);if(o===-1)return;const c=utf8ArrayToStr(toUint8(a.data,1,o)),d=a.data[2+o],h=a.data.subarray(3+o).indexOf(0);if(h===-1)return;const g=utf8ArrayToStr(toUint8(a.data,3+o,h));let _;return c==="-->"?_=utf8ArrayToStr(toUint8(a.data,4+o+h)):_=toArrayBuffer(a.data.subarray(4+o+h)),e.mimeType=c,e.pictureType=d,e.description=g,e.data=_,e}function decodeId3PrivFrame(a){if(a.size<2)return;const e=utf8ArrayToStr(a.data,!0),s=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:s.buffer}}function decodeId3TextFrame(a){if(a.size<2)return;if(a.type==="TXXX"){let s=1;const o=utf8ArrayToStr(a.data.subarray(s),!0);s+=o.length+1;const c=utf8ArrayToStr(a.data.subarray(s));return{key:a.type,info:o,data:c}}const e=utf8ArrayToStr(a.data.subarray(1));return{key:a.type,info:"",data:e}}function decodeId3UrlFrame(a){if(a.type==="WXXX"){if(a.size<2)return;let s=1;const o=utf8ArrayToStr(a.data.subarray(s),!0);s+=o.length+1;const c=utf8ArrayToStr(a.data.subarray(s));return{key:a.type,info:o,data:c}}const e=utf8ArrayToStr(a.data);return{key:a.type,info:"",data:e}}function decodeId3Frame(a){return a.type==="PRIV"?decodeId3PrivFrame(a):a.type[0]==="W"?decodeId3UrlFrame(a):a.type==="APIC"?decodeId3ImageFrame(a):decodeId3TextFrame(a)}function getId3FrameData(a){const e=String.fromCharCode(a[0],a[1],a[2],a[3]),s=readId3Size(a,4),o=10;return{type:e,size:s,data:a.subarray(o,o+s)}}const HEADER_FOOTER_SIZE=10,FRAME_SIZE=10;function getId3Frames(a){let e=0;const s=[];for(;isId3Header(a,e);){const o=readId3Size(a,e+6);a[e+5]>>6&1&&(e+=HEADER_FOOTER_SIZE),e+=HEADER_FOOTER_SIZE;const c=e+o;for(;e+FRAME_SIZE<c;){const d=getId3FrameData(a.subarray(e)),h=decodeId3Frame(d);h&&s.push(h),e+=d.size+HEADER_FOOTER_SIZE}isId3Footer(a,e)&&(e+=HEADER_FOOTER_SIZE)}return s}function isId3TimestampFrame(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function readId3Timestamp(a){if(a.data.byteLength===8){const e=new Uint8Array(a.data),s=e[3]&1;let o=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return o/=45,s&&(o+=4772185884e-2),Math.round(o)}}function getId3Timestamp(a){const e=getId3Frames(a);for(let s=0;s<e.length;s++){const o=e[s];if(isId3TimestampFrame(o))return readId3Timestamp(o)}}let MetadataSchema=function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a}({});function dummyTrack(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,s,o,c){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,s){return!1}appendFrame(e,s,o){}demux(e,s){this.cachedData&&(e=appendUint8Array(this.cachedData,e),this.cachedData=null);let o=getId3Data(e,0),c=o?o.length:0,d;const h=this._audioTrack,g=this._id3Track,_=o?getId3Timestamp(o):void 0,b=e.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(_))&&(this.basePTS=initPTSFn(_,s,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),o&&o.length>0&&g.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:o,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});c<b;){if(this.canParse(e,c)){const $=this.appendFrame(h,e,c);$?(this.frameIndex++,this.lastPTS=$.sample.pts,c+=$.length,d=c):c=b}else canParseId3(e,c)?(o=getId3Data(e,c),g.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:o,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),c+=o.length,d=c):c++;if(c===b&&d!==b){const $=e.slice(d);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,$):this.cachedData=$}}return{audioTrack:h,videoTrack:dummyTrack(),id3Track:g,textTrack:dummyTrack()}}demuxSampleAes(e,s,o){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const s=this.cachedData;return s&&(this.cachedData=null,this.demux(s,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const initPTSFn=(a,e,s)=>{if(isFiniteNumber(a))return a*90;const o=s?s.baseTime*9e4/s.timescale:0;return e*9e4+o};let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(a,e,s,o,c){if(s+24>e.length)return;const d=parseHeader(e,s);if(d&&s+d.frameLength<=e.length){const h=d.samplesPerFrame*9e4/d.sampleRate,g=o+c*h,_={unit:e.subarray(s,s+d.frameLength),pts:g,dts:g};return a.config=[],a.channelCount=d.channelCount,a.samplerate=d.sampleRate,a.samples.push(_),{sample:_,length:d.frameLength,missing:0}}}function parseHeader(a,e){const s=a[e+1]>>3&3,o=a[e+1]>>1&3,c=a[e+2]>>4&15,d=a[e+2]>>2&3;if(s!==1&&c!==0&&c!==15&&d!==3){const h=a[e+2]>>1&1,g=a[e+3]>>6,_=s===3?3-o:o===3?3:4,b=BitratesMap[_*14+c-1]*1e3,j=SamplingRateMap[(s===3?0:s===2?1:2)*3+d],_e=g===3?1:2,tt=SamplesCoefficients[s][o],rt=BytesInSlot[o],nt=tt*8*rt,st=Math.floor(tt*b/j+h)*rt;if(chromeVersion$1===null){const ut=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=ut?parseInt(ut[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&o===2&&b>=224e3&&g===0&&(a[e+3]=a[e+3]|128),{sampleRate:j,channelCount:_e,frameLength:st,samplesPerFrame:nt}}}function isHeaderPattern(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function isHeader(a,e){return e+1<a.length&&isHeaderPattern(a,e)}function canParse(a,e){return isHeaderPattern(a,e)&&4<=a.length-e}function probe(a,e){if(e+1<a.length&&isHeaderPattern(a,e)){const o=parseHeader(a,e);let c=4;o!=null&&o.frameLength&&(c=o.frameLength);const d=e+c;return d===a.length||isHeader(a,d)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(e,s){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=s}resetInitSegment(e,s,o,c){super.resetInitSegment(e,s,o,c),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:s,duration:c,inputTimeScale:9e4,dropped:0}}static probe(e,s){if(!e)return!1;const o=getId3Data(e,0);let c=(o==null?void 0:o.length)||0;if(probe(e,c))return!1;for(let d=e.length;c<d;c++)if(probe$1(e,c))return s.log("ADTS sync word found !"),!0;return!1}canParse(e,s){return canParse$1(e,s)}appendFrame(e,s,o){initTrackConfig(e,this.observer,s,o,e.manifestCodec);const c=appendFrame$2(e,s,o,this.basePTS,this.frameIndex);if(c&&c.missing===0)return c}}const getAudioBSID=(a,e)=>{let s=0,o=5;e+=o;const c=new Uint32Array(1),d=new Uint32Array(1),h=new Uint8Array(1);for(;o>0;){h[0]=a[e];const g=Math.min(o,8),_=8-g;d[0]=4278190080>>>24+_<<_,c[0]=(h[0]&d[0])>>_,s=s?s<<g|c[0]:c[0],e+=1,o-=g}return s};class AC3Demuxer extends BaseAudioDemuxer{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,s,o,c){super.resetInitSegment(e,s,o,c),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:s,duration:c,inputTimeScale:9e4,dropped:0}}canParse(e,s){return s+64<e.length}appendFrame(e,s,o){const c=appendFrame(e,s,o,this.basePTS,this.frameIndex);if(c!==-1)return{sample:e.samples[e.samples.length-1],length:c,missing:0}}static probe(e){if(!e)return!1;const s=getId3Data(e,0);if(!s)return!1;const o=s.length;return e[o]===11&&e[o+1]===119&&getId3Timestamp(s)!==void 0&&getAudioBSID(e,o)<16}}function appendFrame(a,e,s,o,c){if(s+8>e.length||e[s]!==11||e[s+1]!==119)return-1;const d=e[s+4]>>6;if(d>=3)return-1;const g=[48e3,44100,32e3][d],_=e[s+4]&63,$=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][_*3+d]*2;if(s+$>e.length)return-1;const j=e[s+6]>>5;let _e=0;j===2?_e+=2:(j&1&&j!==1&&(_e+=2),j&4&&(_e+=2));const tt=(e[s+6]<<8|e[s+7])>>12-_e&1,nt=[2,1,2,3,3,4,4,5][j]+tt,st=e[s+5]>>3,at=e[s+5]&7,ot=new Uint8Array([d<<6|st<<1|at>>2,(at&3)<<6|j<<3|tt<<2|_>>4,_<<4&224]),ut=1536/g*9e4,mt=o+c*ut,yt=e.subarray(s,s+$);return a.config=ot,a.channelCount=nt,a.samplerate=g,a.samples.push({unit:yt,pts:mt}),$}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(e,s,o,c){super.resetInitSegment(e,s,o,c),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:s,duration:c,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const s=getId3Data(e,0);let o=(s==null?void 0:s.length)||0;if(s&&e[o]===11&&e[o+1]===119&&getId3Timestamp(s)!==void 0&&getAudioBSID(e,o)<=16)return!1;for(let c=e.length;o<c;o++)if(probe(e,o))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,s){return canParse(e,s)}appendFrame(e,s,o){if(this.basePTS!==null)return appendFrame$1(e,s,o,this.basePTS,this.frameIndex)}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(e,s){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=s}resetTimeStamp(){}resetInitSegment(e,s,o,c){const d=this.videoTrack=dummyTrack("video",1),h=this.audioTrack=dummyTrack("audio",1),g=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const _=parseInitSegment(e);if(_.video){const{id:b,timescale:$,codec:j,supplemental:_e}=_.video;d.id=b,d.timescale=g.timescale=$,d.codec=j,d.supplemental=_e}if(_.audio){const{id:b,timescale:$,codec:j}=_.audio;h.id=b,h.timescale=$,h.codec=j}g.id=RemuxerTrackIdConfig.text,d.sampleDuration=0,d.duration=h.duration=c}resetContiguity(){this.remainderData=null}static probe(e){return hasMoofData(e)}demux(e,s){this.timeOffset=s;let o=e;const c=this.videoTrack,d=this.txtTrack;if(this.config.progressive){this.remainderData&&(o=appendUint8Array(this.remainderData,e));const g=segmentValidRange(o);this.remainderData=g.remainder,c.samples=g.valid||new Uint8Array}else c.samples=o;const h=this.extractID3Track(c,s);return d.samples=parseSamples(s,c),{videoTrack:c,audioTrack:this.audioTrack,id3Track:h,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,s=this.videoTrack,o=this.txtTrack;s.samples=this.remainderData||new Uint8Array,this.remainderData=null;const c=this.extractID3Track(s,this.timeOffset);return o.samples=parseSamples(e,s),{videoTrack:s,audioTrack:dummyTrack(),id3Track:c,textTrack:dummyTrack()}}extractID3Track(e,s){const o=this.id3Track;if(e.samples.length){const c=findBox(e.samples,["emsg"]);c&&c.forEach(d=>{const h=parseEmsg(d);if(emsgSchemePattern.test(h.schemeIdUri)){const g=getEmsgStartTime(h,s);let _=h.eventDuration===4294967295?Number.POSITIVE_INFINITY:h.eventDuration/h.timeScale;_<=.001&&(_=Number.POSITIVE_INFINITY);const b=h.payload;o.samples.push({data:b,len:b.byteLength,dts:g,pts:g,type:MetadataSchema.emsg,duration:_})}else if(this.config.enableEmsgKLVMetadata&&h.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const g=getEmsgStartTime(h,s);o.samples.push({data:h.payload,len:h.payload.byteLength,dts:g,pts:g,type:MetadataSchema.misbklv,duration:Number.POSITIVE_INFINITY})}})}return o}demuxSampleAes(e,s,o){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function getEmsgStartTime(a,e){return isFiniteNumber(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale}class SampleAesDecrypter{constructor(e,s,o){this.keyData=void 0,this.decrypter=void 0,this.keyData=o,this.decrypter=new Decrypter(s,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,DecrypterAesMode.cbc)}decryptAacSample(e,s,o){const c=e[s].unit;if(c.length<=16)return;const d=c.subarray(16,c.length-c.length%16),h=d.buffer.slice(d.byteOffset,d.byteOffset+d.length);this.decryptBuffer(h).then(g=>{const _=new Uint8Array(g);c.set(_,16),this.decrypter.isSync()||this.decryptAacSamples(e,s+1,o)}).catch(o)}decryptAacSamples(e,s,o){for(;;s++){if(s>=e.length){o();return}if(!(e[s].unit.length<32)&&(this.decryptAacSample(e,s,o),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const s=Math.floor((e.length-48)/160)*16+16,o=new Int8Array(s);let c=0;for(let d=32;d<e.length-16;d+=160,c+=16)o.set(e.subarray(d,d+16),c);return o}getAvcDecryptedUnit(e,s){const o=new Uint8Array(s);let c=0;for(let d=32;d<e.length-16;d+=160,c+=16)e.set(o.subarray(c,c+16),d);return e}decryptAvcSample(e,s,o,c,d){const h=discardEPB(d.data),g=this.getAvcEncryptedData(h);this.decryptBuffer(g.buffer).then(_=>{d.data=this.getAvcDecryptedUnit(h,_),this.decrypter.isSync()||this.decryptAvcSamples(e,s,o+1,c)}).catch(c)}decryptAvcSamples(e,s,o,c){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;s++,o=0){if(s>=e.length){c();return}const d=e[s].units;for(;!(o>=d.length);o++){const h=d[o];if(!(h.data.length<=48||h.type!==1&&h.type!==5)&&(this.decryptAvcSample(e,s,o,c,h),!this.decrypter.isSync()))return}}}}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(e,s,o){return{key:e,frame:!1,pts:s,dts:o,units:[],length:0}}getLastNalUnit(e){var s;let o=this.VideoSample,c;if((!o||o.units.length===0)&&(o=e[e.length-1]),(s=o)!=null&&s.units){const d=o.units;c=d[d.length-1]}return c}pushAccessUnit(e,s){if(e.units.length&&e.frame){if(e.pts===void 0){const o=s.samples,c=o.length;if(c){const d=o[c-1];e.pts=d.pts,e.dts=d.dts}else{s.dropped++;return}}s.samples.push(e)}}parseNALu(e,s,o){const c=s.byteLength;let d=e.naluState||0;const h=d,g=[];let _=0,b,$,j,_e=-1,tt=0;for(d===-1&&(_e=0,tt=this.getNALuType(s,0),d=0,_=1);_<c;){if(b=s[_++],!d){d=b?0:1;continue}if(d===1){d=b?0:2;continue}if(!b)d=3;else if(b===1){if($=_-d-1,_e>=0){const rt={data:s.subarray(_e,$),type:tt};g.push(rt)}else{const rt=this.getLastNalUnit(e.samples);rt&&(h&&_<=4-h&&rt.state&&(rt.data=rt.data.subarray(0,rt.data.byteLength-h)),$>0&&(rt.data=appendUint8Array(rt.data,s.subarray(0,$)),rt.state=0))}_<c?(j=this.getNALuType(s,_),_e=_,tt=j,d=0):d=-1}else d=0}if(_e>=0&&d>=0){const rt={data:s.subarray(_e,c),type:tt,state:d};g.push(rt)}if(g.length===0){const rt=this.getLastNalUnit(e.samples);rt&&(rt.data=appendUint8Array(rt.data,s))}return e.naluState=d,g}}class ExpGolomb{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,s=this.bytesAvailable,o=e.byteLength-s,c=new Uint8Array(4),d=Math.min(4,s);if(d===0)throw new Error("no bytes available");c.set(e.subarray(o,o+d)),this.word=new DataView(c.buffer).getUint32(0),this.bitsAvailable=d*8,this.bytesAvailable-=d}skipBits(e){let s;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,s=e>>3,e-=s<<3,this.bytesAvailable-=s,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let s=Math.min(this.bitsAvailable,e);const o=this.word>>>32-s;if(e>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=s,this.bitsAvailable>0)this.word<<=s;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return s=e-s,s>0&&this.bitsAvailable?o<<s|this.readBits(s):o}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class AvcVideoParser extends BaseVideoParser{parsePES(e,s,o,c){const d=this.parseNALu(e,o.data,c);let h=this.VideoSample,g,_=!1;o.data=null,h&&d.length&&!e.audFound&&(this.pushAccessUnit(h,e),h=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts)),d.forEach(b=>{var $,j;switch(b.type){case 1:{let nt=!1;g=!0;const st=b.data;if(_&&st.length>4){const at=this.readSliceType(st);(at===2||at===4||at===7||at===9)&&(nt=!0)}if(nt){var _e;(_e=h)!=null&&_e.frame&&!h.key&&(this.pushAccessUnit(h,e),h=this.VideoSample=null)}h||(h=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),h.frame=!0,h.key=nt;break}case 5:g=!0,($=h)!=null&&$.frame&&!h.key&&(this.pushAccessUnit(h,e),h=this.VideoSample=null),h||(h=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),h.key=!0,h.frame=!0;break;case 6:{g=!0,parseSEIMessageFromNALu(b.data,1,o.pts,s.samples);break}case 7:{var tt,rt;g=!0,_=!0;const nt=b.data,st=this.readSPS(nt);if(!e.sps||e.width!==st.width||e.height!==st.height||((tt=e.pixelRatio)==null?void 0:tt[0])!==st.pixelRatio[0]||((rt=e.pixelRatio)==null?void 0:rt[1])!==st.pixelRatio[1]){e.width=st.width,e.height=st.height,e.pixelRatio=st.pixelRatio,e.sps=[nt];const at=nt.subarray(1,4);let ot="avc1.";for(let ut=0;ut<3;ut++){let mt=at[ut].toString(16);mt.length<2&&(mt="0"+mt),ot+=mt}e.codec=ot}break}case 8:g=!0,e.pps=[b.data];break;case 9:g=!0,e.audFound=!0,(j=h)!=null&&j.frame&&(this.pushAccessUnit(h,e),h=null),h||(h=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts));break;case 12:g=!0;break;default:g=!1;break}h&&g&&h.units.push(b)}),c&&h&&(this.pushAccessUnit(h,e),this.VideoSample=null)}getNALuType(e,s){return e[s]&31}readSliceType(e){const s=new ExpGolomb(e);return s.readUByte(),s.readUEG(),s.readUEG()}skipScalingList(e,s){let o=8,c=8,d;for(let h=0;h<e;h++)c!==0&&(d=s.readEG(),c=(o+d+256)%256),o=c===0?o:c}readSPS(e){const s=new ExpGolomb(e);let o=0,c=0,d=0,h=0,g,_,b;const $=s.readUByte.bind(s),j=s.readBits.bind(s),_e=s.readUEG.bind(s),tt=s.readBoolean.bind(s),rt=s.skipBits.bind(s),nt=s.skipEG.bind(s),st=s.skipUEG.bind(s),at=this.skipScalingList.bind(this);$();const ot=$();if(j(5),rt(3),$(),st(),ot===100||ot===110||ot===122||ot===244||ot===44||ot===83||ot===86||ot===118||ot===128){const gt=_e();if(gt===3&&rt(1),st(),st(),rt(1),tt())for(_=gt!==3?8:12,b=0;b<_;b++)tt()&&(b<6?at(16,s):at(64,s))}st();const ut=_e();if(ut===0)_e();else if(ut===1)for(rt(1),nt(),nt(),g=_e(),b=0;b<g;b++)nt();st(),rt(1);const mt=_e(),yt=_e(),Et=j(1);Et===0&&rt(1),rt(1),tt()&&(o=_e(),c=_e(),d=_e(),h=_e());let dt=[1,1];if(tt()&&tt())switch($()){case 1:dt=[1,1];break;case 2:dt=[12,11];break;case 3:dt=[10,11];break;case 4:dt=[16,11];break;case 5:dt=[40,33];break;case 6:dt=[24,11];break;case 7:dt=[20,11];break;case 8:dt=[32,11];break;case 9:dt=[80,33];break;case 10:dt=[18,11];break;case 11:dt=[15,11];break;case 12:dt=[64,33];break;case 13:dt=[160,99];break;case 14:dt=[4,3];break;case 15:dt=[3,2];break;case 16:dt=[2,1];break;case 255:{dt=[$()<<8|$(),$()<<8|$()];break}}return{width:Math.ceil((mt+1)*16-o*2-c*2),height:(2-Et)*(yt+1)*16-(Et?2:4)*(d+h),pixelRatio:dt}}}class HevcVideoParser extends BaseVideoParser{constructor(...e){super(...e),this.initVPS=null}parsePES(e,s,o,c){const d=this.parseNALu(e,o.data,c);let h=this.VideoSample,g,_=!1;o.data=null,h&&d.length&&!e.audFound&&(this.pushAccessUnit(h,e),h=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts)),d.forEach(b=>{var $,j;switch(b.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:h||(h=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts)),h.frame=!0,g=!0;break;case 16:case 17:case 18:case 21:if(g=!0,_){var _e;(_e=h)!=null&&_e.frame&&!h.key&&(this.pushAccessUnit(h,e),h=this.VideoSample=null)}h||(h=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),h.key=!0,h.frame=!0;break;case 19:case 20:g=!0,($=h)!=null&&$.frame&&!h.key&&(this.pushAccessUnit(h,e),h=this.VideoSample=null),h||(h=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),h.key=!0,h.frame=!0;break;case 39:g=!0,parseSEIMessageFromNALu(b.data,2,o.pts,s.samples);break;case 32:g=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=_extends(e.params,this.readVPS(b.data)),this.initVPS=b.data),e.vps=[b.data];break;case 33:if(g=!0,_=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],b.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const tt=this.readSPS(b.data);e.width=tt.width,e.height=tt.height,e.pixelRatio=tt.pixelRatio,e.codec=tt.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const rt in tt.params)e.params[rt]=tt.params[rt]}this.pushParameterSet(e.sps,b.data,e.vps),h||(h=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),h.key=!0;break;case 34:if(g=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const tt=this.readPPS(b.data);for(const rt in tt)e.params[rt]=tt[rt]}this.pushParameterSet(e.pps,b.data,e.vps)}break;case 35:g=!0,e.audFound=!0,(j=h)!=null&&j.frame&&(this.pushAccessUnit(h,e),h=null),h||(h=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts));break;default:g=!1;break}h&&g&&h.units.push(b)}),c&&h&&(this.pushAccessUnit(h,e),this.VideoSample=null)}pushParameterSet(e,s,o){(o&&o[0]===this.initVPS||!o&&!e.length)&&e.push(s)}getNALuType(e,s){return(e[s]&126)>>>1}ebsp2rbsp(e){const s=new Uint8Array(e.byteLength);let o=0;for(let c=0;c<e.byteLength;c++)c>=2&&e[c]===3&&e[c-1]===0&&e[c-2]===0||(s[o]=e[c],o++);return new Uint8Array(s.buffer,0,o)}pushAccessUnit(e,s){super.pushAccessUnit(e,s),this.initVPS&&(this.initVPS=null)}readVPS(e){const s=new ExpGolomb(e);s.readUByte(),s.readUByte(),s.readBits(4),s.skipBits(2),s.readBits(6);const o=s.readBits(3),c=s.readBoolean();return{numTemporalLayers:o+1,temporalIdNested:c}}readSPS(e){const s=new ExpGolomb(this.ebsp2rbsp(e));s.readUByte(),s.readUByte(),s.readBits(4);const o=s.readBits(3);s.readBoolean();const c=s.readBits(2),d=s.readBoolean(),h=s.readBits(5),g=s.readUByte(),_=s.readUByte(),b=s.readUByte(),$=s.readUByte(),j=s.readUByte(),_e=s.readUByte(),tt=s.readUByte(),rt=s.readUByte(),nt=s.readUByte(),st=s.readUByte(),at=s.readUByte(),ot=[],ut=[];for(let ar=0;ar<o;ar++)ot.push(s.readBoolean()),ut.push(s.readBoolean());if(o>0)for(let ar=o;ar<8;ar++)s.readBits(2);for(let ar=0;ar<o;ar++)ot[ar]&&(s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte(),s.readUByte()),ut[ar]&&s.readUByte();s.readUEG();const mt=s.readUEG();mt==3&&s.skipBits(1);const yt=s.readUEG(),Et=s.readUEG(),dt=s.readBoolean();let gt=0,St=0,xt=0,Ct=0;dt&&(gt+=s.readUEG(),St+=s.readUEG(),xt+=s.readUEG(),Ct+=s.readUEG());const Ht=s.readUEG(),Dt=s.readUEG(),rr=s.readUEG(),er=s.readBoolean();for(let ar=er?0:o;ar<=o;ar++)s.skipUEG(),s.skipUEG(),s.skipUEG();if(s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG(),s.readBoolean()&&s.readBoolean())for(let pr=0;pr<4;pr++)for(let kr=0;kr<(pr===3?2:6);kr++)if(!s.readBoolean())s.readUEG();else{const Ar=Math.min(64,1<<4+(pr<<1));pr>1&&s.readEG();for(let Ur=0;Ur<Ar;Ur++)s.readEG()}s.readBoolean(),s.readBoolean(),s.readBoolean()&&(s.readUByte(),s.skipUEG(),s.skipUEG(),s.readBoolean());const Ft=s.readUEG();let Yt=0;for(let ar=0;ar<Ft;ar++){let pr=!1;if(ar!==0&&(pr=s.readBoolean()),pr){ar===Ft&&s.readUEG(),s.readBoolean(),s.readUEG();let kr=0;for(let Or=0;Or<=Yt;Or++){const Ar=s.readBoolean();let Ur=!1;Ar||(Ur=s.readBoolean()),(Ar||Ur)&&kr++}Yt=kr}else{const kr=s.readUEG(),Or=s.readUEG();Yt=kr+Or;for(let Ar=0;Ar<kr;Ar++)s.readUEG(),s.readBoolean();for(let Ar=0;Ar<Or;Ar++)s.readUEG(),s.readBoolean()}}if(s.readBoolean()){const ar=s.readUEG();for(let pr=0;pr<ar;pr++){for(let kr=0;kr<rr+4;kr++)s.readBits(1);s.readBits(1)}}let zt=0,Xt=1,sr=1,Er=!0,Sr=1,_r=0;s.readBoolean(),s.readBoolean();let Fr=!1;if(s.readBoolean()){if(s.readBoolean()){const xr=s.readUByte(),Hr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],sn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];xr>0&&xr<16?(Xt=Hr[xr-1],sr=sn[xr-1]):xr===255&&(Xt=s.readBits(16),sr=s.readBits(16))}if(s.readBoolean()&&s.readBoolean(),s.readBoolean()&&(s.readBits(3),s.readBoolean(),s.readBoolean()&&(s.readUByte(),s.readUByte(),s.readUByte())),s.readBoolean()&&(s.readUEG(),s.readUEG()),s.readBoolean(),s.readBoolean(),s.readBoolean(),Fr=s.readBoolean(),Fr&&(s.skipUEG(),s.skipUEG(),s.skipUEG(),s.skipUEG()),s.readBoolean()&&(Sr=s.readBits(32),_r=s.readBits(32),s.readBoolean()&&s.readUEG(),s.readBoolean())){const sn=s.readBoolean(),Xr=s.readBoolean();let Zr=!1;(sn||Xr)&&(Zr=s.readBoolean(),Zr&&(s.readUByte(),s.readBits(5),s.readBoolean(),s.readBits(5)),s.readBits(4),s.readBits(4),Zr&&s.readBits(4),s.readBits(5),s.readBits(5),s.readBits(5));for(let Tt=0;Tt<=o;Tt++){Er=s.readBoolean();const ct=Er||s.readBoolean();let ft=!1;ct?s.readEG():ft=s.readBoolean();const At=ft?1:s.readUEG()+1;if(sn)for(let Pt=0;Pt<At;Pt++)s.readUEG(),s.readUEG(),Zr&&(s.readUEG(),s.readUEG()),s.skipBits(1);if(Xr)for(let Pt=0;Pt<At;Pt++)s.readUEG(),s.readUEG(),Zr&&(s.readUEG(),s.readUEG()),s.skipBits(1)}}s.readBoolean()&&(s.readBoolean(),s.readBoolean(),s.readBoolean(),zt=s.readUEG())}let yr=yt,qr=Et;if(dt){let ar=1,pr=1;mt===1?ar=pr=2:mt==2&&(ar=2),yr=yt-ar*St-ar*gt,qr=Et-pr*Ct-pr*xt}const Yr=c?["A","B","C"][c]:"",Pr=g<<24|_<<16|b<<8|$;let Bt=0;for(let ar=0;ar<32;ar++)Bt=(Bt|(Pr>>ar&1)<<31-ar)>>>0;let Vt=Bt.toString(16);return h===1&&Vt==="2"&&(Vt="6"),{codecString:`hvc1.${Yr}${h}.${Vt}.${d?"H":"L"}${at}.B0`,params:{general_tier_flag:d,general_profile_idc:h,general_profile_space:c,general_profile_compatibility_flags:[g,_,b,$],general_constraint_indicator_flags:[j,_e,tt,rt,nt,st],general_level_idc:at,bit_depth:Ht+8,bit_depth_luma_minus8:Ht,bit_depth_chroma_minus8:Dt,min_spatial_segmentation_idc:zt,chroma_format_idc:mt,frame_rate:{fixed:Er,fps:_r/Sr}},width:yr,height:qr,pixelRatio:[Xt,sr]}}readPPS(e){const s=new ExpGolomb(this.ebsp2rbsp(e));s.readUByte(),s.readUByte(),s.skipUEG(),s.skipUEG(),s.skipBits(2),s.skipBits(3),s.skipBits(2),s.skipUEG(),s.skipUEG(),s.skipEG(),s.skipBits(2),s.readBoolean()&&s.skipUEG(),s.skipEG(),s.skipEG(),s.skipBits(4);const c=s.readBoolean(),d=s.readBoolean();let h=1;return d&&c?h=0:d?h=3:c&&(h=2),{parallelismType:h}}matchSPS(e,s){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,s).substr(3)}}const PACKET_LENGTH=188;class TSDemuxer{constructor(e,s,o,c){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=s,this.typeSupported=o,this.logger=c,this.videoParser=null}static probe(e,s){const o=TSDemuxer.syncOffset(e);return o>0&&s.warn(`MPEG2-TS detected but first sync word found @ offset ${o}`),o!==-1}static syncOffset(e){const s=e.length;let o=Math.min(PACKET_LENGTH*5,s-PACKET_LENGTH)+1,c=0;for(;c<o;){let d=!1,h=-1,g=0;for(let _=c;_<s;_+=PACKET_LENGTH)if(e[_]===71&&(s-_===PACKET_LENGTH||e[_+PACKET_LENGTH]===71)){if(g++,h===-1&&(h=_,h!==0&&(o=Math.min(h+PACKET_LENGTH*99,e.length-PACKET_LENGTH)+1)),d||(d=parsePID(e,_)===0),d&&g>1&&(h===0&&g>2||_+PACKET_LENGTH>o))return h}else{if(g)return-1;break}c++}return-1}static createTrack(e,s){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?s:void 0}}resetInitSegment(e,s,o,c){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._videoTrack.duration=c,this._audioTrack=TSDemuxer.createTrack("audio",c),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=s,this.videoCodec=o}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:s,_id3Track:o}=this;e&&(e.pesData=null),s&&(s.pesData=null),o&&(o.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,s,o=!1,c=!1){o||(this.sampleAes=null);let d;const h=this._videoTrack,g=this._audioTrack,_=this._id3Track,b=this._txtTrack;let $=h.pid,j=h.pesData,_e=g.pid,tt=_.pid,rt=g.pesData,nt=_.pesData,st=null,at=this.pmtParsed,ot=this._pmtId,ut=e.length;if(this.remainderData&&(e=appendUint8Array(this.remainderData,e),ut=e.length,this.remainderData=null),ut<PACKET_LENGTH&&!c)return this.remainderData=e,{audioTrack:g,videoTrack:h,id3Track:_,textTrack:b};const mt=Math.max(0,TSDemuxer.syncOffset(e));ut-=(ut-mt)%PACKET_LENGTH,ut<e.byteLength&&!c&&(this.remainderData=new Uint8Array(e.buffer,ut,e.buffer.byteLength-ut));let yt=0;for(let dt=mt;dt<ut;dt+=PACKET_LENGTH)if(e[dt]===71){const gt=!!(e[dt+1]&64),St=parsePID(e,dt),xt=(e[dt+3]&48)>>4;let Ct;if(xt>1){if(Ct=dt+5+e[dt+4],Ct===dt+PACKET_LENGTH)continue}else Ct=dt+4;switch(St){case $:gt&&(j&&(d=parsePES(j,this.logger))&&(this.readyVideoParser(h.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(h,b,d,!1)),j={data:[],size:0}),j&&(j.data.push(e.subarray(Ct,dt+PACKET_LENGTH)),j.size+=dt+PACKET_LENGTH-Ct);break;case _e:if(gt){if(rt&&(d=parsePES(rt,this.logger)))switch(g.segmentCodec){case"aac":this.parseAACPES(g,d);break;case"mp3":this.parseMPEGPES(g,d);break;case"ac3":this.parseAC3PES(g,d);break}rt={data:[],size:0}}rt&&(rt.data.push(e.subarray(Ct,dt+PACKET_LENGTH)),rt.size+=dt+PACKET_LENGTH-Ct);break;case tt:gt&&(nt&&(d=parsePES(nt,this.logger))&&this.parseID3PES(_,d),nt={data:[],size:0}),nt&&(nt.data.push(e.subarray(Ct,dt+PACKET_LENGTH)),nt.size+=dt+PACKET_LENGTH-Ct);break;case 0:gt&&(Ct+=e[Ct]+1),ot=this._pmtId=parsePAT(e,Ct);break;case ot:{gt&&(Ct+=e[Ct]+1);const Ht=parsePMT(e,Ct,this.typeSupported,o,this.observer,this.logger);$=Ht.videoPid,$>0&&(h.pid=$,h.segmentCodec=Ht.segmentVideoCodec),_e=Ht.audioPid,_e>0&&(g.pid=_e,g.segmentCodec=Ht.segmentAudioCodec),tt=Ht.id3Pid,tt>0&&(_.pid=tt),st!==null&&!at&&(this.logger.warn(`MPEG-TS PMT found at ${dt} after unknown PID '${st}'. Backtracking to sync byte @${mt} to parse all TS packets.`),st=null,dt=mt-188),at=this.pmtParsed=!0;break}case 17:case 8191:break;default:st=St;break}}else yt++;yt>0&&emitParsingError(this.observer,new Error(`Found ${yt} TS packet/s that do not start with 0x47`),void 0,this.logger),h.pesData=j,g.pesData=rt,_.pesData=nt;const Et={audioTrack:g,videoTrack:h,id3Track:_,textTrack:b};return c&&this.extractRemainingSamples(Et),Et}flush(){const{remainderData:e}=this;this.remainderData=null;let s;return e?s=this.demux(e,-1,!1,!0):s={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(s),this.sampleAes?this.decrypt(s,this.sampleAes):s}extractRemainingSamples(e){const{audioTrack:s,videoTrack:o,id3Track:c,textTrack:d}=e,h=o.pesData,g=s.pesData,_=c.pesData;let b;if(h&&(b=parsePES(h,this.logger))?(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(o,d,b,!0),o.pesData=null)):o.pesData=h,g&&(b=parsePES(g,this.logger))){switch(s.segmentCodec){case"aac":this.parseAACPES(s,b);break;case"mp3":this.parseMPEGPES(s,b);break;case"ac3":this.parseAC3PES(s,b);break}s.pesData=null}else g!=null&&g.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),s.pesData=g;_&&(b=parsePES(_,this.logger))?(this.parseID3PES(c,b),c.pesData=null):c.pesData=_}demuxSampleAes(e,s,o){const c=this.demux(e,o,!0,!this.config.progressive),d=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,s);return this.decrypt(c,d)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new AvcVideoParser:e==="hevc"&&(this.videoParser=new HevcVideoParser))}decrypt(e,s){return new Promise(o=>{const{audioTrack:c,videoTrack:d}=e;c.samples&&c.segmentCodec==="aac"?s.decryptAacSamples(c.samples,0,()=>{d.samples?s.decryptAvcSamples(d.samples,0,0,()=>{o(e)}):o(e)}):d.samples&&s.decryptAvcSamples(d.samples,0,0,()=>{o(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,s){let o=0;const c=this.aacOverFlow;let d=s.data;if(c){this.aacOverFlow=null;const j=c.missing,_e=c.sample.unit.byteLength;if(j===-1)d=appendUint8Array(c.sample.unit,d);else{const tt=_e-j;c.sample.unit.set(d.subarray(0,j),tt),e.samples.push(c.sample),o=c.missing}}let h,g;for(h=o,g=d.length;h<g-1&&!isHeader$1(d,h);h++);if(h!==o){let j;const _e=h<g-1;if(_e?j=`AAC PES did not start with ADTS header,offset:${h}`:j="No ADTS header found in AAC PES",emitParsingError(this.observer,new Error(j),_e,this.logger),!_e)return}initTrackConfig(e,this.observer,d,h,this.audioCodec);let _;if(s.pts!==void 0)_=s.pts;else if(c){const j=getFrameDuration(e.samplerate);_=c.sample.pts+j}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let b=0,$;for(;h<g;)if($=appendFrame$2(e,d,h,_,b),h+=$.length,$.missing){this.aacOverFlow=$;break}else for(b++;h<g-1&&!isHeader$1(d,h);h++);}parseMPEGPES(e,s){const o=s.data,c=o.length;let d=0,h=0;const g=s.pts;if(g===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<c;)if(isHeader(o,h)){const _=appendFrame$1(e,o,h,g,d);if(_)h+=_.length,d++;else break}else h++}parseAC3PES(e,s){{const o=s.data,c=s.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const d=o.length;let h=0,g=0,_;for(;g<d&&(_=appendFrame(e,o,g,c,h++))>0;)g+=_}}parseID3PES(e,s){if(s.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const o=_extends({},s,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(o)}}function parsePID(a,e){return((a[e+1]&31)<<8)+a[e+2]}function parsePAT(a,e){return(a[e+10]&31)<<8|a[e+11]}function parsePMT(a,e,s,o,c,d){const h={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},g=(a[e+1]&15)<<8|a[e+2],_=e+3+g-4,b=(a[e+10]&15)<<8|a[e+11];for(e+=12+b;e<_;){const $=parsePID(a,e),j=(a[e+3]&15)<<8|a[e+4];switch(a[e]){case 207:if(!o){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC",d);break}case 15:h.audioPid===-1&&(h.audioPid=$);break;case 21:h.id3Pid===-1&&(h.id3Pid=$);break;case 219:if(!o){logEncryptedSamplesFoundInUnencryptedStream("H.264",d);break}case 27:h.videoPid===-1&&(h.videoPid=$);break;case 3:case 4:!s.mpeg&&!s.mp3?d.log("MPEG audio found, not supported in this browser"):h.audioPid===-1&&(h.audioPid=$,h.segmentAudioCodec="mp3");break;case 193:if(!o){logEncryptedSamplesFoundInUnencryptedStream("AC-3",d);break}case 129:s.ac3?h.audioPid===-1&&(h.audioPid=$,h.segmentAudioCodec="ac3"):d.log("AC-3 audio found, not supported in this browser");break;case 6:if(h.audioPid===-1&&j>0){let _e=e+5,tt=j;for(;tt>2;){switch(a[_e]){case 106:s.ac3!==!0?d.log("AC-3 audio found, not supported in this browser for now"):(h.audioPid=$,h.segmentAudioCodec="ac3");break}const nt=a[_e+1]+2;_e+=nt,tt-=nt}}break;case 194:case 135:return emitParsingError(c,new Error("Unsupported EC-3 in M2TS found"),void 0,d),h;case 36:h.videoPid===-1&&(h.videoPid=$,h.segmentVideoCodec="hevc",d.log("HEVC in M2TS found"));break}e+=j+5}return h}function emitParsingError(a,e,s,o){o.warn(`parsing error: ${e.message}`),a.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:e,reason:e.message})}function logEncryptedSamplesFoundInUnencryptedStream(a,e){e.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(a,e){let s=0,o,c,d,h,g;const _=a.data;if(!a||a.size===0)return null;for(;_[0].length<19&&_.length>1;)_[0]=appendUint8Array(_[0],_[1]),_.splice(1,1);if(o=_[0],(o[0]<<16)+(o[1]<<8)+o[2]===1){if(c=(o[4]<<8)+o[5],c&&c>a.size-6)return null;const $=o[7];$&192&&(h=(o[9]&14)*536870912+(o[10]&255)*4194304+(o[11]&254)*16384+(o[12]&255)*128+(o[13]&254)/2,$&64?(g=(o[14]&14)*536870912+(o[15]&255)*4194304+(o[16]&254)*16384+(o[17]&255)*128+(o[18]&254)/2,h-g>60*9e4&&(e.warn(`${Math.round((h-g)/9e4)}s delta between PTS and DTS, align them`),h=g)):g=h),d=o[8];let j=d+9;if(a.size<=j)return null;a.size-=j;const _e=new Uint8Array(a.size);for(let tt=0,rt=_.length;tt<rt;tt++){o=_[tt];let nt=o.byteLength;if(j)if(j>nt){j-=nt;continue}else o=o.subarray(j),nt-=j,j=0;_e.set(o,s),s+=nt}return c&&(c-=d+3),{data:_e,pts:h,dts:g,len:c}}return null}class AAC{static getSilentFrame(e,s){switch(e){case"mp4a.40.2":if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in MP4.types)MP4.types.hasOwnProperty(e)&&(MP4.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const s=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),o=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:s,audio:o};const c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),d=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=d,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const h=new Uint8Array([105,115,111,109]),g=new Uint8Array([97,118,99,49]),_=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,h,_,h,g),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,c))}static box(e,...s){let o=8,c=s.length;const d=c;for(;c--;)o+=s[c].byteLength;const h=new Uint8Array(o);for(h[0]=o>>24&255,h[1]=o>>16&255,h[2]=o>>8&255,h[3]=o&255,h.set(e,4),c=0,o=8;c<d;c++)h.set(s[c],o),o+=s[c].byteLength;return h}static hdlr(e){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[e])}static mdat(e){return MP4.box(MP4.types.mdat,e)}static mdhd(e,s){s*=e;const o=Math.floor(s/(UINT32_MAX+1)),c=Math.floor(s%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255,85,196,0,0]))}static mdia(e){return MP4.box(MP4.types.mdia,MP4.mdhd(e.timescale||0,e.duration||0),MP4.hdlr(e.type),MP4.minf(e))}static mfhd(e){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(e)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(e))}static moof(e,s,o){return MP4.box(MP4.types.moof,MP4.mfhd(e),MP4.traf(o,s))}static moov(e){let s=e.length;const o=[];for(;s--;)o[s]=MP4.trak(e[s]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(e[0].timescale||0,e[0].duration||0)].concat(o).concat(MP4.mvex(e)))}static mvex(e){let s=e.length;const o=[];for(;s--;)o[s]=MP4.trex(e[s]);return MP4.box.apply(null,[MP4.types.mvex,...o])}static mvhd(e,s){s*=e;const o=Math.floor(s/(UINT32_MAX+1)),c=Math.floor(s%(UINT32_MAX+1)),d=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,d)}static sdtp(e){const s=e.samples||[],o=new Uint8Array(4+s.length);let c,d;for(c=0;c<s.length;c++)d=s[c].flags,o[c+4]=d.dependsOn<<4|d.isDependedOn<<2|d.hasRedundancy;return MP4.box(MP4.types.sdtp,o)}static stbl(e){return MP4.box(MP4.types.stbl,MP4.stsd(e),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(e){let s=[],o=[],c,d,h;for(c=0;c<e.sps.length;c++)d=e.sps[c],h=d.byteLength,s.push(h>>>8&255),s.push(h&255),s=s.concat(Array.prototype.slice.call(d));for(c=0;c<e.pps.length;c++)d=e.pps[c],h=d.byteLength,o.push(h>>>8&255),o.push(h&255),o=o.concat(Array.prototype.slice.call(d));const g=MP4.box(MP4.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(o))),_=e.width,b=e.height,$=e.pixelRatio[0],j=e.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>8&255,_&255,b>>8&255,b&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),g,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([$>>24,$>>16&255,$>>8&255,$&255,j>>24,j>>16&255,j>>8&255,j&255])))}static esds(e){const s=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...s,6,1,2])}static audioStsd(e){const s=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,s>>8&255,s&255,0,0])}static mp4a(e){return MP4.box(MP4.types.mp4a,MP4.audioStsd(e),MP4.box(MP4.types.esds,MP4.esds(e)))}static mp3(e){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(e))}static ac3(e){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(e),MP4.box(MP4.types.dac3,e.config))}static stsd(e){const{segmentCodec:s}=e;if(e.type==="audio"){if(s==="aac")return MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(e));if(s==="ac3"&&e.config)return MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(e));if(s==="mp3"&&e.codec==="mp3")return MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(e))}else if(e.pps&&e.sps){if(s==="avc")return MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(e));if(s==="hevc"&&e.vps)return MP4.box(MP4.types.stsd,MP4.STSD,MP4.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${s}/${e.codec})`)}static tkhd(e){const s=e.id,o=(e.duration||0)*(e.timescale||0),c=e.width||0,d=e.height||0,h=Math.floor(o/(UINT32_MAX+1)),g=Math.floor(o%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,s&255,0,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>8&255,c&255,0,0,d>>8&255,d&255,0,0]))}static traf(e,s){const o=MP4.sdtp(e),c=e.id,d=Math.floor(s/(UINT32_MAX+1)),h=Math.floor(s%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])),MP4.trun(e,o.length+16+20+8+16+8+8),o)}static trak(e){return e.duration=e.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(e),MP4.mdia(e))}static trex(e){const s=e.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,s){const o=e.samples||[],c=o.length,d=12+16*c,h=new Uint8Array(d);let g,_,b,$,j,_e;for(s+=8+d,h.set([e.type==="video"?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0),g=0;g<c;g++)_=o[g],b=_.duration,$=_.size,j=_.flags,_e=_.cts,h.set([b>>>24&255,b>>>16&255,b>>>8&255,b&255,$>>>24&255,$>>>16&255,$>>>8&255,$&255,j.isLeading<<2|j.dependsOn,j.isDependedOn<<6|j.hasRedundancy<<4|j.paddingValue<<1|j.isNonSync,j.degradPrio&61440,j.degradPrio&15,_e>>>24&255,_e>>>16&255,_e>>>8&255,_e&255],12+16*g);return MP4.box(MP4.types.trun,h)}static initSegment(e){MP4.types||MP4.init();const s=MP4.moov(e);return appendUint8Array(MP4.FTYP,s)}static hvc1(e){const s=e.params,o=[e.vps,e.sps,e.pps],c=4,d=new Uint8Array([1,s.general_profile_space<<6|(s.general_tier_flag?32:0)|s.general_profile_idc,s.general_profile_compatibility_flags[0],s.general_profile_compatibility_flags[1],s.general_profile_compatibility_flags[2],s.general_profile_compatibility_flags[3],s.general_constraint_indicator_flags[0],s.general_constraint_indicator_flags[1],s.general_constraint_indicator_flags[2],s.general_constraint_indicator_flags[3],s.general_constraint_indicator_flags[4],s.general_constraint_indicator_flags[5],s.general_level_idc,240|s.min_spatial_segmentation_idc>>8,255&s.min_spatial_segmentation_idc,252|s.parallelismType,252|s.chroma_format_idc,248|s.bit_depth_luma_minus8,248|s.bit_depth_chroma_minus8,0,parseInt(s.frame_rate.fps),c-1|s.temporal_id_nested<<2|s.num_temporal_layers<<3|(s.frame_rate.fixed?64:0),o.length]);let h=d.length;for(let rt=0;rt<o.length;rt+=1){h+=3;for(let nt=0;nt<o[rt].length;nt+=1)h+=2+o[rt][nt].length}const g=new Uint8Array(h);g.set(d,0),h=d.length;const _=o.length-1;for(let rt=0;rt<o.length;rt+=1){g.set(new Uint8Array([32+rt|(rt===_?128:0),0,o[rt].length]),h),h+=3;for(let nt=0;nt<o[rt].length;nt+=1)g.set(new Uint8Array([o[rt][nt].length>>8,o[rt][nt].length&255]),h),h+=2,g.set(o[rt][nt],h),h+=o[rt][nt].length}const b=MP4.box(MP4.types.hvcC,g),$=e.width,j=e.height,_e=e.pixelRatio[0],tt=e.pixelRatio[1];return MP4.box(MP4.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,$>>8&255,$&255,j>>8&255,j&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),b,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([_e>>24,_e>>16&255,_e>>8&255,_e&255,tt>>24,tt>>16&255,tt>>8&255,tt&255])))}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(a,e,s=1,o=!1){const c=a*e*s;return o?Math.round(c):c}function toTimescaleFromScale(a,e,s=1,o=!1){return toTimescaleFromBase(a,e,1/s,o)}function toMsFromMpegTsClock(a,e=!1){return toTimescaleFromBase(a,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,e)}function toMpegTsClockFromTimescale(a,e=1){return toTimescaleFromBase(a,MPEG_TS_CLOCK_FREQ_HZ,1/e)}function timestampToString(a){const{baseTime:e,timescale:s,trackId:o}=a;return`${e/s} (${e}/${s}) trackId: ${o}`}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;function createMp4Sample(a,e,s,o){return{duration:e,size:s,cts:o,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}class MP4Remuxer extends Logger{constructor(e,s,o,c){if(super("mp4-remuxer",c),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=s,this.typeSupported=o,this.ISGenerated=!1,chromeVersion===null){const h=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=h?parseInt(h[1]):0}if(safariWebkitVersion===null){const d=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=d?parseInt(d[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const s=this._initPTS;(!s||!e||e.trackId!==s.trackId||e.baseTime!==s.baseTime||e.timescale!==s.timescale)&&this.log(`Reset initPTS: ${s&&timestampToString(s)} > ${e&&timestampToString(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let s=!1;const o=e[0].pts,c=e.reduce((d,h)=>{let g=h.pts,_=g-d;return _<-4294967296&&(s=!0,g=normalizePts(g,o),_=g-d),_>0?d:g},o);return s&&this.debug("PTS rollover detected"),c}remux(e,s,o,c,d,h,g,_){let b,$,j,_e,tt,rt,nt=d,st=d;const at=e.pid>-1,ot=s.pid>-1,ut=s.samples.length,mt=e.samples.length>0,yt=g&&ut>0||ut>1;if((!at||mt)&&(!ot||yt)||this.ISGenerated||g){if(this.ISGenerated){var dt,gt,St,xt;const rr=this.videoTrackConfig;(rr&&(s.width!==rr.width||s.height!==rr.height||((dt=s.pixelRatio)==null?void 0:dt[0])!==((gt=rr.pixelRatio)==null?void 0:gt[0])||((St=s.pixelRatio)==null?void 0:St[1])!==((xt=rr.pixelRatio)==null?void 0:xt[1]))||!rr&&yt||this.nextAudioTs===null&&mt)&&this.resetInitSegment()}this.ISGenerated||(j=this.generateIS(e,s,d,h));const Ct=this.isVideoContiguous;let Ht=-1,Dt;if(yt&&(Ht=findKeyframeIndex(s.samples),!Ct&&this.config.forceKeyFrameOnDiscontinuity))if(rt=!0,Ht>0){this.warn(`Dropped ${Ht} out of ${ut} video samples due to a missing keyframe`);const rr=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(Ht),s.dropped+=Ht,st+=(s.samples[0].pts-rr)/s.inputTimeScale,Dt=st}else Ht===-1&&(this.warn(`No keyframe found out of ${ut} video samples`),rt=!1);if(this.ISGenerated){if(mt&&yt){const rr=this.getVideoStartPts(s.samples),qt=(normalizePts(e.samples[0].pts,rr)-rr)/s.inputTimeScale;nt+=Math.max(0,qt),st+=Math.max(0,-qt)}if(mt){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),j=this.generateIS(e,s,d,h)),$=this.remuxAudio(e,nt,this.isAudioContiguous,h,ot||yt||_===PlaylistLevelType.AUDIO?st:void 0),yt){const rr=$?$.endPTS-$.startPTS:0;s.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),j=this.generateIS(e,s,d,h)),b=this.remuxVideo(s,st,Ct,rr)}}else yt&&(b=this.remuxVideo(s,st,Ct,0));b&&(b.firstKeyFrame=Ht,b.independent=Ht!==-1,b.firstKeyFramePTS=Dt)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(o.samples.length&&(tt=flushTextTrackMetadataCueSamples(o,d,this._initPTS,this._initDTS)),c.samples.length&&(_e=flushTextTrackUserdataCueSamples(c,d,this._initPTS))),{audio:$,video:b,initSegment:j,independent:rt,text:_e,id3:tt}}computeInitPts(e,s,o,c){const d=Math.round(o*s);let h=normalizePts(e,d);if(h<d+s)for(this.log(`Adjusting PTS for rollover in timeline near ${(d-h)/s} ${c}`);h<d+s;)h+=8589934592;return h-d}generateIS(e,s,o,c){const d=e.samples,h=s.samples,g=this.typeSupported,_={},b=this._initPTS;let $=!b||c,j="audio/mp4",_e,tt,rt,nt=-1;if($&&(_e=tt=1/0),e.config&&d.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":g.mpeg?(j="audio/mpeg",e.codec=""):g.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}_.audio={id:"audio",container:j,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&g.mpeg?new Uint8Array(0):MP4.initSegment([e]),metadata:{channelCount:e.channelCount}},$&&(nt=e.id,rt=e.inputTimeScale,!b||rt!==b.timescale?_e=tt=this.computeInitPts(d[0].pts,rt,o,"audio"):$=!1)}if(s.sps&&s.pps&&h.length){if(s.timescale=s.inputTimeScale,_.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:MP4.initSegment([s]),metadata:{width:s.width,height:s.height}},$)if(nt=s.id,rt=s.inputTimeScale,!b||rt!==b.timescale){const st=this.getVideoStartPts(h),at=normalizePts(h[0].dts,st),ot=this.computeInitPts(at,rt,o,"video"),ut=this.computeInitPts(st,rt,o,"video");tt=Math.min(tt,ot),_e=Math.min(_e,ut)}else $=!1;this.videoTrackConfig={width:s.width,height:s.height,pixelRatio:s.pixelRatio}}if(Object.keys(_).length)return this.ISGenerated=!0,$?(b&&this.warn(`Timestamps at playlist time: ${c?"":"~"}${o} ${_e/rt} != initPTS: ${b.baseTime/b.timescale} (${b.baseTime}/${b.timescale}) trackId: ${b.trackId}`),this.log(`Found initPTS at playlist time: ${o} offset: ${_e/rt} (${_e}/${rt}) trackId: ${nt}`),this._initPTS={baseTime:_e,timescale:rt,trackId:nt},this._initDTS={baseTime:tt,timescale:rt,trackId:nt}):_e=rt=void 0,{tracks:_,initPTS:_e,timescale:rt,trackId:nt}}remuxVideo(e,s,o,c){const d=e.inputTimeScale,h=e.samples,g=[],_=h.length,b=this._initPTS,$=b.baseTime*d/b.timescale;let j=this.nextVideoTs,_e=8,tt=this.videoSampleDuration,rt,nt,st=Number.POSITIVE_INFINITY,at=Number.NEGATIVE_INFINITY,ot=!1;if(!o||j===null){const zt=$+s*d,Xt=h[0].pts-normalizePts(h[0].dts,h[0].pts);chromeVersion&&j!==null&&Math.abs(zt-Xt-(j+$))<15e3?o=!0:j=zt-Xt-$}const ut=j+$;for(let zt=0;zt<_;zt++){const Xt=h[zt];Xt.pts=normalizePts(Xt.pts,ut),Xt.dts=normalizePts(Xt.dts,ut),Xt.dts<h[zt>0?zt-1:zt].dts&&(ot=!0)}ot&&h.sort(function(zt,Xt){const sr=zt.dts-Xt.dts,Er=zt.pts-Xt.pts;return sr||Er}),rt=h[0].dts,nt=h[h.length-1].dts;const mt=nt-rt,yt=mt?Math.round(mt/(_-1)):tt||e.inputTimeScale/30;if(o){const zt=rt-ut,Xt=zt>yt,sr=zt<-1;if((Xt||sr)&&(Xt?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${toMsFromMpegTsClock(zt,!0)} ms (${zt}dts) hole between fragments detected at ${s.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${toMsFromMpegTsClock(-zt,!0)} ms (${zt}dts) overlapping between fragments detected at ${s.toFixed(3)}`),!sr||ut>=h[0].pts||chromeVersion)){rt=ut;const Er=h[0].pts-zt;if(Xt)h[0].dts=rt,h[0].pts=Er;else{let Sr=!0;for(let _r=0;_r<h.length&&!(h[_r].dts>Er&&Sr);_r++){const Fr=h[_r].pts;if(h[_r].dts-=zt,h[_r].pts-=zt,_r<h.length-1){const $r=h[_r+1].pts,yr=h[_r].pts,qr=$r<=yr,Yr=$r<=Fr;Sr=qr==Yr}}}this.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(Er,!0)}/${toMsFromMpegTsClock(rt,!0)}, delta: ${toMsFromMpegTsClock(zt,!0)} ms`)}}rt=Math.max(0,rt);let Et=0,dt=0,gt=rt;for(let zt=0;zt<_;zt++){const Xt=h[zt],sr=Xt.units,Er=sr.length;let Sr=0;for(let _r=0;_r<Er;_r++)Sr+=sr[_r].data.length;dt+=Sr,Et+=Er,Xt.length=Sr,Xt.dts<gt?(Xt.dts=gt,gt+=yt/4|0||1):gt=Xt.dts,st=Math.min(Xt.pts,st),at=Math.max(Xt.pts,at)}nt=h[_-1].dts;const St=dt+4*Et+8;let xt;try{xt=new Uint8Array(St)}catch(zt){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:zt,bytes:St,reason:`fail allocating video mdat ${St}`});return}const Ct=new DataView(xt.buffer);Ct.setUint32(0,St),xt.set(MP4.types.mdat,4);let Ht=!1,Dt=Number.POSITIVE_INFINITY,rr=Number.POSITIVE_INFINITY,er=Number.NEGATIVE_INFINITY,qt=Number.NEGATIVE_INFINITY;for(let zt=0;zt<_;zt++){const Xt=h[zt],sr=Xt.units;let Er=0;for(let Fr=0,$r=sr.length;Fr<$r;Fr++){const yr=sr[Fr],qr=yr.data,Yr=yr.data.byteLength;Ct.setUint32(_e,Yr),_e+=4,xt.set(qr,_e),_e+=Yr,Er+=4+Yr}let Sr;if(zt<_-1)tt=h[zt+1].dts-Xt.dts,Sr=h[zt+1].pts-Xt.pts;else{const Fr=this.config,$r=zt>0?Xt.dts-h[zt-1].dts:yt;if(Sr=zt>0?Xt.pts-h[zt-1].pts:yt,Fr.stretchShortVideoTrack&&this.nextAudioTs!==null){const yr=Math.floor(Fr.maxBufferHole*d),qr=(c?st+c*d:this.nextAudioTs+$)-Xt.pts;qr>yr?(tt=qr-$r,tt<0?tt=$r:Ht=!0,this.log(`It is approximately ${qr/90} ms to the next segment; using duration ${tt/90} ms for the last video frame.`)):tt=$r}else tt=$r}const _r=Math.round(Xt.pts-Xt.dts);Dt=Math.min(Dt,tt),er=Math.max(er,tt),rr=Math.min(rr,Sr),qt=Math.max(qt,Sr),g.push(createMp4Sample(Xt.key,tt,Er,_r))}if(g.length){if(chromeVersion){if(chromeVersion<70){const zt=g[0].flags;zt.dependsOn=2,zt.isNonSync=0}}else if(safariWebkitVersion&&qt-rr<er-Dt&&yt/er<.025&&g[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let zt=rt;for(let Xt=0,sr=g.length;Xt<sr;Xt++){const Er=zt+g[Xt].duration,Sr=zt+g[Xt].cts;if(Xt<sr-1){const _r=Er+g[Xt+1].cts;g[Xt].duration=_r-Sr}else g[Xt].duration=Xt?g[Xt-1].duration:yt;g[Xt].cts=0,zt=Er}}}tt=Ht||!tt?yt:tt;const tr=nt+tt;this.nextVideoTs=j=tr-$,this.videoSampleDuration=tt,this.isVideoContiguous=!0;const Qt={data1:MP4.moof(e.sequenceNumber++,rt,_extends(e,{samples:g})),data2:xt,startPTS:(st-$)/d,endPTS:(at+tt-$)/d,startDTS:(rt-$)/d,endDTS:j/d,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Qt}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(e,s,o,c,d){const h=e.inputTimeScale,g=e.samplerate?e.samplerate:h,_=h/g,b=this.getSamplesPerFrame(e),$=b*_,j=this._initPTS,_e=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,tt=[],rt=d!==void 0;let nt=e.samples,st=_e?0:8,at=this.nextAudioTs||-1;const ot=j.baseTime*h/j.timescale,ut=ot+s*h;if(this.isAudioContiguous=o=o||nt.length&&at>0&&(c&&Math.abs(ut-(at+ot))<9e3||Math.abs(normalizePts(nt[0].pts,ut)-(at+ot))<20*$),nt.forEach(function(qt){qt.pts=normalizePts(qt.pts,ut)}),!o||at<0){const qt=nt.length;if(nt=nt.filter(tr=>tr.pts>=0),qt!==nt.length&&this.warn(`Removed ${nt.length-qt} of ${qt} samples (initPTS ${ot} / ${h})`),!nt.length)return;d===0?at=0:c&&!rt?at=Math.max(0,ut-ot):at=nt[0].pts-ot}if(e.segmentCodec==="aac"){const qt=this.config.maxAudioFramesDrift;for(let tr=0,Ft=at+ot;tr<nt.length;tr++){const Yt=nt[tr],Qt=Yt.pts,zt=Qt-Ft,Xt=Math.abs(1e3*zt/h);if(zt<=-qt*$&&rt)tr===0&&(this.warn(`Audio frame @ ${(Qt/h).toFixed(3)}s overlaps marker by ${Math.round(1e3*zt/h)} ms.`),this.nextAudioTs=at=Qt-ot,Ft=Qt);else if(zt>=qt*$&&Xt<MAX_SILENT_FRAME_DURATION&&rt){let sr=Math.round(zt/$);for(Ft=Qt-sr*$;Ft<0&&sr&&$;)sr--,Ft+=$;tr===0&&(this.nextAudioTs=at=Ft-ot),this.warn(`Injecting ${sr} audio frames @ ${((Ft-ot)/h).toFixed(3)}s due to ${Math.round(1e3*zt/h)} ms gap.`);for(let Er=0;Er<sr;Er++){let Sr=AAC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Sr||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Sr=Yt.unit.subarray()),nt.splice(tr,0,{unit:Sr,pts:Ft}),Ft+=$,tr++}}Yt.pts=Ft,Ft+=$}}let mt=null,yt=null,Et,dt=0,gt=nt.length;for(;gt--;)dt+=nt[gt].unit.byteLength;for(let qt=0,tr=nt.length;qt<tr;qt++){const Ft=nt[qt],Yt=Ft.unit;let Qt=Ft.pts;if(yt!==null){const Xt=tt[qt-1];Xt.duration=Math.round((Qt-yt)/_)}else if(o&&e.segmentCodec==="aac"&&(Qt=at+ot),mt=Qt,dt>0){dt+=st;try{Et=new Uint8Array(dt)}catch(Xt){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Xt,bytes:dt,reason:`fail allocating audio mdat ${dt}`});return}_e||(new DataView(Et.buffer).setUint32(0,dt),Et.set(MP4.types.mdat,4))}else return;Et.set(Yt,st);const zt=Yt.byteLength;st+=zt,tt.push(createMp4Sample(!0,b,zt,0)),yt=Qt}const St=tt.length;if(!St)return;const xt=tt[tt.length-1];at=yt-ot,this.nextAudioTs=at+_*xt.duration;const Ct=_e?new Uint8Array(0):MP4.moof(e.sequenceNumber++,mt/_,_extends({},e,{samples:tt}));e.samples=[];const Ht=(mt-ot)/h,Dt=this.nextAudioTs/h,er={data1:Ct,data2:Et,startPTS:Ht,endPTS:Dt,startDTS:Ht,endDTS:Dt,type:"audio",hasAudio:!0,hasVideo:!1,nb:St};return this.isAudioContiguous=!0,er}}function normalizePts(a,e){let s;if(e===null)return a;for(e<a?s=-8589934592:s=8589934592;Math.abs(a-e)>4294967296;)a+=s;return a}function findKeyframeIndex(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function flushTextTrackMetadataCueSamples(a,e,s,o){const c=a.samples.length;if(!c)return;const d=a.inputTimeScale;for(let g=0;g<c;g++){const _=a.samples[g];_.pts=normalizePts(_.pts-s.baseTime*d/s.timescale,e*d)/d,_.dts=normalizePts(_.dts-o.baseTime*d/o.timescale,e*d)/d}const h=a.samples;return a.samples=[],{samples:h}}function flushTextTrackUserdataCueSamples(a,e,s){const o=a.samples.length;if(!o)return;const c=a.inputTimeScale;for(let h=0;h<o;h++){const g=a.samples[h];g.pts=normalizePts(g.pts-s.baseTime*c/s.timescale,e*c)/c}a.samples.sort((h,g)=>h.pts-g.pts);const d=a.samples;return a.samples=[],{samples:d}}class PassThroughRemuxer extends Logger{constructor(e,s,o,c){super("passthrough-remuxer",c),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const s=this.initPTS;s&&e&&s.baseTime===e.baseTime&&s.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,s,o,c){this.audioCodec=s,this.videoCodec=o,this.generateInitSegment(e,c),this.emitInitSegment=!0}generateInitSegment(e,s){let{audioCodec:o,videoCodec:c}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:d,video:h}=this.initData=parseInitSegment(e);if(s)patchEncyptionData(e,s);else{const _=d||h;_!=null&&_.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${_.codec}")!`)}d&&(o=getParsedTrackCodec(d,ElementaryStreamTypes.AUDIO,this)),h&&(c=getParsedTrackCodec(h,ElementaryStreamTypes.VIDEO,this));const g={};d&&h?g.audiovideo={container:"video/mp4",codec:o+","+c,supplemental:h.supplemental,encrypted:h.encrypted,initSegment:e,id:"main"}:d?g.audio={container:"audio/mp4",codec:o,encrypted:d.encrypted,initSegment:e,id:"audio"}:h?g.video={container:"video/mp4",codec:c,supplemental:h.supplemental,encrypted:h.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=g}remux(e,s,o,c,d,h){var g,_;let{initPTS:b,lastEndTime:$}=this;const j={audio:void 0,video:void 0,text:c,id3:o,initSegment:void 0};isFiniteNumber($)||($=this.lastEndTime=d||0);const _e=s.samples;if(!_e.length)return j;const tt={initPTS:void 0,timescale:void 0,trackId:void 0};let rt=this.initData;if((g=rt)!=null&&g.length||(this.generateInitSegment(_e),rt=this.initData),!((_=rt)!=null&&_.length))return this.warn("Failed to generate initSegment."),j;this.emitInitSegment&&(tt.tracks=this.initTracks,this.emitInitSegment=!1);const nt=getSampleData(_e,rt,this),st=rt.audio?nt[rt.audio.id]:null,at=rt.video?nt[rt.video.id]:null,ot=toStartEndOrDefault(at,1/0),ut=toStartEndOrDefault(st,1/0),mt=toStartEndOrDefault(at,0,!0),yt=toStartEndOrDefault(st,0,!0);let Et=d,dt=0;const gt=st&&(!at||!b&&ut<ot||b&&b.trackId===rt.audio.id),St=gt?st:at;if(St){const Ft=St.timescale,Yt=St.start-d*Ft,Qt=gt?rt.audio.id:rt.video.id;Et=St.start/Ft,dt=gt?yt-ut:mt-ot,(h||!b)&&(isInvalidInitPts(b,Et,d,dt)||Ft!==b.timescale)&&(b&&this.warn(`Timestamps at playlist time: ${h?"":"~"}${d} ${Yt/Ft} != initPTS: ${b.baseTime/b.timescale} (${b.baseTime}/${b.timescale}) trackId: ${b.trackId}`),this.log(`Found initPTS at playlist time: ${d} offset: ${Et-d} (${Yt}/${Ft}) trackId: ${Qt}`),b=null,tt.initPTS=Yt,tt.timescale=Ft,tt.trackId=Qt)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${d}`);b?(tt.initPTS=b.baseTime,tt.timescale=b.timescale,tt.trackId=b.trackId):((!tt.timescale||tt.trackId===void 0||tt.initPTS===void 0)&&(this.warn("Could not set initPTS"),tt.initPTS=Et,tt.timescale=1,tt.trackId=-1),this.initPTS=b={baseTime:tt.initPTS,timescale:tt.timescale,trackId:tt.trackId});const xt=Et-b.baseTime/b.timescale,Ct=xt+dt;dt>0?this.lastEndTime=Ct:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Ht=!!rt.audio,Dt=!!rt.video;let rr="";Ht&&(rr+="audio"),Dt&&(rr+="video");const er=(rt.audio?rt.audio.encrypted:!1)||(rt.video?rt.video.encrypted:!1),qt={data1:_e,startPTS:xt,startDTS:xt,endPTS:Ct,endDTS:Ct,type:rr,hasAudio:Ht,hasVideo:Dt,nb:1,dropped:0,encrypted:er};j.audio=Ht&&!Dt?qt:void 0,j.video=Dt?qt:void 0;const tr=at==null?void 0:at.sampleCount;if(tr){const Ft=at.keyFrameIndex,Yt=Ft!==-1;qt.nb=tr,qt.dropped=Ft===0||this.isVideoContiguous?0:Yt?Ft:tr,qt.independent=Yt,qt.firstKeyFrame=Ft,Yt&&at.keyFrameStart&&(qt.firstKeyFramePTS=(at.keyFrameStart-b.baseTime)/b.timescale),this.isVideoContiguous||(j.independent=Yt),this.isVideoContiguous||(this.isVideoContiguous=Yt),qt.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Ft}/${tr} dropped: ${qt.dropped} start: ${qt.firstKeyFramePTS||"NA"}`)}return j.initSegment=tt,j.id3=flushTextTrackMetadataCueSamples(o,d,b,b),c.samples.length&&(j.text=flushTextTrackUserdataCueSamples(c,d,b)),j}}function toStartEndOrDefault(a,e,s=!1){return(a==null?void 0:a.start)!==void 0?(a.start+(s?a.duration:0))/a.timescale:e}function isInvalidInitPts(a,e,s,o){if(a===null)return!0;const c=Math.max(o,1),d=e-a.baseTime/a.timescale;return Math.abs(d-s)>c}function getParsedTrackCodec(a,e,s){const o=a.codec;return o&&o.length>4?o:e===ElementaryStreamTypes.AUDIO?o==="ec-3"||o==="ac-3"||o==="alac"?o:o==="fLaC"||o==="Opus"?getCodecCompatibleName(o,!1):(s.warn(`Unhandled audio codec "${o}" in mp4 MAP`),o||"mp4a"):(s.warn(`Unhandled video codec "${o}" in mp4 MAP`),o||"avc1")}let now;try{now=self.performance.now.bind(self.performance)}catch(a){now=Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(e,s,o,c,d,h){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=s,this.config=o,this.id=d,this.logger=h}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,s,o,c){const d=o.transmuxing;d.executeStart=now();let h=new Uint8Array(e);const{currentTransmuxState:g,transmuxConfig:_}=this;c&&(this.currentTransmuxState=c);const{contiguous:b,discontinuity:$,trackSwitch:j,accurateTimeOffset:_e,timeOffset:tt,initSegmentChange:rt}=c||g,{audioCodec:nt,videoCodec:st,defaultInitPts:at,duration:ot,initSegmentData:ut}=_,mt=getEncryptionType(h,s);if(mt&&isFullSegmentEncryption(mt.method)){const gt=this.getDecrypter(),St=getAesModeFromFullSegmentMethod(mt.method);if(gt.isSync()){let xt=gt.softwareDecrypt(h,mt.key.buffer,mt.iv.buffer,St);if(o.part>-1){const Ht=gt.flush();xt=Ht&&Ht.buffer}if(!xt)return d.executeEnd=now(),emptyResult(o);h=new Uint8Array(xt)}else return this.asyncResult=!0,this.decryptionPromise=gt.webCryptoDecrypt(h,mt.key.buffer,mt.iv.buffer,St).then(xt=>{const Ct=this.push(xt,null,o);return this.decryptionPromise=null,Ct}),this.decryptionPromise}const yt=this.needsProbing($,j);if(yt){const gt=this.configureTransmuxer(h);if(gt)return this.logger.warn(`[transmuxer] ${gt.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:gt,reason:gt.message}),d.executeEnd=now(),emptyResult(o)}($||j||rt||yt)&&this.resetInitSegment(ut,nt,st,ot,s),($||rt||yt)&&this.resetInitialTimestamp(at),b||this.resetContiguity();const Et=this.transmux(h,mt,tt,_e,o);this.asyncResult=isPromise(Et);const dt=this.currentTransmuxState;return dt.contiguous=!0,dt.discontinuity=!1,dt.trackSwitch=!1,d.executeEnd=now(),Et}flush(e){const s=e.transmuxing;s.executeStart=now();const{decrypter:o,currentTransmuxState:c,decryptionPromise:d}=this;if(d)return this.asyncResult=!0,d.then(()=>this.flush(e));const h=[],{timeOffset:g}=c;if(o){const j=o.flush();j&&h.push(this.push(j.buffer,null,e))}const{demuxer:_,remuxer:b}=this;if(!_||!b){s.executeEnd=now();const j=[emptyResult(e)];return this.asyncResult?Promise.resolve(j):j}const $=_.flush(g);return isPromise($)?(this.asyncResult=!0,$.then(j=>(this.flushRemux(h,j,e),h))):(this.flushRemux(h,$,e),this.asyncResult?Promise.resolve(h):h)}flushRemux(e,s,o){const{audioTrack:c,videoTrack:d,id3Track:h,textTrack:g}=s,{accurateTimeOffset:_,timeOffset:b}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${o.sn}${o.part>-1?" part: "+o.part:""} of ${this.id===PlaylistLevelType.MAIN?"level":"track"} ${o.level}`);const $=this.remuxer.remux(c,d,h,g,b,_,!0,this.id);e.push({remuxResult:$,chunkMeta:o}),o.transmuxing.executeEnd=now()}resetInitialTimestamp(e){const{demuxer:s,remuxer:o}=this;!s||!o||(s.resetTimeStamp(e),o.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:s}=this;!e||!s||(e.resetContiguity(),s.resetNextTimestamp())}resetInitSegment(e,s,o,c,d){const{demuxer:h,remuxer:g}=this;!h||!g||(h.resetInitSegment(e,s,o,c),g.resetInitSegment(e,s,o,d))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,s,o,c,d){let h;return s&&s.method==="SAMPLE-AES"?h=this.transmuxSampleAes(e,s,o,c,d):h=this.transmuxUnencrypted(e,o,c,d),h}transmuxUnencrypted(e,s,o,c){const{audioTrack:d,videoTrack:h,id3Track:g,textTrack:_}=this.demuxer.demux(e,s,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(d,h,g,_,s,o,!1,this.id),chunkMeta:c}}transmuxSampleAes(e,s,o,c,d){return this.demuxer.demuxSampleAes(e,s,o).then(h=>({remuxResult:this.remuxer.remux(h.audioTrack,h.videoTrack,h.id3Track,h.textTrack,o,c,!1,this.id),chunkMeta:d}))}configureTransmuxer(e){const{config:s,observer:o,typeSupported:c}=this;let d;for(let j=0,_e=muxConfig.length;j<_e;j++){var h;if((h=muxConfig[j].demux)!=null&&h.probe(e,this.logger)){d=muxConfig[j];break}}if(!d)return new Error("Failed to find demuxer by probing fragment data");const g=this.demuxer,_=this.remuxer,b=d.remux,$=d.demux;(!_||!(_ instanceof b))&&(this.remuxer=new b(o,s,c,this.logger)),(!g||!(g instanceof $))&&(this.demuxer=new $(o,s,c,this.logger),this.probe=$.probe)}needsProbing(e,s){return!this.demuxer||!this.remuxer||e||s}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Decrypter(this.config)),e}}function getEncryptionType(a,e){let s=null;return a.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(s=e),s}const emptyResult=a=>({remuxResult:{},chunkMeta:a});function isPromise(a){return"then"in a&&a.then instanceof Function}class TransmuxConfig{constructor(e,s,o,c,d){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=s,this.initSegmentData=o,this.duration=c,this.defaultInitPts=d||null}}class TransmuxState{constructor(e,s,o,c,d,h){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=s,this.accurateTimeOffset=o,this.trackSwitch=c,this.timeOffset=d,this.initSegmentChange=h}}let transmuxerInstanceCount=0;class TransmuxerInterface{constructor(e,s,o,c){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=transmuxerInstanceCount++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=_=>{const b=_.data,$=this.hls;if(!(!$||!(b!=null&&b.event)||b.instanceNo!==this.instanceNo))switch(b.event){case"init":{var j;const _e=(j=this.workerContext)==null?void 0:j.objectURL;_e&&self.URL.revokeObjectURL(_e);break}case"transmuxComplete":{this.handleTransmuxComplete(b.data);break}case"flush":{this.onFlush(b.data);break}case"workerLog":{$.logger[b.data.logType]&&$.logger[b.data.logType](b.data.message);break}default:{b.data=b.data||{},b.data.frag=this.frag,b.data.part=this.part,b.data.id=this.id,$.trigger(b.event,b.data);break}}},this.onWorkerError=_=>{if(!this.hls)return;const b=new Error(`${_.message}  (${_.filename}:${_.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:b})};const d=e.config;this.hls=e,this.id=s,this.useWorker=!!d.enableWorker,this.onTransmuxComplete=o,this.onFlush=c;const h=(_,b)=>{b=b||{},b.frag=this.frag||void 0,_===Events.ERROR&&(b=b,b.parent=this.id,b.part=this.part,this.error=b.error),this.hls.trigger(_,b)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,h),this.observer.on(Events.ERROR,h);const g=getM2TSSupportedAudioTypes(d.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const _=this.hls.logger;if(d.workerPath||hasUMDWorker()){try{d.workerPath?(_.log(`loading Web Worker ${d.workerPath} for "${s}"`),this.workerContext=loadWorker(d.workerPath)):(_.log(`injecting Web Worker for "${s}"`),this.workerContext=injectWorker());const{worker:$}=this.workerContext;$.addEventListener("message",this.onWorkerMessage),$.addEventListener("error",this.onWorkerError),$.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:g,id:s,config:stringify(d)})}catch($){_.warn(`Error setting up "${s}" Web Worker, fallback to inline`,$),this.terminateWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,g,d,"",s,e.logger)}return}}this.transmuxer=new Transmuxer(this.observer,g,d,"",s,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=transmuxerInstanceCount++;const s=this.hls.config,o=getM2TSSupportedAudioTypes(s.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:o,id:this.id,config:stringify(s)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),removeWorkerFromStore(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const s=this.transmuxer;s&&(s.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,s,o,c,d,h,g,_,b,$){var j,_e;b.transmuxing.start=self.performance.now();const{instanceNo:tt,transmuxer:rt}=this,nt=h?h.start:d.start,st=d.decryptdata,at=this.frag,ot=!(at&&d.cc===at.cc),ut=!(at&&b.level===at.level),mt=at?b.sn-at.sn:-1,yt=this.part?b.part-this.part.index:-1,Et=mt===0&&b.id>1&&b.id===(at==null?void 0:at.stats.chunkCount),dt=!ut&&(mt===1||mt===0&&(yt===1||Et&&yt<=0)),gt=self.performance.now();(ut||mt||d.stats.parsing.start===0)&&(d.stats.parsing.start=gt),h&&(yt||!dt)&&(h.stats.parsing.start=gt);const St=!(at&&((j=d.initSegment)==null?void 0:j.url)===((_e=at.initSegment)==null?void 0:_e.url)),xt=new TransmuxState(ot,dt,_,ut,nt,St);if(!dt||ot||St){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${d.type} sn: ${b.sn}${b.part>-1?" part: "+b.part:""} ${this.id===PlaylistLevelType.MAIN?"level":"track"}: ${b.level} id: ${b.id}
        discontinuity: ${ot}
        trackSwitch: ${ut}
        contiguous: ${dt}
        accurateTimeOffset: ${_}
        timeOffset: ${nt}
        initSegmentChange: ${St}`);const Ct=new TransmuxConfig(o,c,s,g,$);this.configureTransmuxer(Ct)}if(this.frag=d,this.part=h,this.workerContext)this.workerContext.worker.postMessage({instanceNo:tt,cmd:"demux",data:e,decryptdata:st,chunkMeta:b,state:xt},e instanceof ArrayBuffer?[e]:[]);else if(rt){const Ct=rt.push(e,st,b,xt);isPromise(Ct)?Ct.then(Ht=>{this.handleTransmuxComplete(Ht)}).catch(Ht=>{this.transmuxerError(Ht,b,"transmuxer-interface push error")}):this.handleTransmuxComplete(Ct)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:s,transmuxer:o}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:s,cmd:"flush",chunkMeta:e});else if(o){const c=o.flush(e);isPromise(c)?c.then(d=>{this.handleFlushResult(d,e)}).catch(d=>{this.transmuxerError(d,e,"transmuxer-interface flush error")}):this.handleFlushResult(c,e)}}transmuxerError(e,s,o){this.hls&&(this.error=e,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:s,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:o}))}handleFlushResult(e,s){e.forEach(o=>{this.handleTransmuxComplete(o)}),this.onFlush(s)}configureTransmuxer(e){const{instanceNo:s,transmuxer:o}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:s,cmd:"configure",config:e}):o&&o.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const TICK_INTERVAL$3=100;class AudioStreamController extends BaseStreamController{constructor(e,s,o){super(e,s,o,"audio-stream-controller",PlaylistLevelType.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Events.BUFFER_RESET,this.onBufferReset,this),e.on(Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Events.FRAG_LOADING,this.onFragLoading,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Events.BUFFER_RESET,this.onBufferReset,this),e.off(Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Events.FRAG_LOADING,this.onFragLoading,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:s,id:o,initPTS:c,timescale:d,trackId:h}){if(o===PlaylistLevelType.MAIN){const g=s.cc,_=this.fragCurrent;if(this.initPTS[g]={baseTime:c,timescale:d,trackId:h},this.log(`InitPTS for cc: ${g} found from main: ${c/d} (${c}/${d}) trackId: ${h}`),this.mainAnchor=s,this.state===State.WAITING_INIT_PTS){const b=this.waitingData;(!b&&!this.loadingParts||b&&b.frag.cc!==g)&&this.syncWithAnchor(s,b==null?void 0:b.frag)}else!this.hls.hasEnoughToStart&&_&&_.cc!==g?(_.abortRequests(),this.syncWithAnchor(s,_)):this.state===State.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,s){var o;const c=((o=this.mainFragLoading)==null?void 0:o.frag)||null;if(s&&(c==null?void 0:c.cc)===s.cc)return;const d=(c||e).cc,h=this.getLevelDetails(),g=this.getLoadPosition(),_=findNearestWithCC(h,d,g);_&&(this.log(`Syncing with main frag at ${_.start} cc ${_.cc}`),this.startFragRequested=!1,this.nextLoadPosition=_.start,this.resetLoadingState(),this.state===State.IDLE&&this.doTickIdle())}startLoad(e,s){if(!this.levels){this.startPosition=e,this.state=State.STOPPED;return}const o=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$3),o>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${o.toFixed(3)}`),e=o,this.state=State.IDLE):this.state=State.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=s?-1:e,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{const{levels:e,trackId:s}=this,o=e==null?void 0:e[s],c=o==null?void 0:o.details;if(c&&!this.waitForLive(o)){if(this.waitForCdnTuneIn(c))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case State.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:s,part:o,cache:c,complete:d}=e,h=this.mainAnchor;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.state=State.FRAG_LOADING;const g=c.flush().buffer,_={frag:s,part:o,payload:g,networkDetails:null};this._handleFragmentLoadProgress(_),d&&super._handleFragmentLoadComplete(_)}else h&&h.cc!==e.frag.cc&&this.syncWithAnchor(h,e.frag)}else this.state=State.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:s,levels:o,media:c,trackId:d}=this,h=s.config;if(!this.buffering||!c&&!this.primaryPrefetch&&(this.startFragRequested||!h.startFragPrefetch)||!(o!=null&&o[d]))return;const g=o[d],_=g.details;if(!_||this.waitForLive(g)||this.waitForCdnTuneIn(_)){this.state=State.WAITING_TRACK,this.startFragRequested=!1;return}const b=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&b&&(this.bufferFlushed=!1,this.afterBufferFlushed(b,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const $=this.getFwdBufferInfo(b,PlaylistLevelType.AUDIO);if($===null)return;if(!this.switchingTrack&&this._streamEnded($,_)){s.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const j=$.len,_e=s.maxBufferLength,tt=_.fragments,rt=tt[0].start,nt=this.getLoadPosition(),st=this.flushing?nt:$.end;if(this.switchingTrack&&c){const ut=nt;_.PTSKnown&&ut<rt&&($.end>rt||$.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),c.currentTime=rt+.05)}if(j>=_e&&!this.switchingTrack&&st<tt[tt.length-1].start)return;let at=this.getNextFragment(st,_);if(at&&this.isLoopLoading(at,st)&&(at=this.getNextFragmentLoopLoading(at,_,$,PlaylistLevelType.MAIN,_e)),!at){this.bufferFlushed=!0;return}let ot=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&ot&&isMediaFragment(at)&&!at.endList&&(!_.live||!this.loadingParts&&st<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(ot)===FragmentState.OK&&(this.mainFragLoading=ot=null),ot&&isMediaFragment(ot))){if(at.start>ot.end){const mt=this.fragmentTracker.getFragAtPos(st,PlaylistLevelType.MAIN);mt&&mt.end>ot.end&&(ot=mt,this.mainFragLoading={frag:mt,targetBufferTime:null})}if(at.start>ot.end)return}this.loadFragment(at,g,st)}onMediaDetaching(e,s){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,s)}onAudioTracksUpdated(e,{audioTracks:s}){this.resetTransmuxer(),this.levels=s.map(o=>new Level(o))}onAudioTrackSwitching(e,s){const o=!!s.url;this.trackId=s.id;const{fragCurrent:c}=this;c&&(c.abortRequests(),this.removeUnbufferedFrags(c.start)),this.resetLoadingState(),o?(this.switchingTrack=s,this.flushAudioIfNeeded(s),this.state!==State.STOPPED&&(this.setInterval(TICK_INTERVAL$3),this.state=State.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=s,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,s){this.mainDetails=s.details;const o=this.cachedTrackLoadedData;o&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(Events.AUDIO_TRACK_LOADED,o))}onAudioTrackLoaded(e,s){var o;const{levels:c}=this,{details:d,id:h,groupId:g,track:_}=s;if(!c){this.warn(`Audio tracks reset while loading track ${h} "${_.name}" of "${g}"`);return}const b=this.mainDetails;if(!b||d.endCC>b.endCC||b.expired){this.cachedTrackLoadedData=s,this.state!==State.STOPPED&&(this.state=State.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${h} "${_.name}" of "${g}" loaded [${d.startSN},${d.endSN}]${d.lastPartSn?`[part-${d.lastPartSn}-${d.lastPartIndex}]`:""},duration:${d.totalduration}`);const $=c[h];let j=0;if(d.live||(o=$.details)!=null&&o.live){if(this.checkLiveUpdate(d),d.deltaUpdateFailed)return;if($.details){var _e;j=this.alignPlaylists(d,$.details,(_e=this.levelLastLoaded)==null?void 0:_e.details)}d.alignedSliding||(alignDiscontinuities(d,b),d.alignedSliding||alignMediaPlaylistByPDT(d,b),j=d.fragmentStart)}$.details=d,this.levelLastLoaded=$,this.startFragRequested||this.setStartPosition(b,j),this.hls.trigger(Events.AUDIO_TRACK_UPDATED,{details:d,id:h,groupId:s.groupId}),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(d)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(e){var s;const o=e.frag,{part:c,payload:d}=e,{config:h,trackId:g,levels:_}=this;if(!_){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${o.sn} of level ${o.level} will not be buffered`);return}const b=_[g];if(!b){this.warn("Audio track is undefined on fragment load progress");return}const $=b.details;if(!$){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(o.start);return}const j=h.defaultAudioCodec||b.audioCodec||"mp4a.40.2";let _e=this.transmuxer;_e||(_e=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const tt=this.initPTS[o.cc],rt=(s=o.initSegment)==null?void 0:s.data;if(tt!==void 0){const st=c?c.index:-1,at=st!==-1,ot=new ChunkMetadata(o.level,o.sn,o.stats.chunkCount,d.byteLength,st,at);_e.push(d,rt,j,"",o,c,$.totalduration,!1,ot,tt)}else{this.log(`Unknown video PTS for cc ${o.cc}, waiting for video PTS before demuxing audio frag ${o.sn} of [${$.startSN} ,${$.endSN}],track ${g}`);const{cache:nt}=this.waitingData=this.waitingData||{frag:o,part:c,cache:new ChunkCache,complete:!1};nt.push(new Uint8Array(d)),this.state!==State.STOPPED&&(this.state=State.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,s){this.bufferFlushed=this.flushing=!1;const o=s.tracks.audio;o&&(this.mediaBuffer=o.buffer||null)}onFragLoading(e,s){!this.audioOnly&&s.frag.type===PlaylistLevelType.MAIN&&isMediaFragment(s.frag)&&(this.mainFragLoading=s,this.state===State.IDLE&&this.tick())}onFragBuffered(e,s){const{frag:o,part:c}=s;if(o.type!==PlaylistLevelType.AUDIO){!this.audioOnly&&o.type===PlaylistLevelType.MAIN&&!o.elementaryStreams.video&&!o.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(o)){this.warn(`Fragment ${o.sn}${c?" p: "+c.index:""} of level ${o.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(isMediaFragment(o)){this.fragPrevious=o;const d=this.switchingTrack;d&&(this.bufferedTrack=d,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},d)))}this.fragBufferedComplete(o,c),this.media&&this.tick()}onError(e,s){var o;if(s.fatal){this.state=State.ERROR;return}switch(s.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,s);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!s.levelRetry&&this.state===State.WAITING_TRACK&&((o=s.context)==null?void 0:o.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:if(s.parent!=="audio")return;this.reduceLengthAndFlushBuffer(s)||this.resetLoadingState();break;case ErrorDetails.BUFFER_FULL_ERROR:if(s.parent!=="audio")return;this.reduceLengthAndFlushBuffer(s)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(s);break}}onBufferFlushing(e,{type:s}){s!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:s}){if(s!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const o=this.mediaBuffer||this.media;o&&(this.afterBufferFlushed(o,s,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(e){var s;const o="audio",{hls:c}=this,{remuxResult:d,chunkMeta:h}=e,g=this.getCurrentContext(h);if(!g){this.resetWhenMissingContext(h);return}const{frag:_,part:b,level:$}=g,{details:j}=$,{audio:_e,text:tt,id3:rt,initSegment:nt}=d;if(this.fragContextChanged(_)||!j){this.fragmentTracker.removeFragment(_);return}if(this.state=State.PARSING,this.switchingTrack&&_e&&this.completeAudioSwitch(this.switchingTrack),nt!=null&&nt.tracks){const st=_.initSegment||_;if(this.unhandledEncryptionError(nt,_))return;this._bufferInitSegment($,nt.tracks,st,h),c.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:st,id:o,tracks:nt.tracks})}if(_e){const{startPTS:st,endPTS:at,startDTS:ot,endDTS:ut}=_e;b&&(b.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:st,endPTS:at,startDTS:ot,endDTS:ut}),_.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,st,at,ot,ut),this.bufferFragmentData(_e,_,b,h)}if(rt!=null&&(s=rt.samples)!=null&&s.length){const st=_extends({id:o,frag:_,details:j},rt);c.trigger(Events.FRAG_PARSING_METADATA,st)}if(tt){const st=_extends({id:o,frag:_,details:j},tt);c.trigger(Events.FRAG_PARSING_USERDATA,st)}}_bufferInitSegment(e,s,o,c){if(this.state!==State.PARSING||(s.video&&delete s.video,s.audiovideo&&delete s.audiovideo,!s.audio))return;const d=s.audio;d.id=PlaylistLevelType.AUDIO;const h=e.audioCodec;this.log(`Init audio buffer, container:${d.container}, codecs[level/parsed]=[${h}/${d.codec}]`),h&&h.split(",").length===1&&(d.levelCodec=h),this.hls.trigger(Events.BUFFER_CODECS,s);const g=d.initSegment;if(g!=null&&g.byteLength){const _={type:"audio",frag:o,part:null,chunkMeta:c,parent:o.type,data:g};this.hls.trigger(Events.BUFFER_APPENDING,_)}this.tickImmediate()}loadFragment(e,s,o){const c=this.fragmentTracker.getState(e);if(this.switchingTrack||c===FragmentState.NOT_LOADED||c===FragmentState.PARTIAL){var d;if(!isMediaFragment(e))this._loadInitSegment(e,s);else if((d=s.details)!=null&&d.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const h=this.mainDetails;h&&h.fragmentStart!==s.details.fragmentStart&&alignMediaPlaylistByPDT(s.details,h)}else super.loadFragment(e,s,o)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:s,lang:o,assocLang:c,characteristics:d,audioCodec:h,channels:g}=this.bufferedTrack;matchesOption({name:s,lang:o,assocLang:c,characteristics:d,audioCodec:h,channels:g},e,audioMatchPredicate)||(useAlternateAudio(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:s}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,s.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},e))}}class BasePlaylistController extends Logger{constructor(e,s){super(s,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,s,o){const c=s==null?void 0:s.renditionReports;if(c){let d=-1;for(let h=0;h<c.length;h++){const g=c[h];let _;try{_=new self.URL(g.URI,s.url).href}catch(b){this.warn(`Could not construct new URL for Rendition Report: ${b}`),_=g.URI||""}if(_===e){d=h;break}else _===e.substring(0,_.length)&&(d=h)}if(d!==-1){const h=c[d],g=parseInt(h["LAST-MSN"])||s.lastPartSn;let _=parseInt(h["LAST-PART"])||s.lastPartIndex;if(this.hls.config.lowLatencyMode){const $=Math.min(s.age-s.partTarget,s.targetduration);_>=0&&$>s.partTarget&&(_+=1)}const b=o&&getSkipValue(o);return new HlsUrlParameters(g,_>=0?_:void 0,b)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,s){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,s){if(s)try{return s.addDirectives(e)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}return e}playlistLoaded(e,s,o){const{details:c,stats:d}=s,h=self.performance.now(),g=d.loading.first?Math.max(0,h-d.loading.first):0;c.advancedDateTime=Date.now()-g;const _=this.hls.config.timelineOffset;if(_!==c.appliedTimelineOffset){const $=Math.max(_||0,0);c.appliedTimelineOffset=$,c.fragments.forEach(j=>{j.setStart(j.playlistOffset+$)})}if(c.live||o!=null&&o.live){const $="levelInfo"in s?s.levelInfo:s.track;if(c.reloaded(o),o&&c.fragments.length>0){mergeDetails(o,c,this);const ot=c.playlistParsingError;if(ot){this.warn(ot);const ut=this.hls;if(!ut.config.ignorePlaylistParsingErrors){var b;const{networkDetails:mt}=s;ut.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:c.url,error:ot,reason:ot.message,level:s.level||void 0,parent:(b=c.fragments[0])==null?void 0:b.type,networkDetails:mt,stats:d});return}c.playlistParsingError=null}}c.requestScheduled===-1&&(c.requestScheduled=d.loading.start);const j=this.hls.mainForwardBufferInfo,_e=j?j.end-j.len:0,tt=(c.edge-_e)*1e3,rt=computeReloadInterval(c,tt);if(c.requestScheduled+rt<h?c.requestScheduled=h:c.requestScheduled+=rt,this.log(`live playlist ${e} ${c.advanced?"REFRESHED "+c.lastPartSn+"-"+c.lastPartIndex:c.updated?"UPDATED":"MISSED"}`),!this.canLoad||!c.live)return;let nt,st,at;if(c.canBlockReload&&c.endSN&&c.advanced){const ot=this.hls.config.lowLatencyMode,ut=c.lastPartSn,mt=c.endSN,yt=c.lastPartIndex,Et=yt!==-1,dt=ut===mt;Et?dt?(st=mt+1,at=ot?0:yt):(st=ut,at=ot?yt+1:c.maxPartIndex):st=mt+1;const gt=c.age,St=gt+c.ageHeader;let xt=Math.min(St-c.partTarget,c.targetduration*1.5);if(xt>0){if(St>c.targetduration*3)this.log(`Playlist last advanced ${gt.toFixed(2)}s ago. Omitting segment and part directives.`),st=void 0,at=void 0;else if(o!=null&&o.tuneInGoal&&St-c.partTarget>o.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${o.tuneInGoal} to: ${xt} with playlist age: ${c.age}`),xt=0;else{const Ct=Math.floor(xt/c.targetduration);if(st+=Ct,at!==void 0){const Ht=Math.round(xt%c.targetduration/c.partTarget);at+=Ht}this.log(`CDN Tune-in age: ${c.ageHeader}s last advanced ${gt.toFixed(2)}s goal: ${xt} skip sn ${Ct} to part ${at}`)}c.tuneInGoal=xt}if(nt=this.getDeliveryDirectives(c,s.deliveryDirectives,st,at),ot||!dt){c.requestScheduled=h,this.loadingPlaylist($,nt);return}}else(c.canBlockReload||c.canSkipUntil)&&(nt=this.getDeliveryDirectives(c,s.deliveryDirectives,st,at));nt&&st!==void 0&&c.canBlockReload&&(c.requestScheduled=d.loading.first+Math.max(rt-g*2,rt/2)),this.scheduleLoading($,nt,c)}else this.clearTimer()}scheduleLoading(e,s,o){const c=o||e.details;if(!c){this.loadingPlaylist(e,s);return}const d=self.performance.now(),h=c.requestScheduled;if(d>=h){this.loadingPlaylist(e,s);return}const g=h-d;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(g)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,s),g)}getDeliveryDirectives(e,s,o,c){let d=getSkipValue(e);return s!=null&&s.skip&&e.deltaUpdateFailed&&(o=s.msn,c=s.part,d=HlsSkip.No),new HlsUrlParameters(o,c,d)}checkRetry(e){const s=e.details,o=isTimeoutError(e),c=e.errorAction,{action:d,retryCount:h=0,retryConfig:g}=c||{},_=!!c&&!!g&&(d===NetworkErrorAction.RetryRequest||!c.resolved&&d===NetworkErrorAction.SendAlternateToPenaltyBox);if(_){var b;if(h>=g.maxNumRetry)return!1;if(o&&(b=e.context)!=null&&b.deliveryDirectives)this.warn(`Retrying playlist loading ${h+1}/${g.maxNumRetry} after "${s}" without delivery-directives`),this.loadPlaylist();else{const $=getRetryDelay(g,h);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),$),this.warn(`Retrying playlist loading ${h+1}/${g.maxNumRetry} after "${s}" in ${$}ms`)}e.levelRetry=!0,c.resolved=!0}return _}}function subtitleOptionsIdentical(a,e){if(a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(!mediaAttributesIdentical(a[s].attrs,e[s].attrs))return!1;return!0}function mediaAttributesIdentical(a,e,s){const o=a["STABLE-RENDITION-ID"];return o&&!s?o===e["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(c=>a[c]!==e[c])}function subtitleTrackMatchesTextTrack(a,e){return e.label.toLowerCase()===a.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(a.lang||"").toLowerCase())}class AudioTrackController extends BasePlaylistController{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,s){this.tracks=s.audioTracks||[]}onAudioTrackLoaded(e,s){const{id:o,groupId:c,details:d}=s,h=this.tracksInGroup[o];if(!h||h.groupId!==c){this.warn(`Audio track with id:${o} and group:${c} not found in active group ${h==null?void 0:h.groupId}`);return}const g=h.details;h.details=s.details,this.log(`Audio track ${o} "${h.name}" lang:${h.lang} group:${c} loaded [${d.startSN}-${d.endSN}]`),o===this.trackId&&this.playlistLoaded(o,s,g)}onLevelLoading(e,s){this.switchLevel(s.level)}onLevelSwitching(e,s){this.switchLevel(s.level)}switchLevel(e){const s=this.hls.levels[e];if(!s)return;const o=s.audioGroups||null,c=this.groupIds;let d=this.currentTrack;if(!o||(c==null?void 0:c.length)!==(o==null?void 0:o.length)||o!=null&&o.some(g=>(c==null?void 0:c.indexOf(g))===-1)){this.groupIds=o,this.trackId=-1,this.currentTrack=null;const g=this.tracks.filter(_e=>!o||o.indexOf(_e.groupId)!==-1);if(g.length)this.selectDefaultTrack&&!g.some(_e=>_e.default)&&(this.selectDefaultTrack=!1),g.forEach((_e,tt)=>{_e.id=tt});else if(!d&&!this.tracksInGroup.length)return;this.tracksInGroup=g;const _=this.hls.config.audioPreference;if(!d&&_){const _e=findMatchingOption(_,g,audioMatchPredicate);if(_e>-1)d=g[_e];else{const tt=findMatchingOption(_,this.tracks);d=this.tracks[tt]}}let b=this.findTrackId(d);b===-1&&d&&(b=this.findTrackId(null));const $={audioTracks:g};this.log(`Updating audio tracks, ${g.length} track(s) found in group(s): ${o==null?void 0:o.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,$);const j=this.trackId;if(b!==-1&&j===-1)this.setAudioTrack(b);else if(g.length&&j===-1){var h;const _e=new Error(`No audio track selected for current audio group-ID(s): ${(h=this.groupIds)==null?void 0:h.join(",")} track count: ${g.length}`);this.warn(_e.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:_e})}}}onError(e,s){s.fatal||!s.context||s.context.type===PlaylistContextType.AUDIO_TRACK&&s.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(s.context.groupId)!==-1)&&this.checkRetry(s)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const s=this.hls;if(s.config.audioPreference=e,e){const o=this.allAudioTracks;if(this.selectDefaultTrack=!1,o.length){const c=this.currentTrack;if(c&&matchesOption(e,c,audioMatchPredicate))return c;const d=findMatchingOption(e,this.tracksInGroup,audioMatchPredicate);if(d>-1){const h=this.tracksInGroup[d];return this.setAudioTrack(d),h}else if(c){let h=s.loadLevel;h===-1&&(h=s.firstAutoLevel);const g=findClosestLevelWithAudioGroup(e,s.levels,o,h,audioMatchPredicate);if(g===-1)return null;s.nextLoadLevel=g}if(e.channels||e.audioCodec){const h=findMatchingOption(e,o);if(h>-1)return o[h]}}}return null}setAudioTrack(e){const s=this.tracksInGroup;if(e<0||e>=s.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const o=this.currentTrack,c=s[e],d=c.details&&!c.details.live;if(e===this.trackId&&c===o&&d||(this.log(`Switching to audio-track ${e} "${c.name}" lang:${c.lang} group:${c.groupId} channels:${c.channels}`),this.trackId=e,this.currentTrack=c,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},c)),d))return;const h=this.switchParams(c.url,o==null?void 0:o.details,c.details);this.loadPlaylist(h)}findTrackId(e){const s=this.tracksInGroup;for(let o=0;o<s.length;o++){const c=s[o];if(!(this.selectDefaultTrack&&!c.default)&&(!e||matchesOption(e,c,audioMatchPredicate)))return o}if(e){const{name:o,lang:c,assocLang:d,characteristics:h,audioCodec:g,channels:_}=e;for(let b=0;b<s.length;b++){const $=s[b];if(matchesOption({name:o,lang:c,assocLang:d,characteristics:h,audioCodec:g,channels:_},$,audioMatchPredicate))return b}for(let b=0;b<s.length;b++){const $=s[b];if(mediaAttributesIdentical(e.attrs,$.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return b}for(let b=0;b<s.length;b++){const $=s[b];if(mediaAttributesIdentical(e.attrs,$.attrs,["LANGUAGE"]))return b}}return-1}loadPlaylist(e){super.loadPlaylist();const s=this.currentTrack;this.shouldLoadPlaylist(s)&&useAlternateAudio(s.url,this.hls)&&this.scheduleLoading(s,e)}loadingPlaylist(e,s){super.loadingPlaylist(e,s);const o=e.id,c=e.groupId,d=this.getUrlWithDirectives(e.url,s),h=e.details,g=h==null?void 0:h.age;this.log(`Loading audio-track ${o} "${e.name}" lang:${e.lang} group:${c}${(s==null?void 0:s.msn)!==void 0?" at sn "+s.msn+" part "+s.part:""}${g&&h.live?" age "+g.toFixed(1)+(h.type&&" "+h.type||""):""} ${d}`),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:d,id:o,groupId:c,deliveryDirectives:s||null,track:e})}}class BufferOperationQueue{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,s,o){if(this.queues===null||this.tracks===null)return;const c=this.queues[s];c.push(e),c.length===1&&!o&&this.executeNext(s)}appendBlocker(e){return new Promise(s=>{const o={label:"async-blocker",execute:s,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(o,e)})}prependBlocker(e){return new Promise(s=>{if(this.queues){const o={label:"async-blocker-prepend",execute:s,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(o)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var s;const o=(s=e[0])==null?void 0:s.label;(o==="async-blocker"||o==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const s=this.queues[e];if(s.length){const c=s[0];try{c.execute()}catch(d){var o;if(c.onError(d),this.queues===null||this.tracks===null)return;const h=(o=this.tracks[e])==null?void 0:o.buffer;h!=null&&h.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var s;return((s=this.queues)==null?void 0:s[e][0])||null}toString(){const{queues:e,tracks:s}=this;return e===null||s===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var s,o;return(s=this.queues)!=null&&s[e]||(o=this.tracks)!=null&&o[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var s;const o=(s=this.tracks)==null?void 0:s[e],c=o==null?void 0:o.buffer;return c?`SourceBuffer${c.updating?" updating":""}${o.ended?" ended":""}${o.ending?" ending":""}`:"none"}listOps(e){var s;return((s=this.queues)==null?void 0:s[e].map(o=>o.label).join(", "))||""}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,TRACK_REMOVED_ERROR_NAME="HlsJsTrackRemovedError";class HlsJsTrackRemovedError extends Error{constructor(e){super(e),this.name=TRACK_REMOVED_ERROR_NAME}}class BufferController extends Logger{constructor(e,s){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=o=>{var c;this.hls&&((c=this.mediaSource)==null?void 0:c.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=o=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=o=>{const{media:c,mediaSource:d}=this;o&&this.log("Media source opened"),!(!c||!d)&&(d.removeEventListener("sourceopen",this._onMediaSourceOpen),c.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:c,mediaSource:d}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:o,_objectUrl:c}=this;o!==c&&this.error(`Media element src was set while attaching MediaSource (${c} > ${o})`)},this.hls=e,this.fragmentTracker=s,this.appendSource=isManagedMediaSource(getMediaSource(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.BUFFER_RESET,this.onBufferReset,this),e.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Events.BUFFER_EOS,this.onBufferEos,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Events.FRAG_PARSED,this.onFragParsed,this),e.on(Events.FRAG_CHANGED,this.onFragChanged,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.BUFFER_RESET,this.onBufferReset,this),e.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Events.BUFFER_EOS,this.onBufferEos,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Events.FRAG_PARSED,this.onFragParsed,this),e.off(Events.FRAG_CHANGED,this.onFragChanged,this),e.off(Events.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:s}=this;if(!e)return null;const o={};if(this.operationQueue){const d=this.isUpdating();d||this.operationQueue.removeBlockers();const h=this.isQueued();(d||h)&&this.warn(`Transfering MediaSource with${h?" operations in queue":""}${d?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const c=this.transferData;return!this.sourceBufferCount&&c&&c.mediaSource===s?_extends(o,c.tracks):this.sourceBuffers.forEach(d=>{const[h]=d;h&&(o[h]=_extends({},this.tracks[h]),this.removeBuffer(h)),d[0]=d[1]=null}),{media:e,mediaSource:s,tracks:o}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,s){var o;let c=2;(s.audio&&!s.video||!s.altAudio)&&(c=1),this.bufferCodecEventsTotal=c,this.log(`${c} bufferCodec event(s) expected.`),(o=this.transferData)!=null&&o.mediaSource&&this.sourceBufferCount&&c&&this.bufferCreated()}onMediaAttaching(e,s){const o=this.media=s.media;this.transferData=this.overrides=void 0;const c=getMediaSource(this.appendSource);if(c){const d=!!s.mediaSource;(d||s.overrides)&&(this.transferData=s,this.overrides=s.overrides);const h=this.mediaSource=s.mediaSource||new c;if(this.assignMediaSource(h),d)this._objectUrl=o.src,this.attachTransferred();else{const g=this._objectUrl=self.URL.createObjectURL(h);if(this.appendSource)try{o.removeAttribute("src");const _=self.ManagedMediaSource;o.disableRemotePlayback=o.disableRemotePlayback||_&&h instanceof _,removeSourceChildren(o),addSource(o,g),o.load()}catch{o.src=g}else o.src=g}o.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var s,o;this.log(`${((s=this.transferData)==null?void 0:s.mediaSource)===e?"transferred":"created"} media source: ${(o=e.constructor)==null?void 0:o.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,s=this.transferData;if(!s||!e)return;const o=this.tracks,c=s.tracks,d=c?Object.keys(c):null,h=d?d.length:0,g=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(c&&d&&h){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${stringify(o,(_,b)=>_==="initSegment"?void 0:b)};
transfer tracks: ${stringify(c,(_,b)=>_==="initSegment"?void 0:b)}}`),!isCompatibleTrackChange(c,o)){s.mediaSource=null,s.tracks=void 0;const _=e.currentTime,b=this.details,$=Math.max(_,(b==null?void 0:b.fragments[0].start)||0);if($-_>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${_} -> ${$}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(c)}"->"${Object.keys(o)}") start time: ${$} currentTime: ${_}`),this.onMediaDetaching(Events.MEDIA_DETACHING,{}),this.onMediaAttaching(Events.MEDIA_ATTACHING,s),e.currentTime=$;return}this.transferData=void 0,d.forEach(_=>{const b=_,$=c[b];if($){const j=$.buffer;if(j){const _e=this.fragmentTracker,tt=$.id;if(_e.hasFragments(tt)||_e.hasParts(tt)){const st=BufferHelper.getBuffered(j);_e.detectEvictedFragments(b,st,tt,null,!0)}const rt=sourceBufferNameToIndex(b),nt=[b,j];this.sourceBuffers[rt]=nt,j.updating&&this.operationQueue&&this.operationQueue.prependBlocker(b),this.trackSourceBuffer(b,$)}}}),g(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),g()}get mediaSourceOpenOrEnded(){var e;const s=(e=this.mediaSource)==null?void 0:e.readyState;return s==="open"||s==="ended"}onMediaDetaching(e,s){const o=!!s.transferMedia;this.transferData=this.overrides=void 0;const{media:c,mediaSource:d,_objectUrl:h}=this;if(d){if(this.log(`media source ${o?"transferring":"detaching"}`),o)this.sourceBuffers.forEach(([g])=>{g&&this.removeBuffer(g)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const g=d.readyState==="open";try{const _=d.sourceBuffers;for(let b=_.length;b--;)g&&_[b].abort(),d.removeSourceBuffer(_[b]);g&&d.endOfStream()}catch(_){this.warn(`onMediaDetaching: ${_.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(d.removeEventListener("startstreaming",this._onStartStreaming),d.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}c&&(c.removeEventListener("emptied",this._onMediaEmptied),o||(h&&self.URL.revokeObjectURL(h),this.mediaSrc===h?(c.removeAttribute("src"),this.appendSource&&removeSourceChildren(c),c.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Events.MEDIA_DETACHED,s)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var s;const o=(s=this.tracks[e])==null?void 0:s.buffer;if(this.removeBuffer(e),o)try{var c;(c=this.mediaSource)!=null&&c.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(o)}catch(d){this.warn(`onBufferReset ${e}`,d)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[sourceBufferNameToIndex(e)]=[null,null];const s=this.tracks[e];s&&(s.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new BufferOperationQueue(this.tracks)}onBufferCodecs(e,s){var o;const c=this.tracks,d=Object.keys(s);this.log(`BUFFER_CODECS: "${d}" (current SB count ${this.sourceBufferCount})`);const h="audiovideo"in s&&(c.audio||c.video)||c.audiovideo&&("audio"in s||"video"in s),g=!h&&this.sourceBufferCount&&this.media&&d.some(_=>!c[_]);if(h||g){this.warn(`Unsupported transition between "${Object.keys(c)}" and "${d}" SourceBuffers`);return}d.forEach(_=>{var b,$;const j=s[_],{id:_e,codec:tt,levelCodec:rt,container:nt,metadata:st,supplemental:at}=j;let ot=c[_];const ut=(b=this.transferData)==null||(b=b.tracks)==null?void 0:b[_],mt=ut!=null&&ut.buffer?ut:ot,yt=(mt==null?void 0:mt.pendingCodec)||(mt==null?void 0:mt.codec),Et=mt==null?void 0:mt.levelCodec;ot||(ot=c[_]={buffer:void 0,listeners:[],codec:tt,supplemental:at,container:nt,levelCodec:rt,metadata:st,id:_e});const dt=pickMostCompleteCodecName(yt,Et),gt=dt==null?void 0:dt.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let St=pickMostCompleteCodecName(tt,rt);const xt=($=St)==null?void 0:$.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");St&&dt&&gt!==xt&&(_.slice(0,5)==="audio"&&(St=getCodecCompatibleName(St,this.appendSource)),this.log(`switching codec ${yt} to ${St}`),St!==(ot.pendingCodec||ot.codec)&&(ot.pendingCodec=St),ot.container=nt,this.appendChangeType(_,nt,St))}),(this.tracksReady||this.sourceBufferCount)&&(s.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!s.video&&((o=s.audio)==null?void 0:o.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,s)=>{const o=this.tracks[s];return e[s]={id:o.id,container:o.container,codec:o.codec,levelCodec:o.levelCodec},e},{})}appendChangeType(e,s,o){const c=`${s};codecs=${o}`,d={label:`change-type=${c}`,execute:()=>{const h=this.tracks[e];if(h){const g=h.buffer;g!=null&&g.changeType&&(this.log(`changing ${e} sourceBuffer type to ${c}`),g.changeType(c),h.codec=o,h.container=s)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:h=>{this.warn(`Failed to change ${e} SourceBuffer type`,h)}};this.append(d,e,this.isPending(this.tracks[e]))}blockAudio(e){var s;const o=e.start,c=o+e.duration*.05;if(((s=this.fragmentTracker.getAppendedFrag(o,PlaylistLevelType.MAIN))==null?void 0:s.gap)===!0)return;const h={label:"block-audio",execute:()=>{var g;const _=this.tracks.video;(this.lastVideoAppendEnd>c||_!=null&&_.buffer&&BufferHelper.isBuffered(_.buffer,c)||((g=this.fragmentTracker.getAppendedFrag(c,PlaylistLevelType.MAIN))==null?void 0:g.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:g=>{this.warn("Error executing block-audio operation",g)}};this.blockedAudioAppend={op:h,frag:e},this.append(h,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:s}=this;e&&s&&(this.blockedAudioAppend=null,s.unblockAudio(e.op))}onBufferAppending(e,s){const{tracks:o}=this,{data:c,type:d,parent:h,frag:g,part:_,chunkMeta:b,offset:$}=s,j=b.buffering[d],{sn:_e,cc:tt}=g,rt=self.performance.now();j.start=rt;const nt=g.stats.buffering,st=_?_.stats.buffering:null;nt.start===0&&(nt.start=rt),st&&st.start===0&&(st.start=rt);const at=o.audio;let ot=!1;d==="audio"&&(at==null?void 0:at.container)==="audio/mpeg"&&(ot=!this.lastMpegAudioChunk||b.id===1||this.lastMpegAudioChunk.sn!==b.sn,this.lastMpegAudioChunk=b);const ut=o.video,mt=ut==null?void 0:ut.buffer;if(mt&&_e!=="initSegment"){const dt=_||g,gt=this.blockedAudioAppend;if(d==="audio"&&h!=="main"&&!this.blockedAudioAppend&&!(ut.ending||ut.ended)){const xt=dt.start+dt.duration*.05,Ct=mt.buffered,Ht=this.currentOp("video");!Ct.length&&!Ht?this.blockAudio(dt):!Ht&&!BufferHelper.isBuffered(mt,xt)&&this.lastVideoAppendEnd<xt&&this.blockAudio(dt)}else if(d==="video"){const St=dt.end;if(gt){const xt=gt.frag.start;(St>xt||St<this.lastVideoAppendEnd||BufferHelper.isBuffered(mt,xt))&&this.unblockAudio()}this.lastVideoAppendEnd=St}}const yt=(_||g).start,Et={label:`append-${d}`,execute:()=>{var dt;j.executeStart=self.performance.now();const gt=(dt=this.tracks[d])==null?void 0:dt.buffer;gt&&(ot?this.updateTimestampOffset(gt,yt,.1,d,_e,tt):$!==void 0&&isFiniteNumber($)&&this.updateTimestampOffset(gt,$,1e-6,d,_e,tt)),this.appendExecutor(c,d)},onStart:()=>{},onComplete:()=>{const dt=self.performance.now();j.executeEnd=j.end=dt,nt.first===0&&(nt.first=dt),st&&st.first===0&&(st.first=dt);const gt={};this.sourceBuffers.forEach(([St,xt])=>{St&&(gt[St]=BufferHelper.getBuffered(xt))}),this.appendErrors[d]=0,d==="audio"||d==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:d,frag:g,part:_,chunkMeta:b,parent:g.type,timeRanges:gt})},onError:dt=>{var gt;const St={type:ErrorTypes.MEDIA_ERROR,parent:g.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:d,frag:g,part:_,chunkMeta:b,error:dt,err:dt,fatal:!1},xt=(gt=this.media)==null?void 0:gt.error;if(dt.code===DOMException.QUOTA_EXCEEDED_ERR||dt.name=="QuotaExceededError"||"quota"in dt)St.details=ErrorDetails.BUFFER_FULL_ERROR;else if(dt.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!xt)St.errorAction=createDoNothingErrorAction(!0);else if(dt.name===TRACK_REMOVED_ERROR_NAME&&this.sourceBufferCount===0)St.errorAction=createDoNothingErrorAction(!0);else{const Ct=++this.appendErrors[d];this.warn(`Failed ${Ct}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${d}" sourceBuffer (${xt||"no media error"})`),(Ct>=this.hls.config.appendErrorMaxRetry||xt)&&(St.fatal=!0)}this.hls.trigger(Events.ERROR,St)}};this.log(`queuing "${d}" append sn: ${_e}${_?" p: "+_.index:""} of ${g.type===PlaylistLevelType.MAIN?"level":"track"} ${g.level} cc: ${tt}`),this.append(Et,d,this.isPending(this.tracks[d]))}getFlushOp(e,s,o){return this.log(`queuing "${e}" remove ${s}-${o}`),{label:"remove",execute:()=>{this.removeExecutor(e,s,o)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:e})},onError:c=>{this.warn(`Failed to remove ${s}-${o} from "${e}" SourceBuffer`,c)}}}onBufferFlushing(e,s){const{type:o,startOffset:c,endOffset:d}=s;o?this.append(this.getFlushOp(o,c,d),o):this.sourceBuffers.forEach(([h])=>{h&&this.append(this.getFlushOp(h,c,d),h)})}onFragParsed(e,s){const{frag:o,part:c}=s,d=[],h=c?c.elementaryStreams:o.elementaryStreams;h[ElementaryStreamTypes.AUDIOVIDEO]?d.push("audiovideo"):(h[ElementaryStreamTypes.AUDIO]&&d.push("audio"),h[ElementaryStreamTypes.VIDEO]&&d.push("video"));const g=()=>{const _=self.performance.now();o.stats.buffering.end=_,c&&(c.stats.buffering.end=_);const b=c?c.stats:o.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:o,part:c,stats:b,id:o.type})};d.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${o.type} level: ${o.level} sn: ${o.sn}`),this.blockBuffers(g,d).catch(_=>{this.warn(`Fragment buffered callback ${_}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,s){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const s=this.tracks[e];if(s)return!s.ended||s.ending}return!1})}onBufferEos(e,s){var o;this.sourceBuffers.forEach(([h])=>{if(h){const g=this.tracks[h];(!s.type||s.type===h)&&(g.ending=!0,g.ended||(g.ended=!0,this.log(`${h} buffer reached EOS`)))}});const c=((o=this.overrides)==null?void 0:o.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([h])=>{var g;return h&&!((g=this.tracks[h])!=null&&g.ended)})?c?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:h}=this;if(!h||h.readyState!=="open"){h&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${h.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),h.endOfStream(),this.hls.trigger(Events.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(Events.BUFFERED_TO_END,void 0)):s.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const s=this.tracks[e];s&&(s.ending=!1)}})}onLevelUpdated(e,{details:s}){s.fragments.length&&(this.details=s,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,s){if(s.details===ErrorDetails.BUFFER_APPEND_ERROR&&s.frag){var o;const c=(o=s.errorAction)==null?void 0:o.nextAutoLevel;isFiniteNumber(c)&&c!==s.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:s,media:o}=this;if(!o||s===null||!this.sourceBufferCount)return;const c=e.config,d=o.currentTime,h=s.levelTargetDuration,g=s.live&&c.liveBackBufferLength!==null?c.liveBackBufferLength:c.backBufferLength;if(isFiniteNumber(g)&&g>=0){const b=Math.max(g,h),$=Math.floor(d/h)*h-b;this.flushBackBuffer(d,h,$)}const _=c.frontBufferFlushThreshold;if(isFiniteNumber(_)&&_>0){const b=Math.max(c.maxBufferLength,_),$=Math.max(b,h),j=Math.floor(d/h)*h+$;this.flushFrontBuffer(d,h,j)}}flushBackBuffer(e,s,o){this.sourceBuffers.forEach(([c,d])=>{if(d){const g=BufferHelper.getBuffered(d);if(g.length>0&&o>g.start(0)){var h;this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:o});const _=this.tracks[c];if((h=this.details)!=null&&h.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o});else if(_!=null&&_.ended){this.log(`Cannot flush ${c} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:c})}}})}flushFrontBuffer(e,s,o){this.sourceBuffers.forEach(([c,d])=>{if(d){const h=BufferHelper.getBuffered(d),g=h.length;if(g<2)return;const _=h.start(g-1),b=h.end(g-1);if(o>_||e>=_&&e<=b)return;this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:_,endOffset:1/0,type:c})}})}getDurationAndRange(){var e;const{details:s,mediaSource:o}=this;if(!s||!this.media||(o==null?void 0:o.readyState)!=="open")return null;const c=s.edge;if(s.live&&this.hls.config.liveDurationInfinity){if(s.fragments.length&&o.setLiveSeekableRange){const b=Math.max(0,s.fragmentStart),$=Math.max(b,c);return{duration:1/0,start:b,end:$}}return{duration:1/0}}const d=(e=this.overrides)==null?void 0:e.duration;if(d)return isFiniteNumber(d)?{duration:d}:null;const h=this.media.duration,g=isFiniteNumber(o.duration)?o.duration:0;return c>g&&c>h||!isFiniteNumber(h)?{duration:c}:null}updateMediaSource({duration:e,start:s,end:o}){const c=this.mediaSource;!this.media||!c||c.readyState!=="open"||(c.duration!==e&&(isFiniteNumber(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),c.duration=e),s!==void 0&&o!==void 0&&(this.log(`MediaSource duration is set to ${c.duration}. Setting seekable range to ${s}-${o}.`),c.setLiveSeekableRange(s,o)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:s,tracks:o}=this;if(this.log(`checkPendingTracks (pending: ${s} codec events expected: ${e}) ${stringify(o)}`),this.tracksReady){var c;const d=(c=this.transferData)==null?void 0:c.tracks;d&&Object.keys(d).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([s,o])=>{if(s){const c=this.tracks[s];e[s]={buffer:o,container:c.container,codec:c.codec,supplemental:c.supplemental,levelCodec:c.levelCodec,id:c.id,metadata:c.metadata}}}),this.hls.trigger(Events.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([s])=>{this.executeNext(s)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:s,mediaSource:o}=this;if(!o)throw new Error("createSourceBuffers called when mediaSource was null");for(const d in e){const h=d,g=e[h];if(this.isPending(g)){const _=this.getTrackCodec(g,h),b=`${g.container};codecs=${_}`;g.codec=_,this.log(`creating sourceBuffer(${b})${this.currentOp(h)?" Queued":""} ${stringify(g)}`);try{const $=o.addSourceBuffer(b),j=sourceBufferNameToIndex(h),_e=[h,$];s[j]=_e,g.buffer=$}catch($){var c;this.error(`error while trying to add sourceBuffer: ${$.message}`),this.shiftAndExecuteNext(h),(c=this.operationQueue)==null||c.removeBlockers(),delete this.tracks[h],this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:$,sourceBufferName:h,mimeType:b,parent:g.id});return}this.trackSourceBuffer(h,g)}}this.bufferCreated()}getTrackCodec(e,s){const o=e.supplemental;let c=e.codec;o&&(s==="video"||s==="audiovideo")&&areCodecsMediaSourceSupported(o,"video")&&(c=replaceVideoCodec(c,o));const d=pickMostCompleteCodecName(c,e.levelCodec);return d?s.slice(0,5)==="audio"?getCodecCompatibleName(d,this.appendSource):d:""}trackSourceBuffer(e,s){const o=s.buffer;if(!o)return;const c=this.getTrackCodec(s,e);this.tracks[e]={buffer:o,codec:c,container:s.container,levelCodec:s.levelCodec,supplemental:s.supplemental,metadata:s.metadata,id:s.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(d,h)=>{const g=h.removedRanges;g!=null&&g.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:d})})}get mediaSrc(){var e,s;const o=((e=this.media)==null||(s=e.querySelector)==null?void 0:s.call(e,"source"))||this.media;return o==null?void 0:o.src}onSBUpdateStart(e){const s=this.currentOp(e);s&&s.onStart()}onSBUpdateEnd(e){var s;if(((s=this.mediaSource)==null?void 0:s.readyState)==="closed"){this.resetBuffer(e);return}const o=this.currentOp(e);o&&(o.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,s){var o;const c=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(o=this.mediaSource)==null?void 0:o.readyState}`);this.error(`${c}`,s),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:c,fatal:!1});const d=this.currentOp(e);d&&d.onError(c)}updateTimestampOffset(e,s,o,c,d,h){const g=s-e.timestampOffset;Math.abs(g)>=o&&(this.log(`Updating ${c} SourceBuffer timestampOffset to ${s} (sn: ${d} cc: ${h})`),e.timestampOffset=s)}removeExecutor(e,s,o){const{media:c,mediaSource:d}=this,h=this.tracks[e],g=h==null?void 0:h.buffer;if(!c||!d||!g){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const _=isFiniteNumber(c.duration)?c.duration:1/0,b=isFiniteNumber(d.duration)?d.duration:1/0,$=Math.max(0,s),j=Math.min(o,_,b);j>$&&(!h.ending||h.ended)?(h.ended=!1,this.log(`Removing [${$},${j}] from the ${e} SourceBuffer`),g.remove($,j)):this.shiftAndExecuteNext(e)}appendExecutor(e,s){const o=this.tracks[s],c=o==null?void 0:o.buffer;if(!c)throw new HlsJsTrackRemovedError(`Attempting to append to the ${s} SourceBuffer, but it does not exist`);o.ending=!1,o.ended=!1,c.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(s=>{this.warn(`SourceBuffer blocked callback ${s}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(s){this.warn(`Callback run without blocking ${this.operationQueue} ${s}`)}}isUpdating(){return this.sourceBuffers.some(([e,s])=>e&&s.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,s=this.sourceBufferTypes){if(!s.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:o}=this,c=s.map(h=>this.appendBlocker(h));return s.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(c).then(h=>{o===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(s=>{var o;const c=(o=this.tracks[s])==null?void 0:o.buffer;!c||c.updating||this.shiftAndExecuteNext(s)})}append(e,s,o){this.operationQueue&&this.operationQueue.append(e,s,o)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,s)=>e+(this.isPending(this.tracks[s])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[s])=>e+(s?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,s,o){const c=this.tracks[e];if(!c)return;const d=c.buffer;if(!d)return;const h=o.bind(this,e);c.listeners.push({event:s,listener:h}),d.addEventListener(s,h)}removeBufferListeners(e){const s=this.tracks[e];if(!s)return;const o=s.buffer;o&&(s.listeners.forEach(c=>{o.removeEventListener(c.event,c.listener)}),s.listeners.length=0)}}function removeSourceChildren(a){const e=a.querySelectorAll("source");[].slice.call(e).forEach(s=>{a.removeChild(s)})}function addSource(a,e){const s=self.document.createElement("source");s.type="video/mp4",s.src=e,a.appendChild(s)}function sourceBufferNameToIndex(a){return a==="audio"?1:0}class CapLevelController{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,s){const o=this.hls.levels[s.droppedLevel];this.isLevelAllowed(o)&&this.restrictedLevels.push({bitrate:o.bitrate,height:o.height,width:o.width})}onMediaAttaching(e,s){this.media=s.media instanceof HTMLVideoElement?s.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,s){const o=this.hls;this.restrictedLevels=[],this.firstLevel=s.firstLevel,o.config.capLevelToPlayerSize&&s.video&&this.startCapping()}onLevelsUpdated(e,s){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,s){this.hls.config.capLevelToPlayerSize&&s.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const s=this.hls,o=this.getMaxLevel(e.length-1);o!==this.autoLevelCapping&&s.logger.log(`Setting autoLevelCapping to ${o}: ${e[o].height}p@${e[o].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),s.autoLevelCapping=o,s.autoLevelEnabled&&s.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=s.autoLevelCapping}}}getMaxLevel(e){const s=this.hls.levels;if(!s.length)return-1;const o=s.filter((c,d)=>this.isLevelAllowed(c)&&d<=e);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(o,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,s={width:0,height:0};if(e){const o=e.getBoundingClientRect();s.width=o.width,s.height=o.height,!s.width&&!s.height&&(s.width=o.right-o.left||e.width||0,s.height=o.bottom-o.top||e.height||0)}return this.clientRect=s,s}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(o=>e.bitrate===o.bitrate&&e.width===o.width&&e.height===o.height)}static getMaxLevelByMediaSize(e,s,o){if(!(e!=null&&e.length))return-1;const c=(g,_)=>_?g.width!==_.width||g.height!==_.height:!0;let d=e.length-1;const h=Math.max(s,o);for(let g=0;g<e.length;g+=1){const _=e[g];if((_.width>=h||_.height>=h)&&c(_,e[g+1])){d=g;break}}return d}}const CmObjectType={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},CmcdObjectType=CmObjectType,CmStreamingFormat={HLS:"h"},CmcdStreamingFormat=CmStreamingFormat;class SfItem{constructor(e,s){Array.isArray(e)&&(e=e.map(o=>o instanceof SfItem?o:new SfItem(o))),this.value=e,this.params=s}}const DICT="Dict";function format(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function throwError(a,e,s,o){return new Error(`failed to ${a} "${format(e)}" as ${s}`,{cause:o})}function serializeError(a,e,s){return throwError("serialize",a,e,s)}class SfToken{constructor(e){this.description=e}}const BARE_ITEM="Bare Item",BOOLEAN="Boolean";function serializeBoolean(a){if(typeof a!="boolean")throw serializeError(a,BOOLEAN);return a?"?1":"?0"}function encodeBase64(a){return btoa(String.fromCharCode(...a))}const BYTES="Byte Sequence";function serializeByteSequence(a){if(ArrayBuffer.isView(a)===!1)throw serializeError(a,BYTES);return`:${encodeBase64(a)}:`}const INTEGER="Integer";function isInvalidInt(a){return a<-999999999999999||999999999999999<a}function serializeInteger(a){if(isInvalidInt(a))throw serializeError(a,INTEGER);return a.toString()}function serializeDate(a){return`@${serializeInteger(a.getTime()/1e3)}`}function roundToEven(a,e){if(a<0)return-roundToEven(-a,e);const s=Math.pow(10,e);if(Math.abs(a*s%1-.5)<Number.EPSILON){const c=Math.floor(a*s);return(c%2===0?c:c+1)/s}else return Math.round(a*s)/s}const DECIMAL="Decimal";function serializeDecimal(a){const e=roundToEven(a,3);if(Math.floor(Math.abs(e)).toString().length>12)throw serializeError(a,DECIMAL);const s=e.toString();return s.includes(".")?s:`${s}.0`}const STRING="String",STRING_REGEX=/[\x00-\x1f\x7f]+/;function serializeString(a){if(STRING_REGEX.test(a))throw serializeError(a,STRING);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(a){return a.description||a.toString().slice(7,-1)}const TOKEN="Token";function serializeToken(a){const e=symbolToStr(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw serializeError(e,TOKEN);return e}function serializeBareItem(a){switch(typeof a){case"number":if(!isFiniteNumber(a))throw serializeError(a,BARE_ITEM);return Number.isInteger(a)?serializeInteger(a):serializeDecimal(a);case"string":return serializeString(a);case"symbol":return serializeToken(a);case"boolean":return serializeBoolean(a);case"object":if(a instanceof Date)return serializeDate(a);if(a instanceof Uint8Array)return serializeByteSequence(a);if(a instanceof SfToken)return serializeToken(a);default:throw serializeError(a,BARE_ITEM)}}const KEY="Key";function serializeKey(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw serializeError(a,KEY);return a}function serializeParams(a){return a==null?"":Object.entries(a).map(([e,s])=>s===!0?`;${serializeKey(e)}`:`;${serializeKey(e)}=${serializeBareItem(s)}`).join("")}function serializeItem(a){return a instanceof SfItem?`${serializeBareItem(a.value)}${serializeParams(a.params)}`:serializeBareItem(a)}function serializeInnerList(a){return`(${a.value.map(serializeItem).join(" ")})${serializeParams(a.params)}`}function serializeDict(a,e={whitespace:!0}){if(typeof a!="object"||a==null)throw serializeError(a,DICT);const s=a instanceof Map?a.entries():Object.entries(a),o=e!=null&&e.whitespace?" ":"";return Array.from(s).map(([c,d])=>{d instanceof SfItem||(d=new SfItem(d));let h=serializeKey(c);return d.value===!0?h+=serializeParams(d.params):(h+="=",Array.isArray(d.value)?h+=serializeInnerList(d):h+=serializeItem(d)),h}).join(`,${o}`)}function encodeSfDict(a,e){return serializeDict(a,e)}const CMCD_OBJECT="CMCD-Object",CMCD_REQUEST="CMCD-Request",CMCD_SESSION="CMCD-Session",CMCD_STATUS="CMCD-Status",CMCD_HEADER_MAP={br:CMCD_OBJECT,ab:CMCD_OBJECT,d:CMCD_OBJECT,ot:CMCD_OBJECT,tb:CMCD_OBJECT,tpb:CMCD_OBJECT,lb:CMCD_OBJECT,tab:CMCD_OBJECT,lab:CMCD_OBJECT,url:CMCD_OBJECT,pb:CMCD_REQUEST,bl:CMCD_REQUEST,tbl:CMCD_REQUEST,dl:CMCD_REQUEST,ltc:CMCD_REQUEST,mtp:CMCD_REQUEST,nor:CMCD_REQUEST,nrr:CMCD_REQUEST,rc:CMCD_REQUEST,sn:CMCD_REQUEST,sta:CMCD_REQUEST,su:CMCD_REQUEST,ttfb:CMCD_REQUEST,ttfbb:CMCD_REQUEST,ttlb:CMCD_REQUEST,cmsdd:CMCD_REQUEST,cmsds:CMCD_REQUEST,smrt:CMCD_REQUEST,df:CMCD_REQUEST,cs:CMCD_REQUEST,ts:CMCD_REQUEST,cid:CMCD_SESSION,pr:CMCD_SESSION,sf:CMCD_SESSION,sid:CMCD_SESSION,st:CMCD_SESSION,v:CMCD_SESSION,msd:CMCD_SESSION,bs:CMCD_STATUS,bsd:CMCD_STATUS,cdn:CMCD_STATUS,rtp:CMCD_STATUS,bg:CMCD_STATUS,pt:CMCD_STATUS,ec:CMCD_STATUS,e:CMCD_STATUS},CmcdHeaderField={REQUEST:CMCD_REQUEST};function createHeaderMap(a){return Object.keys(a).reduce((e,s)=>{var o;return(o=a[s])===null||o===void 0||o.forEach(c=>e[c]=s),e},{})}function groupCmcdHeaders(a,e){const s={};if(!a)return s;const o=Object.keys(a),c=e?createHeaderMap(e):{};return o.reduce((d,h)=>{var g;const _=CMCD_HEADER_MAP[h]||c[h]||CmcdHeaderField.REQUEST,b=(g=d[_])!==null&&g!==void 0?g:d[_]={};return b[h]=a[h],d},s)}function isTokenField(a){return["ot","sf","st","e","sta"].includes(a)}function isValid(a){return typeof a=="number"?isFiniteNumber(a):a!=null&&a!==""&&a!==!1}const CMCD_EVENT_MODE="event";function urlToRelativePath(a,e){const s=new URL(a),o=new URL(e);if(s.origin!==o.origin)return a;const c=s.pathname.split("/").slice(1),d=o.pathname.split("/").slice(1,-1);for(;c[0]===d[0];)c.shift(),d.shift();for(;d.length;)d.shift(),c.unshift("..");return c.join("/")+s.search+s.hash}const toRounded=a=>Math.round(a),toUrlSafe=(a,e)=>Array.isArray(a)?a.map(s=>toUrlSafe(s,e)):a instanceof SfItem&&typeof a.value=="string"?new SfItem(toUrlSafe(a.value,e),a.params):(e.baseUrl&&(a=urlToRelativePath(a,e.baseUrl)),e.version===1?encodeURIComponent(a):a),toHundred=a=>toRounded(a/100)*100,nor=(a,e)=>{let s=a;return e.version>=2&&(a instanceof SfItem&&typeof a.value=="string"?s=new SfItem([a]):typeof a=="string"&&(s=[a])),toUrlSafe(s,e)},CMCD_FORMATTER_MAP={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor,rtp:toHundred,tb:toRounded},CMCD_REQUEST_MODE="request",CMCD_RESPONSE_MODE="response",CMCD_COMMON_KEYS=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],CMCD_EVENT_KEYS=["e"],CUSTOM_KEY_REGEX=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function isCmcdCustomKey(a){return CUSTOM_KEY_REGEX.test(a)}function isCmcdEventKey(a){return CMCD_COMMON_KEYS.includes(a)||CMCD_EVENT_KEYS.includes(a)||isCmcdCustomKey(a)}const CMCD_REQUEST_KEYS=["d","dl","nor","ot","rtp","su"];function isCmcdRequestKey(a){return CMCD_COMMON_KEYS.includes(a)||CMCD_REQUEST_KEYS.includes(a)||isCmcdCustomKey(a)}const CMCD_RESPONSE_KEYS=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function isCmcdResponseKey(a){return CMCD_COMMON_KEYS.includes(a)||CMCD_REQUEST_KEYS.includes(a)||CMCD_RESPONSE_KEYS.includes(a)||isCmcdCustomKey(a)}const CMCD_V1_KEYS=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function isCmcdV1Key(a){return CMCD_V1_KEYS.includes(a)||isCmcdCustomKey(a)}const filterMap={[CMCD_RESPONSE_MODE]:isCmcdResponseKey,[CMCD_EVENT_MODE]:isCmcdEventKey,[CMCD_REQUEST_MODE]:isCmcdRequestKey};function prepareCmcdData(a,e={}){const s={};if(a==null||typeof a!="object")return s;const o=e.version||a.v||1,c=e.reportingMode||CMCD_REQUEST_MODE,d=o===1?isCmcdV1Key:filterMap[c];let h=Object.keys(a).filter(d);const g=e.filter;typeof g=="function"&&(h=h.filter(g));const _=c===CMCD_RESPONSE_MODE||c===CMCD_EVENT_MODE;_&&!h.includes("ts")&&h.push("ts"),o>1&&!h.includes("v")&&h.push("v");const b=_extends({},CMCD_FORMATTER_MAP,e.formatters),$={version:o,reportingMode:c,baseUrl:e.baseUrl};return h.sort().forEach(j=>{let _e=a[j];const tt=b[j];if(typeof tt=="function"&&(_e=tt(_e,$)),j==="v"){if(o===1)return;_e=o}j=="pr"&&_e===1||(_&&j==="ts"&&!isFiniteNumber(_e)&&(_e=Date.now()),isValid(_e)&&(isTokenField(j)&&typeof _e=="string"&&(_e=new SfToken(_e)),s[j]=_e))}),s}function toCmcdHeaders(a,e={}){const s={};if(!a)return s;const o=prepareCmcdData(a,e),c=groupCmcdHeaders(o,e==null?void 0:e.customHeaderMap);return Object.entries(c).reduce((d,[h,g])=>{const _=encodeSfDict(g,{whitespace:!1});return _&&(d[h]=_),d},s)}function appendCmcdHeaders(a,e,s){return _extends(a,toCmcdHeaders(e,s))}const CMCD_PARAM="CMCD";function encodeCmcd(a,e={}){return a?encodeSfDict(prepareCmcdData(a,e),{whitespace:!1}):""}function toCmcdUrl(a,e={}){if(!a)return"";const s=encodeCmcd(a,e);return encodeURIComponent(s)}function toCmcdQuery(a,e={}){if(!a)return"";const s=toCmcdUrl(a,e);return`${CMCD_PARAM}=${s}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(a,e,s){const o=toCmcdQuery(e,s);if(!o)return a;if(REGEX.test(a))return a.replace(REGEX,o);const c=a.includes("?")?"&":"?";return`${a}${c}${o}`}class CMCDController{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=c=>{try{this.apply(c,{ot:CmcdObjectType.MANIFEST,su:!this.initialized})}catch(d){this.hls.logger.warn("Could not generate manifest CMCD data.",d)}},this.applyFragmentData=c=>{try{const{frag:d,part:h}=c,g=this.hls.levels[d.level],_=this.getObjectType(d),b={d:(h||d).duration*1e3,ot:_};(_===CmcdObjectType.VIDEO||_===CmcdObjectType.AUDIO||_==CmcdObjectType.MUXED)&&(b.br=g.bitrate/1e3,b.tb=this.getTopBandwidth(_)/1e3,b.bl=this.getBufferLength(_));const $=h?this.getNextPart(h):this.getNextFrag(d);$!=null&&$.url&&$.url!==d.url&&(b.nor=$.url),this.apply(c,b)}catch(d){this.hls.logger.warn("Could not generate segment CMCD data.",d)}},this.hls=e;const s=this.config=e.config,{cmcd:o}=s;o!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=o.sessionId||e.sessionId,this.cid=o.contentId,this.useHeaders=o.useHeaders===!0,this.includeKeys=o.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,s){var o,c;this.audioBuffer=(o=s.tracks.audio)==null?void 0:o.buffer,this.videoBuffer=(c=s.tracks.video)==null?void 0:c.buffer}createData(){var e;return{v:1,sf:CmcdStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,s={}){_extends(s,this.createData());const o=s.ot===CmcdObjectType.INIT||s.ot===CmcdObjectType.VIDEO||s.ot===CmcdObjectType.MUXED;this.starved&&o&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering);const{includeKeys:c}=this;c&&(s=Object.keys(s).reduce((h,g)=>(c.includes(g)&&(h[g]=s[g]),h),{}));const d={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),appendCmcdHeaders(e.headers,s,d)):e.url=appendCmcdQuery(e.url,s,d)}getNextFrag(e){var s;const o=(s=this.hls.levels[e.level])==null?void 0:s.details;if(o){const c=e.sn-o.startSN;return o.fragments[c+1]}}getNextPart(e){var s;const{index:o,fragment:c}=e,d=(s=this.hls.levels[c.level])==null||(s=s.details)==null?void 0:s.partList;if(d){const{sn:h}=c;for(let g=d.length-1;g>=0;g--){const _=d[g];if(_.index===o&&_.fragment.sn===h)return d[g+1]}}}getObjectType(e){const{type:s}=e;if(s==="subtitle")return CmcdObjectType.TIMED_TEXT;if(e.sn==="initSegment")return CmcdObjectType.INIT;if(s==="audio")return CmcdObjectType.AUDIO;if(s==="main")return this.hls.audioTracks.length?CmcdObjectType.VIDEO:CmcdObjectType.MUXED}getTopBandwidth(e){let s=0,o;const c=this.hls;if(e===CmcdObjectType.AUDIO)o=c.audioTracks;else{const d=c.maxAutoLevel,h=d>-1?d+1:c.levels.length;o=c.levels.slice(0,h)}return o.forEach(d=>{d.bitrate>s&&(s=d.bitrate)}),s>0?s:NaN}getBufferLength(e){const s=this.media,o=e===CmcdObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!o||!s?NaN:BufferHelper.bufferInfo(o,s.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,s=this.applyPlaylistData,o=e||this.config.loader;return class{constructor(d){this.loader=void 0,this.loader=new o(d)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(d,h,g){s(d),this.loader.load(d,h,g)}}}createFragmentLoader(){const{fLoader:e}=this.config,s=this.applyFragmentData,o=e||this.config.loader;return class{constructor(d){this.loader=void 0,this.loader=new o(d)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(d,h,g){s(d),this.loader.load(d,h,g)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController extends Logger{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,s)=>(e.indexOf(s.pathwayId)===-1&&e.push(s.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const s=this.levels;s&&(this.levels=s.filter(o=>o!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,s){const{contentSteering:o}=s;o!==null&&(this.pathwayId=o.pathwayId,this.uri=o.uri,this.started&&this.startLoad())}onManifestParsed(e,s){this.audioTracks=s.audioTracks,this.subtitleTracks=s.subtitleTracks}onError(e,s){const{errorAction:o}=s;if((o==null?void 0:o.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&o.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const c=this.levels;let d=this._pathwayPriority,h=this.pathwayId;if(s.context){const{groupId:g,pathwayId:_,type:b}=s.context;g&&c?h=this.getPathwayForGroupId(g,b,h):_&&(h=_)}h in this.penalizedPathways||(this.penalizedPathways[h]=performance.now()),!d&&c&&(d=this.pathways()),d&&d.length>1&&(this.updatePathwayPriority(d),o.resolved=this.pathwayId!==h),s.details===ErrorDetails.BUFFER_APPEND_ERROR&&!s.fatal?o.resolved=!0:o.resolved||this.warn(`Could not resolve ${s.details} ("${s.error.message}") with content-steering for Pathway: ${h} levels: ${c&&c.length} priorities: ${stringify(d)} penalized: ${stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let s=this.getLevelsForPathway(this.pathwayId);if(s.length===0){const o=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${o}"`),s=this.getLevelsForPathway(o),this.pathwayId=o}return s.length!==e.length&&this.log(`Found ${s.length}/${e.length} levels in Pathway "${this.pathwayId}"`),s}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(s=>e===s.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let s;const o=this.penalizedPathways,c=performance.now();Object.keys(o).forEach(d=>{c-o[d]>PATHWAY_PENALTY_DURATION_MS&&delete o[d]});for(let d=0;d<e.length;d++){const h=e[d];if(h in o)continue;if(h===this.pathwayId)return;const g=this.hls.nextLoadLevel,_=this.hls.levels[g];if(s=this.getLevelsForPathway(h),s.length>0){this.log(`Setting Pathway to "${h}"`),this.pathwayId=h,reassignFragmentLevelIndexes(s),this.hls.trigger(Events.LEVELS_UPDATED,{levels:s});const b=this.hls.levels[g];_&&b&&this.levels&&(b.attrs["STABLE-VARIANT-ID"]!==_.attrs["STABLE-VARIANT-ID"]&&b.bitrate!==_.bitrate&&this.log(`Unstable Pathways change from bitrate ${_.bitrate} to ${b.bitrate}`),this.hls.nextLoadLevel=g);break}}}getPathwayForGroupId(e,s,o){const c=this.getLevelsForPathway(o).concat(this.levels||[]);for(let d=0;d<c.length;d++)if(s===PlaylistContextType.AUDIO_TRACK&&c[d].hasAudioGroup(e)||s===PlaylistContextType.SUBTITLE_TRACK&&c[d].hasSubtitleGroup(e))return c[d].pathwayId;return o}clonePathways(e){const s=this.levels;if(!s)return;const o={},c={};e.forEach(d=>{const{ID:h,"BASE-ID":g,"URI-REPLACEMENT":_}=d;if(s.some($=>$.pathwayId===h))return;const b=this.getLevelsForPathway(g).map($=>{const j=new AttrList($.attrs);j["PATHWAY-ID"]=h;const _e=j.AUDIO&&`${j.AUDIO}_clone_${h}`,tt=j.SUBTITLES&&`${j.SUBTITLES}_clone_${h}`;_e&&(o[j.AUDIO]=_e,j.AUDIO=_e),tt&&(c[j.SUBTITLES]=tt,j.SUBTITLES=tt);const rt=performUriReplacement($.uri,j["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",_),nt=new Level({attrs:j,audioCodec:$.audioCodec,bitrate:$.bitrate,height:$.height,name:$.name,url:rt,videoCodec:$.videoCodec,width:$.width});if($.audioGroups)for(let st=1;st<$.audioGroups.length;st++)nt.addGroupId("audio",`${$.audioGroups[st]}_clone_${h}`);if($.subtitleGroups)for(let st=1;st<$.subtitleGroups.length;st++)nt.addGroupId("text",`${$.subtitleGroups[st]}_clone_${h}`);return nt});s.push(...b),cloneRenditionGroups(this.audioTracks,o,_,h),cloneRenditionGroups(this.subtitleTracks,c,_,h)})}loadSteeringManifest(e){const s=this.hls.config,o=s.loader;this.loader&&this.loader.destroy(),this.loader=new o(s);let c;try{c=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(c.protocol!=="data:"){const $=(this.hls.bandwidthEstimate||s.abrEwmaDefaultEstimate)|0;c.searchParams.set("_HLS_pathway",this.pathwayId),c.searchParams.set("_HLS_throughput",""+$)}const d={responseType:"json",url:c.href},h=s.steeringManifestLoadPolicy.default,g=h.errorRetry||h.timeoutRetry||{},_={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},b={onSuccess:($,j,_e,tt)=>{this.log(`Loaded steering manifest: "${c}"`);const rt=$.data;if((rt==null?void 0:rt.VERSION)!==1){this.log(`Steering VERSION ${rt.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=rt.TTL;const{"RELOAD-URI":nt,"PATHWAY-CLONES":st,"PATHWAY-PRIORITY":at}=rt;if(nt)try{this.uri=new self.URL(nt,c).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${nt}`);return}this.scheduleRefresh(this.uri||_e.url),st&&this.clonePathways(st);const ot={steeringManifest:rt,url:c.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,ot),at&&this.updatePathwayPriority(at)},onError:($,j,_e,tt)=>{if(this.log(`Error loading steering manifest: ${$.code} ${$.text} (${j.url})`),this.stopLoad(),$.code===410){this.enabled=!1,this.log(`Steering manifest ${j.url} no longer available`);return}let rt=this.timeToLoad*1e3;if($.code===429){const nt=this.loader;if(typeof(nt==null?void 0:nt.getResponseHeader)=="function"){const st=nt.getResponseHeader("Retry-After");st&&(rt=parseFloat(st)*1e3)}this.log(`Steering manifest ${j.url} rate limited`);return}this.scheduleRefresh(this.uri||j.url,rt)},onTimeout:($,j,_e)=>{this.log(`Timeout loading steering manifest (${j.url})`),this.scheduleRefresh(this.uri||j.url)}};this.log(`Requesting steering manifest: ${c}`),this.loader.load(d,_,b)}scheduleRefresh(e,s=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var o;const c=(o=this.hls)==null?void 0:o.media;if(c&&!c.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},s)}}function cloneRenditionGroups(a,e,s,o){a&&Object.keys(e).forEach(c=>{const d=a.filter(h=>h.groupId===c).map(h=>{const g=_extends({},h);return g.details=void 0,g.attrs=new AttrList(g.attrs),g.url=g.attrs.URI=performUriReplacement(h.url,h.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),g.groupId=g.attrs["GROUP-ID"]=e[c],g.attrs["PATHWAY-ID"]=o,g});a.push(...d)})}function performUriReplacement(a,e,s,o){const{HOST:c,PARAMS:d,[s]:h}=o;let g;e&&(g=h==null?void 0:h[e],g&&(a=g));const _=new self.URL(a);return c&&!g&&(_.host=c),d&&Object.keys(d).sort().forEach(b=>{b&&_.searchParams.set(b,d[b])}),_.href}class EMEController extends Logger{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=s=>{const{initDataType:o,initData:c}=s,d=`"${s.type}" event: init data type: "${o}"`;if(this.debug(d),c!==null){if(!this.keyFormatPromise){let h=Object.keys(this.keySystemAccessPromises);h.length||(h=getKeySystemsForConfig(this.config));const g=h.map(keySystemDomainToKeySystemFormat).filter(_=>!!_);this.keyFormatPromise=this.getKeyFormatPromise(g)}this.keyFormatPromise.then(h=>{const g=keySystemFormatToKeySystemDomain(h);if(o!=="sinf"||g!==KeySystems.FAIRPLAY){this.log(`Ignoring "${s.type}" event with init data type: "${o}" for selected key-system ${g}`);return}let _;try{const tt=bin2str(new Uint8Array(c)),rt=base64Decode(JSON.parse(tt).sinf),nt=parseSinf(rt);if(!nt)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");_=new Uint8Array(nt.subarray(8,24))}catch(tt){this.warn(`${d} Failed to parse sinf: ${tt}`);return}const b=arrayToHex(_),{keyIdToKeySessionPromise:$,mediaKeySessions:j}=this;let _e=$[b];for(let tt=0;tt<j.length;tt++){const rt=j[tt],nt=rt.decryptdata;if(!nt.keyId)continue;const st=arrayToHex(nt.keyId);if(arrayValuesMatch(_,nt.keyId)||nt.uri.replace(/-/g,"").indexOf(b)!==-1){if(_e=$[st],!_e)continue;if(nt.pssh)break;delete $[st],nt.pssh=new Uint8Array(c),nt.keyId=_,_e=$[b]=_e.then(()=>this.generateRequestWithPreferredKeySession(rt,o,c,"encrypted-event-key-match")),_e.catch(at=>this.handleError(at));break}}_e||this.handleError(new Error(`Key ID ${b} not encountered in playlist. Key-system sessions ${j.length}.`))}).catch(h=>this.handleError(h))}},this.onWaitingForKey=s=>{this.log(`"${s.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(Events.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(Events.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:s,widevineLicenseUrl:o}=this.config,c=s==null?void 0:s[e];if(c)return c.licenseUrl;if(e===KeySystems.WIDEVINE&&o)return o}getLicenseServerUrlOrThrow(e){const s=this.getLicenseServerUrl(e);if(s===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return s}getServerCertificateUrl(e){const{drmSystems:s}=this.config,o=s==null?void 0:s[e];if(o)return o.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const s=this.hls.levels,o=(h,g,_)=>!!h&&_.indexOf(h)===g,c=s.map(h=>h.audioCodec).filter(o),d=s.map(h=>h.videoCodec).filter(o);return c.length+d.length===0&&d.push("avc1.42e01e"),new Promise((h,g)=>{const _=b=>{const $=b.shift();this.getMediaKeysPromise($,c,d).then(j=>h({keySystem:$,mediaKeys:j})).catch(j=>{b.length?_(b):j instanceof EMEKeyError?g(j):g(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:j,fatal:!0},j.message))})};_(e)})}requestMediaKeySystemAccess(e,s){const{requestMediaKeySystemAccessFunc:o}=this.config;if(typeof o!="function"){let c=`Configured requestMediaKeySystemAccess is not a function ${o}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(c=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(c))}return o(e,s)}getMediaKeysPromise(e,s,o){var c;const d=getSupportedMediaKeySystemConfigurations(e,s,o,this.config.drmSystemOptions||{});let h=this.keySystemAccessPromises[e],g=(c=h)==null?void 0:c.keySystemAccess;if(!g){this.log(`Requesting encrypted media "${e}" key-system access with config: ${stringify(d)}`),g=this.requestMediaKeySystemAccess(e,d);const _=h=this.keySystemAccessPromises[e]={keySystemAccess:g};return g.catch(b=>{this.log(`Failed to obtain access to key-system "${e}": ${b}`)}),g.then(b=>{this.log(`Access for key-system "${b.keySystem}" obtained`);const $=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const j=_.mediaKeys=b.createMediaKeys().then(_e=>(this.log(`Media-keys created for "${e}"`),_.hasMediaKeys=!0,$.then(tt=>tt?this.setMediaKeysServerCertificate(_e,e,tt):_e)));return j.catch(_e=>{this.error(`Failed to create media-keys for "${e}"}: ${_e}`)}),j})}return g.then(()=>h.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:s,mediaKeys:o}){this.log(`Creating key-system session "${s}" keyId: ${arrayToHex(e.keyId||[])} keyUri: ${e.uri}`);const c=o.createSession(),d={decryptdata:e,keySystem:s,mediaKeys:o,mediaKeysSession:c,keyStatus:"status-pending"};return this.mediaKeySessions.push(d),d}renewKeySession(e){const s=e.decryptdata;if(s.pssh){const o=this.createMediaKeySessionContext(e),c=getKeyIdString(s),d="cenc";this.keyIdToKeySessionPromise[c]=this.generateRequestWithPreferredKeySession(o,d,s.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,s){const o=e.mediaKeysSession;return this.log(`Updating key-session "${o.sessionId}" for keyId ${arrayToHex(e.decryptdata.keyId||[])}
      } (data length: ${s.byteLength})`),o.update(s)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>keySystemDomainToKeySystemFormat(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:s,mediaKeys:o})=>this.attemptSetMediaKeys(s,o))}selectKeySystem(e){return new Promise((s,o)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:c})=>{const d=keySystemDomainToKeySystemFormat(c);d?s(d):o(new Error(`Unable to find format for key-system "${c}"`))}).catch(o)})}selectKeySystemFormat(e){const s=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)),this.keyFormatPromise}getKeyFormatPromise(e){const s=getKeySystemsForConfig(this.config),o=e.map(keySystemFormatToKeySystemDomain).filter(c=>!!c&&s.indexOf(c)!==-1);return this.selectKeySystem(o)}getKeyStatus(e){const{mediaKeySessions:s}=this;for(let o=0;o<s.length;o++){const c=getKeyStatus(e,s[o]);if(c)return c}}loadKey(e){const s=e.keyInfo.decryptdata,o=getKeyIdString(s),c=this.bannedKeyIds[o];if(c||this.getKeyStatus(s)==="internal-error"){const g=getKeyStatusError(c||"internal-error",s);return this.handleError(g,e.frag),Promise.reject(g)}const d=`(keyId: ${o} format: "${s.keyFormat}" method: ${s.method} uri: ${s.uri})`;this.log(`Starting session for key ${d}`);const h=this.keyIdToKeySessionPromise[o];if(!h){const g=this.getKeySystemForKeyPromise(s).then(({keySystem:_,mediaKeys:b})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${d}`),this.attemptSetMediaKeys(_,b).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:_,mediaKeys:b,decryptdata:s}))))).then(_=>{const b="cenc",$=s.pssh?s.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(_,b,$,"playlist-key")});return g.catch(_=>this.handleError(_,e.frag)),this.keyIdToKeySessionPromise[o]=g,g}return h.catch(g=>{if(g instanceof EMEKeyError){const _=_objectSpread2({},g.data);this.getKeyStatus(s)==="internal-error"&&(_.decryptdata=s);const b=new EMEKeyError(_,g.message);this.handleError(b,e.frag)}}),h}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,s){if(this.hls)if(e instanceof EMEKeyError){s&&(e.data.frag=s);const o=e.data.decryptdata;this.error(`${e.message}${o?` (${arrayToHex(o.keyId||[])})`:""}`),this.hls.trigger(Events.ERROR,e.data)}else this.error(e.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const s=getKeyIdString(e),o=this.keyIdToKeySessionPromise[s];if(!o){const c=keySystemFormatToKeySystemDomain(e.keyFormat),d=c?[c]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(d)}return o}getKeySystemSelectionPromise(e){if(e.length||(e=getKeySystemsForConfig(this.config)),e.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,s){if(this.mediaResolved=void 0,this.mediaKeys===s)return Promise.resolve();const o=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const c=Promise.all(o).then(()=>this.media?this.media.setMediaKeys(s):new Promise((d,h)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return h(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=s,this.media.setMediaKeys(s).then(d).catch(h)}}));return this.mediaKeys=s,this.setMediaKeysQueue.push(c),c.then(()=>{this.log(`Media-keys set for "${e}"`),o.push(c),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(d=>o.indexOf(d)===-1)})}generateRequestWithPreferredKeySession(e,s,o,c){var d;const h=(d=this.config.drmSystems)==null||(d=d[e.keySystem])==null?void 0:d.generateRequest;if(h)try{const rt=h.call(this.hls,s,o,e);if(!rt)throw new Error("Invalid response from configured generateRequest filter");s=rt.initDataType,o=rt.initData?rt.initData:null,e.decryptdata.pssh=o?new Uint8Array(o):null}catch(rt){if(this.warn(rt.message),this.hls&&this.hls.config.debug)throw rt}if(o===null)return this.log(`Skipping key-session request for "${c}" (no initData)`),Promise.resolve(e);const g=getKeyIdString(e.decryptdata),_=e.decryptdata.uri;this.log(`Generating key-session request for "${c}" keyId: ${g} URI: ${_} (init data type: ${s} length: ${o.byteLength})`);const b=new EventEmitter,$=e._onmessage=rt=>{const nt=e.mediaKeysSession;if(!nt){b.emit("error",new Error("invalid state"));return}const{messageType:st,message:at}=rt;this.log(`"${st}" message event for session "${nt.sessionId}" message size: ${at.byteLength}`),st==="license-request"||st==="license-renewal"?this.renewLicense(e,at).catch(ot=>{b.eventNames().length?b.emit("error",ot):this.handleError(ot)}):st==="license-release"?e.keySystem===KeySystems.FAIRPLAY&&this.updateKeySession(e,strToUtf8array("acknowledged")).then(()=>this.removeSession(e)).catch(ot=>this.handleError(ot)):this.warn(`unhandled media key message type "${st}"`)},j=(rt,nt)=>{nt.keyStatus=rt;let st;rt.startsWith("usable")?b.emit("resolved"):rt==="internal-error"||rt==="output-restricted"||rt==="output-downscaled"?st=getKeyStatusError(rt,nt.decryptdata):rt==="expired"?st=new Error(`key expired (keyId: ${g})`):rt==="released"?st=new Error("key released"):rt==="status-pending"||this.warn(`unhandled key status change "${rt}" (keyId: ${g})`),st&&(b.eventNames().length?b.emit("error",st):this.handleError(st))},_e=e._onkeystatuseschange=rt=>{if(!e.mediaKeysSession){b.emit("error",new Error("invalid state"));return}const st=this.getKeyStatuses(e);if(!Object.keys(st).some(mt=>st[mt]!=="status-pending"))return;if(st[g]==="expired"){this.log(`Expired key ${stringify(st)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let ot=st[g];if(ot)j(ot,e);else{var ut;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(ut=e.keyStatusTimeouts)[g]||(ut[g]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const yt=this.getKeyStatus(e.decryptdata);if(yt&&yt!=="status-pending")return this.log(`No status for keyId ${g} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${yt} from other session.`),j(yt,e);this.log(`key status for ${g} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),ot="internal-error",j(ot,e)},1e3)),this.log(`No status for keyId ${g} (${stringify(st)}).`)}};addEventListener$1(e.mediaKeysSession,"message",$),addEventListener$1(e.mediaKeysSession,"keystatuseschange",_e);const tt=new Promise((rt,nt)=>{b.on("error",nt),b.on("resolved",rt)});return e.mediaKeysSession.generateRequest(s,o).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${g} URI: ${_}`)}).catch(rt=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:rt,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${rt}`)}).then(()=>tt).catch(rt=>(b.removeAllListeners(),this.removeSession(e).then(()=>{throw rt}))).then(()=>(b.removeAllListeners(),e))}getKeyStatuses(e){const s={};return e.mediaKeysSession.keyStatuses.forEach((o,c)=>{if(typeof c=="string"&&typeof o=="object"){const g=c;c=o,o=g}const d="buffer"in c?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c);if(e.keySystem===KeySystems.PLAYREADY&&d.length===16){const g=arrayToHex(d);s[g]=o,changeEndianness(d)}const h=arrayToHex(d);o==="internal-error"&&(this.bannedKeyIds[h]=o),this.log(`key status change "${o}" for keyStatuses keyId: ${h} key-session "${e.mediaKeysSession.sessionId}"`),s[h]=o}),s}fetchServerCertificate(e){const s=this.config,o=s.loader,c=new o(s),d=this.getServerCertificateUrl(e);return d?(this.log(`Fetching server certificate for "${e}"`),new Promise((h,g)=>{const _={responseType:"arraybuffer",url:d},b=s.certLoadPolicy.default,$={loadPolicy:b,timeout:b.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},j={onSuccess:(_e,tt,rt,nt)=>{h(_e.data)},onError:(_e,tt,rt,nt)=>{g(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:rt,response:_objectSpread2({url:_.url,data:void 0},_e)},`"${e}" certificate request failed (${d}). Status: ${_e.code} (${_e.text})`))},onTimeout:(_e,tt,rt)=>{g(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:rt,response:{url:_.url,data:void 0}},`"${e}" certificate request timed out (${d})`))},onAbort:(_e,tt,rt)=>{g(new Error("aborted"))}};c.load(_,$,j)})):Promise.resolve()}setMediaKeysServerCertificate(e,s,o){return new Promise((c,d)=>{e.setServerCertificate(o).then(h=>{this.log(`setServerCertificate ${h?"success":"not supported by CDM"} (${o.byteLength}) on "${s}"`),c(e)}).catch(h=>{d(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:h,fatal:!0},h.message))})})}renewLicense(e,s){return this.requestLicense(e,new Uint8Array(s)).then(o=>this.updateKeySession(e,new Uint8Array(o)).catch(c=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:c,fatal:!1},c.message)}))}unpackPlayReadyKeyMessage(e,s){const o=String.fromCharCode.apply(null,new Uint16Array(s.buffer));if(!o.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),s;const c=new DOMParser().parseFromString(o,"application/xml"),d=c.querySelectorAll("HttpHeader");if(d.length>0){let $;for(let j=0,_e=d.length;j<_e;j++){var h,g;$=d[j];const tt=(h=$.querySelector("name"))==null?void 0:h.textContent,rt=(g=$.querySelector("value"))==null?void 0:g.textContent;tt&&rt&&e.setRequestHeader(tt,rt)}}const _=c.querySelector("Challenge"),b=_==null?void 0:_.textContent;if(!b)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(b))}setupLicenseXHR(e,s,o,c){const d=this.config.licenseXhrSetup;return d?Promise.resolve().then(()=>{if(!o.decryptdata)throw new Error("Key removed");return d.call(this.hls,e,s,o,c)}).catch(h=>{if(!o.decryptdata)throw h;return e.open("POST",s,!0),d.call(this.hls,e,s,o,c)}).then(h=>(e.readyState||e.open("POST",s,!0),{xhr:e,licenseChallenge:h||c})):(e.open("POST",s,!0),Promise.resolve({xhr:e,licenseChallenge:c}))}requestLicense(e,s){const o=this.config.keyLoadPolicy.default;return new Promise((c,d)=>{const h=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${h}`);const g=new XMLHttpRequest;g.responseType="arraybuffer",g.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return d(new Error("invalid state"));if(g.readyState===4)if(g.status===200){this._requestLicenseFailureCount=0;let _=g.response;this.log(`License received ${_ instanceof ArrayBuffer?_.byteLength:_}`);const b=this.config.licenseResponseCallback;if(b)try{_=b.call(this.hls,g,h,e)}catch($){this.error($)}c(_)}else{const _=o.errorRetry,b=_?_.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>b||g.status>=400&&g.status<500)d(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:g,response:{url:h,data:void 0,code:g.status,text:g.statusText}},`License Request XHR failed (${h}). Status: ${g.status} (${g.statusText})`));else{const $=b-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${$} attempts left`),this.requestLicense(e,s).then(c,d)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=g,this.setupLicenseXHR(g,h,e,s).then(({xhr:_,licenseChallenge:b})=>{e.keySystem==KeySystems.PLAYREADY&&(b=this.unpackPlayReadyKeyMessage(_,b)),_.send(b)}).catch(d)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,s){if(!this.config.emeEnabled)return;const o=s.media;this.media=o,addEventListener$1(o,"encrypted",this.onMediaEncrypted),addEventListener$1(o,"waitingforkey",this.onWaitingForKey);const c=this.mediaResolved;c?c():this.mediaKeys=o.mediaKeys}onMediaDetached(){const e=this.media;e&&(removeEventListener(e,"encrypted",this.onMediaEncrypted),removeEventListener(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const s=this.mediaResolved;if(s&&s(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const o=this.media,c=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,LevelKey.clearKeyUriToKeyIdMap();const d=c.length;EMEController.CDMCleanupPromise=Promise.all(c.map(h=>this.removeSession(h)).concat((o==null||(e=o.setMediaKeys(null))==null?void 0:e.catch(h=>{this.log(`Could not clear media keys: ${h}`),this.hls&&this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${h}`)})}))||Promise.resolve())).catch(h=>{this.log(`Could not close sessions and clear media keys: ${h}`),this.hls&&this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${h}`)})}).then(()=>{d&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:s}){if(!(!s||!this.config.emeEnabled)&&!this.keyFormatPromise){const o=s.reduce((c,d)=>(c.indexOf(d.keyFormat)===-1&&c.push(d.keyFormat),c),[]);this.log(`Selecting key-system from session-keys ${o.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(o)}}removeSession(e){const{mediaKeysSession:s,licenseXhr:o,decryptdata:c}=e;if(s){this.log(`Remove licenses and keys and close session "${s.sessionId}" keyId: ${arrayToHex((c==null?void 0:c.keyId)||[])}`),e._onmessage&&(s.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(s.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),o&&o.readyState!==XMLHttpRequest.DONE&&o.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const d=this.mediaKeySessions.indexOf(e);d>-1&&this.mediaKeySessions.splice(d,1);const{keyStatusTimeouts:h}=e;h&&Object.keys(h).forEach(b=>self.clearTimeout(h[b]));const{drmSystemOptions:g}=this.config;return(isPersistentSessionType(g)?new Promise((b,$)=>{self.setTimeout(()=>$(new Error("MediaKeySession.remove() timeout")),8e3),s.remove().then(b).catch($)}):Promise.resolve()).catch(b=>{this.log(`Could not remove session: ${b}`),this.hls&&this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${b}`)})}).then(()=>s.close()).catch(b=>{this.log(`Could not close session: ${b}`),this.hls&&this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${b}`)})})}return Promise.resolve()}}EMEController.CDMCleanupPromise=void 0;function getKeyIdString(a){if(!a)throw new Error("Could not read keyId of undefined decryptdata");if(a.keyId===null)throw new Error("keyId is null");return arrayToHex(a.keyId)}function getKeyStatus(a,e){if(a.keyId&&e.mediaKeysSession.keyStatuses.has(a.keyId))return e.mediaKeysSession.keyStatuses.get(a.keyId);if(a.matches(e.decryptdata))return e.keyStatus}class EMEKeyError extends Error{constructor(e,s){super(s),this.data=void 0,e.error||(e.error=new Error(s)),this.data=e,e.err=e.error}}function getKeyStatusError(a,e){const s=a==="output-restricted",o=s?ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:o,fatal:!1,decryptdata:e},s?"HDCP level output restricted":`key status changed to "${a}"`)}class FPSController{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,s){const o=this.hls.config;if(o.capLevelOnFPSDrop){const c=s.media instanceof self.HTMLVideoElement?s.media:null;this.media=c,c&&typeof c.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),o.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,s,o){const c=performance.now();if(s){if(this.lastTime){const d=c-this.lastTime,h=o-this.lastDroppedFrames,g=s-this.lastDecodedFrames,_=1e3*h/d,b=this.hls;if(b.trigger(Events.FPS_DROP,{currentDropped:h,currentDecoded:g,totalDroppedFrames:o}),_>0&&h>b.config.fpsDroppedMonitoringThreshold*g){let $=b.currentLevel;b.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+$),$>0&&(b.autoLevelCapping===-1||b.autoLevelCapping>=$)&&($=$-1,b.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:$,droppedLevel:b.currentLevel}),b.autoLevelCapping=$,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=o,this.lastDecodedFrames=s}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const s=e.getVideoPlaybackQuality();this.checkFPS(e,s.totalVideoFrames,s.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function sendAddTrackEvent(a,e){let s;try{s=new Event("addtrack")}catch{s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=a,e.dispatchEvent(s)}function addCueToTrack(a,e){const s=a.mode;if(s==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(o){logger.debug(`[texttrack-utils]: ${o}`);try{const c=new self.TextTrackCue(e.startTime,e.endTime,e.text);c.id=e.id,a.addCue(c)}catch(c){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${c}`)}}s==="disabled"&&(a.mode=s)}function clearCurrentCues(a,e){const s=a.mode;if(s==="disabled"&&(a.mode="hidden"),a.cues)for(let o=a.cues.length;o--;)e&&a.cues[o].removeEventListener("enter",e),a.removeCue(a.cues[o]);s==="disabled"&&(a.mode=s)}function removeCuesInRange(a,e,s,o){const c=a.mode;if(c==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const d=getCuesInRange(a.cues,e,s);for(let h=0;h<d.length;h++)(!o||o(d[h]))&&a.removeCue(d[h])}c==="disabled"&&(a.mode=c)}function getFirstCueIndexFromTime(a,e){if(e<=a[0].startTime)return 0;const s=a.length-1;if(e>a[s].endTime)return-1;let o=0,c=s,d;for(;o<=c;)if(d=Math.floor((c+o)/2),e<a[d].startTime)c=d-1;else if(e>a[d].startTime&&o<s)o=d+1;else return d;return a[o].startTime-e<e-a[c].startTime?o:c}function getCuesInRange(a,e,s){const o=[],c=getFirstCueIndexFromTime(a,e);if(c>-1)for(let d=c,h=a.length;d<h;d++){const g=a[d];if(g.startTime>=e&&g.endTime<=s)o.push(g);else if(g.startTime>s)return o}return o}function filterSubtitleTracks(a){const e=[];for(let s=0;s<a.length;s++){const o=a[s];(o.kind==="subtitles"||o.kind==="captions")&&o.label&&e.push(a[s])}return e}class SubtitleTrackController extends BasePlaylistController{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let s=null;const o=filterSubtitleTracks(this.media.textTracks);for(let d=0;d<o.length;d++)if(o[d].mode==="hidden")s=o[d];else if(o[d].mode==="showing"){s=o[d];break}const c=this.findTrackForTextTrack(s);this.subtitleTrack!==c&&this.setSubtitleTrack(c)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Events.ERROR,this.onError,this)}onMediaAttached(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,s){const o=this.media;if(!o)return;const c=!!s.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||o.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,c)return;filterSubtitleTracks(o.textTracks).forEach(h=>{clearCurrentCues(h)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,s){this.tracks=s.subtitleTracks}onSubtitleTrackLoaded(e,s){const{id:o,groupId:c,details:d}=s,h=this.tracksInGroup[o];if(!h||h.groupId!==c){this.warn(`Subtitle track with id:${o} and group:${c} not found in active group ${h==null?void 0:h.groupId}`);return}const g=h.details;h.details=s.details,this.log(`Subtitle track ${o} "${h.name}" lang:${h.lang} group:${c} loaded [${d.startSN}-${d.endSN}]`),o===this.trackId&&this.playlistLoaded(o,s,g)}onLevelLoading(e,s){this.switchLevel(s.level)}onLevelSwitching(e,s){this.switchLevel(s.level)}switchLevel(e){const s=this.hls.levels[e];if(!s)return;const o=s.subtitleGroups||null,c=this.groupIds;let d=this.currentTrack;if(!o||(c==null?void 0:c.length)!==(o==null?void 0:o.length)||o!=null&&o.some(h=>(c==null?void 0:c.indexOf(h))===-1)){this.groupIds=o,this.trackId=-1,this.currentTrack=null;const h=this.tracks.filter($=>!o||o.indexOf($.groupId)!==-1);if(h.length)this.selectDefaultTrack&&!h.some($=>$.default)&&(this.selectDefaultTrack=!1),h.forEach(($,j)=>{$.id=j});else if(!d&&!this.tracksInGroup.length)return;this.tracksInGroup=h;const g=this.hls.config.subtitlePreference;if(!d&&g){this.selectDefaultTrack=!1;const $=findMatchingOption(g,h);if($>-1)d=h[$];else{const j=findMatchingOption(g,this.tracks);d=this.tracks[j]}}let _=this.findTrackId(d);_===-1&&d&&(_=this.findTrackId(null));const b={subtitleTracks:h};this.log(`Updating subtitle tracks, ${h.length} track(s) found in "${o==null?void 0:o.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,b),_!==-1&&this.trackId===-1&&this.setSubtitleTrack(_)}}findTrackId(e){const s=this.tracksInGroup,o=this.selectDefaultTrack;for(let c=0;c<s.length;c++){const d=s[c];if(!(o&&!d.default||!o&&!e)&&(!e||matchesOption(d,e)))return c}if(e){for(let c=0;c<s.length;c++){const d=s[c];if(mediaAttributesIdentical(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<s.length;c++){const d=s[c];if(mediaAttributesIdentical(e.attrs,d.attrs,["LANGUAGE"]))return c}}return-1}findTrackForTextTrack(e){if(e){const s=this.tracksInGroup;for(let o=0;o<s.length;o++){const c=s[o];if(subtitleTrackMatchesTextTrack(c,e))return o}}return-1}onError(e,s){s.fatal||!s.context||s.context.type===PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(s.context.groupId)!==-1)&&this.checkRetry(s)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const s=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,s.length){const o=this.currentTrack;if(o&&matchesOption(e,o))return o;const c=findMatchingOption(e,this.tracksInGroup);if(c>-1){const d=this.tracksInGroup[c];return this.setSubtitleTrack(c),d}else{if(o)return null;{const d=findMatchingOption(e,s);if(d>-1)return s[d]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,s){super.loadingPlaylist(e,s);const o=e.id,c=e.groupId,d=this.getUrlWithDirectives(e.url,s),h=e.details,g=h==null?void 0:h.age;this.log(`Loading subtitle ${o} "${e.name}" lang:${e.lang} group:${c}${(s==null?void 0:s.msn)!==void 0?" at sn "+s.msn+" part "+s.part:""}${g&&h.live?" age "+g.toFixed(1)+(h.type&&" "+h.type||""):""} ${d}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:d,id:o,groupId:c,deliveryDirectives:s||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const s=filterSubtitleTracks(e.textTracks),o=this.currentTrack;let c;if(o&&(c=s.filter(d=>subtitleTrackMatchesTextTrack(o,d))[0],c||this.warn(`Unable to find subtitle TextTrack with name "${o.name}" and language "${o.lang}"`)),[].slice.call(s).forEach(d=>{d.mode!=="disabled"&&d!==c&&(d.mode="disabled")}),c){const d=this.subtitleDisplay?"showing":"hidden";c.mode!==d&&(c.mode=d)}}setSubtitleTrack(e){const s=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=s.length||!isFiniteNumber(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const o=this.currentTrack,c=s[e]||null;if(this.trackId=e,this.currentTrack=c,this.toggleTrackModes(),!c){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:e});return}const d=!!c.details&&!c.details.live;if(e===this.trackId&&c===o&&d)return;this.log(`Switching to subtitle-track ${e}`+(c?` "${c.name}" lang:${c.lang} group:${c.groupId}`:""));const{id:h,groupId:g="",name:_,type:b,url:$}=c;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:h,groupId:g,name:_,type:b,url:$});const j=this.switchParams(c.url,o==null?void 0:o.details,c.details);this.loadPlaylist(j)}}function uuid(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),s=e.toString();return URL.revokeObjectURL(e),s.slice(s.lastIndexOf("/")+1)}catch{let s=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const d=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(c=="x"?d:d&3|8).toString(16)})}}}function hash(a){let e=5381,s=a.length;for(;s;)e=e*33^a.charCodeAt(--s);return(e>>>0).toString()}const ALIGNED_END_THRESHOLD_SECONDS=.025;let TimelineOccupancy=function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a}({});function generateAssetIdentifier(a,e,s){return`${a.identifier}-${s+1}-${hash(e)}`}class InterstitialEvent{constructor(e,s){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=s,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var s;if(e>0&&e>=this.assetList.length)return!0;const o=this.playoutLimit;return e<=0||isNaN(o)?!1:o===0?!0:(((s=this.assetList[e])==null?void 0:s.startOffset)||0)>o}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const s=this.dateRange.tagAnchor;if(s)return getSnapToFragmentTime(e,s)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const s=this.dateRange.startTime,o=getSnapToFragmentTime(s,e);return s-o<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,s=isFiniteNumber(e)?e:this.duration;return this.cumulativeDuration+s}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const s=this.resumeAnchor;if(s)return getSnapToFragmentTime(e,s)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ALIGNED_END_THRESHOLD_SECONDS))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let s;return this._duration!==null?s=this._duration:this.dateRange.duration?s=this.dateRange.duration:s=this.dateRange.plannedDuration||0,!isNaN(e)&&e<s&&(s=e),s}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?TimelineOccupancy.Range:TimelineOccupancy.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return eventToString(this)}}function getSnapToFragmentTime(a,e){return a-e.start<e.duration/2&&!(Math.abs(a-(e.start+e.duration))<ALIGNED_END_THRESHOLD_SECONDS)?e.start:e.start+e.duration}function getInterstitialUrl(a,e,s){const o=new self.URL(a,s);return o.protocol!=="data:"&&o.searchParams.set("_HLS_primary_id",e),o}function getNextAssetIndex(a,e){for(;(s=a.assetList[++e])!=null&&s.error;)var s;return e}function eventToString(a){return`["${a.identifier}" ${a.cue.pre?"<pre>":a.cue.post?"<post>":""}${a.timelineStart.toFixed(2)}-${a.resumeTime.toFixed(2)}]`}function eventAssetToString(a){const e=a.timelineStart,s=a.duration||0;return`["${a.identifier}" ${e.toFixed(2)}-${(e+s).toFixed(2)}]`}class HlsAssetPlayer{constructor(e,s,o,c){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(Events.PLAYOUT_LIMIT_REACHED,{})};const d=this.hls=new e(s);this.interstitial=o,this.assetItem=c;const h=()=>{this.hasDetails=!0};d.once(Events.LEVEL_LOADED,h),d.once(Events.AUDIO_TRACK_LOADED,h),d.once(Events.SUBTITLE_TRACK_LOADED,h),d.on(Events.MEDIA_ATTACHING,(g,{media:_})=>{this.removeMediaListeners(),this.mediaAttached=_,this.interstitial.playoutLimit&&(_.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&d.on(Events.BUFFER_APPENDED,()=>{const $=this.bufferedEnd;this.reachedPlayout($)&&(this._bufferedEosTime=$,d.trigger(Events.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let s=this.assetItem.uri;try{s=getInterstitialUrl(s,e.config.primarySessionId||"").href}catch{}e.loadSource(s)}}bufferedInPlaceToEnd(e){var s;if(!this.appendInPlace)return!1;if((s=this.hls)!=null&&s.bufferedToEnd)return!0;if(!e)return!1;const o=Math.min(this._bufferedEosTime||1/0,this.duration),c=this.timelineOffset,d=BufferHelper.bufferInfo(e,c,0);return this.getAssetTime(d.end)>=o-.02}reachedPlayout(e){const o=this.interstitial.playoutLimit;return this.startOffset+e>=o}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const s=BufferHelper.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(s.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const s=this.interstitial.playoutLimit;if(s){const o=s-this.startOffset;if(o>0&&o<e)return o}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const s=this.timelineOffset;if(e!==s){const o=e-s;if(Math.abs(o)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const s=this.timelineOffset,o=this.duration;return Math.min(Math.max(0,e-s),o)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var s;this.loadSource(),(s=this.hls)==null||s.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const s=o=>delete o.details;e.levels.forEach(s),e.allAudioTracks.forEach(s),e.allSubtitleTracks.forEach(s),this.hasDetails=!1}}on(e,s,o){var c;(c=this.hls)==null||c.on(e,s)}once(e,s,o){var c;(c=this.hls)==null||c.once(e,s)}off(e,s,o){var c;(c=this.hls)==null||c.off(e,s)}toString(){var e;return`HlsAssetPlayer: ${eventAssetToString(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const ABUTTING_THRESHOLD_SECONDS=.033;class InterstitialsSchedule extends Logger{constructor(e,s){super("interstitials-sched",s),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,s){return this.events?this.events.reduce((o,c)=>e<=c.startOffset&&s>c.startOffset?(delete c.error,o+1):o,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,s){if(e.event)return this.findEventIndex(e.event.identifier);let o=-1;e.nextEvent?o=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(o=this.findEventIndex(e.previousEvent.identifier)+1);const c=this.items;if(c)for(c[o]||(s===void 0&&(s=e.start),o=this.findItemIndexAtTime(s));o>=0&&(d=c[o])!=null&&d.event;){var d;o--}return o}findItemIndexAtTime(e,s){const o=this.items;if(o)for(let c=0;c<o.length;c++){let d=o[c];if(s&&s!=="primary"&&(d=d[s]),e===d.start||e>d.start&&e<d.end)return c}return-1}findJumpRestrictedIndex(e,s){const o=this.items;if(o)for(let c=e;c<=s&&o[c];c++){const d=o[c].event;if(d!=null&&d.restrictions.jump&&!d.appendInPlace)return c}return-1}findEventIndex(e){const s=this.items;if(s)for(let c=s.length;c--;){var o;if(((o=s[c].event)==null?void 0:o.identifier)===e)return c}return-1}findAssetIndex(e,s){const o=e.assetList,c=o.length;if(c>1)for(let d=0;d<c;d++){const h=o[d];if(!h.error){const g=h.timelineStart;if(s===g||s>g&&(s<g+(h.duration||0)||d===c-1))return d}}return 0}get assetIdAtEnd(){var e;const s=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(s){const o=s.assetList,c=o[o.length-1];if(c)return c.identifier}return null}parseInterstitialDateRanges(e,s){const o=e.main.details,{dateRanges:c}=o,d=this.events,h=this.parseDateRanges(c,{url:o.url},s),g=Object.keys(c),_=d?d.filter(b=>!g.includes(b.identifier)):[];h.length&&h.sort((b,$)=>{const j=b.cue.pre,_e=b.cue.post,tt=$.cue.pre,rt=$.cue.post;if(j&&!tt)return-1;if(tt&&!j||_e&&!rt)return 1;if(rt&&!_e)return-1;if(!j&&!tt&&!_e&&!rt){const nt=b.startTime,st=$.startTime;if(nt!==st)return nt-st}return b.dateRange.tagOrder-$.dateRange.tagOrder}),this.events=h,_.forEach(b=>{this.removeEvent(b)}),this.updateSchedule(e,_)}updateSchedule(e,s=[],o=!1){const c=this.events||[];if(c.length||s.length||this.length<2){const d=this.items,h=this.parseSchedule(c,e);(o||s.length||(d==null?void 0:d.length)!==h.length||h.some((_,b)=>Math.abs(_.playout.start-d[b].playout.start)>.005||Math.abs(_.playout.end-d[b].playout.end)>.005))&&(this.items=h,this.onScheduleUpdate(s,d))}}parseDateRanges(e,s,o){const c=[],d=Object.keys(e);for(let h=0;h<d.length;h++){const g=d[h],_=e[g];if(_.isInterstitial){let b=this.eventMap[g];b?b.setDateRange(_):(b=new InterstitialEvent(_,s),this.eventMap[g]=b,o===!1&&(b.appendInPlace=o)),c.push(b)}}return c}parseSchedule(e,s){const o=[],c=s.main.details,d=c.live?1/0:c.edge;let h=0;if(e=e.filter(_=>!_.error&&!(_.cue.once&&_.hasPlayed)),e.length){this.resolveOffsets(e,s);let _=0,b=0;if(e.forEach(($,j)=>{const _e=$.cue.pre,tt=$.cue.post,rt=e[j-1]||null,nt=$.appendInPlace,st=tt?d:$.startOffset,at=$.duration,ot=$.timelineOccupancy===TimelineOccupancy.Range?at:0,ut=$.resumptionOffset,mt=(rt==null?void 0:rt.startTime)===st,yt=st+$.cumulativeDuration;let Et=nt?yt+at:st+ut;if(_e||!tt&&st<=0){const gt=b;b+=ot,$.timelineStart=yt;const St=h;h+=at,o.push({event:$,start:yt,end:Et,playout:{start:St,end:h},integrated:{start:gt,end:b}})}else if(st<=d){if(!mt){const xt=st-_;if(xt>ABUTTING_THRESHOLD_SECONDS){const Ct=_,Ht=b;b+=xt;const Dt=h;h+=xt;const rr={previousEvent:e[j-1]||null,nextEvent:$,start:Ct,end:Ct+xt,playout:{start:Dt,end:h},integrated:{start:Ht,end:b}};o.push(rr)}else xt>0&&rt&&(rt.cumulativeDuration+=xt,o[o.length-1].end=st)}tt&&(Et=yt),$.timelineStart=yt;const gt=b;b+=ot;const St=h;h+=at,o.push({event:$,start:yt,end:Et,playout:{start:St,end:h},integrated:{start:gt,end:b}})}else return;const dt=$.resumeTime;tt||dt>d?_=d:_=dt}),_<d){var g;const $=_,j=b,_e=d-_;b+=_e;const tt=h;h+=_e,o.push({previousEvent:((g=o[o.length-1])==null?void 0:g.event)||null,nextEvent:null,start:_,end:$+_e,playout:{start:tt,end:h},integrated:{start:j,end:b}})}this.setDurations(d,h,b)}else o.push({previousEvent:null,nextEvent:null,start:0,end:d,playout:{start:0,end:d},integrated:{start:0,end:d}}),this.setDurations(d,d,d);return o}setDurations(e,s,o){this.durations={primary:e,playout:s,integrated:o}}resolveOffsets(e,s){const o=s.main.details,c=o.live?1/0:o.edge;let d=0,h=-1;e.forEach((g,_)=>{const b=g.cue.pre,$=g.cue.post,j=b?0:$?c:g.startTime;this.updateAssetDurations(g),h===j?g.cumulativeDuration=d:(d=0,h=j),!$&&g.snapOptions.in&&(g.resumeAnchor=findFragmentByPTS(null,o.fragments,g.startOffset+g.resumptionOffset,0,0)||void 0),g.appendInPlace&&!g.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(g,s)||(g.appendInPlace=!1)),!g.appendInPlace&&_+1<e.length&&e[_+1].startTime-e[_].resumeTime<ABUTTING_THRESHOLD_SECONDS&&(e[_+1].appendInPlace=!1,e[_+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${g}`));const tt=isFiniteNumber(g.resumeOffset)?g.resumeOffset:g.duration;d+=tt})}primaryCanResumeInPlaceAt(e,s){const o=e.resumeTime,c=e.startTime+e.resumptionOffset;return Math.abs(o-c)>ALIGNED_END_THRESHOLD_SECONDS?(this.log(`"${e.identifier}" resumption ${o} not aligned with estimated timeline end ${c}`),!1):!Object.keys(s).some(h=>{const g=s[h].details,_=g.edge;if(o>=_)return this.log(`"${e.identifier}" resumption ${o} past ${h} playlist end ${_}`),!1;const b=findFragmentByPTS(null,g.fragments,o);if(!b)return this.log(`"${e.identifier}" resumption ${o} does not align with any fragments in ${h} playlist (${g.fragStart}-${g.fragmentEnd})`),!0;const $=h==="audio"?.175:0;return Math.abs(b.start-o)<ALIGNED_END_THRESHOLD_SECONDS+$||Math.abs(b.end-o)<ALIGNED_END_THRESHOLD_SECONDS+$?!1:(this.log(`"${e.identifier}" resumption ${o} not aligned with ${h} fragment bounds (${b.start}-${b.end} sn: ${b.sn} cc: ${b.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const s=e.timelineStart;let o=0,c=!1,d=!1;for(let h=0;h<e.assetList.length;h++){const g=e.assetList[h],_=s+o;g.startOffset=o,g.timelineStart=_,c||(c=g.duration===null),d||(d=!!g.error);const b=g.error?0:g.duration||0;o+=b}c&&!d?e.duration=Math.max(o,e.duration):e.duration=o}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function segmentToString(a){return`[${a.event?'"'+a.event.identifier+'"':"primary"}: ${a.start.toFixed(2)}-${a.end.toFixed(2)}]`}class AssetListLoader{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,s){const o=e.assetListUrl;let c;try{c=getInterstitialUrl(o,this.hls.sessionId,e.baseUrl)}catch(_e){const tt=this.assignAssetListError(e,ErrorDetails.ASSET_LIST_LOAD_ERROR,_e,o);this.hls.trigger(Events.ERROR,tt);return}s&&c.protocol!=="data:"&&c.searchParams.set("_HLS_start_offset",""+s);const d=this.hls.config,h=d.loader,g=new h(d),_={responseType:"json",url:c.href},b=d.interstitialAssetListLoadPolicy.default,$={loadPolicy:b,timeout:b.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},j={onSuccess:(_e,tt,rt,nt)=>{const st=_e.data,at=st==null?void 0:st.ASSETS;if(!Array.isArray(at)){const ot=this.assignAssetListError(e,ErrorDetails.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),rt.url,tt,nt);this.hls.trigger(Events.ERROR,ot);return}e.assetListResponse=st,this.hls.trigger(Events.ASSET_LIST_LOADED,{event:e,assetListResponse:st,networkDetails:nt})},onError:(_e,tt,rt,nt)=>{const st=this.assignAssetListError(e,ErrorDetails.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${_e.code} ${_e.text} (${tt.url})`),tt.url,nt,rt);this.hls.trigger(Events.ERROR,st)},onTimeout:(_e,tt,rt)=>{const nt=this.assignAssetListError(e,ErrorDetails.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${tt.url})`),tt.url,_e,rt);this.hls.trigger(Events.ERROR,nt)}};return g.load(_,$,j),this.hls.trigger(Events.ASSET_LIST_LOADING,{event:e}),g}assignAssetListError(e,s,o,c,d,h){return e.error=o,{type:ErrorTypes.NETWORK_ERROR,details:s,fatal:!1,interstitial:e,url:c,error:o,networkDetails:h,stats:d}}}function playWithCatch(a){var e;a==null||(e=a.play())==null||e.catch(()=>{})}function timelineMessage(a,e){return`[${a}] Advancing timeline position to ${e}`}class InterstitialsController extends Logger{constructor(e,s){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const o=this.currentTime;if(o===void 0||this.playbackDisabled||!this.schedule)return;const c=o-this.timelinePos;if(Math.abs(c)<1/7056e5)return;const h=c<=-.01;this.timelinePos=o,this.bufferedPos=o;const g=this.playingItem;if(!g){this.checkBuffer();return}if(h&&this.schedule.resetErrorsInRange(o,o-c)&&this.updateSchedule(!0),this.checkBuffer(),h&&o<g.start||o>=g.end){var _;const tt=this.findItemIndex(g);let rt=this.schedule.findItemIndexAtTime(o);if(rt===-1&&(rt=tt+(h?-1:1),this.log(`seeked ${h?"back ":""}to position not covered by schedule ${o} (resolving from ${tt} to ${rt})`)),!this.isInterstitial(g)&&(_=this.media)!=null&&_.paused&&(this.shouldPlay=!1),!h&&rt>tt){const nt=this.schedule.findJumpRestrictedIndex(tt+1,rt);if(nt>tt){this.setSchedulePosition(nt);return}}this.setSchedulePosition(rt);return}const b=this.playingAsset;if(!b){if(this.playingLastItem&&this.isInterstitial(g)){const tt=g.event.assetList[0];tt&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(o,tt))}return}const $=b.timelineStart,j=b.duration||0;if(h&&o<$||o>=$+j){var _e;(_e=g.event)!=null&&_e.appendInPlace&&(this.clearAssetPlayers(g.event,g),this.flushFrontBuffer(o)),this.setScheduleToAssetAtTime(o,b)}},this.onTimeupdate=()=>{const o=this.currentTime;if(o===void 0||this.playbackDisabled)return;if(o>this.timelinePos)this.timelinePos=o,o>this.bufferedPos&&this.checkBuffer();else return;const c=this.playingItem;if(!c||this.playingLastItem)return;if(o>=c.end){this.timelinePos=c.end;const g=this.findItemIndex(c);this.setSchedulePosition(g+1)}const d=this.playingAsset;if(!d)return;const h=d.timelineStart+(d.duration||0);o>=h&&this.setScheduleToAssetAtTime(o,d)},this.onScheduleUpdate=(o,c)=>{const d=this.schedule;if(!d)return;const h=this.playingItem,g=d.events||[],_=d.items||[],b=d.durations,$=o.map(nt=>nt.identifier),j=!!(g.length||$.length);(j||c)&&this.log(`INTERSTITIALS_UPDATED (${g.length}): ${g}
Schedule: ${_.map(nt=>segmentToString(nt))} pos: ${this.timelinePos}`),$.length&&this.log(`Removed events ${$}`);let _e=null,tt=null;h&&(_e=this.updateItem(h,this.timelinePos),this.itemsMatch(h,_e)?this.playingItem=_e:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const rt=this.bufferingItem;if(rt&&(tt=this.updateItem(rt,this.bufferedPos),this.itemsMatch(rt,tt)?this.bufferingItem=tt:rt.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(rt.event,null))),o.forEach(nt=>{nt.assetList.forEach(st=>{this.clearAssetPlayer(st.identifier,null)})}),this.playerQueue.forEach(nt=>{if(nt.interstitial.appendInPlace){const st=nt.assetItem.timelineStart,at=nt.timelineOffset-st;if(at)try{nt.timelineOffset=st}catch(ot){Math.abs(at)>ALIGNED_END_THRESHOLD_SECONDS&&this.warn(`${ot} ("${nt.assetId}" ${nt.timelineOffset}->${st})`)}}}),j||c){if(this.hls.trigger(Events.INTERSTITIALS_UPDATED,{events:g.slice(0),schedule:_.slice(0),durations:b,removedIds:$}),this.isInterstitial(h)&&$.includes(h.event.identifier)){this.warn(`Interstitial "${h.event.identifier}" removed while playing`),this.primaryFallback(h.event);return}h&&this.trimInPlace(_e,h),rt&&tt!==_e&&this.trimInPlace(tt,rt),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=s,this.assetListLoader=new AssetListLoader(e),this.schedule=new InterstitialsSchedule(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Events.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Events.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(Events.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(Events.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Events.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(Events.MEDIA_ENDED,this.onMediaEnded,this),e.on(Events.ERROR,this.onError,this),e.on(Events.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Events.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Events.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(Events.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(Events.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Events.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(Events.MEDIA_ENDED,this.onMediaEnded,this),e.off(Events.ERROR,this.onError,this),e.off(Events.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){removeEventListener(e,"play",this.onPlay),removeEventListener(e,"pause",this.onPause),removeEventListener(e,"seeking",this.onSeeking),removeEventListener(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,s){const o=this.media=s.media;addEventListener$1(o,"seeking",this.onSeeking),addEventListener$1(o,"timeupdate",this.onTimeupdate),addEventListener$1(o,"play",this.onPlay),addEventListener$1(o,"pause",this.onPause)}onMediaAttached(e,s){const o=this.effectivePlayingItem,c=this.detachedData;if(this.detachedData=null,o===null)this.checkStart();else if(!c){this.clearScheduleState();const d=this.findItemIndex(o);this.setSchedulePosition(d)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,s){const o=!!s.transferMedia,c=this.media;if(this.media=null,!o&&(c&&this.removeMediaListeners(c),this.detachedData)){const d=this.getBufferingPlayer();d&&(this.log(`Removing schedule state for detachedData and ${d}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,d.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,s=()=>e.bufferingItem||e.waitingItem,o=j=>j&&e.getAssetPlayer(j.identifier),c=(j,_e,tt,rt,nt)=>{if(j){let st=j[_e].start;const at=j.event;if(at){if(_e==="playout"||at.timelineOccupancy!==TimelineOccupancy.Point){const ot=o(tt);(ot==null?void 0:ot.interstitial)===at&&(st+=ot.assetItem.startOffset+ot[nt])}}else{const ot=rt==="bufferedPos"?h():e[rt];st+=ot-j.start}return st}return 0},d=(j,_e)=>{var tt;if(j!==0&&_e!=="primary"&&(tt=e.schedule)!=null&&tt.length){var rt;const nt=e.schedule.findItemIndexAtTime(j),st=(rt=e.schedule.items)==null?void 0:rt[nt];if(st){const at=st[_e].start-st.start;return j+at}}return j},h=()=>{const j=e.bufferedPos;return j===Number.MAX_VALUE?g("primary"):Math.max(j,0)},g=j=>{var _e,tt;return(_e=e.primaryDetails)!=null&&_e.live?e.primaryDetails.edge:((tt=e.schedule)==null?void 0:tt.durations[j])||0},_=(j,_e)=>{var tt,rt;const nt=e.effectivePlayingItem;if(nt!=null&&(tt=nt.event)!=null&&tt.restrictions.skip||!e.schedule)return;e.log(`seek to ${j} "${_e}"`);const st=e.effectivePlayingItem,at=e.schedule.findItemIndexAtTime(j,_e),ot=(rt=e.schedule.items)==null?void 0:rt[at],ut=e.getBufferingPlayer(),mt=ut==null?void 0:ut.interstitial,yt=mt==null?void 0:mt.appendInPlace,Et=st&&e.itemsMatch(st,ot);if(st&&(yt||Et)){const dt=o(e.playingAsset),gt=(dt==null?void 0:dt.media)||e.primaryMedia;if(gt){const St=_e==="primary"?gt.currentTime:c(st,_e,e.playingAsset,"timelinePos","currentTime"),xt=j-St,Ct=(yt?St:gt.currentTime)+xt;if(Ct>=0&&(!dt||yt||Ct<=dt.duration)){gt.currentTime=Ct;return}}}if(ot){let dt=j;if(_e!=="primary"){const St=ot[_e].start,xt=j-St;dt=ot.start+xt}const gt=!e.isInterstitial(ot);if((!e.isInterstitial(st)||st.event.appendInPlace)&&(gt||ot.event.appendInPlace)){const St=e.media||(yt?ut==null?void 0:ut.media:null);St&&(St.currentTime=dt)}else if(st){const St=e.findItemIndex(st);if(at>St){const Ct=e.schedule.findJumpRestrictedIndex(St+1,at);if(Ct>St){e.setSchedulePosition(Ct);return}}let xt=0;if(gt)e.timelinePos=dt,e.checkBuffer();else{const Ct=ot.event.assetList,Ht=j-(ot[_e]||ot).start;for(let Dt=Ct.length;Dt--;){const rr=Ct[Dt];if(rr.duration&&Ht>=rr.startOffset&&Ht<rr.startOffset+rr.duration){xt=Dt;break}}}e.setSchedulePosition(at,xt)}}},b=()=>{const j=e.effectivePlayingItem;if(e.isInterstitial(j))return j;const _e=s();return e.isInterstitial(_e)?_e:null},$={get bufferedEnd(){const j=s(),_e=e.bufferingItem;if(_e&&_e===j){var tt;return c(_e,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-_e.playout.start||((tt=e.bufferingAsset)==null?void 0:tt.startOffset)||0}return 0},get currentTime(){const j=b(),_e=e.effectivePlayingItem;return _e&&_e===j?c(_e,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-_e.playout.start:0},set currentTime(j){const _e=b(),tt=e.effectivePlayingItem;tt&&tt===_e&&_(j+tt.playout.start,"playout")},get duration(){const j=b();return j?j.playout.end-j.playout.start:0},get assetPlayers(){var j;const _e=(j=b())==null?void 0:j.event.assetList;return _e?_e.map(tt=>e.getAssetPlayer(tt.identifier)):[]},get playingIndex(){var j;const _e=(j=b())==null?void 0:j.event;return _e&&e.effectivePlayingAsset?_e.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return b()}};return this.manager={get events(){var j;return((j=e.schedule)==null||(j=j.events)==null?void 0:j.slice(0))||[]},get schedule(){var j;return((j=e.schedule)==null||(j=j.items)==null?void 0:j.slice(0))||[]},get interstitialPlayer(){return b()?$:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return s()},get bufferingIndex(){const j=s();return e.findItemIndex(j)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const j=e.effectivePlayingItem;return e.findItemIndex(j)},primary:{get bufferedEnd(){return h()},get currentTime(){const j=e.timelinePos;return j>0?j:0},set currentTime(j){_(j,"primary")},get duration(){return g("primary")},get seekableStart(){var j;return((j=e.primaryDetails)==null?void 0:j.fragmentStart)||0}},integrated:{get bufferedEnd(){return c(s(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return c(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(j){_(j,"integrated")},get duration(){return g("integrated")},get seekableStart(){var j;return d(((j=e.primaryDetails)==null?void 0:j.fragmentStart)||0,"integrated")}},skip:()=>{const j=e.effectivePlayingItem,_e=j==null?void 0:j.event;if(_e&&!_e.restrictions.skip){const tt=e.findItemIndex(j);if(_e.appendInPlace){const rt=j.playout.start+j.event.duration;_(rt+.001,"playout")}else e.advanceAfterAssetEnded(_e,tt,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const s=this.playingItem,o=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!s||!o?!1:this.findItemIndex(s)===o.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,s;if(this.mediaSelection===null)return;const o=this.waitingItem||this.playingItem;if(this.isInterstitial(o)&&!o.event.appendInPlace)return;let c=this.media;!c&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(c=this.primaryMedia);const d=(s=c)==null?void 0:s.currentTime;if(!(d===void 0||!isFiniteNumber(d)))return d}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,s){const o=this.getAssetPlayer(e);o&&this.transferMediaFromPlayer(o,s)}transferMediaFromPlayer(e,s){const o=e.interstitial.appendInPlace,c=e.media;if(o&&c===this.primaryMedia){if(this.bufferingAsset=null,(!s||this.isInterstitial(s)&&!s.event.appendInPlace)&&s&&c){this.detachedData={media:c};return}const d=e.transferMedia();this.log(`transfer MediaSource from ${e} ${stringify(d)}`),this.detachedData=d}else s&&c&&(this.shouldPlay||(this.shouldPlay=!c.paused))}transferMediaTo(e,s){var o,c;if(e.media===s)return;let d=null;const h=this.hls,g=e!==h,_=g&&e.interstitial.appendInPlace,b=(o=this.detachedData)==null?void 0:o.mediaSource;let $;if(h.media)_&&(d=h.transferMedia(),this.detachedData=d),$="Primary";else if(b){const rt=this.getBufferingPlayer();rt?(d=rt.transferMedia(),$=`${rt}`):$="detached MediaSource"}else $="detached media";if(!d){if(b)d=this.detachedData,this.log(`using detachedData: MediaSource ${stringify(d)}`);else if(!this.detachedData||h.media===s){const rt=this.playerQueue;rt.length>1&&rt.forEach(nt=>{if(g&&nt.interstitial.appendInPlace!==_){const st=nt.interstitial;this.clearInterstitial(nt.interstitial,null),st.appendInPlace=!1,st.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${st}`)}}),this.hls.detachMedia(),this.detachedData={media:s}}}const j=d&&"mediaSource"in d&&((c=d.mediaSource)==null?void 0:c.readyState)!=="closed",_e=j&&d?d:s;this.log(`${j?"transfering MediaSource":"attaching media"} to ${g?e:"Primary"} from ${$} (media.currentTime: ${s.currentTime})`);const tt=this.schedule;if(_e===d&&tt){const rt=g&&e.assetId===tt.assetIdAtEnd;_e.overrides={duration:tt.duration,endOfStream:!g||rt,cueRemoval:!g}}e.attachMedia(_e)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,s=e==null?void 0:e.events;if(!s||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const o=this.timelinePos,c=this.effectivePlayingItem;if(o===-1){const d=this.hls.startPosition;if(this.log(timelineMessage("checkStart",d)),this.timelinePos=d,s.length&&s[0].cue.pre){const h=e.findEventIndex(s[0].identifier);this.setSchedulePosition(h)}else if(d>=0||!this.primaryLive){const h=this.timelinePos=d>0?d:0,g=e.findItemIndexAtTime(h);this.setSchedulePosition(g)}}else if(c&&!this.playingItem){const d=e.findItemIndex(c);this.setSchedulePosition(d)}}advanceAssetBuffering(e,s){const o=e.event,c=o.findAssetIndex(s),d=getNextAssetIndex(o,c);if(!o.isAssetPastPlayoutLimit(d))this.bufferedToEvent(e,d);else if(this.schedule){var h;const g=(h=this.schedule.items)==null?void 0:h[this.findItemIndex(e)+1];g&&this.bufferedToItem(g)}}advanceAfterAssetEnded(e,s,o){const c=getNextAssetIndex(e,o);if(e.isAssetPastPlayoutLimit(c)){if(this.schedule){const d=this.schedule.items;if(d){const h=s+1,g=d.length;if(h>=g){this.setSchedulePosition(-1);return}const _=e.resumeTime;this.timelinePos<_&&(this.log(timelineMessage("advanceAfterAssetEnded",_)),this.timelinePos=_,e.appendInPlace&&this.advanceInPlace(_),this.checkBuffer(this.bufferedPos<_)),this.setSchedulePosition(h)}}}else{if(e.appendInPlace){const d=e.assetList[c];d&&this.advanceInPlace(d.timelineStart)}this.setSchedulePosition(s,c)}}setScheduleToAssetAtTime(e,s){const o=this.schedule;if(!o)return;const c=s.parentIdentifier,d=o.getEvent(c);if(d){const h=o.findEventIndex(c),g=o.findAssetIndex(d,e);this.advanceAfterAssetEnded(d,h,g-1)}}setSchedulePosition(e,s){var o;const c=(o=this.schedule)==null?void 0:o.items;if(!c||this.playbackDisabled)return;const d=e>=0?c[e]:null;this.log(`setSchedulePosition ${e}, ${s} (${d&&segmentToString(d)}) pos: ${this.timelinePos}`);const h=this.waitingItem||this.playingItem,g=this.playingLastItem;if(this.isInterstitial(h)){const $=h.event,j=this.playingAsset,_e=j==null?void 0:j.identifier,tt=_e?this.getAssetPlayer(_e):null;if(tt&&_e&&(!this.eventItemsMatch(h,d)||s!==void 0&&_e!==$.assetList[s].identifier)){var _;const rt=$.findAssetIndex(j);if(this.log(`INTERSTITIAL_ASSET_ENDED ${rt+1}/${$.assetList.length} ${eventAssetToString(j)}`),this.endedAsset=j,this.playingAsset=null,this.hls.trigger(Events.INTERSTITIAL_ASSET_ENDED,{asset:j,assetListIndex:rt,event:$,schedule:c.slice(0),scheduleIndex:e,player:tt}),h!==this.playingItem){this.itemsMatch(h,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded($,this.findItemIndex(this.playingItem),rt);return}this.retreiveMediaSource(_e,d),tt.media&&!((_=this.detachedData)!=null&&_.mediaSource)&&tt.detachMedia()}if(!this.eventItemsMatch(h,d)&&(this.endedItem=h,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${$} ${segmentToString(h)}`),$.hasPlayed=!0,this.hls.trigger(Events.INTERSTITIAL_ENDED,{event:$,schedule:c.slice(0),scheduleIndex:e}),$.cue.once)){var b;this.updateSchedule();const rt=(b=this.schedule)==null?void 0:b.items;if(d&&rt){const nt=this.findItemIndex(d);this.advanceSchedule(nt,rt,s,h,g)}return}}this.advanceSchedule(e,c,s,h,g)}advanceSchedule(e,s,o,c,d){const h=this.schedule;if(!h)return;const g=s[e]||null,_=this.primaryMedia,b=this.playerQueue;if(b.length&&b.forEach($=>{const j=$.interstitial,_e=h.findEventIndex(j.identifier);(_e<e||_e>e+1)&&this.clearInterstitial(j,g)}),this.isInterstitial(g)){this.timelinePos=Math.min(Math.max(this.timelinePos,g.start),g.end);const $=g.event;if(o===void 0){o=h.findAssetIndex($,this.timelinePos);const rt=getNextAssetIndex($,o-1);if($.isAssetPastPlayoutLimit(rt)||$.appendInPlace&&this.timelinePos===g.end){this.advanceAfterAssetEnded($,e,o);return}o=rt}const j=this.waitingItem;this.assetsBuffered(g,_)||this.setBufferingItem(g);let _e=this.preloadAssets($,o);if(this.eventItemsMatch(g,j||c)||(this.waitingItem=g,this.log(`INTERSTITIAL_STARTED ${segmentToString(g)} ${$.appendInPlace?"append in place":""}`),this.hls.trigger(Events.INTERSTITIAL_STARTED,{event:$,schedule:s.slice(0),scheduleIndex:e})),!$.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${$}`);return}if($.assetListLoader&&($.assetListLoader.destroy(),$.assetListLoader=void 0),!_){this.log(`Waiting for attachMedia to start Interstitial ${$}`);return}this.waitingItem=this.endedItem=null,this.playingItem=g;const tt=$.assetList[o];if(!tt){this.advanceAfterAssetEnded($,e,o||0);return}if(_e||(_e=this.getAssetPlayer(tt.identifier)),_e===null||_e.destroyed){const rt=$.assetList.length;this.warn(`asset ${o+1}/${rt} player destroyed ${$}`),_e=this.createAssetPlayer($,tt,o),_e.loadSource()}if(!this.eventItemsMatch(g,this.bufferingItem)&&$.appendInPlace&&this.isAssetBuffered(tt))return;this.startAssetPlayer(_e,o,s,e,_),this.shouldPlay&&playWithCatch(_e.media)}else g?(this.resumePrimary(g,e,c),this.shouldPlay&&playWithCatch(this.hls.media)):d&&this.isInterstitial(c)&&(this.endedItem=null,this.playingItem=c,c.event.appendInPlace||this.attachPrimary(h.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,s,o){var c,d;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${segmentToString(e)}`),!((c=this.detachedData)!=null&&c.mediaSource)){let g=this.timelinePos;(g<e.start||g>=e.end)&&(g=this.getPrimaryResumption(e,s),this.log(timelineMessage("resumePrimary",g)),this.timelinePos=g),this.attachPrimary(g,e)}if(!o)return;const h=(d=this.schedule)==null?void 0:d.items;h&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${segmentToString(e)}`),this.hls.trigger(Events.INTERSTITIALS_PRIMARY_RESUMED,{schedule:h.slice(0),scheduleIndex:s}),this.checkBuffer())}getPrimaryResumption(e,s){const o=e.start;if(this.primaryLive){const c=this.primaryDetails;if(s===0)return this.hls.startPosition;if(c&&(o<c.fragmentStart||o>c.edge))return this.hls.liveSyncPosition||-1}return o}isAssetBuffered(e){const s=this.getAssetPlayer(e.identifier);return s!=null&&s.hls?s.hls.bufferedToEnd:BufferHelper.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,s,o){s?this.setBufferingItem(s):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const c=this.primaryMedia;if(!c)return;const d=this.hls;d.media?this.checkBuffer():(this.transferMediaTo(d,c),o&&this.startLoadingPrimaryAt(e,o)),o||(this.log(timelineMessage("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,o))}startLoadingPrimaryAt(e,s){var o;const c=this.hls;!c.loadingEnabled||!c.media||Math.abs((((o=c.mainForwardBufferInfo)==null?void 0:o.start)||c.media.currentTime)-e)>.5?c.startLoad(e,s):c.bufferingEnabled||c.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Events.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,s){if(s.level===-1||!this.schedule)return;const o=this.hls.levels[s.level];if(!o.details)return;const c=_objectSpread2(_objectSpread2({},this.mediaSelection||this.altSelection),{},{main:o});this.mediaSelection=c,this.schedule.parseInterstitialDateRanges(c,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,s){const o=this.hls.audioTracks[s.id],c=this.mediaSelection;if(!c){this.altSelection=_objectSpread2(_objectSpread2({},this.altSelection),{},{audio:o});return}const d=_objectSpread2(_objectSpread2({},c),{},{audio:o});this.mediaSelection=d}onSubtitleTrackUpdated(e,s){const o=this.hls.subtitleTracks[s.id],c=this.mediaSelection;if(!c){this.altSelection=_objectSpread2(_objectSpread2({},this.altSelection),{},{subtitles:o});return}const d=_objectSpread2(_objectSpread2({},c),{},{subtitles:o});this.mediaSelection=d}onAudioTrackSwitching(e,s){const o=getBasicSelectionOption(s);this.playerQueue.forEach(({hls:c})=>c&&(c.setAudioOption(s)||c.setAudioOption(o)))}onSubtitleTrackSwitch(e,s){const o=getBasicSelectionOption(s);this.playerQueue.forEach(({hls:c})=>c&&(c.setSubtitleOption(s)||s.id!==-1&&c.setSubtitleOption(o)))}onBufferCodecs(e,s){const o=s.tracks;o&&(this.requiredTracks=o)}onBufferAppended(e,s){this.checkBuffer()}onBufferFlushed(e,s){const o=this.playingItem;if(o&&!this.itemsMatch(o,this.bufferingItem)&&!this.isInterstitial(o)){const c=this.timelinePos;this.bufferedPos=c,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const s=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&s){for(let c=0;c<s.length;c++){const d=s[c];if(d.cue.post){var o;const h=this.schedule.findEventIndex(d.identifier),g=(o=this.schedule.items)==null?void 0:o[h];this.isInterstitial(g)&&this.eventItemsMatch(g,this.bufferingItem)&&this.bufferedToItem(g,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const s=this.playingItem;if(!this.playingLastItem&&s){const o=this.findItemIndex(s);this.setSchedulePosition(o+1)}else this.shouldPlay=!1}updateItem(e,s){var o;const c=(o=this.schedule)==null?void 0:o.items;if(e&&c){const d=this.findItemIndex(e,s);return c[d]||null}return null}trimInPlace(e,s){if(this.isInterstitial(e)&&e.event.appendInPlace&&s.end-e.end>.25){e.event.assetList.forEach((d,h)=>{e.event.isAssetPastPlayoutLimit(h)&&this.clearAssetPlayer(d.identifier,null)});const o=e.end+.25,c=BufferHelper.bufferInfo(this.primaryMedia,o,0);(c.end>o||(c.nextStart||0)>o)&&(this.log(`trim buffered interstitial ${segmentToString(e)} (was ${segmentToString(s)})`),this.attachPrimary(o,null,!0),this.flushFrontBuffer(o))}}itemsMatch(e,s){return!!s&&(e===s||e.event&&s.event&&this.eventItemsMatch(e,s)||!e.event&&!s.event&&this.findItemIndex(e)===this.findItemIndex(s))}eventItemsMatch(e,s){var o;return!!s&&(e===s||e.event.identifier===((o=s.event)==null?void 0:o.identifier))}findItemIndex(e,s){return e&&this.schedule?this.schedule.findItemIndex(e,s):-1}updateSchedule(e=!1){var s;const o=this.mediaSelection;o&&((s=this.schedule)==null||s.updateSchedule(o,[],e))}checkBuffer(e){var s;const o=(s=this.schedule)==null?void 0:s.items;if(!o)return;const c=BufferHelper.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=c.len<1),this.updateBufferedPos(c.end,o,e)}updateBufferedPos(e,s,o){const c=this.schedule,d=this.bufferingItem;if(this.bufferedPos>e||!c)return;if(s.length===1&&this.itemsMatch(s[0],d)){this.bufferedPos=e;return}const h=this.playingItem,g=this.findItemIndex(h);let _=c.findItemIndexAtTime(e);if(this.bufferedPos<e){var b;const $=this.findItemIndex(d),j=Math.min($+1,s.length-1),_e=s[j];if((_===-1&&d&&e>=d.end||(b=_e.event)!=null&&b.appendInPlace&&e+.01>=_e.start)&&(_=j),this.isInterstitial(d)){const tt=d.event;if(j-g>1&&tt.appendInPlace===!1||tt.assetList.length===0&&tt.assetListLoader)return}if(this.bufferedPos=e,_>$&&_>g)this.bufferedToItem(_e);else{const tt=this.primaryDetails;this.primaryLive&&tt&&e>tt.edge-tt.targetduration&&_e.start<tt.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(_e)&&this.preloadAssets(_e.event,0)}}else o&&h&&!this.itemsMatch(h,d)&&(_===g?this.bufferedToItem(h):_===g+1&&this.bufferedToItem(s[_]))}assetsBuffered(e,s){return e.event.assetList.length===0?!1:!e.event.assetList.some(c=>{const d=this.getAssetPlayer(c.identifier);return!(d!=null&&d.bufferedInPlaceToEnd(s))})}setBufferingItem(e){const s=this.bufferingItem,o=this.schedule;if(!this.itemsMatch(e,s)&&o){const{items:c,events:d}=o;if(!c||!d)return s;const h=this.isInterstitial(e),g=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const _=g?g.remaining:s?s.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${segmentToString(e)}`+(s?` (${_.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(h){const b=o.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach(($,j)=>{const _e=this.getAssetPlayer($.identifier);_e&&(j===b&&_e.loadSource(),_e.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(b=>b.pauseBuffering());this.hls.trigger(Events.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:d.slice(0),schedule:c.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return s}bufferedToItem(e,s=0){const o=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,s);else if(o!==null){this.bufferingAsset=null;const c=this.detachedData;c?c.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const s=this.findItemIndex(e),o=this.getPrimaryResumption(e,s);this.startLoadingPrimaryAt(o)}bufferedToEvent(e,s){const o=e.event,c=o.assetList.length===0&&!o.assetListLoader,d=o.cue.once;if(c||!d){const h=this.preloadAssets(o,s);if(h!=null&&h.interstitial.appendInPlace){const g=this.primaryMedia;g&&this.bufferAssetPlayer(h,g)}}}preloadAssets(e,s){const o=e.assetUrl,c=e.assetList.length,d=c===0&&!e.assetListLoader,h=e.cue.once;if(d){const _=e.timelineStart;if(e.appendInPlace){var g;const _e=this.playingItem;!this.isInterstitial(_e)&&(_e==null||(g=_e.nextEvent)==null?void 0:g.identifier)===e.identifier&&this.flushFrontBuffer(_+.25)}let b,$=0;if(!this.playingItem&&this.primaryLive&&($=this.hls.startPosition,$===-1&&($=this.hls.liveSyncPosition||0)),$&&!(e.cue.pre||e.cue.post)){const _e=$-_;_e>0&&(b=Math.round(_e*1e3)/1e3)}if(this.log(`Load interstitial asset ${s+1}/${o?1:c} ${e}${b?` live-start: ${$} start-offset: ${b}`:""}`),o)return this.createAsset(e,0,0,_,e.duration,o);const j=this.assetListLoader.loadAssetList(e,b);j&&(e.assetListLoader=j)}else if(!h&&c){for(let b=s;b<c;b++){const $=e.assetList[b],j=this.getAssetPlayerQueueIndex($.identifier);(j===-1||this.playerQueue[j].destroyed)&&!$.error&&this.createAssetPlayer(e,$,b)}const _=e.assetList[s];if(_){const b=this.getAssetPlayer(_.identifier);return b&&b.loadSource(),b}}return null}flushFrontBuffer(e){const s=this.requiredTracks;if(!s)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(s).forEach(c=>{this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:c})})}getAssetPlayerQueueIndex(e){const s=this.playerQueue;for(let o=0;o<s.length;o++)if(e===s[o].assetId)return o;return-1}getAssetPlayer(e){const s=this.getAssetPlayerQueueIndex(e);return this.playerQueue[s]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:s}=this;if(s){for(let o=0;o<e.length;o++)if(e[o].media===s)return e[o]}return null}createAsset(e,s,o,c,d,h){const g={parentIdentifier:e.identifier,identifier:generateAssetIdentifier(e,h,s),duration:d,startOffset:o,timelineStart:c,uri:h};return this.createAssetPlayer(e,g,s)}createAssetPlayer(e,s,o){const c=this.hls,d=c.userConfig;let h=d.videoPreference;const g=c.loadLevelObj||c.levels[c.currentLevel];(h||g)&&(h=_extends({},h),g.videoCodec&&(h.videoCodec=g.videoCodec),g.videoRange&&(h.allowedVideoRanges=[g.videoRange]));const _=c.audioTracks[c.audioTrack],b=c.subtitleTracks[c.subtitleTrack];let $=0;if(this.primaryLive||e.appendInPlace){const mt=this.timelinePos-s.timelineStart;if(mt>1){const yt=s.duration;yt&&mt<yt&&($=mt)}}const j=s.identifier,_e=_objectSpread2(_objectSpread2({},d),{},{maxMaxBufferLength:Math.min(180,c.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:c.sessionId,assetPlayerId:j,abrEwmaDefaultEstimate:c.bandwidthEstimate,interstitialsController:void 0,startPosition:$,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:h,audioPreference:_||d.audioPreference,subtitlePreference:b||d.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,s.timelineStart&&(_e.timelineOffset=s.timelineStart));const tt=_e.cmcd;tt!=null&&tt.sessionId&&tt.contentId&&(_e.cmcd=_extends({},tt,{contentId:hash(s.uri)})),this.getAssetPlayer(j)&&this.warn(`Duplicate date range identifier ${e} and asset ${j}`);const rt=new HlsAssetPlayer(this.HlsPlayerClass,_e,e,s);this.playerQueue.push(rt),e.assetList[o]=s;let nt=!0;const st=mt=>{if(mt.live){var yt;const gt=new Error(`Interstitials MUST be VOD assets ${e}`),St={fatal:!0,type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERSTITIAL_ASSET_ITEM_ERROR,error:gt},xt=((yt=this.schedule)==null?void 0:yt.findEventIndex(e.identifier))||-1;this.handleAssetItemError(St,e,xt,o,gt.message);return}const Et=mt.edge-mt.fragmentStart,dt=s.duration;(nt||dt===null||Et>dt)&&(nt=!1,this.log(`Interstitial asset "${j}" duration change ${dt} > ${Et}`),s.duration=Et,this.updateSchedule())};rt.on(Events.LEVEL_UPDATED,(mt,{details:yt})=>st(yt)),rt.on(Events.LEVEL_PTS_UPDATED,(mt,{details:yt})=>st(yt)),rt.on(Events.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const at=(mt,yt)=>{const Et=this.getAssetPlayer(j);if(Et&&yt.tracks){Et.off(Events.BUFFER_CODECS,at),Et.tracks=yt.tracks;const dt=this.primaryMedia;this.bufferingAsset===Et.assetItem&&dt&&!Et.media&&this.bufferAssetPlayer(Et,dt)}};rt.on(Events.BUFFER_CODECS,at);const ot=()=>{var mt;const yt=this.getAssetPlayer(j);if(this.log(`buffered to end of asset ${yt}`),!yt||!this.schedule)return;const Et=this.schedule.findEventIndex(e.identifier),dt=(mt=this.schedule.items)==null?void 0:mt[Et];this.isInterstitial(dt)&&this.advanceAssetBuffering(dt,s)};rt.on(Events.BUFFERED_TO_END,ot);const ut=mt=>()=>{if(!this.getAssetPlayer(j)||!this.schedule)return;this.shouldPlay=!0;const Et=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,Et,mt)};return rt.once(Events.MEDIA_ENDED,ut(o)),rt.once(Events.PLAYOUT_LIMIT_REACHED,ut(1/0)),rt.on(Events.ERROR,(mt,yt)=>{if(!this.schedule)return;const Et=this.getAssetPlayer(j);if(yt.details===ErrorDetails.BUFFER_STALLED_ERROR){if(Et!=null&&Et.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(yt,e,this.schedule.findEventIndex(e.identifier),o,`Asset player error ${yt.error} ${e}`)}),rt.on(Events.DESTROYING,()=>{if(!this.getAssetPlayer(j)||!this.schedule)return;const yt=new Error(`Asset player destroyed unexpectedly ${j}`),Et={fatal:!0,type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERSTITIAL_ASSET_ITEM_ERROR,error:yt};this.handleAssetItemError(Et,e,this.schedule.findEventIndex(e.identifier),o,yt.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${eventAssetToString(s)}`),this.hls.trigger(Events.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:s,assetListIndex:o,event:e,player:rt}),rt}clearInterstitial(e,s){this.clearAssetPlayers(e,s),e.reset()}clearAssetPlayers(e,s){e.assetList.forEach(o=>{this.clearAssetPlayer(o.identifier,s)})}resetAssetPlayer(e){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){this.log(`reset asset player "${e}" after error`);const o=this.playerQueue[s];this.transferMediaFromPlayer(o,null),o.resetDetails()}}clearAssetPlayer(e,s){const o=this.getAssetPlayerQueueIndex(e);if(o!==-1){const c=this.playerQueue[o];this.log(`clear ${c} toSegment: ${s&&segmentToString(s)}`),this.transferMediaFromPlayer(c,s),this.playerQueue.splice(o,1),c.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,s,o,c,d){const{interstitial:h,assetItem:g,assetId:_}=e,b=h.assetList.length,$=this.playingAsset;this.endedAsset=null,this.playingAsset=g,(!$||$.identifier!==_)&&($&&(this.clearAssetPlayer($.identifier,o[c]),delete $.error),this.log(`INTERSTITIAL_ASSET_STARTED ${s+1}/${b} ${eventAssetToString(g)}`),this.hls.trigger(Events.INTERSTITIAL_ASSET_STARTED,{asset:g,assetListIndex:s,event:h,schedule:o.slice(0),scheduleIndex:c,player:e})),this.bufferAssetPlayer(e,d)}bufferAssetPlayer(e,s){var o,c;if(!this.schedule)return;const{interstitial:d,assetItem:h}=e,g=this.schedule.findEventIndex(d.identifier),_=(o=this.schedule.items)==null?void 0:o[g];if(!_)return;e.loadSource(),this.setBufferingItem(_),this.bufferingAsset=h;const b=this.getBufferingPlayer();if(b===e)return;const $=d.appendInPlace;if($&&(b==null?void 0:b.interstitial.appendInPlace)===!1)return;const j=(b==null?void 0:b.tracks)||((c=this.detachedData)==null?void 0:c.tracks)||this.requiredTracks;if($&&h!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(j&&!isCompatibleTrackChange(j,e.tracks)){const _e=new Error(`Asset ${eventAssetToString(h)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(j)}')`),tt={fatal:!0,type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERSTITIAL_ASSET_ITEM_ERROR,error:_e},rt=d.findAssetIndex(h);this.handleAssetItemError(tt,d,g,rt,_e.message);return}}this.transferMediaTo(e,s)}handleInPlaceStall(e){const s=this.schedule,o=this.primaryMedia;if(!s||!o)return;const c=o.currentTime,d=s.findAssetIndex(e,c),h=e.assetList[d];if(h){const g=this.getAssetPlayer(h.identifier);if(g){const _=g.currentTime||c-h.timelineStart,b=g.duration-_;if(this.warn(`Stalled at ${_} of ${_+b} in ${g} ${e} (media.currentTime: ${c})`),_&&(b/o.playbackRate<.5||g.bufferedInPlaceToEnd(o))&&g.hls){const $=s.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,$,d)}}}}advanceInPlace(e){const s=this.primaryMedia;s&&s.currentTime<e&&(s.currentTime=e)}handleAssetItemError(e,s,o,c,d){if(e.details===ErrorDetails.BUFFER_STALLED_ERROR)return;const h=s.assetList[c]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${h&&eventAssetToString(h)} ${e.error}`),!this.schedule)return;const g=(h==null?void 0:h.identifier)||"",_=this.getAssetPlayerQueueIndex(g),b=this.playerQueue[_]||null,$=this.schedule.items,j=_extends({},e,{fatal:!1,errorAction:createDoNothingErrorAction(!0),asset:h,assetListIndex:c,event:s,schedule:$,scheduleIndex:o,player:b});if(this.hls.trigger(Events.INTERSTITIAL_ASSET_ERROR,j),!e.fatal)return;const _e=this.playingAsset,tt=this.bufferingAsset,rt=new Error(d);if(h&&(this.clearAssetPlayer(g,null),h.error=rt),!s.assetList.some(nt=>!nt.error))s.error=rt;else for(let nt=c;nt<s.assetList.length;nt++)this.resetAssetPlayer(s.assetList[nt].identifier);this.updateSchedule(!0),s.error?this.primaryFallback(s):_e&&_e.identifier===g?this.advanceAfterAssetEnded(s,o,c):tt&&tt.identifier===g&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,tt)}primaryFallback(e){const s=e.timelineStart,o=this.effectivePlayingItem;let c=this.timelinePos;if(o){this.log(`Fallback to primary from event "${e.identifier}" start: ${s} pos: ${c} playing: ${segmentToString(o)} error: ${e.error}`),c===-1&&(c=this.hls.startPosition);const h=this.updateItem(o,c);this.itemsMatch(o,h)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(s,null),this.flushFrontBuffer(s))}else if(c===-1){this.checkStart();return}if(!this.schedule)return;const d=this.schedule.findItemIndexAtTime(c);this.setSchedulePosition(d)}onAssetListLoaded(e,s){var o,c;const d=s.event,h=d.identifier,g=s.assetListResponse.ASSETS;if(!((o=this.schedule)!=null&&o.hasEvent(h)))return;const _=d.timelineStart,b=d.duration;let $=0;g.forEach((nt,st)=>{const at=parseFloat(nt.DURATION);this.createAsset(d,st,$,_+$,at,nt.URI),$+=at}),d.duration=$,this.log(`Loaded asset-list with duration: ${$} (was: ${b}) ${d}`);const j=this.waitingItem,_e=(j==null?void 0:j.event.identifier)===h;this.updateSchedule();const tt=(c=this.bufferingItem)==null?void 0:c.event;if(_e){var rt;const nt=this.schedule.findEventIndex(h),st=(rt=this.schedule.items)==null?void 0:rt[nt];if(st){if(!this.playingItem&&this.timelinePos>st.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==nt){d.error=new Error(`Interstitial ${g.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${d}`),this.log(d.error.message),this.updateSchedule(!0),this.primaryFallback(d);return}this.setBufferingItem(st)}this.setSchedulePosition(nt)}else if((tt==null?void 0:tt.identifier)===h){const nt=d.assetList[0];if(nt){const st=this.getAssetPlayer(nt.identifier);if(tt.appendInPlace){const at=this.primaryMedia;st&&at&&this.bufferAssetPlayer(st,at)}else st&&st.loadSource()}}}onError(e,s){if(this.schedule)switch(s.details){case ErrorDetails.ASSET_LIST_PARSING_ERROR:case ErrorDetails.ASSET_LIST_LOAD_ERROR:case ErrorDetails.ASSET_LIST_LOAD_TIMEOUT:{const o=s.interstitial;o&&(this.updateSchedule(!0),this.primaryFallback(o));break}case ErrorDetails.BUFFER_STALLED_ERROR:{const o=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(o)&&o.event.appendInPlace){this.handleInPlaceStall(o.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const TICK_INTERVAL$2=500;class SubtitleStreamController extends BaseStreamController{constructor(e,s,o){super(e,s,o,"subtitle-stream-controller",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,s){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$2),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=s?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,s){this.tracksBuffered=[],super.onMediaDetaching(e,s)}onLevelLoaded(e,s){this.mainDetails=s.details}onSubtitleFragProcessed(e,s){const{frag:o,success:c}=s;if(this.fragContextChanged(o)||(isMediaFragment(o)&&(this.fragPrevious=o),this.state=State.IDLE),!c)return;const d=this.tracksBuffered[this.currentTrackId];if(!d)return;let h;const g=o.start;for(let b=0;b<d.length;b++)if(g>=d[b].start&&g<=d[b].end){h=d[b];break}const _=o.start+o.duration;h?h.end=_:(h={start:g,end:_},d.push(h)),this.fragmentTracker.fragBuffered(o),this.fragBufferedComplete(o,null),this.media&&this.tick()}onBufferFlushing(e,s){const{startOffset:o,endOffset:c}=s;if(o===0&&c!==Number.POSITIVE_INFINITY){const d=c-1;if(d<=0)return;s.endOffsetSubtitles=Math.max(0,d),this.tracksBuffered.forEach(h=>{for(let g=0;g<h.length;){if(h[g].end<=d){h.shift();continue}else if(h[g].start<d)h[g].start=d;else break;g++}}),this.fragmentTracker.removeFragmentsInRange(o,d,PlaylistLevelType.SUBTITLE)}}onError(e,s){const o=s.frag;(o==null?void 0:o.type)===PlaylistLevelType.SUBTITLE&&(s.details===ErrorDetails.FRAG_GAP&&this.fragmentTracker.fragBuffered(o,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:s}){if(this.levels&&subtitleOptionsIdentical(this.levels,s)){this.levels=s.map(o=>new Level(o));return}this.tracksBuffered=[],this.levels=s.map(o=>{const c=new Level(o);return this.tracksBuffered[c.id]=[],c}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,s){var o;if(this.currentTrackId=s.id,!((o=this.levels)!=null&&o.length)||this.currentTrackId===-1){this.clearInterval();return}const c=this.levels[this.currentTrackId];c!=null&&c.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,c&&this.state!==State.STOPPED&&this.setInterval(TICK_INTERVAL$2)}onSubtitleTrackLoaded(e,s){var o;const{currentTrackId:c,levels:d}=this,{details:h,id:g}=s;if(!d){this.warn(`Subtitle tracks were reset while loading level ${g}`);return}const _=d[g];if(g>=d.length||!_)return;this.log(`Subtitle track ${g} loaded [${h.startSN},${h.endSN}]${h.lastPartSn?`[part-${h.lastPartSn}-${h.lastPartIndex}]`:""},duration:${h.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let b=0;if(h.live||(o=_.details)!=null&&o.live){if(h.deltaUpdateFailed)return;const j=this.mainDetails;if(!j){this.startFragRequested=!1;return}const _e=j.fragments[0];if(!_.details)h.hasProgramDateTime&&j.hasProgramDateTime?(alignMediaPlaylistByPDT(h,j),b=h.fragmentStart):_e&&(b=_e.start,addSliding(h,b));else{var $;b=this.alignPlaylists(h,_.details,($=this.levelLastLoaded)==null?void 0:$.details),b===0&&_e&&(b=_e.start,addSliding(h,b))}j&&!this.startFragRequested&&this.setStartPosition(j,b)}_.details=h,this.levelLastLoaded=_,g===c&&(this.hls.trigger(Events.SUBTITLE_TRACK_UPDATED,{details:h,id:g,groupId:s.groupId}),this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,h.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),_.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:s,payload:o}=e,c=s.decryptdata,d=this.hls;if(!this.fragContextChanged(s)&&o&&o.byteLength>0&&c!=null&&c.key&&c.iv&&isFullSegmentEncryption(c.method)){const h=performance.now();this.decrypter.decrypt(new Uint8Array(o),c.key.buffer,c.iv.buffer,getAesModeFromFullSegmentMethod(c.method)).catch(g=>{throw d.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:g,reason:g.message,frag:s}),g}).then(g=>{const _=performance.now();d.trigger(Events.FRAG_DECRYPTED,{frag:s,payload:g,stats:{tstart:h,tdecrypt:_}})}).catch(g=>{this.warn(`${g.name}: ${g.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:e,levels:s}=this,o=s==null?void 0:s[e];if(!o||!s.length||!o.details||this.waitForLive(o))return;const{config:c}=this,d=this.getLoadPosition(),h=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],d,c.maxBufferHole),{end:g,len:_}=h,b=o.details,$=this.hls.maxBufferLength+b.levelTargetDuration;if(_>$)return;const j=b.fragments,_e=j.length,tt=b.edge;let rt=null;const nt=this.fragPrevious;if(g<tt){const ot=c.maxFragLookUpTolerance,ut=g>tt-ot?0:ot;rt=findFragmentByPTS(nt,j,Math.max(j[0].start,g),ut),!rt&&nt&&nt.start<j[0].start&&(rt=j[0])}else rt=j[_e-1];if(rt=this.filterReplacedPrimary(rt,o.details),!rt)return;const st=rt.sn-b.startSN,at=j[st-1];if(at&&at.cc===rt.cc&&this.fragmentTracker.getState(at)===FragmentState.NOT_LOADED&&(rt=at),this.fragmentTracker.getState(rt)===FragmentState.NOT_LOADED){const ot=this.mapToInitFragWhenRequired(rt);ot&&this.loadFragment(ot,o,g)}}}loadFragment(e,s,o){isMediaFragment(e)?super.loadFragment(e,s,o):this._loadInitSegment(e,s)}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(e){this.buffered=void 0;const s=(o,c,d)=>{if(c=c>>>0,c>d-1)throw new DOMException(`Failed to execute '${o}' on 'TimeRanges': The index provided (${c}) is greater than the maximum bound (${d})`);return e[c][o]};this.buffered={get length(){return e.length},end(o){return s("end",o,e.length)},start(o){return s("start",o,e.length)}}}}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=a=>String.fromCharCode(specialCea608CharsCodes[a]||a),NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(e,s){if(this.verboseLevel>=e){const o=typeof s=="function"?s():s;logger.log(`${this.time} [${e}] ${o}`)}}}const numArrayToHexArray=function a(e){const s=[];for(let o=0;o<e.length;o++)s.push(e[o].toString(16));return s};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const s=["foreground","underline","italics","background","flash"];for(let o=0;o<s.length;o++){const c=s[o];e.hasOwnProperty(c)&&(this[c]=e[c])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(e,s){this.uchar=e,this.penState.copy(s)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(e){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let s=0;s<NR_COLS;s++)this.chars.push(new StyledUnicodeChar);this.logger=e}equals(e){for(let s=0;s<NR_COLS;s++)if(!this.chars[s].equals(e.chars[s]))return!1;return!0}copy(e){for(let s=0;s<NR_COLS;s++)this.chars[s].copy(e.chars[s])}isEmpty(){let e=!0;for(let s=0;s<NR_COLS;s++)if(!this.chars[s].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(e){const s=this.pos+e;if(e>1)for(let o=this.pos+1;o<s+1;o++)this.chars[o].setPenState(this.currPenState);this.setCursor(s)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const s=getCharForByte(e);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+s+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(s,this.currPenState),this.moveCursor(1)}clearFromPos(e){let s;for(s=e;s<NR_COLS;s++)this.chars[s].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let s=!0;for(let o=0;o<NR_COLS;o++){const c=this.chars[o].uchar;c!==" "&&(s=!1),e.push(c)}return s?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(e){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let s=0;s<NR_ROWS;s++)this.rows.push(new Row(e));this.logger=e}reset(){for(let e=0;e<NR_ROWS;e++)this.rows[e].clear();this.currRow=NR_ROWS-1}equals(e){let s=!0;for(let o=0;o<NR_ROWS;o++)if(!this.rows[o].equals(e.rows[o])){s=!1;break}return s}copy(e){for(let s=0;s<NR_ROWS;s++)this.rows[s].copy(e.rows[s])}isEmpty(){let e=!0;for(let s=0;s<NR_ROWS;s++)if(!this.rows[s].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+stringify(e));let s=e.row-1;if(this.nrRollUpRows&&s<this.nrRollUpRows-1&&(s=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==s){for(let g=0;g<NR_ROWS;g++)this.rows[g].clear();const d=this.currRow+1-this.nrRollUpRows,h=this.lastOutputScreen;if(h){const g=h.rows[d].cueStartTime,_=this.logger.time;if(g!==null&&_!==null&&g<_)for(let b=0;b<this.nrRollUpRows;b++)this.rows[s-this.nrRollUpRows+b+1].copy(h.rows[d+b])}}this.currRow=s;const o=this.rows[this.currRow];if(e.indent!==null){const d=e.indent,h=Math.max(d-1,0);o.setCursor(e.indent),e.color=o.chars[h].penState.foreground}const c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,s=this.rows.splice(e,1)[0];s.clear(),this.rows.splice(this.currRow,0,s),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const s=[];let o="",c=-1;for(let d=0;d<NR_ROWS;d++){const h=this.rows[d].getTextString();h&&(c=d+1,e?s.push("Row "+c+": '"+h+"'"):s.push(h.trim()))}return s.length>0&&(e?o="["+s.join(" | ")+"]":o=s.join(`
`)),o}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(e,s,o){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=s,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(o),this.nonDisplayedMemory=new CaptionScreen(o),this.lastOutputScreen=new CaptionScreen(o),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=o}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let o=0;o<e.length;o++)this.writeScreen.insertChar(e[o]);const s=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>s+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const s={flash:!1};if(s.underline=e%2===1,s.italics=e>=46,s.italics)s.foreground="white";else{const o=Math.floor(e/2)-16,c=["white","green","blue","cyan","red","yellow","magenta"];s.foreground=c[o]}this.logger.log(2,"MIDROW: "+stringify(s)),this.writeScreen.setPen(s)}outputDataUpdate(e=!1){const s=this.logger.time;s!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=s:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,s,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:s),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Cea608Parser{constructor(e,s,o){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const c=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(e,s,c),new Cea608Channel(e+1,o,c)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,s){this.channels[e].setHandler(s)}addData(e,s){this.logger.time=e;for(let o=0;o<s.length;o+=2){const c=s[o]&127,d=s[o+1]&127;let h=!1,g=null;if(c===0&&d===0)continue;this.logger.log(3,()=>"["+numArrayToHexArray([s[o],s[o+1]])+"] -> ("+numArrayToHexArray([c,d])+")");const _=this.cmdHistory;if(c>=16&&c<=31){if(hasCmdRepeated(c,d,_)){setLastCmd(null,null,_),this.logger.log(3,()=>"Repeated command ("+numArrayToHexArray([c,d])+") is dropped");continue}setLastCmd(c,d,this.cmdHistory),h=this.parseCmd(c,d),h||(h=this.parseMidrow(c,d)),h||(h=this.parsePAC(c,d)),h||(h=this.parseBackgroundAttributes(c,d))}else setLastCmd(null,null,_);if(!h&&(g=this.parseChars(c,d),g)){const $=this.currentChannel;$&&$>0?this.channels[$].insertChars(g):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!h&&!g&&this.logger.log(2,()=>"Couldn't parse cleaned data "+numArrayToHexArray([c,d])+" orig: "+numArrayToHexArray([s[o],s[o+1]]))}}parseCmd(e,s){const o=(e===20||e===28||e===21||e===29)&&s>=32&&s<=47,c=(e===23||e===31)&&s>=33&&s<=35;if(!(o||c))return!1;const d=e===20||e===21||e===23?1:2,h=this.channels[d];return e===20||e===21||e===28||e===29?s===32?h.ccRCL():s===33?h.ccBS():s===34?h.ccAOF():s===35?h.ccAON():s===36?h.ccDER():s===37?h.ccRU(2):s===38?h.ccRU(3):s===39?h.ccRU(4):s===40?h.ccFON():s===41?h.ccRDC():s===42?h.ccTR():s===43?h.ccRTD():s===44?h.ccEDM():s===45?h.ccCR():s===46?h.ccENM():s===47&&h.ccEOC():h.ccTO(s-32),this.currentChannel=d,!0}parseMidrow(e,s){let o=0;if((e===17||e===25)&&s>=32&&s<=47){if(e===17?o=1:o=2,o!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const c=this.channels[o];return c?(c.ccMIDROW(s),this.logger.log(3,()=>"MIDROW ("+numArrayToHexArray([e,s])+")"),!0):!1}return!1}parsePAC(e,s){let o;const c=(e>=17&&e<=23||e>=25&&e<=31)&&s>=64&&s<=127,d=(e===16||e===24)&&s>=64&&s<=95;if(!(c||d))return!1;const h=e<=23?1:2;s>=64&&s<=95?o=h===1?rowsLowCh1[e]:rowsLowCh2[e]:o=h===1?rowsHighCh1[e]:rowsHighCh2[e];const g=this.channels[h];return g?(g.setPAC(this.interpretPAC(o,s)),this.currentChannel=h,!0):!1}interpretPAC(e,s){let o;const c={color:null,italics:!1,indent:null,underline:!1,row:e};return s>95?o=s-96:o=s-64,c.underline=(o&1)===1,o<=13?c.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(o/2)]:o<=15?(c.italics=!0,c.color="white"):c.indent=Math.floor((o-16)/2)*4,c}parseChars(e,s){let o,c=null,d=null;if(e>=25?(o=2,d=e-8):(o=1,d=e),d>=17&&d<=19){let h;d===17?h=s+80:d===18?h=s+112:h=s+144,this.logger.log(2,()=>"Special char '"+getCharForByte(h)+"' in channel "+o),c=[h]}else e>=32&&e<=127&&(c=s===0?[e]:[e,s]);return c&&this.logger.log(3,()=>"Char codes =  "+numArrayToHexArray(c).join(",")),c}parseBackgroundAttributes(e,s){const o=(e===16||e===24)&&s>=32&&s<=47,c=(e===23||e===31)&&s>=45&&s<=47;if(!(o||c))return!1;let d;const h={};e===16||e===24?(d=Math.floor((s-32)/2),h.background=backgroundColors[d],s%2===1&&(h.background=h.background+"_semi")):s===45?h.background="transparent":(h.foreground="black",s===47&&(h.underline=!0));const g=e<=23?1:2;return this.channels[g].setBkgData(h),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const s=this.channels[e];s&&s.reset()}setLastCmd(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let s=0;s<this.channels.length;s++){const o=this.channels[s];o&&o.cueSplitAtTime(e)}}}function setLastCmd(a,e,s){s.a=a,s.b=e}function hasCmdRepeated(a,e,s){return s.a===a&&s.b===e}function createCmdHistory(){return{a:null,b:null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function s(g,_){if(typeof _!="string"||!Array.isArray(g))return!1;const b=_.toLowerCase();return~g.indexOf(b)?b:!1}function o(g){return s(a,g)}function c(g){return s(e,g)}function d(g,..._){let b=1;for(;b<arguments.length;b++){const $=arguments[b];for(const j in $)g[j]=$[j]}return g}function h(g,_,b){const $=this,j={enumerable:!0};$.hasBeenReset=!1;let _e="",tt=!1,rt=g,nt=_,st=b,at=null,ot="",ut=!0,mt="auto",yt="start",Et=50,dt="middle",gt=50,St="middle";Object.defineProperty($,"id",d({},j,{get:function(){return _e},set:function(xt){_e=""+xt}})),Object.defineProperty($,"pauseOnExit",d({},j,{get:function(){return tt},set:function(xt){tt=!!xt}})),Object.defineProperty($,"startTime",d({},j,{get:function(){return rt},set:function(xt){if(typeof xt!="number")throw new TypeError("Start time must be set to a number.");rt=xt,this.hasBeenReset=!0}})),Object.defineProperty($,"endTime",d({},j,{get:function(){return nt},set:function(xt){if(typeof xt!="number")throw new TypeError("End time must be set to a number.");nt=xt,this.hasBeenReset=!0}})),Object.defineProperty($,"text",d({},j,{get:function(){return st},set:function(xt){st=""+xt,this.hasBeenReset=!0}})),Object.defineProperty($,"region",d({},j,{get:function(){return at},set:function(xt){at=xt,this.hasBeenReset=!0}})),Object.defineProperty($,"vertical",d({},j,{get:function(){return ot},set:function(xt){const Ct=o(xt);if(Ct===!1)throw new SyntaxError("An invalid or illegal string was specified.");ot=Ct,this.hasBeenReset=!0}})),Object.defineProperty($,"snapToLines",d({},j,{get:function(){return ut},set:function(xt){ut=!!xt,this.hasBeenReset=!0}})),Object.defineProperty($,"line",d({},j,{get:function(){return mt},set:function(xt){if(typeof xt!="number"&&xt!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");mt=xt,this.hasBeenReset=!0}})),Object.defineProperty($,"lineAlign",d({},j,{get:function(){return yt},set:function(xt){const Ct=c(xt);if(!Ct)throw new SyntaxError("An invalid or illegal string was specified.");yt=Ct,this.hasBeenReset=!0}})),Object.defineProperty($,"position",d({},j,{get:function(){return Et},set:function(xt){if(xt<0||xt>100)throw new Error("Position must be between 0 and 100.");Et=xt,this.hasBeenReset=!0}})),Object.defineProperty($,"positionAlign",d({},j,{get:function(){return dt},set:function(xt){const Ct=c(xt);if(!Ct)throw new SyntaxError("An invalid or illegal string was specified.");dt=Ct,this.hasBeenReset=!0}})),Object.defineProperty($,"size",d({},j,{get:function(){return gt},set:function(xt){if(xt<0||xt>100)throw new Error("Size must be between 0 and 100.");gt=xt,this.hasBeenReset=!0}})),Object.defineProperty($,"align",d({},j,{get:function(){return St},set:function(xt){const Ct=c(xt);if(!Ct)throw new SyntaxError("An invalid or illegal string was specified.");St=Ct,this.hasBeenReset=!0}})),$.displayState=void 0}return h.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},h}();class StringDecoder{decode(e,s){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function parseTimeStamp(a){function e(o,c,d,h){return(o|0)*3600+(c|0)*60+(d|0)+parseFloat(h||0)}const s=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?e(s[2],s[3],0,s[4]):e(s[1],s[2],s[3],s[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(e,s){!this.get(e)&&s!==""&&(this.values[e]=s)}get(e,s,o){return o?this.has(e)?this.values[e]:s[o]:this.has(e)?this.values[e]:s}has(e){return e in this.values}alt(e,s,o){for(let c=0;c<o.length;++c)if(s===o[c]){this.set(e,s);break}}integer(e,s){/^-?\d+$/.test(s)&&this.set(e,parseInt(s,10))}percent(e,s){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(s)){const o=parseFloat(s);if(o>=0&&o<=100)return this.set(e,o),!0}return!1}}function parseOptions(a,e,s,o){const c=o?a.split(o):[a];for(const d in c){if(typeof c[d]!="string")continue;const h=c[d].split(s);if(h.length!==2)continue;const g=h[0],_=h[1];e(g,_)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue(a,e,s){const o=a;function c(){const g=parseTimeStamp(a);if(g===null)throw new Error("Malformed timestamp: "+o);return a=a.replace(/^[^\sa-zA-Z-]+/,""),g}function d(g,_){const b=new Settings;parseOptions(g,function(_e,tt){let rt;switch(_e){case"region":for(let nt=s.length-1;nt>=0;nt--)if(s[nt].id===tt){b.set(_e,s[nt].region);break}break;case"vertical":b.alt(_e,tt,["rl","lr"]);break;case"line":rt=tt.split(","),b.integer(_e,rt[0]),b.percent(_e,rt[0])&&b.set("snapToLines",!1),b.alt(_e,rt[0],["auto"]),rt.length===2&&b.alt("lineAlign",rt[1],["start",center,"end"]);break;case"position":rt=tt.split(","),b.percent(_e,rt[0]),rt.length===2&&b.alt("positionAlign",rt[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":b.percent(_e,tt);break;case"align":b.alt(_e,tt,["start",center,"end","left","right"]);break}},/:/,/\s/),_.region=b.get("region",null),_.vertical=b.get("vertical","");let $=b.get("line","auto");$==="auto"&&defaults.line===-1&&($=-1),_.line=$,_.lineAlign=b.get("lineAlign","start"),_.snapToLines=b.get("snapToLines",!0),_.size=b.get("size",100),_.align=b.get("align",center);let j=b.get("position","auto");j==="auto"&&defaults.position===50&&(j=_.align==="start"||_.align==="left"?0:_.align==="end"||_.align==="right"?100:50),_.position=j}function h(){a=a.replace(/^\s+/,"")}if(h(),e.startTime=c(),h(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);a=a.slice(3),h(),e.endTime=c(),h(),d(a,e)}function fixLineBreaks(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const s=this;e&&(s.buffer+=s.decoder.decode(e,{stream:!0}));function o(){let d=s.buffer,h=0;for(d=fixLineBreaks(d);h<d.length&&d[h]!=="\r"&&d[h]!==`
`;)++h;const g=d.slice(0,h);return d[h]==="\r"&&++h,d[h]===`
`&&++h,s.buffer=d.slice(h),g}function c(d){parseOptions(d,function(h,g){},/:/)}try{let d="";if(s.state==="INITIAL"){if(!/\r\n|\n/.test(s.buffer))return this;d=o();const g=d.match(/^()?WEBVTT([ \t].*)?$/);if(!(g!=null&&g[0]))throw new Error("Malformed WebVTT signature.");s.state="HEADER"}let h=!1;for(;s.buffer;){if(!/\r\n|\n/.test(s.buffer))return this;switch(h?h=!1:d=o(),s.state){case"HEADER":/:/.test(d)?c(d):d||(s.state="ID");continue;case"NOTE":d||(s.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){s.state="NOTE";break}if(!d)continue;if(s.cue=new VTTCue(0,0,""),s.state="CUE",d.indexOf("-->")===-1){s.cue.id=d;continue}case"CUE":if(!s.cue){s.state="BADCUE";continue}try{parseCue(d,s.cue,s.regionList)}catch{s.cue=null,s.state="BADCUE";continue}s.state="CUETEXT";continue;case"CUETEXT":{const g=d.indexOf("-->")!==-1;if(!d||g&&(h=!0)){s.oncue&&s.cue&&s.oncue(s.cue),s.cue=null,s.state="ID";continue}if(s.cue===null)continue;s.cue.text&&(s.cue.text+=`
`),s.cue.text+=d}continue;case"BADCUE":d||(s.state="ID")}}}catch{s.state==="CUETEXT"&&s.cue&&s.oncue&&s.oncue(s.cue),s.cue=null,s.state=s.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(s){e.onparsingerror&&e.onparsingerror(s)}return e.onflush&&e.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function a(e,s,o=0){return e.slice(o,o+s.length)===s},cueString2millis=function a(e){let s=parseInt(e.slice(-3));const o=parseInt(e.slice(-6,-4)),c=parseInt(e.slice(-9,-7)),d=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!isFiniteNumber(s)||!isFiniteNumber(o)||!isFiniteNumber(c)||!isFiniteNumber(d))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return s+=1e3*o,s+=60*1e3*c,s+=60*60*1e3*d,s};function generateCueId(a,e,s){return hash(a.toString())+hash(e.toString())+hash(s)}const calculateOffset=function a(e,s,o){let c=e[s],d=e[c.prevCC];if(!d||!d.new&&c.new){e.ccOffset=e.presentationOffset=c.start,c.new=!1;return}for(;(h=d)!=null&&h.new;){var h;e.ccOffset+=c.start-d.start,c.new=!1,c=d,d=e[c.prevCC]}e.presentationOffset=o};function parseWebVTT(a,e,s,o,c,d,h){const g=new VTTParser,_=utf8ArrayToStr(new Uint8Array(a)).trim().replace(LINEBREAKS,`
`).split(`
`),b=[],$=e?toMpegTsClockFromTimescale(e.baseTime,e.timescale):0;let j="00:00.000",_e=0,tt=0,rt,nt=!0;g.oncue=function(st){const at=s[o];let ot=s.ccOffset;const ut=(_e-$)/9e4;if(at!=null&&at.new&&(tt!==void 0?ot=s.ccOffset=at.start:calculateOffset(s,o,ut)),ut){if(!e){rt=new Error("Missing initPTS for VTT MPEGTS");return}ot=ut-s.presentationOffset}const mt=st.endTime-st.startTime,yt=normalizePts((st.startTime+ot-tt)*9e4,c*9e4)/9e4;st.startTime=Math.max(yt,0),st.endTime=Math.max(yt+mt,0);const Et=st.text.trim();st.text=decodeURIComponent(encodeURIComponent(Et)),st.id||(st.id=generateCueId(st.startTime,st.endTime,Et)),st.endTime>0&&b.push(st)},g.onparsingerror=function(st){rt=st},g.onflush=function(){if(rt){h(rt);return}d(b)},_.forEach(st=>{if(nt)if(startsWith(st,"X-TIMESTAMP-MAP=")){nt=!1,st.slice(16).split(",").forEach(at=>{startsWith(at,"LOCAL:")?j=at.slice(6):startsWith(at,"MPEGTS:")&&(_e=parseInt(at.slice(7)))});try{tt=cueString2millis(j)/1e3}catch(at){rt=at}return}else st===""&&(nt=!1);g.parse(st+`
`)}),g.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(a,e,s,o){const c=findBox(new Uint8Array(a),["mdat"]);if(c.length===0){o(new Error("Could not parse IMSC1 mdat"));return}const d=c.map(g=>utf8ArrayToStr(g)),h=toTimescaleFromScale(e.baseTime,1,e.timescale);try{d.forEach(g=>s(parseTTML(g,h)))}catch(g){o(g)}}function parseTTML(a,e){const c=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!c)throw new Error("Invalid ttml");const d={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},h=Object.keys(d).reduce((j,_e)=>(j[_e]=c.getAttribute(`ttp:${_e}`)||d[_e],j),{}),g=c.getAttribute("xml:space")!=="preserve",_=collectionToDictionary(getElementCollection(c,"styling","style")),b=collectionToDictionary(getElementCollection(c,"layout","region")),$=getElementCollection(c,"body","[begin]");return[].map.call($,j=>{const _e=getTextContent(j,g);if(!_e||!j.hasAttribute("begin"))return null;const tt=parseTtmlTime(j.getAttribute("begin"),h),rt=parseTtmlTime(j.getAttribute("dur"),h);let nt=parseTtmlTime(j.getAttribute("end"),h);if(tt===null)throw timestampParsingError(j);if(nt===null){if(rt===null)throw timestampParsingError(j);nt=tt+rt}const st=new VTTCue(tt-e,nt-e,_e);st.id=generateCueId(st.startTime,st.endTime,st.text);const at=b[j.getAttribute("region")],ot=_[j.getAttribute("style")],ut=getTtmlStyles(at,ot,_),{textAlign:mt}=ut;if(mt){const yt=textAlignToLineAlign[mt];yt&&(st.lineAlign=yt),st.align=mt}return _extends(st,ut),st}).filter(j=>j!==null)}function getElementCollection(a,e,s){const o=a.getElementsByTagName(e)[0];return o?[].slice.call(o.querySelectorAll(s)):[]}function collectionToDictionary(a){return a.reduce((e,s)=>{const o=s.getAttribute("xml:id");return o&&(e[o]=s),e},{})}function getTextContent(a,e){return[].slice.call(a.childNodes).reduce((s,o,c)=>{var d;return o.nodeName==="br"&&c?s+`
`:(d=o.childNodes)!=null&&d.length?getTextContent(o,e):e?s+o.textContent.trim().replace(/\s+/g," "):s+o.textContent},"")}function getTtmlStyles(a,e,s){const o="http://www.w3.org/ns/ttml#styling";let c=null;const d=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],h=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return h&&s.hasOwnProperty(h)&&(c=s[h]),d.reduce((g,_)=>{const b=getAttributeNS(e,o,_)||getAttributeNS(a,o,_)||getAttributeNS(c,o,_);return b&&(g[_]=b),g},{})}function getAttributeNS(a,e,s){return a&&a.hasAttributeNS(e,s)?a.getAttributeNS(e,s):null}function timestampParsingError(a){return new Error(`Could not parse ttml timestamp ${a}`)}function parseTtmlTime(a,e){if(!a)return null;let s=parseTimeStamp(a);return s===null&&(HMSF_REGEX.test(a)?s=parseHoursMinutesSecondsFrames(a,e):TIME_UNIT_REGEX.test(a)&&(s=parseTimeUnits(a,e))),s}function parseHoursMinutesSecondsFrames(a,e){const s=HMSF_REGEX.exec(a),o=(s[4]|0)+(s[5]|0)/e.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+o/e.frameRate}function parseTimeUnits(a,e){const s=TIME_UNIT_REGEX.exec(a),o=Number(s[1]);switch(s[2]){case"h":return o*3600;case"m":return o*60;case"ms":return o*1e3;case"f":return o/e.frameRate;case"t":return o/e.tickRate}return o}class OutputFilter{constructor(e,s){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=s}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,s,o){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=s,this.screen=o,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class TimelineController{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Events.FRAG_LOADING,this.onFragLoading,this),e.on(Events.FRAG_LOADED,this.onFragLoaded,this),e.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Events.FRAG_LOADING,this.onFragLoading,this),e.off(Events.FRAG_LOADED,this.onFragLoaded,this),e.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new OutputFilter(this,"textTrack1"),s=new OutputFilter(this,"textTrack2"),o=new OutputFilter(this,"textTrack3"),c=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,e,s),this.cea608Parser2=new Cea608Parser(3,o,c)}addCues(e,s,o,c,d){let h=!1;for(let g=d.length;g--;){const _=d[g],b=intersection(_[0],_[1],s,o);if(b>=0&&(_[0]=Math.min(_[0],s),_[1]=Math.max(_[1],o),h=!0,b/(o-s)>.5))return}if(h||d.push([s,o]),this.config.renderTextTracksNatively){const g=this.captionsTracks[e];this.Cues.newCue(g,s,o,c)}else{const g=this.Cues.newCue(null,s,o,c);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:g,track:e})}}onInitPtsFound(e,{frag:s,id:o,initPTS:c,timescale:d,trackId:h}){const{unparsedVttFrags:g}=this;o===PlaylistLevelType.MAIN&&(this.initPTS[s.cc]={baseTime:c,timescale:d,trackId:h}),g.length&&(this.unparsedVttFrags=[],g.forEach(_=>{this.initPTS[_.frag.cc]?this.onFragLoaded(Events.FRAG_LOADED,_):this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:_.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,s){const{media:o}=this;if(o)for(let c=0;c<o.textTracks.length;c++){const d=o.textTracks[c];if(canReuseVttTextTrack(d,{name:e,lang:s,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return d}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:s,captionsTracks:o,media:c}=this,{label:d,languageCode:h}=s[e],g=this.getExistingTrack(d,h);if(g)o[e]=g,clearCurrentCues(o[e]),sendAddTrackEvent(o[e],c);else{const _=this.createTextTrack("captions",d,h);_&&(_[e]=!0,o[e]=_)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const s=this.captionsProperties[e];if(!s)return;const o=s.label,c={_id:e,label:o,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[e]=c,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[c]})}createTextTrack(e,s,o){const c=this.media;if(c)return c.addTextTrack(e,s,o)}onMediaAttaching(e,s){this.media=s.media,s.mediaSource||this._cleanTracks()}onMediaDetaching(e,s){const o=!!s.transferMedia;if(this.media=null,o)return;const{captionsTracks:c}=this;Object.keys(c).forEach(d=>{clearCurrentCues(c[d]),delete c[d]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const s=e.textTracks;if(s)for(let o=0;o<s.length;o++)clearCurrentCues(s[o])}onSubtitleTracksUpdated(e,s){const o=s.subtitleTracks||[],c=o.some(d=>d.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||c&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,o)){this.tracks=o;return}if(this.textTracks=[],this.tracks=o,this.config.renderTextTracksNatively){const h=this.media,g=h?filterSubtitleTracks(h.textTracks):null;if(this.tracks.forEach((_,b)=>{let $;if(g){let j=null;for(let _e=0;_e<g.length;_e++)if(g[_e]&&canReuseVttTextTrack(g[_e],_)){j=g[_e],g[_e]=null;break}j&&($=j)}if($)clearCurrentCues($);else{const j=captionsOrSubtitlesFromCharacteristics(_);$=this.createTextTrack(j,_.name,_.lang),$&&($.mode="disabled")}$&&this.textTracks.push($)}),g!=null&&g.length){const _=g.filter(b=>b!==null).map(b=>b.label);_.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${_.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const h=this.tracks.map(g=>({label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}}onManifestLoaded(e,s){this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(o=>{const c=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(!c)return;const d=`textTrack${c[1]}`,h=this.captionsProperties[d];h&&(h.label=o.name,o.lang&&(h.languageCode=o.lang),h.media=o)})}closedCaptionsForLevel(e){const s=this.hls.levels[e.level];return s==null?void 0:s.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,s){if(this.enabled&&s.frag.type===PlaylistLevelType.MAIN){var o,c;const{cea608Parser1:d,cea608Parser2:h,lastSn:g}=this,{cc:_,sn:b}=s.frag,$=(o=(c=s.part)==null?void 0:c.index)!=null?o:-1;d&&h&&(b!==g+1||b===g&&$!==this.lastPartIndex+1||_!==this.lastCc)&&(d.reset(),h.reset()),this.lastCc=_,this.lastSn=b,this.lastPartIndex=$}}onFragLoaded(e,s){const{frag:o,payload:c}=s;if(o.type===PlaylistLevelType.SUBTITLE)if(c.byteLength){const d=o.decryptdata,h="stats"in s;if(d==null||!d.encrypted||h){const g=this.tracks[o.level],_=this.vttCCs;_[o.cc]||(_[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),g&&g.textCodec===IMSC1_CODEC?this._parseIMSC1(o,c):this._parseVTTs(s)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,s){const o=this.hls;parseIMSC1(s,this.initPTS[e.cc],c=>{this._appendCues(c,e.level),o.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},c=>{o.logger.log(`Failed to parse IMSC1: ${c}`),o.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:c})})}_parseVTTs(e){var s;const{frag:o,payload:c}=e,{initPTS:d,unparsedVttFrags:h}=this,g=d.length-1;if(!d[o.cc]&&g===-1){h.push(e);return}const _=this.hls,b=(s=o.initSegment)!=null&&s.data?appendUint8Array(o.initSegment.data,new Uint8Array(c)).buffer:c;parseWebVTT(b,this.initPTS[o.cc],this.vttCCs,o.cc,o.start,$=>{this._appendCues($,o.level),_.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},$=>{const j=$.message==="Missing initPTS for VTT MPEGTS";j?h.push(e):this._fallbackToIMSC1(o,c),_.logger.log(`Failed to parse VTT cue: ${$}`),!(j&&g>o.cc)&&_.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:$})})}_fallbackToIMSC1(e,s){const o=this.tracks[e.level];o.textCodec||parseIMSC1(s,this.initPTS[e.cc],()=>{o.textCodec=IMSC1_CODEC,this._parseIMSC1(e,s)},()=>{o.textCodec="wvtt"})}_appendCues(e,s){const o=this.hls;if(this.config.renderTextTracksNatively){const c=this.textTracks[s];if(!c||c.mode==="disabled")return;e.forEach(d=>addCueToTrack(c,d))}else{const c=this.tracks[s];if(!c)return;const d=c.default?"default":"subtitles"+s;o.trigger(Events.CUES_PARSED,{type:"subtitles",cues:e,track:d})}}onFragDecrypted(e,s){const{frag:o}=s;o.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,s)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,s){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:o,samples:c}=s;if(!(o.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(o)==="NONE"))for(let d=0;d<c.length;d++){const h=c[d].bytes;if(h){this.cea608Parser1||this.initCea608Parsers();const g=this.extractCea608Data(h);this.cea608Parser1.addData(c[d].pts,g[0]),this.cea608Parser2.addData(c[d].pts,g[1])}}}onBufferFlushing(e,{startOffset:s,endOffset:o,endOffsetSubtitles:c,type:d}){const{media:h}=this;if(!(!h||h.currentTime<o)){if(!d||d==="video"){const{captionsTracks:g}=this;Object.keys(g).forEach(_=>removeCuesInRange(g[_],s,o))}if(this.config.renderTextTracksNatively&&s===0&&c!==void 0){const{textTracks:g}=this;Object.keys(g).forEach(_=>removeCuesInRange(g[_],s,c))}}}extractCea608Data(e){const s=[[],[]],o=e[0]&31;let c=2;for(let d=0;d<o;d++){const h=e[c++],g=127&e[c++],_=127&e[c++];if(g===0&&_===0)continue;if((4&h)!==0){const $=3&h;($===0||$===1)&&(s[$].push(g),s[$].push(_))}}return s}}function captionsOrSubtitlesFromCharacteristics(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(a,e){return!!a&&a.kind===captionsOrSubtitlesFromCharacteristics(e)&&subtitleTrackMatchesTextTrack(e,a)}function intersection(a,e,s,o){return Math.min(e,o)-Math.max(a,s)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const WHITESPACE_CHAR=/\s/,Cues={newCue(a,e,s,o){const c=[];let d,h,g,_,b;const $=self.VTTCue||self.TextTrackCue;for(let _e=0;_e<o.rows.length;_e++)if(d=o.rows[_e],g=!0,_=0,b="",!d.isEmpty()){var j;for(let nt=0;nt<d.chars.length;nt++)WHITESPACE_CHAR.test(d.chars[nt].uchar)&&g?_++:(b+=d.chars[nt].uchar,g=!1);d.cueStartTime=e,e===s&&(s+=1e-4),_>=16?_--:_++;const tt=fixLineBreaks(b.trim()),rt=generateCueId(e,s,tt);a!=null&&(j=a.cues)!=null&&j.getCueById(rt)||(h=new $(e,s,tt),h.id=rt,h.line=_e+1,h.align="left",h.position=10+Math.min(80,Math.floor(_*8/32)*10),c.push(h))}return a&&c.length&&(c.sort((_e,tt)=>_e.line==="auto"||tt.line==="auto"?0:_e.line>8&&tt.line>8?tt.line-_e.line:_e.line-tt.line),c.forEach(_e=>addCueToTrack(a,_e))),c}};function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,s,o){const c=this.stats;if(c.loading.start)throw new Error("Loader can only be used once.");c.loading.start=self.performance.now();const d=getRequestParameters(e,this.controller.signal),h=e.responseType==="arraybuffer",g=h?"byteLength":"length",{maxTimeToFirstByteMs:_,maxLoadTimeMs:b}=s.loadPolicy;this.context=e,this.config=s,this.callbacks=o,this.request=this.fetchSetup(e,d),self.clearTimeout(this.requestTimeout),s.timeout=_&&isFiniteNumber(_)?_:b,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(c,e,this.response))},s.timeout),(isPromise(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(j=>{var _e;this.response=this.loader=j;const tt=Math.max(self.performance.now(),c.loading.start);if(self.clearTimeout(this.requestTimeout),s.timeout=b,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(c,e,this.response))},b-(tt-c.loading.start)),!j.ok){const{status:nt,statusText:st}=j;throw new FetchError(st||"fetch, bad network response",nt,j)}c.loading.first=tt,c.total=getContentLength(j.headers)||c.total;const rt=(_e=this.callbacks)==null?void 0:_e.onProgress;return rt&&isFiniteNumber(s.highWaterMark)?this.loadProgressively(j,c,e,s.highWaterMark,rt):h?j.arrayBuffer():e.responseType==="json"?j.json():j.text()}).then(j=>{var _e,tt;const rt=this.response;if(!rt)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),c.loading.end=Math.max(self.performance.now(),c.loading.first);const nt=j[g];nt&&(c.loaded=c.total=nt);const st={url:rt.url,data:j,code:rt.status},at=(_e=this.callbacks)==null?void 0:_e.onProgress;at&&!isFiniteNumber(s.highWaterMark)&&at(c,e,j,rt),(tt=this.callbacks)==null||tt.onSuccess(st,c,e,rt)}).catch(j=>{var _e;if(self.clearTimeout(this.requestTimeout),c.aborted)return;const tt=j&&j.code||0,rt=j?j.message:null;(_e=this.callbacks)==null||_e.onError({code:tt,text:rt},e,j?j.details:null,c)})}getCacheAge(){let e=null;if(this.response){const s=this.response.headers.get("age");e=s?parseFloat(s):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,s,o,c=0,d){const h=new ChunkCache,g=e.body.getReader(),_=()=>g.read().then(b=>{if(b.done)return h.dataLength&&d(s,o,h.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const $=b.value,j=$.length;return s.loaded+=j,j<c||h.dataLength?(h.push($),h.dataLength>=c&&d(s,o,h.flush().buffer,e)):d(s,o,$.buffer,e),_()}).catch(()=>Promise.reject());return _()}}function getRequestParameters(a,e){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(_extends({},a.headers))};return a.rangeEnd&&s.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),s}function getByteRangeLength(a){const e=BYTERANGE.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function getContentLength(a){const e=a.get("Content-Range");if(e){const o=getByteRangeLength(e);if(isFiniteNumber(o))return o}const s=a.get("Content-Length");if(s)return parseInt(s)}function getRequest(a,e){return new self.Request(a.url,e)}class FetchError extends Error{constructor(e,s,o){super(e),this.code=void 0,this.details=void 0,this.code=s,this.details=o}}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,s,o){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=s,this.callbacks=o,this.loadInternal()}loadInternal(){const{config:e,context:s}=this;if(!e||!s)return;const o=this.loader=new self.XMLHttpRequest,c=this.stats;c.loading.first=0,c.loaded=0,c.aborted=!1;const d=this.xhrSetup;d?Promise.resolve().then(()=>{if(!(this.loader!==o||this.stats.aborted))return d(o,s.url)}).catch(h=>{if(!(this.loader!==o||this.stats.aborted))return o.open("GET",s.url,!0),d(o,s.url)}).then(()=>{this.loader!==o||this.stats.aborted||this.openAndSendXhr(o,s,e)}).catch(h=>{var g;(g=this.callbacks)==null||g.onError({code:o.status,text:h.message},s,o,c)}):this.openAndSendXhr(o,s,e)}openAndSendXhr(e,s,o){e.readyState||e.open("GET",s.url,!0);const c=s.headers,{maxTimeToFirstByteMs:d,maxLoadTimeMs:h}=o.loadPolicy;if(c)for(const g in c)e.setRequestHeader(g,c[g]);s.rangeEnd&&e.setRequestHeader("Range","bytes="+s.rangeStart+"-"+(s.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=s.responseType,self.clearTimeout(this.requestTimeout),o.timeout=d&&isFiniteNumber(d)?d:h,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),e.send()}readystatechange(){const{context:e,loader:s,stats:o}=this;if(!e||!s)return;const c=s.readyState,d=this.config;if(!o.aborted&&c>=2&&(o.loading.first===0&&(o.loading.first=Math.max(self.performance.now(),o.loading.start),d.timeout!==d.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),d.timeout=d.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),d.loadPolicy.maxLoadTimeMs-(o.loading.first-o.loading.start)))),c===4)){self.clearTimeout(this.requestTimeout),s.onreadystatechange=null,s.onprogress=null;const b=s.status,$=s.responseType==="text"?s.responseText:null;if(b>=200&&b<300){const rt=$??s.response;if(rt!=null){var h,g;o.loading.end=Math.max(self.performance.now(),o.loading.first);const nt=s.responseType==="arraybuffer"?rt.byteLength:rt.length;o.loaded=o.total=nt,o.bwEstimate=o.total*8e3/(o.loading.end-o.loading.first);const st=(h=this.callbacks)==null?void 0:h.onProgress;st&&st(o,e,rt,s);const at={url:s.responseURL,data:rt,code:b};(g=this.callbacks)==null||g.onSuccess(at,o,e,s);return}}const j=d.loadPolicy.errorRetry,_e=o.retry,tt={url:e.url,data:void 0,code:b};if(shouldRetry(j,_e,!1,tt))this.retry(j);else{var _;logger.error(`${b} while loading ${e.url}`),(_=this.callbacks)==null||_.onError({code:b,text:s.statusText},e,s,o)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,s=this.stats.retry;if(shouldRetry(e,s,!0))this.retry(e);else{var o;logger.warn(`timeout while loading ${(o=this.context)==null?void 0:o.url}`);const c=this.callbacks;c&&(this.abortInternal(),c.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:s,stats:o}=this;this.retryDelay=getRetryDelay(e,o.retry),o.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${s==null?void 0:s.url}, retrying ${o.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const s=this.stats;s.loaded=e.loaded,e.lengthComputable&&(s.total=e.total)}getCacheAge(){let e=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const s=this.loader.getResponseHeader("age");e=s?parseFloat(s):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController,interstitialsController:InterstitialsController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(a,e,s){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const o=deepCpy(a),c=["manifest","level","frag"],d=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return c.forEach(h=>{const g=`${h==="level"?"playlist":h}LoadPolicy`,_=e[g]===void 0,b=[];d.forEach($=>{const j=`${h}Loading${$}`,_e=e[j];if(_e!==void 0&&_){b.push(j);const tt=o[g].default;switch(e[g]={default:tt},$){case"TimeOut":tt.maxLoadTimeMs=_e,tt.maxTimeToFirstByteMs=_e;break;case"MaxRetry":tt.errorRetry.maxNumRetry=_e,tt.timeoutRetry.maxNumRetry=_e;break;case"RetryDelay":tt.errorRetry.retryDelayMs=_e,tt.timeoutRetry.retryDelayMs=_e;break;case"MaxRetryTimeout":tt.errorRetry.maxRetryDelayMs=_e,tt.timeoutRetry.maxRetryDelayMs=_e;break}}}),b.length&&s.warn(`hls.js config: "${b.join('", "')}" setting(s) are deprecated, use "${g}": ${stringify(e[g])}`)}),_objectSpread2(_objectSpread2({},o),e)}function deepCpy(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(deepCpy):Object.keys(a).reduce((e,s)=>(e[s]=deepCpy(a[s]),e),{}):a}function enableStreamingMode(a,e){const s=a.loader;s!==FetchLoader&&s!==XhrLoader?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):fetchSupported()&&(a.loader=FetchLoader,a.progressive=!0,a.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05,TICK_INTERVAL$1=100;class GapController extends TaskLoop{constructor(e,s){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var o;(o=this.media)!=null&&o.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var o;this.ended=((o=this.media)==null?void 0:o.currentTime)||1,this.hls.trigger(Events.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=s,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,s){this.setInterval(TICK_INTERVAL$1),this.mediaSource=s.mediaSource;const o=this.media=s.media;addEventListener$1(o,"playing",this.onMediaPlaying),addEventListener$1(o,"waiting",this.onMediaWaiting),addEventListener$1(o,"ended",this.onMediaEnded)}onMediaDetaching(e,s){this.clearInterval();const{media:o}=this;o&&(removeEventListener(o,"playing",this.onMediaPlaying),removeEventListener(o,"waiting",this.onMediaWaiting),removeEventListener(o,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,s){this.buffered=s.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const s=this.media.currentTime;this.poll(s,this.lastCurrentTime),this.lastCurrentTime=s}poll(e,s){var o,c;const d=(o=this.hls)==null?void 0:o.config;if(!d)return;const h=this.media;if(!h)return;const{seeking:g}=h,_=this.seeking&&!g,b=!this.seeking&&g,$=h.paused&&!g||h.ended||h.playbackRate===0;if(this.seeking=g,e!==s){s&&(this.ended=0),this.moved=!0,g||(this.nudgeRetry=0,d.nudgeOnVideoHole&&!$&&e>s&&this.nudgeOnVideoHole(e,s)),this.waiting===0&&this.stallResolved(e);return}if(b||_){_&&this.stallResolved(e);return}if($){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&h.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(Events.MEDIA_ENDED,{stalled:!1}));return}if(!BufferHelper.getBuffered(h).length){this.nudgeRetry=0;return}const j=BufferHelper.bufferInfo(h,e,0),_e=j.nextStart||0,tt=this.fragmentTracker;if(g&&tt&&this.hls){const Et=getInFlightDependency(this.hls.inFlightFragments,e),dt=j.len>MAX_START_GAP_JUMP,gt=!_e||Et||_e-e>MAX_START_GAP_JUMP&&!tt.getPartialFragment(e);if(dt||gt)return;this.moved=!1}const rt=(c=this.hls)==null?void 0:c.latestLevelDetails;if(!this.moved&&this.stalled!==null&&tt){if(!(j.len>0)&&!_e)return;const dt=Math.max(_e,j.start||0)-e,St=!!(rt!=null&&rt.live)?rt.targetduration*2:MAX_START_GAP_JUMP,xt=appendedFragAtPosition(e,tt);if(dt>0&&(dt<=St||xt)){h.paused||this._trySkipBufferHole(xt);return}}const nt=d.detectStallWithCurrentTimeMs,st=self.performance.now(),at=this.waiting;let ot=this.stalled;if(ot===null)if(at>0&&st-at<nt)ot=this.stalled=at;else{this.stalled=st;return}const ut=st-ot;if(!g&&(ut>=nt||at)&&this.hls){var mt;if(((mt=this.mediaSource)==null?void 0:mt.readyState)==="ended"&&!(rt!=null&&rt.live)&&Math.abs(e-((rt==null?void 0:rt.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(Events.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(j),!this.media||!this.hls)return}const yt=BufferHelper.bufferInfo(h,e,d.maxBufferHole);this._tryFixBufferStall(yt,ut,e)}stallResolved(e){const s=this.stalled;if(s&&this.hls&&(this.stalled=null,this.stallReported)){const o=self.performance.now()-s;this.log(`playback not stuck anymore @${e}, after ${Math.round(o)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(Events.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,s){var o;const c=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(o=this.buffered.audio)!=null&&o.length&&c&&c.length>1&&e>c.end(0)){const d=BufferHelper.bufferedInfo(BufferHelper.timeRangesToArray(this.buffered.audio),e,0);if(d.len>1&&s>=d.start){const h=BufferHelper.timeRangesToArray(c),g=BufferHelper.bufferedInfo(h,s,0).bufferedIndex;if(g>-1&&g<h.length-1){const _=BufferHelper.bufferedInfo(h,e,0).bufferedIndex,b=h[g].end,$=h[g+1].start;if((_===-1||_>g)&&$-b<1&&e-b<2){const j=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${b} -> ${$} buffered index: ${_}`);this.warn(j.message),this.media.currentTime+=1e-6;let _e=appendedFragAtPosition(e,this.fragmentTracker);_e&&"fragment"in _e?_e=_e.fragment:_e||(_e=void 0);const tt=BufferHelper.bufferInfo(this.media,e,0);this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:j,reason:j.message,frag:_e,buffer:tt.len,bufferInfo:tt})}}}}}_tryFixBufferStall(e,s,o){var c,d;const{fragmentTracker:h,media:g}=this,_=(c=this.hls)==null?void 0:c.config;if(!g||!h||!_)return;const b=(d=this.hls)==null?void 0:d.latestLevelDetails,$=appendedFragAtPosition(o,h);if(($||b!=null&&b.live&&o<b.fragmentStart)&&(this._trySkipBufferHole($)||!this.media))return;const j=e.buffered,_e=this.adjacentTraversal(e,o);(j&&j.length>1&&e.len>_.maxBufferHole||e.nextStart&&(e.nextStart-o<_.maxBufferHole||_e))&&(s>_.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,s){const o=this.fragmentTracker,c=e.nextStart;if(o&&c){const d=o.getFragAtPos(s,PlaylistLevelType.MAIN),h=o.getFragAtPos(c,PlaylistLevelType.MAIN);if(d&&h)return h.sn-d.sn<2}return!1}_reportStall(e){const{hls:s,media:o,stallReported:c,stalled:d}=this;if(!c&&d!==null&&o&&s){this.stallReported=!0;const h=new Error(`Playback stalling at @${o.currentTime} due to low buffer (${stringify(e)})`);this.warn(h.message),s.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:h,buffer:e.len,bufferInfo:e,stalled:{start:d}})}}_trySkipBufferHole(e){var s;const{fragmentTracker:o,media:c}=this,d=(s=this.hls)==null?void 0:s.config;if(!c||!o||!d)return 0;const h=c.currentTime,g=BufferHelper.bufferInfo(c,h,0),_=h<g.start?g.start:g.nextStart;if(_&&this.hls){const $=g.len<=d.maxBufferHole,j=g.len>0&&g.len<1&&c.readyState<3,_e=_-h;if(_e>0&&($||j)){if(_e>d.maxBufferHole){let rt=!1;if(h===0){const nt=o.getAppendedFrag(0,PlaylistLevelType.MAIN);nt&&_<nt.end&&(rt=!0)}if(!rt&&e){var b;if(!((b=this.hls.loadLevelObj)!=null&&b.details)||getInFlightDependency(this.hls.inFlightFragments,_))return 0;let st=!1,at=e.end;for(;at<_;){const ot=appendedFragAtPosition(at,o);if(ot)at+=ot.duration;else{st=!0;break}}if(st)return 0}}const tt=Math.max(_+SKIP_BUFFER_RANGE_START,h+SKIP_BUFFER_HOLE_STEP_SECONDS);if(this.warn(`skipping hole, adjusting currentTime from ${h} to ${tt}`),this.moved=!0,c.currentTime=tt,!(e!=null&&e.gap)){const rt=new Error(`fragment loaded with buffer holes, seeking from ${h} to ${tt}`),nt={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:rt,reason:rt.message,buffer:g.len,bufferInfo:g};e&&("fragment"in e?nt.part=e:nt.frag=e),this.hls.trigger(Events.ERROR,nt)}return tt}}return 0}_tryNudgeBuffer(e){const{hls:s,media:o,nudgeRetry:c}=this,d=s==null?void 0:s.config;if(!o||!d)return 0;const h=o.currentTime;if(this.nudgeRetry++,c<d.nudgeMaxRetry){const g=h+(c+1)*d.nudgeOffset,_=new Error(`Nudging 'currentTime' from ${h} to ${g}`);this.warn(_.message),o.currentTime=g,s.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:_,fatal:!1,buffer:e.len,bufferInfo:e})}else{const g=new Error(`Playhead still not moving while enough data buffered @${h} after ${d.nudgeMaxRetry} nudges`);this.error(g.message),s.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:g,fatal:!0,buffer:e.len,bufferInfo:e})}}}function getInFlightDependency(a,e){const s=inFlight(a.main);if(s&&s.start<=e)return s;const o=inFlight(a.audio);return o&&o.start<=e?o:null}function inFlight(a){if(!a)return null;switch(a.state){case State.IDLE:case State.STOPPED:case State.ENDED:case State.ERROR:return null}return a.frag}function appendedFragAtPosition(a,e){return e.getAppendedFrag(a,PlaylistLevelType.MAIN)||e.getPartialFragment(a)}const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(a,e,s,o,c){let d=new a(e,s,"");try{d.value=o,c&&(d.type=c)}catch{d=new a(e,s,stringify(c?_objectSpread2({type:c},o):o))}return d}const MAX_CUE_ENDTIME=(()=>{const a=getCueClass();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class ID3TrackController{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(Events.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Events.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Events.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,s){var o;this.media=s.media,((o=s.overrides)==null?void 0:o.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const s=(e=this.hls)==null?void 0:e.latestLevelDetails;s&&this.updateDateRangeCues(s)}onMediaDetaching(e,s){this.media=null,!s.transferMedia&&(this.id3Track&&(this.removeCues&&clearCurrentCues(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const s=this.getID3Track(e.textTracks);return s.mode="hidden",s}getID3Track(e){if(this.media){for(let s=0;s<e.length;s++){const o=e[s];if(o.kind==="metadata"&&o.label==="id3")return sendAddTrackEvent(o,this.media),o}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,s){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:o,enableID3MetadataCues:c}=this.hls.config;if(!o&&!c)return;const{samples:d}=s;this.id3Track||(this.id3Track=this.createTrack(this.media));const h=getCueClass();if(h)for(let g=0;g<d.length;g++){const _=d[g].type;if(_===MetadataSchema.emsg&&!o||!c)continue;const b=getId3Frames(d[g].data),$=d[g].pts;let j=$+d[g].duration;j>MAX_CUE_ENDTIME&&(j=MAX_CUE_ENDTIME),j-$<=0&&(j=$+MIN_CUE_DURATION);for(let tt=0;tt<b.length;tt++){const rt=b[tt];if(!isId3TimestampFrame(rt)){this.updateId3CueEnds($,_);const nt=createCueWithDataFields(h,$,j,rt,_);nt&&this.id3Track.addCue(nt)}}}}updateId3CueEnds(e,s){var o;const c=(o=this.id3Track)==null?void 0:o.cues;if(c)for(let d=c.length;d--;){const h=c[d];h.type===s&&h.startTime<e&&h.endTime===MAX_CUE_ENDTIME&&(h.endTime=e)}}onBufferFlushing(e,{startOffset:s,endOffset:o,type:c}){const{id3Track:d,hls:h}=this;if(!h)return;const{config:{enableEmsgMetadataCues:g,enableID3MetadataCues:_}}=h;if(d&&(g||_)){let b;c==="audio"?b=$=>$.type===MetadataSchema.audioId3&&_:c==="video"?b=$=>$.type===MetadataSchema.emsg&&g:b=$=>$.type===MetadataSchema.audioId3&&_||$.type===MetadataSchema.emsg&&g,removeCuesInRange(d,s,o,b)}}onLevelUpdated(e,{details:s}){this.updateDateRangeCues(s,!0)}onLevelPtsUpdated(e,s){Math.abs(s.drift)>.01&&this.updateDateRangeCues(s.details)}updateDateRangeCues(e,s){if(!this.hls||!this.media)return;const{assetPlayerId:o,timelineOffset:c,enableDateRangeMetadataCues:d,interstitialsController:h}=this.hls.config;if(!d)return;const g=getCueClass();if(o&&c&&!h){const{fragmentStart:nt,fragmentEnd:st}=e;let at=this.assetCue;at?(at.startTime=nt,at.endTime=st):g&&(at=this.assetCue=createCueWithDataFields(g,nt,st,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),at&&(at.id=o,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(at),at.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:_}=this,{dateRanges:b}=e,$=Object.keys(b);let j=this.dateRangeCuesAppended;if(_&&s){var _e;if((_e=_.cues)!=null&&_e.length){const nt=Object.keys(j).filter(st=>!$.includes(st));for(let st=nt.length;st--;){var tt;const at=nt[st],ot=(tt=j[at])==null?void 0:tt.cues;delete j[at],ot&&Object.keys(ot).forEach(ut=>{const mt=ot[ut];if(mt){mt.removeEventListener("enter",this.onEventCueEnter);try{_.removeCue(mt)}catch{}}})}}else j=this.dateRangeCuesAppended={}}const rt=e.fragments[e.fragments.length-1];if(!($.length===0||!isFiniteNumber(rt==null?void 0:rt.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let nt=0;nt<$.length;nt++){const st=$[nt],at=b[st],ot=at.startTime,ut=j[st],mt=(ut==null?void 0:ut.cues)||{};let yt=(ut==null?void 0:ut.durationKnown)||!1,Et=MAX_CUE_ENDTIME;const{duration:dt,endDate:gt}=at;if(gt&&dt!==null)Et=ot+dt,yt=!0;else if(at.endOnNext&&!yt){const xt=$.reduce((Ct,Ht)=>{if(Ht!==at.id){const Dt=b[Ht];if(Dt.class===at.class&&Dt.startDate>at.startDate&&(!Ct||at.startDate<Ct.startDate))return Dt}return Ct},null);xt&&(Et=xt.startTime,yt=!0)}const St=Object.keys(at.attr);for(let xt=0;xt<St.length;xt++){const Ct=St[xt];if(!isDateRangeCueAttribute(Ct))continue;const Ht=mt[Ct];if(Ht)yt&&!(ut!=null&&ut.durationKnown)?Ht.endTime=Et:Math.abs(Ht.startTime-ot)>.01&&(Ht.startTime=ot,Ht.endTime=Et);else if(g){let Dt=at.attr[Ct];isSCTE35Attribute(Ct)&&(Dt=hexToArrayBuffer(Dt));const er=createCueWithDataFields(g,ot,Et,{key:Ct,data:Dt},MetadataSchema.dateRange);er&&(er.id=st,this.id3Track.addCue(er),mt[Ct]=er,h&&(Ct==="X-ASSET-LIST"||Ct==="X-ASSET-URL")&&er.addEventListener("enter",this.onEventCueEnter))}}j[st]={cues:mt,dateRange:at,durationKnown:yt}}}}}class LatencyController{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:s}=this,o=this.levelDetails;if(!s||!o)return;this.currentTime=s.currentTime;const c=this.computeLatency();if(c===null)return;this._latency=c;const{lowLatencyMode:d,maxLiveSyncPlaybackRate:h}=this.config;if(!d||h===1||!o.live)return;const g=this.targetLatency;if(g===null)return;const _=c-g,b=Math.min(this.maxLatency,g+o.targetduration);if(_<b&&_>.05&&this.forwardBufferLength>1){const j=Math.min(2,Math.max(1,h)),_e=Math.round(2/(1+Math.exp(-.75*_-this.edgeStalled))*20)/20,tt=Math.min(j,Math.max(1,_e));this.changeMediaPlaybackRate(s,tt)}else s.playbackRate!==1&&s.playbackRate!==0&&this.changeMediaPlaybackRate(s,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const s=this.levelDetails;return s?e.liveMaxLatencyDurationCount*s.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:s,partHoldBack:o,targetduration:c}=e,{liveSyncDuration:d,liveSyncDurationCount:h,lowLatencyMode:g}=this.config,_=this.hls.userConfig;let b=g&&o||s;(this._targetLatencyUpdated||_.liveSyncDuration||_.liveSyncDurationCount||b===0)&&(b=d!==void 0?d:h*c);const $=c;return b+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,$)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),s=this.targetLatency;if(e===null||s===null)return null;const o=this.levelDetails;if(o===null)return null;const c=o.edge,d=e-s-this.edgeStalled,h=c-o.totalduration,g=c-(this.config.lowLatencyMode&&o.partTarget||o.targetduration);return Math.min(Math.max(h,d),g)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const s=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-s,0)}get forwardBufferLength(){const{media:e}=this,s=this.levelDetails;if(!e||!s)return 0;const o=e.buffered.length;return(o?e.buffered.end(o-1):s.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Events.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Events.ERROR,this.onError,this))}onMediaAttached(e,s){this.media=s.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:s}){s.advanced&&this.onTimeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,s){var o;s.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(o=this.levelDetails)!=null&&o.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,s){var o,c;e.playbackRate!==s&&((o=this.hls)==null||o.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(c=this.targetLatency)==null?void 0:c.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${s}`),e.playbackRate=s)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class LevelController extends BasePlaylistController{constructor(e,s){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=s,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(s=>{s.loadError=0,s.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,s){this.resetLevels()}onManifestLoaded(e,s){const o=this.hls.config.preferManagedMediaSource,c=[],d={},h={};let g=!1,_=!1,b=!1;s.levels.forEach($=>{const j=$.attrs;let{audioCodec:_e,videoCodec:tt}=$;_e&&($.audioCodec=_e=getCodecCompatibleName(_e,o)||void 0),tt&&(tt=$.videoCodec=convertAVC1ToAVCOTI(tt));const{width:rt,height:nt,unknownCodecs:st}=$,at=(st==null?void 0:st.length)||0;if(g||(g=!!(rt&&nt)),_||(_=!!tt),b||(b=!!_e),at||_e&&!this.isAudioSupported(_e)||tt&&!this.isVideoSupported(tt)){this.log(`Some or all CODECS not supported "${j.CODECS}"`);return}const{CODECS:ot,"FRAME-RATE":ut,"HDCP-LEVEL":mt,"PATHWAY-ID":yt,RESOLUTION:Et,"VIDEO-RANGE":dt}=j,St=`${`${yt||"."}-`}${$.bitrate}-${Et}-${ut}-${ot}-${dt}-${mt}`;if(d[St])if(d[St].uri!==$.url&&!$.attrs["PATHWAY-ID"]){const xt=h[St]+=1;$.attrs["PATHWAY-ID"]=new Array(xt+1).join(".");const Ct=this.createLevel($);d[St]=Ct,c.push(Ct)}else d[St].addGroupId("audio",j.AUDIO),d[St].addGroupId("text",j.SUBTITLES);else{const xt=this.createLevel($);d[St]=xt,h[St]=1,c.push(xt)}}),this.filterAndSortMediaOptions(c,s,g,_,b)}createLevel(e){const s=new Level(e),o=e.supplemental;if(o!=null&&o.videoCodec&&!this.isVideoSupported(o.videoCodec)){const c=new Error(`SUPPLEMENTAL-CODECS not supported "${o.videoCodec}"`);this.log(c.message),s.supportedResult=getUnsupportedResult(c,[])}return s}isAudioSupported(e){return areCodecsMediaSourceSupported(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return areCodecsMediaSourceSupported(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,s,o,c,d){var h;let g=[],_=[],b=e;const $=((h=s.stats)==null?void 0:h.parsing)||{};if((o||c)&&d&&(b=b.filter(({videoCodec:ot,videoRange:ut,width:mt,height:yt})=>(!!ot||!!(mt&&yt))&&isVideoRange(ut))),b.length===0){Promise.resolve().then(()=>{if(this.hls){let ot="no level with compatible codecs found in manifest",ut=ot;s.levels.length&&(ut=`one or more CODECS in variant not supported: ${stringify(s.levels.map(yt=>yt.attrs.CODECS).filter((yt,Et,dt)=>dt.indexOf(yt)===Et))}`,this.warn(ut),ot+=` (${ut})`);const mt=new Error(ot);this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,error:mt,reason:ut})}}),$.end=performance.now();return}s.audioTracks&&(g=s.audioTracks.filter(ot=>!ot.audioCodec||this.isAudioSupported(ot.audioCodec)),assignTrackIdsByGroup(g)),s.subtitles&&(_=s.subtitles,assignTrackIdsByGroup(_));const j=b.slice(0);b.sort((ot,ut)=>{if(ot.attrs["HDCP-LEVEL"]!==ut.attrs["HDCP-LEVEL"])return(ot.attrs["HDCP-LEVEL"]||"")>(ut.attrs["HDCP-LEVEL"]||"")?1:-1;if(o&&ot.height!==ut.height)return ot.height-ut.height;if(ot.frameRate!==ut.frameRate)return ot.frameRate-ut.frameRate;if(ot.videoRange!==ut.videoRange)return VideoRangeValues.indexOf(ot.videoRange)-VideoRangeValues.indexOf(ut.videoRange);if(ot.videoCodec!==ut.videoCodec){const mt=videoCodecPreferenceValue(ot.videoCodec),yt=videoCodecPreferenceValue(ut.videoCodec);if(mt!==yt)return yt-mt}if(ot.uri===ut.uri&&ot.codecSet!==ut.codecSet){const mt=codecsSetSelectionPreferenceValue(ot.codecSet),yt=codecsSetSelectionPreferenceValue(ut.codecSet);if(mt!==yt)return yt-mt}return ot.averageBitrate!==ut.averageBitrate?ot.averageBitrate-ut.averageBitrate:0});let _e=j[0];if(this.steering&&(b=this.steering.filterParsedLevels(b),b.length!==j.length)){for(let ot=0;ot<j.length;ot++)if(j[ot].pathwayId===b[0].pathwayId){_e=j[ot];break}}this._levels=b;for(let ot=0;ot<b.length;ot++)if(b[ot]===_e){var tt;this._firstLevel=ot;const ut=_e.bitrate,mt=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${b.length} level(s) found, first bitrate: ${ut}`),((tt=this.hls.userConfig)==null?void 0:tt.abrEwmaDefaultEstimate)===void 0){const yt=Math.min(ut,this.hls.config.abrEwmaDefaultEstimateMax);yt>mt&&mt===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=yt)}break}const rt=d&&!c,nt=this.hls.config,st=!!(nt.audioStreamController&&nt.audioTrackController),at={levels:b,audioTracks:g,subtitleTracks:_,sessionData:s.sessionData,sessionKeys:s.sessionKeys,firstLevel:this._firstLevel,stats:s.stats,audio:d,video:c,altAudio:st&&!rt&&g.some(ot=>!!ot.url)};$.end=performance.now(),this.hls.trigger(Events.MANIFEST_PARSED,at)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const s=this._levels;if(s.length===0)return;if(e<0||e>=s.length){const $=new Error("invalid level idx"),j=e<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:j,error:$,reason:$.message}),j)return;e=Math.min(e,s.length-1)}const o=this.currentLevelIndex,c=this.currentLevel,d=c?c.attrs["PATHWAY-ID"]:void 0,h=s[e],g=h.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=h,o===e&&c&&d===g)return;this.log(`Switching to level ${e} (${h.height?h.height+"p ":""}${h.videoRange?h.videoRange+" ":""}${h.codecSet?h.codecSet+" ":""}@${h.bitrate})${g?" with Pathway "+g:""} from level ${o}${d?" with Pathway "+d:""}`);const _={level:e,attrs:h.attrs,details:h.details,bitrate:h.bitrate,averageBitrate:h.averageBitrate,maxBitrate:h.maxBitrate,realBitrate:h.realBitrate,width:h.width,height:h.height,codecSet:h.codecSet,audioCodec:h.audioCodec,videoCodec:h.videoCodec,audioGroups:h.audioGroups,subtitleGroups:h.subtitleGroups,loaded:h.loaded,loadError:h.loadError,fragmentError:h.fragmentError,name:h.name,id:h.id,uri:h.uri,url:h.url,urlId:0,audioGroupIds:h.audioGroupIds,textGroupIds:h.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,_);const b=h.details;if(!b||b.live){const $=this.switchParams(h.uri,c==null?void 0:c.details,b);this.loadPlaylist($)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const s=this.steering.pathways(),o=e.filter(c=>s.indexOf(c)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${s}`);return}this.steering.pathwayPriority=o}}onError(e,s){s.fatal||!s.context||s.context.type===PlaylistContextType.LEVEL&&s.context.level===this.level&&this.checkRetry(s)}onFragBuffered(e,{frag:s}){if(s!==void 0&&s.type===PlaylistLevelType.MAIN){const o=s.elementaryStreams;if(!Object.keys(o).some(d=>!!o[d]))return;const c=this._levels[s.level];c!=null&&c.loadError&&(this.log(`Resetting level error count of ${c.loadError} on frag buffered`),c.loadError=0)}}onLevelLoaded(e,s){var o;const{level:c,details:d}=s,h=s.levelInfo;if(!h){var g;this.warn(`Invalid level index ${c}`),(g=s.deliveryDirectives)!=null&&g.skip&&(d.deltaUpdateFailed=!0);return}if(h===this.currentLevel||s.withoutMultiVariant){h.fragmentError===0&&(h.loadError=0);let _=h.details;_===s.details&&_.advanced&&(_=void 0),this.playlistLoaded(c,s,_)}else(o=s.deliveryDirectives)!=null&&o.skip&&(d.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,s){super.loadingPlaylist(e,s);const o=this.getUrlWithDirectives(e.uri,s),c=this.currentLevelIndex,d=e.attrs["PATHWAY-ID"],h=e.details,g=h==null?void 0:h.age;this.log(`Loading level index ${c}${(s==null?void 0:s.msn)!==void 0?" at sn "+s.msn+" part "+s.part:""}${d?" Pathway "+d:""}${g&&h.live?" age "+g.toFixed(1)+(h.type&&" "+h.type||""):""} ${o}`),this.hls.trigger(Events.LEVEL_LOADING,{url:o,level:c,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:s||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var s;if(this._levels.length===1)return;const o=this._levels.filter((d,h)=>h!==e?!0:(this.steering&&this.steering.removeLevel(d),d===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,d.details&&d.details.fragments.forEach(g=>g.level=-1)),!1));reassignFragmentLevelIndexes(o),this._levels=o,this.currentLevelIndex>-1&&(s=this.currentLevel)!=null&&s.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const c=o.length-1;this._firstLevel=Math.min(this._firstLevel,c),this._startLevel&&(this._startLevel=Math.min(this._startLevel,c)),this.hls.trigger(Events.LEVELS_UPDATED,{levels:o})}onLevelsUpdated(e,{levels:s}){this._levels=s}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:s,maxHdcpLevel:o}=this.hls;this._maxAutoLevel!==s&&(this._maxAutoLevel=s,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:s,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:o}))}}function assignTrackIdsByGroup(a){const e={};a.forEach(s=>{const o=s.groupId||"";s.id=e[o]=e[o]||0,e[o]++})}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const e=getSourceBuffer();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const a=getMediaSource();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>a.isTypeSupported(mimeTypeForCodec(e,"video")))||["mp4a.40.2","fLaC"].some(e=>a.isTypeSupported(mimeTypeForCodec(e,"audio"))))}function changeTypeSupported(){var a;const e=getSourceBuffer();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(e,s,o){super(e,s,o,"stream-controller",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const c=this.media,d=c?c.currentTime:null;if(d===null||!isFiniteNumber(d)||(this.log(`Media seeked to ${d.toFixed(3)}`),!this.getBufferedFrag(d)))return;const h=this.getFwdBufferInfoAtPos(c,d,PlaylistLevelType.MAIN,0);if(h===null||h.len===0){this.warn(`Main forward buffer length at ${d} on "seeked" event ${h?h.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,s){if(this.levels){const{lastCurrentTime:o,hls:c}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let d=c.startLevel;d===-1&&(c.config.testBandwidth&&this.levels.length>1?(d=0,this.bitrateTest=!0):d=c.firstAutoLevel),c.nextLoadLevel=d,this.level=c.loadLevel,this._hasEnoughToStart=!!s}o>0&&e===-1&&!s&&(this.log(`Override startPosition with lastCurrentTime @${o.toFixed(3)}`),e=o),this.state=State.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=s?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:e,level:s}=this,o=e==null?void 0:e[s],c=o==null?void 0:o.details;if(c&&(!c.live||this.levelLastLoaded===o&&!this.waitForLive(o))){if(this.waitForCdnTuneIn(c))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:s,levels:o,media:c}=this;if(s===null||!c&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const d=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(o!=null&&o[d]))return;const h=o[d],g=this.getMainFwdBufferInfo();if(g===null)return;const _=this.getLevelDetails();if(_&&this._streamEnded(g,_)){const nt={};this.altAudio===2&&(nt.type="video"),this.hls.trigger(Events.BUFFER_EOS,nt),this.state=State.ENDED;return}if(!this.buffering)return;e.loadLevel!==d&&e.manualLevel===-1&&this.log(`Adapting to level ${d} from level ${this.level}`),this.level=e.nextLoadLevel=d;const b=h.details;if(!b||this.state===State.WAITING_LEVEL||this.waitForLive(h)){this.level=d,this.state=State.WAITING_LEVEL,this.startFragRequested=!1;return}const $=g.len,j=this.getMaxBufferLength(h.maxBitrate);if($>=j)return;this.backtrackFragment&&this.backtrackFragment.start>g.end&&(this.backtrackFragment=null);const _e=this.backtrackFragment?this.backtrackFragment.start:g.end;let tt=this.getNextFragment(_e,b);if(this.couldBacktrack&&!this.fragPrevious&&tt&&isMediaFragment(tt)&&this.fragmentTracker.getState(tt)!==FragmentState.OK){var rt;const st=((rt=this.backtrackFragment)!=null?rt:tt).sn-b.startSN,at=b.fragments[st-1];at&&tt.cc===at.cc&&(tt=at,this.fragmentTracker.removeFragment(at))}else this.backtrackFragment&&g.len&&(this.backtrackFragment=null);if(tt&&this.isLoopLoading(tt,_e)){if(!tt.gap){const st=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,at=(st===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;at&&this.afterBufferFlushed(at,st,PlaylistLevelType.MAIN)}tt=this.getNextFragmentLoopLoading(tt,b,g,PlaylistLevelType.MAIN,j)}tt&&(tt.initSegment&&!tt.initSegment.data&&!this.bitrateTest&&(tt=tt.initSegment),this.loadFragment(tt,h,_e))}loadFragment(e,s,o){const c=this.fragmentTracker.getState(e);c===FragmentState.NOT_LOADED||c===FragmentState.PARTIAL?isMediaFragment(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,s)):super.loadFragment(e,s,o):this._loadInitSegment(e,s):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,PlaylistLevelType.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:s}=this;if(s!=null&&s.readyState){let o;const c=this.getAppendedFrag(s.currentTime);c&&c.start>1&&this.flushMainBuffer(0,c.start-1);const d=this.getLevelDetails();if(d!=null&&d.live){const g=this.getMainFwdBufferInfo();if(!g||g.len<d.targetduration*2)return}if(!s.paused&&e){const g=this.hls.nextLoadLevel,_=e[g],b=this.fragLastKbps;b&&this.fragCurrent?o=this.fragCurrent.duration*_.maxBitrate/(1e3*b)+1:o=0}else o=0;const h=this.getBufferedFrag(s.currentTime+o);if(h){const g=this.followingBufferedFrag(h);if(g){this.abortCurrentFrag();const _=g.maxStartPTS?g.maxStartPTS:g.start,b=g.duration,$=Math.max(h.end,_+Math.min(Math.max(b-this.config.maxFragLookUpTolerance,b*(this.couldBacktrack?.5:.125)),b*(this.couldBacktrack?.75:.25)));this.flushMainBuffer($,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,s){super.flushMainBuffer(e,s,this.altAudio===2?"video":null)}onMediaAttached(e,s){super.onMediaAttached(e,s);const o=s.media;addEventListener$1(o,"playing",this.onMediaPlaying),addEventListener$1(o,"seeked",this.onMediaSeeked)}onMediaDetaching(e,s){const{media:o}=this;o&&(removeEventListener(o,"playing",this.onMediaPlaying),removeEventListener(o,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,s),!s.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,s){let o=!1,c=!1;for(let d=0;d<s.levels.length;d++){const h=s.levels[d].audioCodec;h&&(o=o||h.indexOf("mp4a.40.2")!==-1,c=c||h.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=o&&c&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1}onLevelLoading(e,s){const{levels:o}=this;if(!o||this.state!==State.IDLE)return;const c=s.levelInfo;(!c.details||c.details.live&&(this.levelLastLoaded!==c||c.details.expired)||this.waitForCdnTuneIn(c.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(e,s){var o;const{levels:c,startFragRequested:d}=this,h=s.level,g=s.details,_=g.totalduration;if(!c){this.warn(`Levels were reset while loading level ${h}`);return}this.log(`Level ${h} loaded [${g.startSN},${g.endSN}]${g.lastPartSn?`[part-${g.lastPartSn}-${g.lastPartIndex}]`:""}, cc [${g.startCC}, ${g.endCC}] duration:${_}`);const b=s.levelInfo,$=this.fragCurrent;$&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&$.level!==s.level&&$.loader&&this.abortCurrentFrag();let j=0;if(g.live||(o=b.details)!=null&&o.live){var _e;if(this.checkLiveUpdate(g),g.deltaUpdateFailed)return;j=this.alignPlaylists(g,b.details,(_e=this.levelLastLoaded)==null?void 0:_e.details)}if(b.details=g,this.levelLastLoaded=b,d||this.setStartPosition(g,j),this.hls.trigger(Events.LEVEL_UPDATED,{details:g,level:h}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(g))return;this.state=State.IDLE}d&&g.live&&this.synchronizeToLiveEdge(g),this.tick()}synchronizeToLiveEdge(e){const{config:s,media:o}=this;if(!o)return;const c=this.hls.liveSyncPosition,d=this.getLoadPosition(),h=e.fragmentStart,g=e.edge,_=d>=h-s.maxFragLookUpTolerance&&d<=g;if(c!==null&&o.duration>c&&(d<c||!_)){const $=s.liveMaxLatencyDuration!==void 0?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if((!_&&o.readyState<4||d<g-$)&&(this._hasEnoughToStart||(this.nextLoadPosition=c),o.readyState))if(this.warn(`Playback: ${d.toFixed(3)} is located too far from the end of live sliding playlist: ${g}, reset currentTime to : ${c.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var b;const j=BufferHelper.bufferInfo(o,c,0);if(!((b=j.buffered)!=null&&b.length)){o.currentTime=c;return}if(j.start<=d){o.currentTime=c;return}const{nextStart:tt}=BufferHelper.bufferedInfo(j.buffered,d,0);tt&&(o.currentTime=tt)}else o.currentTime=c}}_handleFragmentLoadProgress(e){var s;const o=e.frag,{part:c,payload:d}=e,{levels:h}=this;if(!h){this.warn(`Levels were reset while fragment load was in progress. Fragment ${o.sn} of level ${o.level} will not be buffered`);return}const g=h[o.level];if(!g){this.warn(`Level ${o.level} not found on progress`);return}const _=g.details;if(!_){this.warn(`Dropping fragment ${o.sn} of level ${o.level} after level details were reset`),this.fragmentTracker.removeFragment(o);return}const b=g.videoCodec,$=_.PTSKnown||!_.live,j=(s=o.initSegment)==null?void 0:s.data,_e=this._getAudioCodec(g),tt=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),rt=c?c.index:-1,nt=rt!==-1,st=new ChunkMetadata(o.level,o.sn,o.stats.chunkCount,d.byteLength,rt,nt),at=this.initPTS[o.cc];tt.push(d,j,_e,b,o,c,_.totalduration,$,st,at)}onAudioTrackSwitching(e,s){const o=this.hls,c=this.altAudio!==0;if(useAlternateAudio(s.url,o))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const h=this.fragCurrent;h&&(this.log("Switching to main audio track, cancel main fragment load"),h.abortRequests(),this.fragmentTracker.removeFragment(h)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(c){this.altAudio=0,this.fragmentTracker.removeAllFragments(),o.once(Events.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,s)}),o.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}o.trigger(Events.AUDIO_TRACK_SWITCHED,s)}}onAudioTrackSwitched(e,s){const o=useAlternateAudio(s.url,this.hls);if(o){const c=this.videoBuffer;c&&this.mediaBuffer!==c&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=c)}this.altAudio=o?2:0,this.tick()}onBufferCreated(e,s){const o=s.tracks;let c,d,h=!1;for(const g in o){const _=o[g];if(_.id==="main"){if(d=g,c=_,g==="video"){const b=o[g];b&&(this.videoBuffer=b.buffer)}}else h=!0}h&&c?(this.log(`Alternate track found, use ${d}.buffered to schedule main fragment loading`),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media}onFragBuffered(e,s){const{frag:o,part:c}=s,d=o.type===PlaylistLevelType.MAIN;if(d){if(this.fragContextChanged(o)){this.warn(`Fragment ${o.sn}${c?" p: "+c.index:""} of level ${o.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const g=c?c.stats:o.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),isMediaFragment(o)&&(this.fragPrevious=o),this.fragBufferedComplete(o,c)}const h=this.media;h&&(!this._hasEnoughToStart&&BufferHelper.getBuffered(h).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),d&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,s){var o;if(s.fatal){this.state=State.ERROR;return}switch(s.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,s);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!s.levelRetry&&this.state===State.WAITING_LEVEL&&((o=s.context)==null?void 0:o.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:if(s.parent!=="main")return;this.reduceLengthAndFlushBuffer(s)&&this.resetLoadingState();break;case ErrorDetails.BUFFER_FULL_ERROR:if(s.parent!=="main")return;this.reduceLengthAndFlushBuffer(s)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(s);break}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:s}){if(s!==ElementaryStreamTypes.AUDIO||!this.altAudio){const o=(s===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;o&&(this.afterBufferFlushed(o,s,PlaylistLevelType.MAIN),this.tick())}}onLevelsUpdated(e,s){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=s.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const s=e.currentTime;let o=this.startPosition;if(o>=0&&s<o){if(e.seeking){this.log(`could not seek to ${o}, already seeking at ${s}`);return}const c=this.timelineOffset;c&&o&&(o+=c);const d=this.getLevelDetails(),h=BufferHelper.getBuffered(e),g=h.length?h.start(0):0,_=g-o,b=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||_>0&&(_<b||this.loadingParts&&_<2*((d==null?void 0:d.partTarget)||0)))&&(this.log(`adjusting start position by ${_} to match buffer start`),o+=_,this.startPosition=o),s<o&&(this.log(`seek to target start position ${o} from current time ${s} buffer start ${g}`),e.currentTime=o)}}_getAudioCodec(e){let s=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s}_loadBitrateTestFrag(e,s){e.bitrateTest=!0,this._doFragLoad(e,s).then(o=>{const{hls:c}=this,d=o==null?void 0:o.frag;if(!d||this.fragContextChanged(d))return;s.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const h=d.stats;h.parsing.start=h.parsing.end=h.buffering.start=h.buffering.end=self.performance.now(),c.trigger(Events.FRAG_LOADED,o),d.bitrateTest=!1}).catch(o=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(o),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const s=this.playlistType,{hls:o}=this,{remuxResult:c,chunkMeta:d}=e,h=this.getCurrentContext(d);if(!h){this.resetWhenMissingContext(d);return}const{frag:g,part:_,level:b}=h,{video:$,text:j,id3:_e,initSegment:tt}=c,{details:rt}=b,nt=this.altAudio?void 0:c.audio;if(this.fragContextChanged(g)){this.fragmentTracker.removeFragment(g);return}if(this.state=State.PARSING,tt){const st=tt.tracks;if(st){const mt=g.initSegment||g;if(this.unhandledEncryptionError(tt,g))return;this._bufferInitSegment(b,st,mt,d),o.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:mt,id:s,tracks:st})}const at=tt.initPTS,ot=tt.timescale,ut=this.initPTS[g.cc];if(isFiniteNumber(at)&&(!ut||ut.baseTime!==at||ut.timescale!==ot)){const mt=tt.trackId;this.initPTS[g.cc]={baseTime:at,timescale:ot,trackId:mt},o.trigger(Events.INIT_PTS_FOUND,{frag:g,id:s,initPTS:at,timescale:ot,trackId:mt})}}if($&&rt){nt&&$.type==="audiovideo"&&this.logMuxedErr(g);const st=rt.fragments[g.sn-1-rt.startSN],at=g.sn===rt.startSN,ot=!st||g.cc>st.cc;if(c.independent!==!1){const{startPTS:ut,endPTS:mt,startDTS:yt,endDTS:Et}=$;if(_)_.elementaryStreams[$.type]={startPTS:ut,endPTS:mt,startDTS:yt,endDTS:Et};else if($.firstKeyFrame&&$.independent&&d.id===1&&!ot&&(this.couldBacktrack=!0),$.dropped&&$.independent){const dt=this.getMainFwdBufferInfo(),gt=(dt?dt.end:this.getLoadPosition())+this.config.maxBufferHole,St=$.firstKeyFramePTS?$.firstKeyFramePTS:ut;if(!at&&gt<St-this.config.maxBufferHole&&!ot){this.backtrack(g);return}else ot&&(g.gap=!0);g.setElementaryStreamInfo($.type,g.start,mt,g.start,Et,!0)}else at&&ut-(rt.appliedTimelineOffset||0)>MAX_START_GAP_JUMP&&(g.gap=!0);g.setElementaryStreamInfo($.type,ut,mt,yt,Et),this.backtrackFragment&&(this.backtrackFragment=g),this.bufferFragmentData($,g,_,d,at||ot)}else if(at||ot)g.gap=!0;else{this.backtrack(g);return}}if(nt){const{startPTS:st,endPTS:at,startDTS:ot,endDTS:ut}=nt;_&&(_.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:st,endPTS:at,startDTS:ot,endDTS:ut}),g.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,st,at,ot,ut),this.bufferFragmentData(nt,g,_,d)}if(rt&&_e!=null&&_e.samples.length){const st={id:s,frag:g,details:rt,samples:_e.samples};o.trigger(Events.FRAG_PARSING_METADATA,st)}if(rt&&j){const st={id:s,frag:g,details:rt,samples:j.samples};o.trigger(Events.FRAG_PARSING_USERDATA,st)}}logMuxedErr(e){this.warn(`${isMediaFragment(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,s,o,c){if(this.state!==State.PARSING)return;this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&(delete s.audio,s.audiovideo&&this.logMuxedErr(o));const{audio:d,video:h,audiovideo:g}=s;if(d){const b=e.audioCodec;let $=pickMostCompleteCodecName(d.codec,b);$==="mp4a"&&($="mp4a.40.5");const j=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){$&&($.indexOf("mp4a.40.5")!==-1?$="mp4a.40.2":$="mp4a.40.5");const _e=d.metadata;_e&&"channelCount"in _e&&(_e.channelCount||1)!==1&&j.indexOf("firefox")===-1&&($="mp4a.40.5")}$&&$.indexOf("mp4a.40.5")!==-1&&j.indexOf("android")!==-1&&d.container!=="audio/mpeg"&&($="mp4a.40.2",this.log(`Android: force audio codec to ${$}`)),b&&b!==$&&this.log(`Swapping manifest audio codec "${b}" for "${$}"`),d.levelCodec=$,d.id=PlaylistLevelType.MAIN,this.log(`Init audio buffer, container:${d.container}, codecs[selected/level/parsed]=[${$||""}/${b||""}/${d.codec}]`),delete s.audiovideo}if(h){h.levelCodec=e.videoCodec,h.id=PlaylistLevelType.MAIN;const b=h.codec;if((b==null?void 0:b.length)===4)switch(b){case"hvc1":case"hev1":h.codec="hvc1.1.6.L120.90";break;case"av01":h.codec="av01.0.04M.08";break;case"avc1":h.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${h.container}, codecs[level/parsed]=[${e.videoCodec||""}/${b}]${h.codec!==b?" parsed-corrected="+h.codec:""}${h.supplemental?" supplemental="+h.supplemental:""}`),delete s.audiovideo}g&&(this.log(`Init audiovideo buffer, container:${g.container}, codecs[level/parsed]=[${e.codecs}/${g.codec}]`),delete s.video,delete s.audio);const _=Object.keys(s);if(_.length){if(this.hls.trigger(Events.BUFFER_CODECS,s),!this.hls)return;_.forEach(b=>{const j=s[b].initSegment;j!=null&&j.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:b,data:j,frag:o,part:null,chunkMeta:c,parent:o.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,PlaylistLevelType.MAIN)}get maxBufferLength(){const{levels:e,level:s}=this,o=e==null?void 0:e[s];return o?this.getMaxBufferLength(o.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=State.IDLE}checkFragmentChanged(){const e=this.media;let s=null;if(e&&e.readyState>1&&e.seeking===!1){const o=e.currentTime;if(BufferHelper.isBuffered(e,o)?s=this.getAppendedFrag(o):BufferHelper.isBuffered(e,o+.1)&&(s=this.getAppendedFrag(o+.1)),s){this.backtrackFragment=null;const c=this.fragPlaying,d=s.level;(!c||s.sn!==c.sn||c.level!==d)&&(this.fragPlaying=s,this.hls.trigger(Events.FRAG_CHANGED,{frag:s}),(!c||c.level!==d)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:d}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const s=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return isFiniteNumber(s)?this.getAppendedFrag(s):null}get currentProgramDateTime(){var e;const s=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(isFiniteNumber(s)){const o=this.getLevelDetails(),c=this.currentFrag||(o?findFragmentByPTS(null,o.fragments,s):null);if(c){const d=c.programDateTime;if(d!==null){const h=d+(s-c.start)*1e3;return new Date(h)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class KeyLoader extends Logger{constructor(e,s){super("key-loader",s),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const o in this.keyIdToKeyInfo){const c=this.keyIdToKeyInfo[o].loader;if(c){var s;if(e&&e!==((s=c.context)==null?void 0:s.frag.type))return;c.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[e];(s.mediaKeySessionContext||s.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[e].loader;s&&s.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,s=ErrorDetails.KEY_LOAD_ERROR,o,c,d){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:s,fatal:!1,frag:e,response:d,error:o,networkDetails:c})}loadClear(e,s,o){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(s.length)for(let c=0,d=s.length;c<d;c++){const h=s[c];if(e.cc<=h.cc&&(!isMediaFragment(e)||!isMediaFragment(h)||e.sn<h.sn)||!o&&c==d-1)return this.emeController.selectKeySystemFormat(h).then(g=>{if(!this.emeController)return;h.setKeyFormat(g);const _=keySystemFormatToKeySystemDomain(g);if(_)return this.emeController.getKeySystemAccess([_])})}if(this.config.requireKeySystemAccessOnStart){const c=getKeySystemsForConfig(this.config);if(c.length)return this.emeController.getKeySystemAccess(c)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(s=>this.loadInternal(e,s)):this.loadInternal(e)}loadInternal(e,s){var o,c;s&&e.setKeyFormat(s);const d=e.decryptdata;if(!d){const b=new Error(s?`Expected frag.decryptdata to be defined after setting format ${s}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,b))}const h=d.uri;if(!h)return Promise.reject(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${h}"`)));const g=getKeyId(d);let _=this.keyIdToKeyInfo[g];if((o=_)!=null&&o.decryptdata.key)return d.key=_.decryptdata.key,Promise.resolve({frag:e,keyInfo:_});if(this.emeController&&(c=_)!=null&&c.keyLoadPromise)switch(this.emeController.getKeyStatus(_.decryptdata)){case"usable":case"usable-in-future":return _.keyLoadPromise.then($=>{const{keyInfo:j}=$;return d.key=j.decryptdata.key,{frag:e,keyInfo:j}})}switch(this.log(`${this.keyIdToKeyInfo[g]?"Rel":"L"}oading${d.keyId?" keyId: "+arrayToHex(d.keyId):""} URI: ${d.uri} from ${e.type} ${e.level}`),_=this.keyIdToKeyInfo[g]={decryptdata:d,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},d.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return d.keyFormat==="identity"?this.loadKeyHTTP(_,e):this.loadKeyEME(_,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(_,e);default:return Promise.reject(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${d.method}"`)))}}loadKeyEME(e,s){const o={frag:s,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var c;if(!e.decryptdata.keyId&&(c=s.initSegment)!=null&&c.data){const h=parseKeyIdsFromTenc(s.initSegment.data);if(h.length){let g=h[0];g.some(_=>_!==0)?(this.log(`Using keyId found in init segment ${arrayToHex(g)}`),LevelKey.setKeyIdForUri(e.decryptdata.uri,g)):(g=LevelKey.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${arrayToHex(g)}`)),e.decryptdata.keyId=g}}if(!e.decryptdata.keyId&&!isMediaFragment(s))return Promise.resolve(o);const d=this.emeController.loadKey(o);return(e.keyLoadPromise=d.then(h=>(e.mediaKeySessionContext=h,o))).catch(h=>{throw e.keyLoadPromise=null,"data"in h&&(h.data.frag=s),h})}return Promise.resolve(o)}loadKeyHTTP(e,s){const o=this.config,c=o.loader,d=new c(o);return s.keyLoader=e.loader=d,e.keyLoadPromise=new Promise((h,g)=>{const _={keyInfo:e,frag:s,responseType:"arraybuffer",url:e.decryptdata.uri},b=o.keyLoadPolicy.default,$={loadPolicy:b,timeout:b.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},j={onSuccess:(_e,tt,rt,nt)=>{const{frag:st,keyInfo:at}=rt,ot=getKeyId(at.decryptdata);if(!st.decryptdata||at!==this.keyIdToKeyInfo[ot])return g(this.createKeyLoadError(st,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),nt));at.decryptdata.key=st.decryptdata.key=new Uint8Array(_e.data),st.keyLoader=null,at.loader=null,h({frag:st,keyInfo:at})},onError:(_e,tt,rt,nt)=>{this.resetLoader(tt),g(this.createKeyLoadError(s,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${_e.code} loading key ${_e.text}`),rt,_objectSpread2({url:_.url,data:void 0},_e)))},onTimeout:(_e,tt,rt)=>{this.resetLoader(tt),g(this.createKeyLoadError(s,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),rt))},onAbort:(_e,tt,rt)=>{this.resetLoader(tt),g(this.createKeyLoadError(s,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),rt))}};d.load(_,$,j)})}resetLoader(e){const{frag:s,keyInfo:o,url:c}=e,d=o.loader;s.keyLoader===d&&(s.keyLoader=null,o.loader=null);const h=getKeyId(o.decryptdata)||c;delete this.keyIdToKeyInfo[h],d&&d.destroy()}}function getKeyId(a){if(a.keyFormat!==KeySystemFormats.FAIRPLAY){const e=a.keyId;if(e)return arrayToHex(e)}return a.uri}function mapContextToLevelType(a){const{type:e}=a;switch(e){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(a,e){let s=a.url;return(s===void 0||s.indexOf("data:")===0)&&(s=e.url),s}class PlaylistLoader{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const s=this.hls.config,o=s.pLoader,c=s.loader,d=o||c,h=new d(s);return this.loaders[e.type]=h,h}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const s=this.loaders[e];s&&s.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,s){const{url:o}=s;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:o,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,s){const{id:o,level:c,pathwayId:d,url:h,deliveryDirectives:g,levelInfo:_}=s;this.load({id:o,level:c,pathwayId:d,responseType:"text",type:PlaylistContextType.LEVEL,url:h,deliveryDirectives:g,levelOrTrack:_})}onAudioTrackLoading(e,s){const{id:o,groupId:c,url:d,deliveryDirectives:h,track:g}=s;this.load({id:o,groupId:c,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:d,deliveryDirectives:h,levelOrTrack:g})}onSubtitleTrackLoading(e,s){const{id:o,groupId:c,url:d,deliveryDirectives:h,track:g}=s;this.load({id:o,groupId:c,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:d,deliveryDirectives:h,levelOrTrack:g})}onLevelsUpdated(e,s){const o=this.loaders[PlaylistContextType.LEVEL];if(o){const c=o.context;c&&!s.levels.some(d=>d===c.levelOrTrack)&&(o.abort(),delete this.loaders[PlaylistContextType.LEVEL])}}load(e){var s;const o=this.hls.config;let c=this.getInternalLoader(e);if(c){const b=this.hls.logger,$=c.context;if($&&$.levelOrTrack===e.levelOrTrack&&($.url===e.url||$.deliveryDirectives&&!e.deliveryDirectives)){$.url===e.url?b.log(`[playlist-loader]: ignore ${e.url} ongoing request`):b.log(`[playlist-loader]: ignore ${e.url} in favor of ${$.url}`);return}b.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),c.abort()}let d;if(e.type===PlaylistContextType.MANIFEST?d=o.manifestLoadPolicy.default:d=_extends({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),c=this.createInternalLoader(e),isFiniteNumber((s=e.deliveryDirectives)==null?void 0:s.part)){let b;if(e.type===PlaylistContextType.LEVEL&&e.level!==null?b=this.hls.levels[e.level].details:e.type===PlaylistContextType.AUDIO_TRACK&&e.id!==null?b=this.hls.audioTracks[e.id].details:e.type===PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(b=this.hls.subtitleTracks[e.id].details),b){const $=b.partTarget,j=b.targetduration;if($&&j){const _e=Math.max($*3,j*.8)*1e3;d=_extends({},d,{maxTimeToFirstByteMs:Math.min(_e,d.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(_e,d.maxTimeToFirstByteMs)})}}}const h=d.errorRetry||d.timeoutRetry||{},g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},_={onSuccess:(b,$,j,_e)=>{const tt=this.getInternalLoader(j);this.resetInternalLoader(j.type);const rt=b.data;$.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(rt)||j.type!==PlaylistContextType.MANIFEST?this.handleTrackOrLevelPlaylist(b,$,j,_e||null,tt):this.handleMasterPlaylist(b,$,j,_e)},onError:(b,$,j,_e)=>{this.handleNetworkError($,j,!1,b,_e)},onTimeout:(b,$,j)=>{this.handleNetworkError($,j,!0,void 0,b)}};c.load(e,g,_)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:s},forceStartLoad:o}=this.hls;(e||o)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${s}`),this.hls.startLoad(s))}handleMasterPlaylist(e,s,o,c){const d=this.hls,h=e.data,g=getResponseUrl(e,o),_=M3U8Parser.parseMasterPlaylist(h,g);if(_.playlistParsingError){s.parsing.end=performance.now(),this.handleManifestParsingError(e,o,_.playlistParsingError,c,s);return}const{contentSteering:b,levels:$,sessionData:j,sessionKeys:_e,startTimeOffset:tt,variableList:rt}=_;this.variableList=rt,$.forEach(ot=>{const{unknownCodecs:ut}=ot;if(ut){const{preferManagedMediaSource:mt}=this.hls.config;let{audioCodec:yt,videoCodec:Et}=ot;for(let dt=ut.length;dt--;){const gt=ut[dt];areCodecsMediaSourceSupported(gt,"audio",mt)?(ot.audioCodec=yt=yt?`${yt},${gt}`:gt,sampleEntryCodesISO.audio[yt.substring(0,4)]=2,ut.splice(dt,1)):areCodecsMediaSourceSupported(gt,"video",mt)&&(ot.videoCodec=Et=Et?`${Et},${gt}`:gt,sampleEntryCodesISO.video[Et.substring(0,4)]=2,ut.splice(dt,1))}}});const{AUDIO:nt=[],SUBTITLES:st,"CLOSED-CAPTIONS":at}=M3U8Parser.parseMasterPlaylistMedia(h,g,_);nt.length&&!nt.some(ut=>!ut.url)&&$[0].audioCodec&&!$[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),nt.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),d.trigger(Events.MANIFEST_LOADED,{levels:$,audioTracks:nt,subtitles:st,captions:at,contentSteering:b,url:g,stats:s,networkDetails:c,sessionData:j,sessionKeys:_e,startTimeOffset:tt,variableList:rt})}handleTrackOrLevelPlaylist(e,s,o,c,d){const h=this.hls,{id:g,level:_,type:b}=o,$=getResponseUrl(e,o),j=isFiniteNumber(_)?_:isFiniteNumber(g)?g:0,_e=mapContextToLevelType(o),tt=M3U8Parser.parseLevelPlaylist(e.data,$,j,_e,0,this.variableList);if(b===PlaylistContextType.MANIFEST){const rt={attrs:new AttrList({}),bitrate:0,details:tt,name:"",url:$};tt.requestScheduled=s.loading.start+computeReloadInterval(tt,0),h.trigger(Events.MANIFEST_LOADED,{levels:[rt],audioTracks:[],url:$,stats:s,networkDetails:c,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}s.parsing.end=performance.now(),o.levelDetails=tt,this.handlePlaylistLoaded(tt,e,s,o,c,d)}handleManifestParsingError(e,s,o,c,d){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===PlaylistContextType.MANIFEST,url:e.url,err:o,error:o,reason:o.message,response:e,context:s,networkDetails:c,stats:d})}handleNetworkError(e,s,o=!1,c,d){let h=`A network ${o?"timeout":"error"+(c?" (status "+c.code+")":"")} occurred while loading ${e.type}`;e.type===PlaylistContextType.LEVEL?h+=`: ${e.level} id: ${e.id}`:(e.type===PlaylistContextType.AUDIO_TRACK||e.type===PlaylistContextType.SUBTITLE_TRACK)&&(h+=` id: ${e.id} group-id: "${e.groupId}"`);const g=new Error(h);this.hls.logger.warn(`[playlist-loader]: ${h}`);let _=ErrorDetails.UNKNOWN,b=!1;const $=this.getInternalLoader(e);switch(e.type){case PlaylistContextType.MANIFEST:_=o?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,b=!0;break;case PlaylistContextType.LEVEL:_=o?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,b=!1;break;case PlaylistContextType.AUDIO_TRACK:_=o?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,b=!1;break;case PlaylistContextType.SUBTITLE_TRACK:_=o?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,b=!1;break}$&&this.resetInternalLoader(e.type);const j={type:ErrorTypes.NETWORK_ERROR,details:_,fatal:b,url:e.url,loader:$,context:e,error:g,networkDetails:s,stats:d};if(c){const _e=(s==null?void 0:s.url)||e.url;j.response=_objectSpread2({url:_e,data:void 0},c)}this.hls.trigger(Events.ERROR,j)}handlePlaylistLoaded(e,s,o,c,d,h){const g=this.hls,{type:_,level:b,levelOrTrack:$,id:j,groupId:_e,deliveryDirectives:tt}=c,rt=getResponseUrl(s,c),nt=mapContextToLevelType(c);let st=typeof c.level=="number"&&nt===PlaylistLevelType.MAIN?b:void 0;const at=e.playlistParsingError;if(at){if(this.hls.logger.warn(`${at} ${e.url}`),!g.config.ignorePlaylistParsingErrors){g.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:rt,error:at,reason:at.message,response:s,context:c,level:st,parent:nt,networkDetails:d,stats:o});return}e.playlistParsingError=null}if(!e.fragments.length){const ot=e.playlistParsingError=new Error("No Segments found in Playlist");g.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:rt,error:ot,reason:ot.message,response:s,context:c,level:st,parent:nt,networkDetails:d,stats:o});return}switch(e.live&&h&&(h.getCacheAge&&(e.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),_){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:if(st){if(!$)st=0;else if($!==g.levels[st]){const ot=g.levels.indexOf($);ot>-1&&(st=ot)}}g.trigger(Events.LEVEL_LOADED,{details:e,levelInfo:$||g.levels[0],level:st||0,id:j||0,stats:o,networkDetails:d,deliveryDirectives:tt,withoutMultiVariant:_===PlaylistContextType.MANIFEST});break;case PlaylistContextType.AUDIO_TRACK:g.trigger(Events.AUDIO_TRACK_LOADED,{details:e,track:$,id:j||0,groupId:_e||"",stats:o,networkDetails:d,deliveryDirectives:tt});break;case PlaylistContextType.SUBTITLE_TRACK:g.trigger(Events.SUBTITLE_TRACK_LOADED,{details:e,track:$,id:j||0,groupId:_e||"",stats:o,networkDetails:d,deliveryDirectives:tt});break}}}class Hls{static get version(){return version}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get MetadataSchema(){return MetadataSchema}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(e){Hls.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const s=this.logger=enableLogs(e.debug||!1,"Hls instance",e.assetPlayerId),o=this.config=mergeConfig(Hls.DefaultConfig,e,s);this.userConfig=e,o.progressive&&enableStreamingMode(o,s);const{abrController:c,bufferController:d,capLevelController:h,errorController:g,fpsController:_}=o,b=new g(this),$=this.abrController=new c(this),j=new FragmentTracker(this),_e=o.interstitialsController,tt=_e?this.interstitialsController=new _e(this,Hls):null,rt=this.bufferController=new d(this,j),nt=this.capLevelController=new h(this),st=new _(this),at=new PlaylistLoader(this),ot=o.contentSteeringController,ut=ot?new ot(this):null,mt=this.levelController=new LevelController(this,ut),yt=new ID3TrackController(this),Et=new KeyLoader(this.config,this.logger),dt=this.streamController=new StreamController(this,j,Et),gt=this.gapController=new GapController(this,j);nt.setStreamController(dt),st.setStreamController(dt);const St=[at,mt,dt];tt&&St.splice(1,0,tt),ut&&St.splice(1,0,ut),this.networkControllers=St;const xt=[$,rt,gt,nt,st,yt,j];this.audioTrackController=this.createController(o.audioTrackController,St);const Ct=o.audioStreamController;Ct&&St.push(this.audioStreamController=new Ct(this,j,Et)),this.subtitleTrackController=this.createController(o.subtitleTrackController,St);const Ht=o.subtitleStreamController;Ht&&St.push(this.subtititleStreamController=new Ht(this,j,Et)),this.createController(o.timelineController,xt),Et.emeController=this.emeController=this.createController(o.emeController,xt),this.cmcdController=this.createController(o.cmcdController,xt),this.latencyController=this.createController(LatencyController,xt),this.coreComponents=xt,St.push(b);const Dt=b.onErrorOut;typeof Dt=="function"&&this.on(Events.ERROR,Dt,b),this.on(Events.MANIFEST_LOADED,at.onManifestLoaded,at)}createController(e,s){if(e){const o=new e(this);return s&&s.push(o),o}return null}on(e,s,o=this){this._emitter.on(e,s,o)}once(e,s,o=this){this._emitter.once(e,s,o)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,s,o=this,c){this._emitter.off(e,s,o,c)}listeners(e){return this._emitter.listeners(e)}emit(e,s,o){return this._emitter.emit(e,s,o)}trigger(e,s){if(this.config.debug)return this.emit(e,e,s);try{return this.emit(e,e,s)}catch(o){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+o.message+'". Here is a stacktrace:',o),!this.triggeringException){this.triggeringException=!0;const c=e===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:c,event:e,error:o}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(s=>s.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(s=>s.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const d=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.ATTACH_MEDIA_ERROR,fatal:!0,error:d});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const s="media"in e,o=s?e.media:e,c=s?e:{media:o};this._media=o,this.trigger(Events.MEDIA_ATTACHING,c)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(Events.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const s=this.media,o=this._url,c=this._url=urlToolkitExports.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${c}`),s&&o&&(o!==c||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(s)),this.trigger(Events.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,s){this.logger.log(`startLoad(${e+(s?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let o=0;o<this.networkControllers.length&&(this.networkControllers[o].startLoad(e,s),!(!this.started||!this.networkControllers));o++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[PlaylistLevelType.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[PlaylistLevelType.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[PlaylistLevelType.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,s=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),s&&this.startLoad(s))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=uuid()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const s=!!e;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){isHdcpLevel(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:s}}=this;if(!e)return 0;const o=e.length;for(let c=0;c<o;c++)if(e[c].maxBitrate>=s)return c;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:s,maxHdcpLevel:o}=this;let c;if(s===-1&&e!=null&&e.length?c=e.length-1:c=s,o)for(let d=c;d--;){const h=e[d].attrs["HDCP-LEVEL"];if(h&&h<=o)return d}return c}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var s;return((s=this.audioTrackController)==null?void 0:s.setAudioOption(e))||null}setSubtitleOption(e){var s;return((s=this.subtitleTrackController)==null?void 0:s.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const s=this.audioTrackController;s&&(s.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const s=this.subtitleTrackController;s&&(s.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const s=this.subtitleTrackController;s&&(s.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,s=this.allAudioTracks){const o=getAudioTracksByGroup(s);return getMediaDecodingInfoPromise(e,o,navigator.mediaCapabilities)}}Hls.defaultConfig=void 0;const AudioController=()=>{const a=reactExports.useRef(new Audio),e=reactExports.useRef(null),{currentSong:s,isPlaying:o,volume:c,setIsPlaying:d,nextSong:h,setCurrentTime:g,setDuration:_,currentTime:b}=usePlayerStore();return reactExports.useEffect(()=>{const $=a.current;if(!s){$.pause(),$.src="",e.current&&(e.current.destroy(),e.current=null);return}return(async()=>{let _e="";if(s.url)_e=s.url;else if(s.fileHandle)try{const tt=await s.fileHandle.getFile();_e=URL.createObjectURL(tt)}catch(tt){console.error("Failed to load file",tt)}if(_e)if(e.current&&(e.current.destroy(),e.current=null),Hls.isSupported()&&(_e.includes(".m3u8")||s.isRadio)){const tt=new Hls;e.current=tt,tt.loadSource(_e),tt.attachMedia($),tt.on(Hls.Events.MANIFEST_PARSED,()=>{o&&$.play().catch(rt=>console.warn("Autoplay prevented",rt))}),tt.on(Hls.Events.ERROR,function(rt,nt){if(nt.fatal)switch(nt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered, try to recover"),tt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered, try to recover"),tt.recoverMediaError();break;default:tt.destroy();break}})}else $.canPlayType("application/vnd.apple.mpegurl")&&(_e.includes(".m3u8")||s.isRadio)?($.src=_e,o&&$.play().catch(tt=>console.warn("Autoplay prevented",tt))):($.src!==_e&&($.src=_e,$.load()),o&&$.play().catch(tt=>console.warn("Autoplay prevented",tt)))})(),()=>{}},[s]),reactExports.useEffect(()=>{const $=a.current;o?$.paused&&$.src&&$.play().catch(()=>{}):$.paused||$.pause()},[o]),reactExports.useEffect(()=>{a.current.volume=c},[c]),reactExports.useEffect(()=>{const $=a.current;Math.abs($.currentTime-b)>1&&($.currentTime=b)},[b]),reactExports.useEffect(()=>{const $=a.current,j=()=>{$.paused||g($.currentTime)},_e=()=>{_($.duration)},tt=()=>{d(!1),h()};return $.addEventListener("timeupdate",j),$.addEventListener("loadedmetadata",_e),$.addEventListener("ended",tt),()=>{$.removeEventListener("timeupdate",j),$.removeEventListener("loadedmetadata",_e),$.removeEventListener("ended",tt)}},[h,d,g,_]),null};function App(){const{isFullScreen:a,currentView:e}=usePlayerStore(),s=()=>{switch(e){case"home":return jsxRuntimeExports.jsx(SearchPage,{});case"radio":return jsxRuntimeExports.jsx(RadioView,{});case"albums":return jsxRuntimeExports.jsx(AlbumsView,{});case"library":default:return jsxRuntimeExports.jsx(SongList,{})}};return jsxRuntimeExports.jsxs("div",{className:"flex h-screen w-full bg-black text-white overflow-hidden font-sans selection:bg-pink-500 selection:text-white",children:[jsxRuntimeExports.jsx(AudioController,{}),jsxRuntimeExports.jsx(Sidebar,{}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col relative min-w-0",children:[s(),jsxRuntimeExports.jsx(PlayerBar,{})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:a&&jsxRuntimeExports.jsx(motion.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed inset-0 z-[100]",children:jsxRuntimeExports.jsx(FullScreenPlayer,{})})})]})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
